var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs($){return $&&$.__esModule&&Object.prototype.hasOwnProperty.call($,"default")?$.default:$}var _3Dmol={exports:{}};/*!
 * 3dmol v2.0.3
 * JavaScript/TypeScript molecular visualization library
 * Author: David Koes and contributors
 */(function(module,exports){(function(T,f){module.exports=f()})(commonjsGlobal,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js":($,T,f)=>{f.r(T),f.d(T,{IOBuffer:()=>v});var w=f("./node_modules/iobuffer/lib-esm/text.browser.js");const S=1024*8,O=(()=>{const _=new Uint8Array(4),L=new Uint32Array(_.buffer);return!((L[0]=1)&_[0])})(),P={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class v{constructor(L=S,g={}){let M=!1;typeof L=="number"?L=new ArrayBuffer(L):(M=!0,this.lastWrittenByte=L.byteLength);const x=g.offset?g.offset>>>0:0,p=L.byteLength-x;let y=x;(ArrayBuffer.isView(L)||L instanceof v)&&(L.byteLength!==L.buffer.byteLength&&(y=L.byteOffset+x),L=L.buffer),M?this.lastWrittenByte=p:this.lastWrittenByte=0,this.buffer=L,this.length=p,this.byteLength=p,this.byteOffset=y,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,y,p),this._mark=0,this._marks=[]}available(L=1){return this.offset+L<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(L=1){return this.offset+=L,this}back(L=1){return this.offset-=L,this}seek(L){return this.offset=L,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const L=this._marks.pop();if(L===void 0)throw new Error("Mark stack empty");return this.seek(L),this}rewind(){return this.offset=0,this}ensureAvailable(L=1){if(!this.available(L)){const M=(this.offset+L)*2,x=new Uint8Array(M);x.set(new Uint8Array(this.buffer)),this.buffer=x.buffer,this.length=this.byteLength=M,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(L=1){return this.readArray(L,"uint8")}readArray(L,g){const M=P[g].BYTES_PER_ELEMENT*L,x=this.byteOffset+this.offset,p=this.buffer.slice(x,x+M);if(this.littleEndian===O&&g!=="uint8"&&g!=="int8"){const e=new Uint8Array(this.buffer.slice(x,x+M));e.reverse();const r=new P[g](e.buffer);return this.offset+=M,r.reverse(),r}const y=new P[g](p);return this.offset+=M,y}readInt16(){const L=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,L}readUint16(){const L=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,L}readInt32(){const L=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,L}readUint32(){const L=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,L}readFloat32(){const L=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,L}readFloat64(){const L=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,L}readBigInt64(){const L=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,L}readBigUint64(){const L=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,L}readChar(){return String.fromCharCode(this.readInt8())}readChars(L=1){let g="";for(let M=0;M<L;M++)g+=this.readChar();return g}readUtf8(L=1){return(0,w.decode)(this.readBytes(L))}decodeText(L=1,g="utf-8"){return(0,w.decode)(this.readBytes(L),g)}writeBoolean(L){return this.writeUint8(L?255:0),this}writeInt8(L){return this.ensureAvailable(1),this._data.setInt8(this.offset++,L),this._updateLastWrittenByte(),this}writeUint8(L){return this.ensureAvailable(1),this._data.setUint8(this.offset++,L),this._updateLastWrittenByte(),this}writeByte(L){return this.writeUint8(L)}writeBytes(L){this.ensureAvailable(L.length);for(let g=0;g<L.length;g++)this._data.setUint8(this.offset++,L[g]);return this._updateLastWrittenByte(),this}writeInt16(L){return this.ensureAvailable(2),this._data.setInt16(this.offset,L,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(L){return this.ensureAvailable(2),this._data.setUint16(this.offset,L,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(L){return this.ensureAvailable(4),this._data.setInt32(this.offset,L,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(L){return this.ensureAvailable(4),this._data.setUint32(this.offset,L,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(L){return this.ensureAvailable(4),this._data.setFloat32(this.offset,L,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(L){return this.ensureAvailable(8),this._data.setFloat64(this.offset,L,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(L){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,L,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(L){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,L,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(L){return this.writeUint8(L.charCodeAt(0))}writeChars(L){for(let g=0;g<L.length;g++)this.writeUint8(L.charCodeAt(g));return this}writeUtf8(L){return this.writeBytes((0,w.encode)(L))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},"./node_modules/iobuffer/lib-esm/text-encoding-polyfill.js":function(){(function($){if($.TextEncoder&&$.TextDecoder)return!1;function T(w="utf-8"){if(w!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${w}') is invalid.`)}Object.defineProperty(T.prototype,"encoding",{value:"utf-8"}),T.prototype.encode=function(w,S={stream:!1}){if(S.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let O=0;const P=w.length;let v=0,_=Math.max(32,P+(P>>1)+7),L=new Uint8Array(_>>3<<3);for(;O<P;){let g=w.charCodeAt(O++);if(g>=55296&&g<=56319){if(O<P){const M=w.charCodeAt(O);(M&64512)===56320&&(++O,g=((g&1023)<<10)+(M&1023)+65536)}if(g>=55296&&g<=56319)continue}if(v+4>L.length){_+=8,_*=1+O/w.length*2,_=_>>3<<3;const M=new Uint8Array(_);M.set(L),L=M}if(g&4294967168)if(!(g&4294965248))L[v++]=g>>6&31|192;else if(!(g&4294901760))L[v++]=g>>12&15|224,L[v++]=g>>6&63|128;else if(!(g&4292870144))L[v++]=g>>18&7|240,L[v++]=g>>12&63|128,L[v++]=g>>6&63|128;else continue;else{L[v++]=g;continue}L[v++]=g&63|128}return L.slice(0,v)};function f(w="utf-8",S={fatal:!1}){if(w!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${w}') is invalid.`);if(S.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(f.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(f.prototype,"fatal",{value:!1}),Object.defineProperty(f.prototype,"ignoreBOM",{value:!1}),f.prototype.decode=function(w,S={stream:!1}){if(S.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const O=new Uint8Array(w);let P=0;const v=O.length,_=[];for(;P<v;){const L=O[P++];if(L===0)break;if(!(L&128))_.push(L);else if((L&224)===192){const g=O[P++]&63;_.push((L&31)<<6|g)}else if((L&240)===224){const g=O[P++]&63,M=O[P++]&63;_.push((L&31)<<12|g<<6|M)}else if((L&248)===240){const g=O[P++]&63,M=O[P++]&63,x=O[P++]&63;let p=(L&7)<<18|g<<12|M<<6|x;p>65535&&(p-=65536,_.push(p>>>10&1023|55296),p=56320|p&1023),_.push(p)}}return String.fromCharCode.apply(null,_)},$.TextEncoder=T,$.TextDecoder=f})(typeof window<"u"?window:typeof self<"u"?self:this)},"./node_modules/iobuffer/lib-esm/text.browser.js":($,T,f)=>{f.r(T),f.d(T,{decode:()=>w,encode:()=>O}),f("./node_modules/iobuffer/lib-esm/text-encoding-polyfill.js");function w(P,v="utf8"){return new TextDecoder(v).decode(P)}const S=new TextEncoder;function O(P){return S.encode(P)}},"./node_modules/netcdfjs/src/data.js":($,T,f)=>{f.r(T),f.d(T,{nonRecord:()=>S,record:()=>O});var w=f("./node_modules/netcdfjs/src/types.js");function S(P,v){const _=(0,w.str2num)(v.type);let L=v.size/(0,w.num2bytes)(_),g=new Array(L);for(let M=0;M<L;M++)g[M]=(0,w.readType)(P,_,1);return g}function O(P,v,_){const L=(0,w.str2num)(v.type),g=v.size?v.size/(0,w.num2bytes)(L):1;let M=_.length,x=new Array(M);const p=_.recordStep;for(let y=0;y<M;y++){let e=P.offset;x[y]=(0,w.readType)(P,L,g),P.seek(e+p)}return x}},"./node_modules/netcdfjs/src/header.js":($,T,f)=>{f.r(T),f.d(T,{header:()=>L});var w=f("./node_modules/netcdfjs/src/types.js"),S=f("./node_modules/netcdfjs/src/utils.js");const O=0,P=10,v=11,_=12;function L(y,e){let r={recordDimension:{length:y.readUint32()}};r.version=e;let s=M(y);r.recordDimension.id=s.recordId,r.recordDimension.name=s.recordName,r.dimensions=s.dimensions,r.globalAttributes=x(y);let h=p(y,s.recordId,e);return r.variables=h.variables,r.recordDimension.recordStep=h.recordStep,r}const g=0;function M(y){let e,r;const s=y.readUint32();let h;if(s===O)return(0,S.notNetcdf)(y.readUint32()!==O,"wrong empty tag for list of dimensions"),[];{(0,S.notNetcdf)(s!==P,"wrong tag for list of dimensions");const a=y.readUint32();h=new Array(a);for(let t=0;t<a;t++){let n=(0,S.readName)(y);const o=y.readUint32();o===g&&(e=t,r=n),h[t]={name:n,size:o}}}return{dimensions:h,recordId:e,recordName:r}}function x(y){const e=y.readUint32();let r;if(e===O)return(0,S.notNetcdf)(y.readUint32()!==O,"wrong empty tag for list of attributes"),[];{(0,S.notNetcdf)(e!==_,"wrong tag for list of attributes");const s=y.readUint32();r=new Array(s);for(let h=0;h<s;h++){let a=(0,S.readName)(y),t=y.readUint32();(0,S.notNetcdf)(t<1||t>6,`non valid type ${t}`);let n=y.readUint32(),o=(0,w.readType)(y,t,n);(0,S.padding)(y),r[h]={name:a,type:(0,w.num2str)(t),value:o}}}return r}function p(y,e,r){const s=y.readUint32();let h=0,a;if(s===O)return(0,S.notNetcdf)(y.readUint32()!==O,"wrong empty tag for list of variables"),[];{(0,S.notNetcdf)(s!==v,"wrong tag for list of variables");const t=y.readUint32();a=new Array(t);for(let n=0;n<t;n++){let o=(0,S.readName)(y);const c=y.readUint32();let u=new Array(c);for(let z=0;z<c;z++)u[z]=y.readUint32();let E=x(y),A=y.readUint32();(0,S.notNetcdf)(A<1&&A>6,`non valid type ${A}`);const I=y.readUint32();let R=y.readUint32();r===2&&((0,S.notNetcdf)(R>0,"offsets larger than 4GB not supported"),R=y.readUint32());let C=!1;typeof e<"u"&&u[0]===e&&(h+=I,C=!0),a[n]={name:o,dimensions:u,attributes:E,type:(0,w.num2str)(A),size:I,offset:R,record:C}}}return{variables:a,recordStep:h}}},"./node_modules/netcdfjs/src/index.js":($,T,f)=>{f.r(T),f.d(T,{NetCDFReader:()=>_});var w=f("./node_modules/iobuffer/lib-esm/IOBuffer.js"),S=f("./node_modules/netcdfjs/src/data.js"),O=f("./node_modules/netcdfjs/src/header.js"),P=f("./node_modules/netcdfjs/src/toString.js"),v=f("./node_modules/netcdfjs/src/utils.js");class _{constructor(g){const M=new w.IOBuffer(g);M.setBigEndian(),(0,v.notNetcdf)(M.readChars(3)!=="CDF","should start with CDF");const x=M.readByte();(0,v.notNetcdf)(x>2,"unknown version"),this.header=(0,O.header)(M,x),this.buffer=M}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(g){const M=this.globalAttributes.find(x=>x.name===g);return M?M.value:null}getDataVariableAsString(g){const M=this.getDataVariable(g);return M?M.join(""):null}get variables(){return this.header.variables}toString(){return P.toString.call(this)}getDataVariable(g){let M;return typeof g=="string"?M=this.header.variables.find(x=>x.name===g):M=g,(0,v.notNetcdf)(M===void 0,`variable not found: ${g}`),this.buffer.seek(M.offset),M.record?(0,S.record)(this.buffer,M,this.header.recordDimension):(0,S.nonRecord)(this.buffer,M)}dataVariableExists(g){return this.header.variables.find(x=>x.name===g)!==void 0}attributeExists(g){return this.globalAttributes.find(x=>x.name===g)!==void 0}}},"./node_modules/netcdfjs/src/toString.js":($,T,f)=>{f.r(T),f.d(T,{toString:()=>w});function w(){let S=[];S.push("DIMENSIONS");for(let P of this.dimensions)S.push(`  ${P.name.padEnd(30)} = size: ${P.size}`);S.push(""),S.push("GLOBAL ATTRIBUTES");for(let P of this.globalAttributes)S.push(`  ${P.name.padEnd(30)} = ${P.value}`);let O=JSON.parse(JSON.stringify(this.variables));S.push(""),S.push("VARIABLES:");for(let P of O){P.value=this.getDataVariable(P);let v=JSON.stringify(P.value);v.length>50&&(v=v.substring(0,50)),isNaN(P.value.length)||(v+=` (length: ${P.value.length})`),S.push(`  ${P.name.padEnd(30)} = ${v}`)}return S.join(`
`)}},"./node_modules/netcdfjs/src/types.js":($,T,f)=>{f.r(T),f.d(T,{num2bytes:()=>P,num2str:()=>O,readType:()=>L,str2num:()=>v});var w=f("./node_modules/netcdfjs/src/utils.js");const S={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function O(M){switch(Number(M)){case S.BYTE:return"byte";case S.CHAR:return"char";case S.SHORT:return"short";case S.INT:return"int";case S.FLOAT:return"float";case S.DOUBLE:return"double";default:return"undefined"}}function P(M){switch(Number(M)){case S.BYTE:return 1;case S.CHAR:return 1;case S.SHORT:return 2;case S.INT:return 4;case S.FLOAT:return 4;case S.DOUBLE:return 8;default:return-1}}function v(M){switch(String(M)){case"byte":return S.BYTE;case"char":return S.CHAR;case"short":return S.SHORT;case"int":return S.INT;case"float":return S.FLOAT;case"double":return S.DOUBLE;default:return-1}}function _(M,x){if(M!==1){let p=new Array(M);for(let y=0;y<M;y++)p[y]=x();return p}else return x()}function L(M,x,p){switch(x){case S.BYTE:return M.readBytes(p);case S.CHAR:return g(M.readChars(p));case S.SHORT:return _(p,M.readInt16.bind(M));case S.INT:return _(p,M.readInt32.bind(M));case S.FLOAT:return _(p,M.readFloat32.bind(M));case S.DOUBLE:return _(p,M.readFloat64.bind(M));default:(0,w.notNetcdf)(!0,`non valid type ${x}`);return}}function g(M){return M.charCodeAt(M.length-1)===0?M.substring(0,M.length-1):M}},"./node_modules/netcdfjs/src/utils.js":($,T,f)=>{f.r(T),f.d(T,{notNetcdf:()=>w,padding:()=>S,readName:()=>O});function w(P,v){if(P)throw new TypeError(`Not a valid NetCDF v3.x file: ${v}`)}function S(P){P.offset%4!==0&&P.skip(4-P.offset%4)}function O(P){let v=P.readUint32(),_=P.readChars(v);return S(P),_}},"./src/WebGL/shaders/lib/basic/basic.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform mat4 viewMatrix;
uniform float opacity;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
varying vec3 vColor;
//DEFINEFRAGCOLOR
void main() {
    gl_FragColor = vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}`},"./src/WebGL/shaders/lib/basic/basic.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

attribute vec3 position;
attribute vec3 color;

varying vec3 vColor;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;

}`},"./src/WebGL/shaders/lib/instanced/instanced.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/instanced/instanced.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 offset;
attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/lambert/lambert.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}`},"./src/WebGL/shaders/lib/lambert/lambert.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vLightBack;

varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    if ( gl_FrontFacing )
       gl_FragColor.xyz *= vLightFront;
    else
       gl_FragColor.xyz *= vLightBack;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec3 vLightBack;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );
    vLightBack = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;
    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/outline/outline.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
//DEFINEFRAGCOLOR

void main() {
    gl_FragColor = vec4( outlineColor, 1 );
}


`},"./src/WebGL/shaders/lib/outline/outline.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

void main() {

    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    mvPosition.xy += norm.xy*outlineWidth;
    gl_Position = projectionMatrix * mvPosition;
    mvPosition.z -= outlinePushback; //go backwards in model space
    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..
    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;
}

`},"./src/WebGL/shaders/lib/screen/screen.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = texture2D(colormap, vTexCoords);
}
        `},"./src/WebGL/shaders/lib/screen/screen.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/screenaa/screenaa.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;

// Basic FXAA implementation based on the code on geeks3d.com 
#define FXAA_REDUCE_MIN (1.0/ 128.0)
#define FXAA_REDUCE_MUL (1.0 / 8.0)
#define FXAA_SPAN_MAX 8.0

vec4 applyFXAA(vec2 fragCoord, sampler2D tex)
{
    vec4 color;
    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec3 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP).xyz;
    vec3 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP).xyz;
    vec3 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP).xyz;
    vec3 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP).xyz;
    vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
            dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)).xyz +
        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
        texture2D(tex, fragCoord  + dir * -0.5).xyz +
        texture2D(tex, fragCoord  + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, 1.0);
    else
        color = vec4(rgbB, 1.0);
    return color;
}
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = applyFXAA(vTexCoords, colormap);
}
        `},"./src/WebGL/shaders/lib/screenaa/screenaa.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`
uniform mat4 viewMatrix;
uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float uDepth;
uniform vec3 directionalLightColor[ 1 ];

varying vec3 vColor;
varying vec2 mapping;
varying float rval;
varying vec3 vLight;
varying vec3 center;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));
    float dotProduct = dot( norm, vLight );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;
    gl_FragColor = vec4(vLight*vColor, opacity*opacity );
    float fogFactor = smoothstep( fogNear, fogFar, gl_FragDepthEXT/gl_FragCoord.w );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );


}

`},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying vec3 vColor;
varying float rval;
varying vec3 vLight;
varying vec3 center;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz );
    mapping = normal.xy;
    rval = abs(normal.x);
    gl_Position = projPosition+adjust;

}
`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform mat4 projectionMatrix;
varying vec2 mapping;
varying float rval;
varying vec3 center;

uniform float outlinePushback;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragColor = vec4(outlineColor, 1 );
}


`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying float rval;
varying vec3 center;

void main() {

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);
    vec4 adjust = projectionMatrix* vec4(norm,normal.z,0.0); adjust.z = 0.0; adjust.w = 0.0;
    mapping = norm.xy;
    rval = abs(norm.x);
    gl_Position = projPosition+adjust;
}

`},"./src/WebGL/shaders/lib/sprite/sprite.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform vec3 color;
uniform sampler2D map;
uniform float opacity;

uniform int fogType;
uniform vec3 fogColor;
uniform float fogDensity;
uniform float fogNear;
uniform float fogFar;
uniform float alphaTest;

varying vec2 vUV;
//DEFINEFRAGCOLOR

void main() {

    vec4 texture = texture2D(map, vUV);

    if (texture.a < alphaTest) discard;

    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);

    if (fogType > 0) {

        float depth = gl_FragCoord.z / gl_FragCoord.w;
        float fogFactor = 0.0;

        if (fogType == 1) {
            fogFactor = smoothstep(fogNear, fogFar, depth);
        }

        else {
            const float LOG2 = 1.442695;
            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);
            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);
        }

        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);

    }
}

`},"./src/WebGL/shaders/lib/sprite/sprite.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform int useScreenCoordinates;
uniform vec3 screenPosition;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float rotation;
uniform vec2 scale;
uniform vec2 alignment;
uniform vec2 uvOffset;
uniform vec2 uvScale;

attribute vec2 position;
attribute vec2 uv;

varying vec2 vUV;

void main() {

    vUV = uvOffset + uv * uvScale;

    vec2 alignedPosition = position + alignment;

    vec2 rotatedPosition;
    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;
    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;

    vec4 finalPosition;

    if(useScreenCoordinates != 0) {
        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);
    }

    else {
        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;
        finalPosition.xy += rotatedPosition; 
    }

    gl_Position = finalPosition;

}

`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`    float dotProduct = dot( norm, vLight );
    vec3 light = vec3( max( dotProduct, 0.0 ) );
    gl_FragColor = vec4(light*color, opacity*opacity );
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary
    r = abs(radius);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       if(projectionMatrix[3][3] == 0.0) { //perspective
         vec3 pnorm = normalize(p1);
         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
         mvPosition.xyz = p1+t*pnorm; 
       } else { //orthographic
         mvPosition.xyz = p1;
       }
    } else {
      if(projectionMatrix[3][3] == 0.0) { //perspective
         vec3 pnorm = normalize(p2);
         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
         mvPosition.xyz = p2+t*pnorm;
       } else { //orthographic
         mvPosition.xyz = p2;
       } 
       mult *= -1.0;
    }
    vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;
    mvPosition.xyz +=  mult*(cr + doublecr).xyz;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..
}

`},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];
uniform vec3 outlineColor;
uniform float outlineWidth;
uniform float outlinePushback;


attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = outlineColor;
    float rad = radius+sign(radius)*outlineWidth;
    r = abs(rad);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
//pushback
    to.xyz += normalize(to.xyz)*outlinePushback;
    pt.xyz += normalize(pt.xyz)*outlinePushback;

    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       vec3 pnorm = normalize(p1);
       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
       mvPosition.xyz = p1+t*pnorm;
    } else {
       vec3 pnorm = normalize(p2);
       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
       mvPosition.xyz = p2+t*pnorm;
       mult *= -1.0;
    }
    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;
    mvPosition.xy +=  mult*(cr + doublecr).xy;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vLight = vec3(1.0,1.0,1.0);
}

`},"./src/WebGL/shaders/lib/volumetric/volumetric.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`
uniform highp sampler3D data;
uniform highp sampler2D colormap;
uniform highp sampler2D depthmap;


uniform mat4 textmat;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

uniform float step;
uniform float subsamples;
uniform float maxdepth;
uniform float transfermin;
uniform float transfermax;
in  vec4 mvPosition;
out vec4 color;
void main(void) {

   vec4 pos = mvPosition;
   bool seengood = false;
   float i = 0.0;
   color = vec4(1,1,1,0);
   float increment = 1.0/subsamples;
   float maxsteps = (maxdepth*subsamples/step);
//there's probably a better way to do this..
//calculate farthest possible point in model coordinates
   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);
// convert to projection
   maxpos = projectionMatrix*maxpos;
   vec4 startp = projectionMatrix*pos;
// homogonize
   maxpos /= maxpos.w;
   startp /= startp.w;
//take x,y from start and z from max
   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);
//convert back to model space
   maxpos = projinv*maxpos;
   maxpos /= maxpos.w;
   float incr = step/subsamples;
//get depth from depthmap
//startp is apparently [-1,1]
   vec2 tpos = startp.xy/2.0+0.5;
   float depth = texture(depthmap, tpos).r;
//compute vector between start and end
   vec4 direction = maxpos-pos;
   for( i = 0.0; i <= maxsteps; i++) {
      vec4 pt = (pos+(i/maxsteps)*direction);
      vec4 ppt = projectionMatrix*pt;
      float ptdepth = ppt.z/ppt.w;
      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
      if(ptdepth > depth) break;
      pt = textmat*pt;
//       pt /= pt.w;
      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {
         seengood = true;
      } else if(seengood) {
         break;
      }
      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){
          color.a = 0.0;
          continue;
      }
      else {
         float val = texture(data, pt.zyx).r;
         if(isinf(val)) continue; //masked out
         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range
         vec4 val_color = texture(colormap, vec2(cval,0.5));
         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;
         color.a += (1.0 - color.a) * val_color.a; 
         if(color.a > 0.0) color.rgb /= color.a;
//          color = vec4(pt.x, pt.y, pt.z, 1.0);
      }
//       color = vec4(pt.x, pt.y, pt.z, 0.0)
    }
}

        `},"./src/WebGL/shaders/lib/volumetric/volumetric.vert":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

in vec3 position;
out vec4 mvPosition;
void main() {

    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix*mvPosition;
}
`},"./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag":($,T,f)=>{f.r(T),f.d(T,{default:()=>w});const w=`uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLight;
varying vec3 vColor;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

//DEFINEFRAGCOLOR

//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf
//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl
//with a bit more care (caps) this could be a general cylinder imposter (see also outline)
void main() {
    vec3 color = abs(vColor);
    vec3 pos = cposition;
    vec3 p = pos; //ray point
    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic
    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective
    vec3 pa = p1; //cyl start
    vec3 va = normalize(p2-p1); //cyl norm
    vec3 tmp1 = v-(dot(v,va)*va);
    vec3 deltap = p-pa;
    float A = dot(tmp1,tmp1);
    if(A == 0.0) discard;
    vec3 tmp2 = deltap-(dot(deltap,va)*va);
    float B = 2.0*dot(tmp1, tmp2);
    float C = dot(tmp2,tmp2)-r*r;
//quadratic equation!
    float det = (B*B) - (4.0*A*C);
    if(det < 0.0) discard;
    float sqrtDet = sqrt(det);
    float posT = (-B+sqrtDet)/(2.0*A);
    float negT = (-B-sqrtDet)/(2.0*A);
    float intersectionT = min(posT,negT);
    vec3 qi = p+v*intersectionT;
    float dotp1 = dot(va,qi-p1);
    float dotp2 = dot(va,qi-p2);
    vec3 norm;
    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0
       vec3 cp;
       if( dotp1 < 0.0) {  
//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not
        cp = p1;
       } else {
//          if(vColor.y < 0.0 ) discard;
          cp = p2;
       }
       vec3 diff = p-cp;
       A = dot(v,v);
       B = dot(diff,v)*2.0;
       C = dot(diff,diff)-r*r;
       det = (B*B) - (4.0*C);
       if(det < 0.0) discard;
       sqrtDet = sqrt(det);
       posT = (-B+sqrtDet)/(2.0);
       negT = (-B-sqrtDet)/(2.0);
       float t = min(posT,negT);
       qi = p+v*t; 
       norm = normalize(qi-cp); 
    } else {
       norm = normalize(qi-(dotp1*va + p1));
    }
    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragDepthEXT = depth;`},"./src/GLDraw.ts":($,T,f)=>{f.r(T),f.d(T,{CAP:()=>S,GLDraw:()=>O});var w=f("./src/WebGL/math/index.ts"),S;(function(P){P[P.NONE=0]="NONE",P[P.FLAT=1]="FLAT",P[P.ROUND=2]="ROUND"})(S||(S={}));var O;(function(P){function v(e,r,s){var h=Math.sqrt(e*e+r*r),a,t,n,o,c;h<1e-4?(t=0,n=1):(t=-e/h,n=r/h),r=-t*e+n*r,a=Math.sqrt(r*r+s*s),a<1e-4?(o=0,c=1):(o=s/a,c=r/a);var u=new Float32Array(9);return u[0]=n,u[1]=t,u[2]=0,u[3]=-t*c,u[4]=n*c,u[5]=o,u[6]=t*o,u[7]=-n*o,u[8]=c,u}class _{constructor(){this.cache={};let r=[],s=4,h=Math.pow(2,s),a=2,t=Math.pow(2,a),n=h/t,o;for(r[0]=new w.Vector3(-1,0,0),r[n]=new w.Vector3(0,0,1),r[n*2]=new w.Vector3(1,0,0),r[n*3]=new w.Vector3(0,0,-1),a=3;a<=s;a++){for(t=Math.pow(2,a-1),n=h/t,o=0;o<t-1;o++)r[n/2+o*n]=r[o*n].clone().add(r[(o+1)*n]).normalize();o=t-1,r[n/2+o*n]=r[o*n].clone().add(r[0]).normalize()}this.basisVectors=r}getVerticesForRadius(r,s,h){if(typeof this.cache<"u"&&this.cache[r]!==void 0&&this.cache[r][s+h]!==void 0)return this.cache[r][s+h];for(var a=this.basisVectors.length,t=[],n=[],o,c=0;c<a;c++)t.push(this.basisVectors[c].clone().multiplyScalar(r)),t.push(this.basisVectors[c].clone().multiplyScalar(r)),o=this.basisVectors[c].clone().normalize(),n.push(o),n.push(o);var u=[],E=10,A=a,I=0,R=Math.PI*2,C=0,z=Math.PI,V,G,B=!1,F=!1;for(G=0;G<=E;G++){B=G===0||G===E,F=G===E/2;var N=[],j=[];for(V=0;V<=A;V++){if(F){var U=V<A?2*V:0;j.push(U+1),N.push(U);continue}var k=V/A,te=G/E;if(!B||V===0)if(V<A){var he=new w.Vector3;he.x=-r*Math.cos(I+k*R)*Math.sin(C+te*z),s==1?he.y=0:he.y=r*Math.cos(C+te*z),he.z=r*Math.sin(I+k*R)*Math.sin(C+te*z),Math.abs(he.x)<1e-5&&(he.x=0),Math.abs(he.y)<1e-5&&(he.y=0),Math.abs(he.z)<1e-5&&(he.z=0),s==S.FLAT?(o=new w.Vector3(0,Math.cos(C+te*z),0),o.normalize()):(o=new w.Vector3(he.x,he.y,he.z),o.normalize()),t.push(he),n.push(o),N.push(t.length-1)}else N.push(t.length-A);else B&&N.push(t.length-1)}F&&u.push(j),u.push(N)}var re={vertices:t,normals:n,verticesRows:u,w:A,h:E};return r in this.cache||(this.cache[r]={}),this.cache[r][s+h]=re,re}}var L=new _;function g(e,r,s,h,a,t=0,n=0){if(!(!r||!s)){var o=n||t;a=a||{r:0,g:0,b:0};var c=v(s.x-r.x,s.y-r.y,s.z-r.z),u=L.getVerticesForRadius(h,n,"to"),E=u.w,A=u.h,I=o?A*E+2:2*E,R=e.updateGeoGroup(I),C=u.vertices,z=u.normals,V=u.verticesRows,G=V[A/2],B=V[A/2+1],F=R.vertices,N,j,U,k,te,he,re=R.vertexArray,ae=R.normalArray,pe=R.colorArray,oe=R.faceArray;for(U=0;U<E;++U){var se=2*U;k=c[0]*C[se].x+c[3]*C[se].y+c[6]*C[se].z,te=c[1]*C[se].x+c[4]*C[se].y+c[7]*C[se].z,he=c[5]*C[se].y+c[8]*C[se].z,N=3*(F+se),j=R.faceidx,re[N]=k+r.x,re[N+1]=te+r.y,re[N+2]=he+r.z,re[N+3]=k+s.x,re[N+4]=te+s.y,re[N+5]=he+s.z,ae[N]=k,ae[N+3]=k,ae[N+1]=te,ae[N+4]=te,ae[N+2]=he,ae[N+5]=he,pe[N]=a.r,pe[N+3]=a.r,pe[N+1]=a.g,pe[N+4]=a.g,pe[N+2]=a.b,pe[N+5]=a.b,oe[j]=B[U]+F,oe[j+1]=B[U+1]+F,oe[j+2]=G[U]+F,oe[j+3]=G[U]+F,oe[j+4]=B[U+1]+F,oe[j+5]=G[U+1]+F,R.faceidx+=6}if(o){var Ce=n?0:A/2,_e=t?A+1:A/2+1,Se,fe,xe,Ee,We,Ge,Ne,Be,Te,Re,Pe,Ue,ze,Ze,He,X,Z,J,ce,ue,Le,De,K,de,me,Ie,ne,we,H,Oe,ke,D;for(te=Ce;te<_e;te++)if(te!==A/2){var ge=te<=A/2?s:r,be=L.getVerticesForRadius(h,n,"to"),Y=L.getVerticesForRadius(h,t,"from");for(ge===s?(C=be.vertices,z=be.normals,V=be.verticesRows):ge==r&&(C=Y.vertices,z=Y.normals,V=Y.verticesRows),k=0;k<E;k++)j=R.faceidx,Se=V[te][k+1],H=(Se+F)*3,fe=V[te][k],Oe=(fe+F)*3,xe=V[te+1][k],ke=(xe+F)*3,Ee=V[te+1][k+1],D=(Ee+F)*3,We=c[0]*C[Se].x+c[3]*C[Se].y+c[6]*C[Se].z,Ge=c[0]*C[fe].x+c[3]*C[fe].y+c[6]*C[fe].z,Ne=c[0]*C[xe].x+c[3]*C[xe].y+c[6]*C[xe].z,Be=c[0]*C[Ee].x+c[3]*C[Ee].y+c[6]*C[Ee].z,Te=c[1]*C[Se].x+c[4]*C[Se].y+c[7]*C[Se].z,Re=c[1]*C[fe].x+c[4]*C[fe].y+c[7]*C[fe].z,Pe=c[1]*C[xe].x+c[4]*C[xe].y+c[7]*C[xe].z,Ue=c[1]*C[Ee].x+c[4]*C[Ee].y+c[7]*C[Ee].z,ze=c[5]*C[Se].y+c[8]*C[Se].z,Ze=c[5]*C[fe].y+c[8]*C[fe].z,He=c[5]*C[xe].y+c[8]*C[xe].z,X=c[5]*C[Ee].y+c[8]*C[Ee].z,re[H]=We+ge.x,re[Oe]=Ge+ge.x,re[ke]=Ne+ge.x,re[D]=Be+ge.x,re[H+1]=Te+ge.y,re[Oe+1]=Re+ge.y,re[ke+1]=Pe+ge.y,re[D+1]=Ue+ge.y,re[H+2]=ze+ge.z,re[Oe+2]=Ze+ge.z,re[ke+2]=He+ge.z,re[D+2]=X+ge.z,pe[H]=a.r,pe[Oe]=a.r,pe[ke]=a.r,pe[D]=a.r,pe[H+1]=a.g,pe[Oe+1]=a.g,pe[ke+1]=a.g,pe[D+1]=a.g,pe[H+2]=a.b,pe[Oe+2]=a.b,pe[ke+2]=a.b,pe[D+2]=a.b,Z=c[0]*z[Se].x+c[3]*z[Se].y+c[6]*z[Se].z,J=c[0]*z[fe].x+c[3]*z[fe].y+c[6]*z[fe].z,ce=c[0]*z[xe].x+c[3]*z[xe].y+c[6]*z[xe].z,ue=c[0]*z[Ee].x+c[3]*z[Ee].y+c[6]*z[Ee].z,Le=c[1]*z[Se].x+c[4]*z[Se].y+c[7]*z[Se].z,De=c[1]*z[fe].x+c[4]*z[fe].y+c[7]*z[fe].z,K=c[1]*z[xe].x+c[4]*z[xe].y+c[7]*z[xe].z,de=c[1]*z[Ee].x+c[4]*z[Ee].y+c[7]*z[Ee].z,me=c[5]*z[Se].y+c[8]*z[Se].z,Ie=c[5]*z[fe].y+c[8]*z[fe].z,ne=c[5]*z[xe].y+c[8]*z[xe].z,we=c[5]*z[Ee].y+c[8]*z[Ee].z,te===0?(ae[H]=Z,ae[ke]=ce,ae[D]=ue,ae[H+1]=Le,ae[ke+1]=K,ae[D+1]=de,ae[H+2]=me,ae[ke+2]=ne,ae[D+2]=we,oe[j]=Se+F,oe[j+1]=xe+F,oe[j+2]=Ee+F,R.faceidx+=3):te===_e-1?(ae[H]=Z,ae[Oe]=J,ae[ke]=ce,ae[H+1]=Le,ae[Oe+1]=De,ae[ke+1]=K,ae[H+2]=me,ae[Oe+2]=Ie,ae[ke+2]=ne,oe[j]=Se+F,oe[j+1]=fe+F,oe[j+2]=xe+F,R.faceidx+=3):(ae[H]=Z,ae[Oe]=J,ae[D]=ue,ae[H+1]=Le,ae[Oe+1]=De,ae[D+1]=de,ae[H+2]=me,ae[Oe+2]=Ie,ae[D+2]=we,ae[Oe]=J,ae[ke]=ce,ae[D]=ue,ae[Oe+1]=De,ae[ke+1]=K,ae[D+1]=de,ae[Oe+2]=Ie,ae[ke+2]=ne,ae[D+2]=we,oe[j]=Se+F,oe[j+1]=fe+F,oe[j+2]=Ee+F,oe[j+3]=fe+F,oe[j+4]=xe+F,oe[j+5]=Ee+F,R.faceidx+=6)}}R.vertices+=I}}P.drawCylinder=g;function M(e,r,s,h,a){if(!r||!s)return;a=a||{r:0,g:0,b:0};let t=new w.Vector3(s.x-r.x,s.y-r.y,s.z-r.z);var n=v(t.x,t.y,t.z);t=t.normalize();var o=L.basisVectors.length,c=L.basisVectors,u=o+2,E=e.updateGeoGroup(u),A=E.vertices,I,R,C,z,V,G,B=E.vertexArray,F=E.normalArray,N=E.colorArray,j=E.faceArray;for(I=A*3,B[I]=r.x,B[I+1]=r.y,B[I+2]=r.z,F[I]=-t.x,F[I+1]=-t.y,F[I+2]=-t.z,N[I]=a.r,N[I+1]=a.g,N[I+2]=a.b,B[I+3]=s.x,B[I+4]=s.y,B[I+5]=s.z,F[I+3]=t.x,F[I+4]=t.y,F[I+5]=t.z,N[I+3]=a.r,N[I+4]=a.g,N[I+5]=a.b,I+=6,C=0;C<o;++C){var U=c[C].clone();U.multiplyScalar(h),z=n[0]*U.x+n[3]*U.y+n[6]*U.z,V=n[1]*U.x+n[4]*U.y+n[7]*U.z,G=n[5]*U.y+n[8]*U.z,B[I]=z+r.x,B[I+1]=V+r.y,B[I+2]=G+r.z,F[I]=z,F[I+1]=V,F[I+2]=G,N[I]=a.r,N[I+1]=a.g,N[I+2]=a.b,I+=3}for(E.vertices+=o+2,R=E.faceidx,C=0;C<o;C++){var k=A+2+C,te=A+2+(C+1)%o;j[R]=k,j[R+1]=te,j[R+2]=A,R+=3,j[R]=k,j[R+1]=te,j[R+2]=A+1,R+=3}E.faceidx+=6*o}P.drawCone=M;class x{constructor(){this.cache=new Map}getVerticesForRadius(r,s){s=s||2,this.cache.has(s)||this.cache.set(s,new Map);let h=this.cache.get(s);if(h.has(r))return h.get(r);var a={vertices:[],verticesRows:[],normals:[]},t=16*s,n=10*s;r<1&&(t=10*s,n=8*s);var o=0,c=Math.PI*2,u=0,E=Math.PI,A,I;for(I=0;I<=n;I++){let C=[];for(A=0;A<=t;A++){let z=A/t,V=I/n,G=-r*Math.cos(o+z*c)*Math.sin(u+V*E),B=r*Math.cos(u+V*E),F=r*Math.sin(o+z*c)*Math.sin(u+V*E);var R=new w.Vector3(G,B,F);R.normalize(),a.vertices.push({x:G,y:B,z:F}),a.normals.push(R),C.push(a.vertices.length-1)}a.verticesRows.push(C)}return h.set(r,a),a}}var p=new x;function y(e,r,s,h,a){var t=p.getVerticesForRadius(s,a),n=t.vertices,o=t.normals,c=e.updateGeoGroup(n.length),u=c.vertices,E=c.vertexArray,A=c.colorArray,I=c.faceArray,R=c.lineArray,C=c.normalArray;for(let G=0,B=n.length;G<B;++G){let F=3*(u+G),N=n[G];E[F]=N.x+r.x,E[F+1]=N.y+r.y,E[F+2]=N.z+r.z,A[F]=h.r,A[F+1]=h.g,A[F+2]=h.b}c.vertices+=n.length;let z=t.verticesRows,V=z.length-1;for(let G=0;G<V;G++){let B=z[G].length-1;for(let F=0;F<B;F++){let N=c.faceidx,j=c.lineidx,U=z[G][F+1]+u,k=U*3,te=z[G][F]+u,he=te*3,re=z[G+1][F]+u,ae=re*3,pe=z[G+1][F+1]+u,oe=pe*3,se=o[U-u],Ce=o[te-u],_e=o[re-u],Se=o[pe-u];Math.abs(n[U-u].y)===s?(C[k]=se.x,C[ae]=_e.x,C[oe]=Se.x,C[k+1]=se.y,C[ae+1]=_e.y,C[oe+1]=Se.y,C[k+2]=se.z,C[ae+2]=_e.z,C[oe+2]=Se.z,I[N]=U,I[N+1]=re,I[N+2]=pe,R[j]=U,R[j+1]=re,R[j+2]=U,R[j+3]=pe,R[j+4]=re,R[j+5]=pe,c.faceidx+=3,c.lineidx+=6):Math.abs(n[re-u].y)===s?(C[k]=se.x,C[he]=Ce.x,C[ae]=_e.x,C[k+1]=se.y,C[he+1]=Ce.y,C[ae+1]=_e.y,C[k+2]=se.z,C[he+2]=Ce.z,C[ae+2]=_e.z,I[N]=U,I[N+1]=te,I[N+2]=re,R[j]=U,R[j+1]=te,R[j+2]=U,R[j+3]=re,R[j+4]=te,R[j+5]=re,c.faceidx+=3,c.lineidx+=6):(C[k]=se.x,C[he]=Ce.x,C[oe]=Se.x,C[k+1]=se.y,C[he+1]=Ce.y,C[oe+1]=Se.y,C[k+2]=se.z,C[he+2]=Ce.z,C[oe+2]=Se.z,C[he]=Ce.x,C[ae]=_e.x,C[oe]=Se.x,C[he+1]=Ce.y,C[ae+1]=_e.y,C[oe+1]=Se.y,C[he+2]=Ce.z,C[ae+2]=_e.z,C[oe+2]=Se.z,I[N]=U,I[N+1]=te,I[N+2]=pe,I[N+3]=te,I[N+4]=re,I[N+5]=pe,R[j]=U,R[j+1]=te,R[j+2]=U,R[j+3]=pe,R[j+4]=te,R[j+5]=re,R[j+6]=re,R[j+7]=pe,c.faceidx+=6,c.lineidx+=8)}}}P.drawSphere=y})(O||(O={}))},"./src/GLModel.ts":($,T,f)=>{f.r(T),f.d(T,{GLModel:()=>e});var w=f("./src/WebGL/index.ts"),S=f("./src/WebGL/shapes/index.ts"),O=f("./src/WebGL/math/index.ts"),P=f("./src/colors.ts"),v=f("./src/GLDraw.ts"),_=f("./src/glcartoon.ts"),L=f("./src/utilities.ts"),g=f("./src/Gradient.ts"),M=f("./src/parsers/index.ts"),x=f("./node_modules/netcdfjs/src/index.js"),p=f("./node_modules/pako/dist/pako.esm.mjs"),y=f("./src/parsers/utils/assignBonds.ts");class e{static sameObj(s,h){return s&&h?JSON.stringify(s)==JSON.stringify(h):s==h}constructor(s,h){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new O.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=P.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=h||{},this.ElementColors=this.options.defaultcolors?this.options.defaultcolors:P.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius?this.options.defaultSphereRadius:1.5,this.defaultCartoonQuality=this.options.cartoonQuality?this.options.cartoonQuality:10,this.id=s}getRadiusFromStyle(s,h){var a=this.defaultSphereRadius;if(typeof h.radius<"u")a=h.radius;else if(e.vdwRadii[s.elem])a=e.vdwRadii[s.elem];else if(s.elem.length>1){let t=s.elem;t=t[0].toUpperCase()+t[1].toLowerCase(),e.vdwRadii[t]&&(a=e.vdwRadii[t])}return typeof h.scale<"u"&&(a*=h.scale),a}drawAtomCross(s,h){if(s.style.cross){var a=s.style.cross;if(!a.hidden){var t=a.linewidth||e.defaultlineWidth;h[t]||(h[t]=new w.Geometry);var n=h[t].updateGeoGroup(6),o=this.getRadiusFromStyle(s,a),c=[[o,0,0],[-o,0,0],[0,o,0],[0,-o,0],[0,0,o],[0,0,-o]],u=s.clickable||s.hoverable;u&&s.intersectionShape===void 0&&(s.intersectionShape={sphere:[],cylinder:[],line:[]});for(var E=(0,L.getColorFromStyle)(s,a),A=n.vertexArray,I=n.colorArray,R=0;R<6;R++){var C=n.vertices*3;if(n.vertices++,A[C]=s.x+c[R][0],A[C+1]=s.y+c[R][1],A[C+2]=s.z+c[R][2],I[C]=E.r,I[C+1]=E.g,I[C+2]=E.b,u){var z=new O.Vector3(c[R][0],c[R][1],c[R][2]);z.multiplyScalar(.1),z.set(z.x+s.x,z.y+s.y,z.z+s.z),s.intersectionShape.line.push(z)}}}}}getGoodCross(s,h,a,t){for(var n=null,o=-1,c=0,u=s.bonds.length;c<u;c++)if(s.bonds[c]!=h.index){let A=s.bonds[c],I=this.atoms[A],C=new O.Vector3(I.x,I.y,I.z).clone();C.sub(a);let z=C.clone();z.cross(t);var E=z.lengthSq();if(E>o&&(o=E,n=z,o>.1))return n}return n}getSideBondV(s,h,a){var t,n,o,c,u,E=new O.Vector3(s.x,s.y,s.z),A=new O.Vector3(h.x,h.y,h.z),I=A.clone(),R=null;if(I.sub(E),s.bonds.length===1)h.bonds.length===1?(R=I.clone(),Math.abs(R.x)>1e-4?R.y+=1:R.x+=1):(t=(a+1)%h.bonds.length,n=h.bonds[t],o=this.atoms[n],c=new O.Vector3(o.x,o.y,o.z),u=c.clone(),u.sub(E),R=u.clone(),R.cross(I));else if(R=this.getGoodCross(s,h,E,I),R.lengthSq()<.01){var C=this.getGoodCross(h,s,E,I);C!=null&&(R=C)}return R.lengthSq()<.01&&(R=I.clone(),Math.abs(R.x)>1e-4?R.y+=1:R.x+=1),R.cross(I),R.normalize(),R}addLine(s,h,a,t,n,o){s[a]=t.x,s[a+1]=t.y,s[a+2]=t.z,h[a]=o.r,h[a+1]=o.g,h[a+2]=o.b,s[a+3]=n.x,s[a+4]=n.y,s[a+5]=n.z,h[a+3]=o.r,h[a+4]=o.g,h[a+5]=o.b}drawBondLines(s,h,a){if(s.style.line){var t=s.style.line;if(!t.hidden){var n,o,c,u,E=t.linewidth||e.defaultlineWidth;a[E]||(a[E]=new w.Geometry);for(var A=a[E].updateGeoGroup(6*s.bonds.length),I=A.vertexArray,R=A.colorArray,C=0;C<s.bonds.length;C++){var z=s.bonds[C],V=h[z];if(V.style.line&&!(s.index>=V.index)){var G=new O.Vector3(s.x,s.y,s.z),B=new O.Vector3(V.x,V.y,V.z),F=G.clone().add(B).multiplyScalar(.5),N=!1,j=s.clickable||s.hoverable,U=V.clickable||V.hoverable;(j||U)&&(j&&(s.intersectionShape===void 0&&(s.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),s.intersectionShape.line.push(G),s.intersectionShape.line.push(F)),U&&(V.intersectionShape===void 0&&(V.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),V.intersectionShape.line.push(F),V.intersectionShape.line.push(B)));var k=(0,L.getColorFromStyle)(s,s.style.line),te=(0,L.getColorFromStyle)(V,V.style.line);if(s.bondStyles&&s.bondStyles[C]){var he=s.bondStyles[C];if(!he.iswire)continue;he.singleBond&&(N=!0),typeof he.color1<"u"&&(k=P.CC.color(he.color1)),typeof he.color2<"u"&&(te=P.CC.color(he.color2))}var re=A.vertices*3,ae,pe;if(s.bondOrder[C]>1&&s.bondOrder[C]<4&&!N){var oe=this.getSideBondV(s,V,C),se=B.clone();se.sub(G),s.bondOrder[C]==2?(oe.multiplyScalar(.1),n=G.clone(),n.add(oe),o=G.clone(),o.sub(oe),c=n.clone(),c.add(se),u=o.clone(),u.add(se),k==te?(A.vertices+=4,this.addLine(I,R,re,n,c,k),this.addLine(I,R,re+6,o,u,k)):(A.vertices+=8,se.multiplyScalar(.5),ae=n.clone(),ae.add(se),pe=o.clone(),pe.add(se),this.addLine(I,R,re,n,ae,k),this.addLine(I,R,re+6,ae,c,te),this.addLine(I,R,re+12,o,pe,k),this.addLine(I,R,re+18,pe,u,te))):s.bondOrder[C]==3&&(oe.multiplyScalar(.1),n=G.clone(),n.add(oe),o=G.clone(),o.sub(oe),c=n.clone(),c.add(se),u=o.clone(),u.add(se),k==te?(A.vertices+=6,this.addLine(I,R,re,G,B,k),this.addLine(I,R,re+6,n,c,k),this.addLine(I,R,re+12,o,u,k)):(A.vertices+=12,se.multiplyScalar(.5),ae=n.clone(),ae.add(se),pe=o.clone(),pe.add(se),this.addLine(I,R,re,G,F,k),this.addLine(I,R,re+6,F,B,te),this.addLine(I,R,re+12,n,ae,k),this.addLine(I,R,re+18,ae,c,te),this.addLine(I,R,re+24,o,pe,k),this.addLine(I,R,re+30,pe,u,te)))}else k==te?(A.vertices+=2,this.addLine(I,R,re,G,B,k)):(A.vertices+=4,this.addLine(I,R,re,G,F,k),this.addLine(I,R,re+6,F,B,te))}}}}}drawAtomSphere(s,h){if(s.style.sphere){var a=s.style.sphere;if(!a.hidden){var t=(0,L.getColorFromStyle)(s,a),n=this.getRadiusFromStyle(s,a);if((s.clickable===!0||s.hoverable)&&s.intersectionShape!==void 0){var o=new O.Vector3(s.x,s.y,s.z);s.intersectionShape.sphere.push(new S.Sphere(o,n))}v.GLDraw.drawSphere(h,s,n,t)}}}drawAtomClickSphere(s){if(s.style.clicksphere){var h=s.style.clicksphere;if(!h.hidden){var a=this.getRadiusFromStyle(s,h);if((s.clickable===!0||s.hoverable)&&s.intersectionShape!==void 0){var t=new O.Vector3(s.x,s.y,s.z);s.intersectionShape.sphere.push(new S.Sphere(t,a))}}}}drawAtomInstanced(s,h){if(s.style.sphere){var a=s.style.sphere;if(!a.hidden){var t=this.getRadiusFromStyle(s,a),n=(0,L.getColorFromStyle)(s,a),o=h.updateGeoGroup(1),c=o.vertices,u=c*3,E=o.vertexArray,A=o.colorArray,I=o.radiusArray;if(E[u]=s.x,E[u+1]=s.y,E[u+2]=s.z,A[u]=n.r,A[u+1]=n.g,A[u+2]=n.b,I[c]=t,(s.clickable===!0||s.hoverable)&&s.intersectionShape!==void 0){var R=new O.Vector3(s.x,s.y,s.z);s.intersectionShape.sphere.push(new S.Sphere(R,t))}o.vertices+=1}}}drawSphereImposter(s,h,a,t){var n=s.updateGeoGroup(4),o,c=n.vertices,u=c*3,E=n.vertexArray,A=n.colorArray;for(o=0;o<4;o++)E[u+3*o]=h.x,E[u+3*o+1]=h.y,E[u+3*o+2]=h.z;var I=n.normalArray;for(o=0;o<4;o++)A[u+3*o]=t.r,A[u+3*o+1]=t.g,A[u+3*o+2]=t.b;I[u+0]=-a,I[u+1]=a,I[u+2]=0,I[u+3]=-a,I[u+4]=-a,I[u+5]=0,I[u+6]=a,I[u+7]=-a,I[u+8]=0,I[u+9]=a,I[u+10]=a,I[u+11]=0,n.vertices+=4;var R=n.faceArray,C=n.faceidx;R[C+0]=c,R[C+1]=c+1,R[C+2]=c+2,R[C+3]=c+2,R[C+4]=c+3,R[C+5]=c,n.faceidx+=6}drawAtomImposter(s,h){if(s.style.sphere){var a=s.style.sphere;if(!a.hidden){var t=this.getRadiusFromStyle(s,a),n=(0,L.getColorFromStyle)(s,a);if((s.clickable===!0||s.hoverable)&&s.intersectionShape!==void 0){var o=new O.Vector3(s.x,s.y,s.z);s.intersectionShape.sphere.push(new S.Sphere(o,t))}this.drawSphereImposter(h,s,t,n)}}}static drawStickImposter(s,h,a,t,n){for(var o=s.updateGeoGroup(4),c=o.vertices,u=c*3,E=o.vertexArray,A=o.colorArray,I=o.radiusArray,R=o.normalArray,C=n.r,z=n.g,V=n.b,G=function(U){var k=-U;return k==0&&(k=-1e-4),k},B=u,F=0;F<4;F++)E[B]=h.x,R[B]=a.x,A[B]=C,B++,E[B]=h.y,R[B]=a.y,A[B]=z,B++,E[B]=h.z,R[B]=a.z,F<2?A[B]=V:A[B]=G(V),B++;o.vertices+=4,I[c]=-t,I[c+1]=t,I[c+2]=-t,I[c+3]=t;var N=o.faceArray,j=o.faceidx;N[j+0]=c,N[j+1]=c+1,N[j+2]=c+2,N[j+3]=c+2,N[j+4]=c+3,N[j+5]=c,o.faceidx+=6}drawBondSticks(s,h,a){if(s.style.stick){var t=s.style.stick;if(!t.hidden){var n=t.radius||this.defaultStickRadius,o=n,c=t.singleBonds||!1,u=0,E=0,A,I,R,C,z,V,G,B,F,N,j,U=(0,L.getColorFromStyle)(s,t),k,te,he;!s.capDrawn&&s.bonds.length<4&&(u=2);var re=v.GLDraw.drawCylinder;for(a.imposter&&(re=e.drawStickImposter),R=0;R<s.bonds.length;R++){var ae=s.bonds[R],pe=h[ae];if(k=te=he=null,s.index<pe.index){var oe=pe.style;if(!oe.stick||oe.stick.hidden)continue;var se=(0,L.getColorFromStyle)(pe,oe.stick);if(o=n,C=c,s.bondStyles&&s.bondStyles[R]){if(z=s.bondStyles[R],z.iswire)continue;z.radius&&(o=z.radius),z.singleBond&&(C=!0),typeof z.color1<"u"&&(U=P.CC.color(z.color1)),typeof z.color2<"u"&&(se=P.CC.color(z.color2))}var Ce=new O.Vector3(s.x,s.y,s.z),_e=new O.Vector3(pe.x,pe.y,pe.z);if(s.bondOrder[R]<=1||C||s.bondOrder[R]>3){if(s.bondOrder[R]<1&&(o*=s.bondOrder[R]),!pe.capDrawn&&pe.bonds.length<4&&(E=2),U!=se?(k=new O.Vector3().addVectors(Ce,_e).multiplyScalar(.5),re(a,Ce,k,o,U,u,0),re(a,k,_e,o,se,0,E)):re(a,Ce,_e,o,U,u,E),A=s.clickable||s.hoverable,I=pe.clickable||pe.hoverable,A||I){if(k||(k=new O.Vector3().addVectors(Ce,_e).multiplyScalar(.5)),A){var Se=new S.Cylinder(Ce,k,o),fe=new S.Sphere(Ce,o);s.intersectionShape.cylinder.push(Se),s.intersectionShape.sphere.push(fe)}if(I){var xe=new S.Cylinder(_e,k,o),Ee=new S.Sphere(_e,o);pe.intersectionShape.cylinder.push(xe),pe.intersectionShape.sphere.push(Ee)}}}else if(s.bondOrder[R]>1){var We=0,Ge=0;o!=n&&(We=2,Ge=2);var Ne=_e.clone(),Be=null;Ne.sub(Ce);var Te,Re,Pe,Ue,ze;Be=this.getSideBondV(s,pe,R),s.bondOrder[R]==2?(Te=o/2.5,Be.multiplyScalar(Te*1.5),Re=Ce.clone(),Re.add(Be),Pe=Ce.clone(),Pe.sub(Be),Ue=Re.clone(),Ue.add(Ne),ze=Pe.clone(),ze.add(Ne),U!=se?(k=new O.Vector3().addVectors(Re,Ue).multiplyScalar(.5),te=new O.Vector3().addVectors(Pe,ze).multiplyScalar(.5),re(a,Re,k,Te,U,We,0),re(a,k,Ue,Te,se,0,Ge),re(a,Pe,te,Te,U,We,0),re(a,te,ze,Te,se,0,Ge)):(re(a,Re,Ue,Te,U,We,Ge),re(a,Pe,ze,Te,U,We,Ge)),A=s.clickable||s.hoverable,I=pe.clickable||pe.hoverable,(A||I)&&(k||(k=new O.Vector3().addVectors(Re,Ue).multiplyScalar(.5)),te||(te=new O.Vector3().addVectors(Pe,ze).multiplyScalar(.5)),A&&(V=new S.Cylinder(Re,k,Te),G=new S.Cylinder(Pe,te,Te),s.intersectionShape.cylinder.push(V),s.intersectionShape.cylinder.push(G)),I&&(F=new S.Cylinder(Ue,k,Te),N=new S.Cylinder(ze,te,Te),pe.intersectionShape.cylinder.push(F),pe.intersectionShape.cylinder.push(N)))):s.bondOrder[R]==3&&(Te=o/4,Be.cross(Ne),Be.normalize(),Be.multiplyScalar(Te*3),Re=Ce.clone(),Re.add(Be),Pe=Ce.clone(),Pe.sub(Be),Ue=Re.clone(),Ue.add(Ne),ze=Pe.clone(),ze.add(Ne),U!=se?(k=new O.Vector3().addVectors(Re,Ue).multiplyScalar(.5),te=new O.Vector3().addVectors(Pe,ze).multiplyScalar(.5),he=new O.Vector3().addVectors(Ce,_e).multiplyScalar(.5),re(a,Re,k,Te,U,We,0),re(a,k,Ue,Te,se,0,Ge),re(a,Ce,he,Te,U,u,0),re(a,he,_e,Te,se,0,E),re(a,Pe,te,Te,U,We,0),re(a,te,ze,Te,se,0,Ge)):(re(a,Re,Ue,Te,U,We,Ge),re(a,Ce,_e,Te,U,u,E),re(a,Pe,ze,Te,U,We,Ge)),A=s.clickable||s.hoverable,I=pe.clickable||pe.hoverable,(A||I)&&(k||(k=new O.Vector3().addVectors(Re,Ue).multiplyScalar(.5)),te||(te=new O.Vector3().addVectors(Pe,ze).multiplyScalar(.5)),he||(he=new O.Vector3().addVectors(Ce,_e).multiplyScalar(.5)),A&&(V=new S.Cylinder(Re.clone(),k.clone(),Te),G=new S.Cylinder(Pe.clone(),te.clone(),Te),B=new S.Cylinder(Ce.clone(),he.clone(),Te),s.intersectionShape.cylinder.push(V),s.intersectionShape.cylinder.push(G),s.intersectionShape.cylinder.push(B)),I&&(F=new S.Cylinder(Ue.clone(),k.clone(),Te),N=new S.Cylinder(ze.clone(),te.clone(),Te),j=new S.Cylinder(_e.clone(),he.clone(),Te),pe.intersectionShape.cylinder.push(F),pe.intersectionShape.cylinder.push(N),pe.intersectionShape.cylinder.push(j))))}}}var Ze=!1,He=0,X=!1;for(R=0;R<s.bonds.length;R++)C=c,s.bondStyles&&s.bondStyles[R]&&(z=s.bondStyles[R],z.singleBond&&(C=!0),z.radius&&z.radius!=n&&(X=!0)),(C||s.bondOrder[R]==1)&&He++;X?He>0&&(Ze=!0):He==0&&(s.bonds.length>0||t.showNonBonded)&&(Ze=!0),Ze&&(o=n,a.imposter?this.drawSphereImposter(a.sphereGeometry,s,o,U):v.GLDraw.drawSphere(a,s,o,U))}}}createMolObj(s,h){h=h||{};var a=new w.Object3D,t=[],n={},o={},c=this.drawAtomSphere,u=null,E=null;h.supportsImposters?(c=this.drawAtomImposter,u=new w.Geometry(!0),u.imposter=!0,E=new w.Geometry(!0,!0),E.imposter=!0,E.sphereGeometry=new w.Geometry(!0),E.sphereGeometry.imposter=!0,E.drawnCaps={}):h.supportsAIA?(c=this.drawAtomInstanced,u=new w.Geometry(!1,!0,!0),u.instanced=!0,E=new w.Geometry(!0)):(u=new w.Geometry(!0),E=new w.Geometry(!0));var A,I,R,C,z={},V=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(A=0,R=s.length;A<R;A++){var G=s[A];if(G&&G.style){(G.clickable||G.hoverable)&&G.intersectionShape===void 0&&(G.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),C={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(I in C)G.style[I]?G.style[I].opacity?C[I]=parseFloat(G.style[I].opacity):C[I]=1:C[I]=void 0,z[I]?C[I]!=null&&z[I]!=C[I]&&(console.log("Warning: "+I+" opacity is ambiguous"),z[I]=1):z[I]=C[I];c.call(this,G,u),this.drawAtomClickSphere(G),this.drawAtomCross(G,o),this.drawBondLines(G,s,n),this.drawBondSticks(G,s,E),typeof G.style.cartoon<"u"&&!G.style.cartoon.hidden&&(G.style.cartoon.color==="spectrum"&&typeof G.resi=="number"&&!G.hetflag&&(G.resi<V[0]&&(V[0]=G.resi),G.resi>V[1]&&(V[1]=G.resi)),t.push(G))}}if(t.length>0&&(0,_.drawCartoon)(a,t,V,this.defaultCartoonQuality),u&&u.vertices>0){u.initTypedArrays();var B=null,F=null;u.imposter?B=new w.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):u.instanced?(F=new w.Geometry(!0),v.GLDraw.drawSphere(F,{x:0,y:0,z:0},1,new P.Color(.5,.5,.5)),F.initTypedArrays(),B=new w.InstancedMaterial({sphereMaterial:new w.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:F})):B=new w.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),z.sphere<1&&z.sphere>=0&&(B.transparent=!0,B.opacity=z.sphere),F=new w.Mesh(u,B),a.add(F)}if(E.vertices>0){var N=null,j=null,U=E.sphereGeometry;(!U||typeof U.vertices>"u"||U.vertices==0)&&(U=null),E.initTypedArrays(),U&&U.initTypedArrays();var k={ambient:0,vertexColors:!0,reflectivity:0};E.imposter?(N=new w.StickImposterMaterial(k),j=new w.SphereImposterMaterial(k)):(N=new w.MeshLambertMaterial(k),j=new w.MeshLambertMaterial(k),N.wireframe&&(E.setUpWireframe(),U&&U.setUpWireframe())),z.stick<1&&z.stick>=0&&(N.transparent=!0,N.opacity=z.stick,j.transparent=!0,j.opacity=z.stick);var te=new w.Mesh(E,N);if(a.add(te),U){var he=new w.Mesh(U,j);a.add(he)}}var re;for(A in n)if(n.hasOwnProperty(A)){re=A;var ae=new w.LineBasicMaterial({linewidth:re,vertexColors:!0});z.line<1&&z.line>=0&&(ae.transparent=!0,ae.opacity=z.line),n[A].initTypedArrays();var pe=new w.Line(n[A],ae,w.LineStyle.LinePieces);a.add(pe)}for(A in o)if(o.hasOwnProperty(A)){re=A;var oe=new w.LineBasicMaterial({linewidth:re,vertexColors:!0});z.cross<1&&z.cross>=0&&(oe.transparent=!0,oe.opacity=z.cross),o[A].initTypedArrays();var se=new w.Line(o[A],oe,w.LineStyle.LinePieces);a.add(se)}if(this.dontDuplicateAtoms&&this.modelData.symmetries&&this.modelData.symmetries.length>0){var Ce=new w.Object3D,_e;for(_e=0;_e<this.modelData.symmetries.length;_e++){var Se=new w.Object3D;Se=a.clone(),Se.matrix.copy(this.modelData.symmetries[_e]),Se.matrixAutoUpdate=!1,Ce.add(Se)}return Ce}return a}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(s){this.atoms=s.atoms,this.frames=s.frames,this.molObj=null}getCrystData(){if(this.modelData.cryst){if(!this.modelData.cryst.matrix){const s=this.modelData.cryst;this.modelData.cryst.matrix=(0,O.conversionMatrix3)(s.a,s.b,s.c,s.alpha,s.beta,s.gamma)}return this.modelData.cryst}else return null}setCrystData(s,h,a,t,n,o){s=s||1,h=h||1,a=a||1,t=t||90,n=n||90,o=o||90;const c=(0,O.conversionMatrix3)(s,h,a,t,n,o);this.modelData.cryst={a:s,b:h,c:a,alpha:t,beta:n,gamma:o,matrix:c}}setCrystMatrix(s){s=s||new O.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:s}}getSymmetries(){return typeof this.modelData.symmetries>"u"&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(s){typeof s>"u"?this.modelData.symmetries=[this.idMatrix]:this.modelData.symmetries=s}getID(){return this.id}getNumFrames(){return this.frames.numFrames!=null?this.frames.numFrames:this.frames.length}adjustCoord(s,h,a,t){var n=h-s;return n<-a?h+t:n>a?h-t:h}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var s=this.box[0],h=this.box[1],a=this.box[2],t=s*.9,n=h*.9,o=a*.9,c=0;c<this.atomdfs.length;c++)for(var u=this.atomdfs[c],E=1;E<u.length;E++){var A=this.atoms[u[E][0]],I=this.atoms[u[E][1]];A.x=this.adjustCoord(I.x,A.x,t,s),A.y=this.adjustCoord(I.y,A.y,n,h),A.z=this.adjustCoord(I.z,A.z,o,a)}}setFrame(s,h){var a=this.getNumFrames();let t=this;return new Promise(function(n,o){if(a==0&&n(),(s<0||s>=a)&&(s=a-1),t.frames.url!=null){var c=t.frames.url;(0,L.getbin)(c+"/traj/frame/"+s+"/"+t.frames.path,void 0,"POST",void 0).then(function(u){for(var E=new Float32Array(u,44),A=0,I=0;I<t.atoms.length;I++)t.atoms[I].x=E[A++],t.atoms[I].y=E[A++],t.atoms[I].z=E[A++];t.box&&t.atomdfs&&t.adjustCoordinatesToBox(),n()}).catch(o)}else t.atoms=t.frames[s],n();t.molObj=null,t.modelDatas&&s<t.modelDatas.length&&(t.modelData=t.modelDatas[s],t.unitCellObjects&&h&&(h.removeUnitCell(t),h.addUnitCell(t)))})}addFrame(s){this.frames.push(s)}vibrate(s=10,h=1,a=!1,t,n){var o=0,c=s;a&&(o=-s,c=s),this.frames!==void 0&&this.frames.origIndex!==void 0?this.setFrame(this.frames.origIndex):this.setFrame(0),o<c&&(this.frames=[]),a&&(this.frames.origIndex=s);for(var u=o;u<c;u++){var E=[],A=this.frames.length;if(u==0&&!n){this.frames.push(this.atoms);continue}for(var I=0;I<this.atoms.length;I++){var R=(0,L.getAtomProperty)(this.atoms[I],"dx"),C=(0,L.getAtomProperty)(this.atoms[I],"dy"),z=(0,L.getAtomProperty)(this.atoms[I],"dz"),V=new O.Vector3(R,C,z),G=new O.Vector3(this.atoms[I].x,this.atoms[I].y,this.atoms[I].z),B=u*h/s;V.multiplyScalar(B),G.add(V);var F={};for(var N in this.atoms[I])F[N]=this.atoms[I][N];if(F.x=G.x,F.y=G.y,F.z=G.z,E.push(F),t&&n){var j=(0,L.extend)({},n),U=new O.Vector3(R,C,z);if(U.multiplyScalar(h),U.add(G),j.start=G,j.end=U,j.frame=A,!j.color){var k=F.style.sphere;k||(k=F.style.stick),k||(k=F.style.line),j.color=(0,L.getColorFromStyle)(F,k)}t.addArrow(j)}}this.frames.push(E)}}setAtomDefaults(s){for(let h=0;h<s.length;h++){let a=s[h];a&&(a.style=a.style||(0,L.deepCopy)(e.defaultAtomStyle),a.color=a.color||this.ElementColors[a.elem]||this.defaultColor,a.model=this.id,(a.clickable||a.hoverable)&&(a.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(s,h,a={}){var t=e.parseMolData(s,h,a);this.dontDuplicateAtoms=!a.duplicateAssemblyAtoms;var n=t.modelData;if(n&&(Array.isArray(n)?(this.modelData=n[0],a.frames&&(this.modelDatas=n)):this.modelData=n),t.box?this.box=t.box:this.box=null,this.frames.length==0){for(let c=0;c<t.length;c++)t[c].length!=0&&this.frames.push(t[c]);this.frames[0]&&(this.atoms=this.frames[0])}else if(a.frames)for(let c=0;c<t.length;c++)this.frames.push(t[c]);else for(var o=0;o<t.length;o++)this.addAtoms(t[o]);for(let c=0;c<this.frames.length;c++)this.setAtomDefaults(this.frames[c]);a.vibrate&&a.vibrate.frames&&a.vibrate.amplitude&&this.vibrate(a.vibrate.frames,a.vibrate.amplitude),a.style&&this.setStyle({},a.style)}setDontDuplicateAtoms(s){this.dontDuplicateAtoms=s}setModelData(s){this.modelData=s}propertyMatches(s,h){if(s==h)return!0;if(typeof h=="string"&&typeof s=="number"){var a=h.match(/(-?\d+)\s*-\s*(-?\d+)/);if(a){var t=parseInt(a[1]),n=parseInt(a[2]);if(a&&s>=t&&s<=n)return!0}}return!1}static deepCopyAndCache(s,h){if(typeof s!="object"||s==null||s.__cache_created)return s;const a={};for(const t in s){const n=s[t];if(Array.isArray(n)){a[t]=[];for(let o=0;o<n.length;o++)a[t].push(e.deepCopyAndCache(n[o],h))}else typeof n=="object"&&t!="properties"&&t!="model"?a[t]=e.deepCopyAndCache(n,h):a[t]=n;if(t=="and"||t=="or"){const o=[];for(const c of a[t]){const u=new Set;for(const E of h.selectedAtoms(c))u.add(E.index);o.push(u)}if(t=="and"){const c=function(E,A){const I=new Set;for(const R of A)E.has(R)&&I.add(R);return I};let u=new Set(o[0]);for(const E of o.splice(1))u=c(u,E);a[t].__cached_results=u}else if(t=="or"){const c=new Set;for(const u of o)for(const E of u)c.add(E);a[t].__cached_results=c}}}return a.__cache_created=!0,a}atomIsSelected(s,h){if(typeof h>"u")return!0;var a=!!h.invert,t=!0;for(var n in h)if(n=="and"||n=="or"||n=="not"){if(n=="not"){if(this.atomIsSelected(s,h[n])){t=!1;break}}else if(h[n].__cached_results===void 0&&(h=e.deepCopyAndCache(h,this)),t=h[n].__cached_results.has(s.index),!t)break}else if(n==="predicate"){if(!h.predicate(s)){t=!1;break}}else if(n=="properties"&&s[n]){for(var o in h.properties)if(!o.startsWith("__cache")){if(typeof s.properties[o]>"u"){t=!1;break}if(s.properties[o]!=h.properties[o]){t=!1;break}}}else if(h.hasOwnProperty(n)&&n!="props"&&n!="invert"&&n!="model"&&n!="byres"&&n!="expand"&&n!="within"&&n!="and"&&n!="or"&&n!="not"&&!n.startsWith("__cache")){if(typeof s[n]>"u"){t=!1;break}var c=!1;if(n==="bonds"){var u=h[n];if(u!=s.bonds.length){t=!1;break}}else if(Array.isArray(h[n])){var E=h[n],A=s[n];for(let I=0;I<E.length;I++)if(this.propertyMatches(A,E[I])){c=!0;break}if(!c){t=!1;break}}else{let I=h[n];if(!this.propertyMatches(s[n],I)){t=!1;break}}}return a?!t:t}static squaredDistance(s,h){var a=h.x-s.x,t=h.y-s.y,n=h.z-s.z;return a*a+t*t+n*n}expandAtomList(s,h){if(h<=0)return s;for(var a=(0,L.getExtent)(s,void 0),t=[[],[],[]],n=0;n<3;n++)t[0][n]=a[0][n]-h,t[1][n]=a[1][n]+h,t[2][n]=a[2][n];var o=[];for(let A=0;A<this.atoms.length;A++){var c=this.atoms[A].x,u=this.atoms[A].y,E=this.atoms[A].z;c>=t[0][0]&&c<=t[1][0]&&u>=t[0][1]&&u<=t[1][1]&&E>=t[0][2]&&E<=t[1][2]&&(c>=a[0][0]&&c<=a[1][0]&&u>=a[0][1]&&u<=a[1][1]&&E>=a[0][2]&&E<=a[1][2]||o.push(this.atoms[A]))}return o}static getFloat(s){return typeof s=="number"?s:parseFloat(s)}selectedAtoms(s,h){var a=[];s=e.deepCopyAndCache(s||{},this),h||(h=this.atoms);for(var t=h.length,n=0;n<t;n++){var o=h[n];o&&this.atomIsSelected(o,s)&&a.push(o)}if(s.hasOwnProperty("expand")){const F=e.getFloat(s.expand);let N=this.expandAtomList(a,F),j=a.length;const U=F*F;for(let k=0;k<N.length;k++)for(let te=0;te<j;te++){var c=e.squaredDistance(N[k],a[te]);c<U&&c>0&&a.push(N[k])}}if(s.hasOwnProperty("within")&&s.within.hasOwnProperty("sel")&&s.within.hasOwnProperty("distance")){var u=this.selectedAtoms(s.within.sel,this.atoms),E={};const F=e.getFloat(s.within.distance),N=F*F;for(let j=0;j<u.length;j++)for(let U=0;U<a.length;U++){let k=e.squaredDistance(u[j],a[U]);k<N&&k>0&&(E[U]=1)}var A=[];if(s.within.invert)for(let j=0;j<a.length;j++)E[j]||A.push(a[j]);else for(let j in E)A.push(a[j]);a=A}if(s.hasOwnProperty("byres")){var I={},R=[],C=[];for(let F=0;F<a.length;F++){let N=a[F];var z=N.chain,V=N.resi;if(I[z]===void 0&&(I[z]={}),N.hasOwnProperty("resi")&&I[z][V]===void 0){for(I[z][V]=!0,C.push(N);C.length>0;)if(N=C.pop(),z=N.chain,V=N.resi,R[N.index]===void 0){R[N.index]=!0;for(var G=0;G<N.bonds.length;G++){var B=this.atoms[N.bonds[G]];R[B.index]===void 0&&B.hasOwnProperty("resi")&&B.chain==z&&B.resi==V&&(C.push(B),a.push(B))}}}}}return a}addAtoms(s){this.molObj=null;var h=this.atoms.length,a=[],t;for(t=0;t<s.length;t++)typeof s[t].index>"u"&&(s[t].index=t),typeof s[t].serial>"u"&&(s[t].serial=t),a[s[t].index]=h+t;for(t=0;t<s.length;t++){var n=s[t],o=a[n.index],c=(0,L.extend)({},n);c.index=o,c.bonds=[],c.bondOrder=[],c.model=this.id,c.style=c.style||(0,L.deepCopy)(e.defaultAtomStyle),typeof c.color>"u"&&(c.color=this.ElementColors[c.elem]||this.defaultColor);for(var u=n.bonds?n.bonds.length:0,E=0;E<u;E++){var A=a[n.bonds[E]];typeof A<"u"&&(c.bonds.push(A),c.bondOrder.push(n.bondOrder?n.bondOrder[E]:1))}this.atoms.push(c)}}assignBonds(){(0,y.assignBonds)(this.atoms)}removeAtoms(s){this.molObj=null;var h=[],a;for(a=0;a<s.length;a++)h[s[a].index]=!0;var t=[];for(a=0;a<this.atoms.length;a++){var n=this.atoms[a];h[n.index]||t.push(n)}this.atoms=[],this.addAtoms(t)}setStyle(s,h,a){typeof h>"u"&&typeof a>"u"&&(h=s,s={}),typeof h=="string"&&(h=(0,L.specStringToObject)(h));var t=!1,n=this,o=function(u){var E=n.selectedAtoms(s,u);for(let A=0;A<u.length;A++)u[A]&&(u[A].capDrawn=!1);for(let A=0;A<E.length;A++){t=!0,(E[A].clickable||E[A].hoverable)&&(E[A].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),a||(E[A].style={});for(let I in h)h.hasOwnProperty(I)&&(E[A].style[I]=E[A].style[I]||{},Object.assign(E[A].style[I],h[I]))}};o(this.atoms);for(var c=0;c<this.frames.length;c++)this.frames[c]!==this.atoms&&o(this.frames[c]);t&&(this.molObj=null)}setClickable(s,h,a){if(h=!!h,a=(0,L.makeFunction)(a),a===null){console.log("Callback is not a function");return}var t=this.selectedAtoms(s,this.atoms),n=t.length;for(let o=0;o<n;o++)t[o].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},t[o].clickable=h,a&&(t[o].callback=a);n>0&&(this.molObj=null)}setHoverable(s,h,a,t){if(h=!!h,a=(0,L.makeFunction)(a),t=(0,L.makeFunction)(t),a===null){console.log("Hover_callback is not a function");return}if(t===null){console.log("Unhover_callback is not a function");return}var n=this.selectedAtoms(s,this.atoms),o=n.length;for(let c=0;c<o;c++)n[c].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},n[c].hoverable=h,a&&(n[c].hover_callback=a),t&&(n[c].unhover_callback=t);o>0&&(this.molObj=null)}enableContextMenu(s,h){h=!!h;var a,t=this.selectedAtoms(s,this.atoms),n=t.length;for(a=0;a<n;a++)t[a].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},t[a].contextMenuEnabled=h;n>0&&(this.molObj=null)}setColorByElement(s,h){if(!(this.molObj!==null&&e.sameObj(h,this.lastColors))){this.lastColors=h;var a=this.selectedAtoms(s,a);a.length>0&&(this.molObj=null);for(var t=0;t<a.length;t++){var n=a[t];typeof h[n.elem]<"u"&&(n.color=h[n.elem])}}}setColorByProperty(s,h,a,t){var n,o,c=this.selectedAtoms(s,c);for(this.lastColors=null,c.length>0&&(this.molObj=null),typeof a=="string"&&typeof g.Gradient.builtinGradients[a]<"u"&&(a=new g.Gradient.builtinGradients[a]),a=a,t||(t=a.range()),t||(t=(0,L.getPropertyRange)(c,h)),n=0;n<c.length;n++){o=c[n];var u=(0,L.getAtomProperty)(o,h);u!=null&&(o.color=a.valueToHex(parseFloat(o.properties[h]),t))}}setColorByFunction(s,h){var a=this.selectedAtoms(s,a);if(typeof h=="function"){this.lastColors=null,a.length>0&&(this.molObj=null);for(let t=0;t<a.length;t++){let n=a[t];n.color=h(n)}}}toCDObject(s=!1){var h={a:[],b:[]};s&&(h.s=[]);for(let t=0;t<this.atoms.length;t++){let n={},o=this.atoms[t];if(n.x=o.x,n.y=o.y,n.z=o.z,o.elem!="C"&&(n.l=o.elem),s){for(var a=0;a<h.s.length&&JSON.stringify(o.style)!==JSON.stringify(h.s[a]);)a++;a===h.s.length&&h.s.push(o.style),a!==0&&(n.s=a)}h.a.push(n);for(let c=0;c<o.bonds.length;c++){let u=t,E=o.bonds[c];if(u>=E)continue;let A={b:u,e:E},I=o.bondOrder[c];I!=1&&(A.o=I),h.b.push(A)}}return h}globj(s,h){(this.molObj===null||h.regen)&&(this.molObj=this.createMolObj(this.atoms,h),this.renderedMolObj&&(s.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),s.add(this.renderedMolObj))}exportVRML(){var s=this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1});return s.vrml()}removegl(s){this.renderedMolObj&&(this.renderedMolObj.geometry!==void 0&&this.renderedMolObj.geometry.dispose(),this.renderedMolObj.material!==void 0&&this.renderedMolObj.material.dispose(),s.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(s,h,a,t){for(var n=this.selectedAtoms(h,n),o=(0,L.deepCopy)(t),c=0;c<n.length;c++){var u=n[c],E=null;typeof u[s]<"u"?E=String(u[s]):typeof u.properties[s]<"u"&&(E=String(u.properties[s])),E!=null&&(o.position=u,a.addLabel(E,o))}}addResLabels(s,h,a,t=!1){var n=[],o=function(u,E){for(var A=u.selectedAtoms(s,A),I={},R=0;R<A.length;R++){var C=A[R],z=C.chain,V=C.resn,G=C.resi,B=V+""+G;I[z]||(I[z]={}),I[z][B]||(I[z][B]=[]),I[z][B].push(C)}var F=(0,L.deepCopy)(a);for(let j in I)if(I.hasOwnProperty(j)){var N=I[j];for(let U in N)if(N.hasOwnProperty(U)){let k=N[U],te=new O.Vector3(0,0,0);for(let re=0;re<k.length;re++){let ae=k[re];te.x+=ae.x,te.y+=ae.y,te.z+=ae.z}te.divideScalar(k.length),F.position=te,F.frame=E;let he=h.addLabel(U,F,void 0,!0);n.push(he)}}};if(t){var c=this.getNumFrames();let u=this.atoms;for(let E=0;E<c;E++)this.frames[E]&&(this.atoms=this.frames[E],o(this,E));this.atoms=u}else o(this);return n}setupDFS(){this.atomdfs=[];var s=this,h=new Int8Array(this.atoms.length);h.fill(0);for(var a=function(c,u,E){E.push([c,u]);var A=s.atoms[c];h[c]=1;for(var I=0;I<A.bonds.length;I++){var R=A.bonds[I];s.atoms[R]&&!h[R]&&a(R,c,E)}},t=0;t<this.atoms.length;t++){var n=this.atoms[t];if(n&&!h[t]){var o=[];a(t,-1,o),this.atomdfs.push(o)}}}setCoordinatesFromURL(s,h){this.frames=[];var a=this;return this.box&&this.setupDFS(),s.startsWith("http")||(s="http://"+s),(0,L.get)(s+"/traj/numframes/"+h,function(t){if(!isNaN(parseInt(t)))return a.frames.push(a.atoms),a.frames.numFrames=t,a.frames.url=s,a.frames.path=h,a.setFrame(0)})}setCoordinates(s,h){if(h=h||"",!s)return[];if(/\.gz$/.test(h)){h=h.replace(/\.gz$/,"");try{s=(0,p.inflate)(s,{to:"string"})}catch(I){console.log(I)}}var a={mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""};if(a.hasOwnProperty(h)){this.frames=[];for(var t=this.atoms.length,n=e.parseCrd(s,h),o=0;o<n.length;){for(var c=[],u=0;u<t;u++){var E={};for(var A in this.atoms[u])E[A]=this.atoms[u][A];c[u]=E,c[u].x=n[o++],c[u].y=n[o++],c[u].z=n[o++]}this.frames.push(c)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(s){}static parseCrd(s,h){var a=[],t=0;if(h=="pdb")for(var n=s.indexOf(`
ATOM`);n!=-1;){for(;s.slice(n,n+5)==`
ATOM`||s.slice(n,n+7)==`
HETATM`;)a[t++]=parseFloat(s.slice(n+31,n+39)),a[t++]=parseFloat(s.slice(n+39,n+47)),a[t++]=parseFloat(s.slice(n+47,n+55)),n=s.indexOf(`
`,n+54),s.slice(n,n+4)==`
TER`&&(n=s.indexOf(`
`,n+5));n=s.indexOf(`
ATOM`,n)}else if(h=="netcdf"){var o=new x.NetCDFReader(s);a=[].concat.apply([],o.getDataVariable("coordinates"))}else{if(h=="array"||Array.isArray(s))return s.flat(2);{let c=s.indexOf(`
`);h=="inpcrd"&&(c=s.indexOf(`
`,c+1)),s=s.slice(c+1),a=s.match(/\S+/g).map(parseFloat)}}return a}static parseMolData(s,h="",a){if(!s)return[];if(/\.gz$/.test(h)){h=h.replace(/\.gz$/,"");try{s=(0,p.inflate)(s,{to:"string"})}catch(o){console.log(o)}}typeof M.Parsers[h]>"u"&&(h=h.split(".").pop(),typeof M.Parsers[h]>"u"&&(console.log("Unknown format: "+h),s instanceof Uint8Array?h="mmtf":s.match(/^@<TRIPOS>MOLECULE/gm)?h="mol2":s.match(/^data_/gm)&&s.match(/^loop_/gm)?h="cif":s.match(/^HETATM/gm)||s.match(/^ATOM/gm)?h="pdb":s.match(/ITEM: TIMESTEP/gm)?h="lammpstrj":s.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?h="sdf":s.match(/^%VERSION\s+VERSION_STAMP/gm)?h="prmtop":h="xyz",console.log("Best guess: "+h)));var t=M.Parsers[h],n=t(s,a);return n}}e.defaultAtomStyle={line:{}},e.defaultlineWidth=1,e.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86}},"./src/GLShape.ts":($,T,f)=>{f.r(T),f.d(T,{GLShape:()=>x,splitMesh:()=>p});var w=f("./src/WebGL/index.ts"),S=f("./src/WebGL/shapes/index.ts"),O=f("./src/WebGL/math/index.ts"),P=f("./src/colors.ts"),v=f("./src/ProteinSurface4.ts"),_=f("./src/VolumeData.ts"),L=f("./src/GLDraw.ts"),g=f("./src/glcartoon.ts"),M=f("./src/utilities.ts");class x{static finalizeGeo(e){var r=e.updateGeoGroup(0);r.vertices>0&&r.truncateArrayBuffers(!0,!0)}static updateColor(e,r){r=r||P.CC.color(r),e.colorsNeedUpdate=!0;var s,h,a;r.constructor!==Array&&(s=r.r,h=r.g,a=r.b);for(let t in e.geometryGroups){let n=e.geometryGroups[t],o=n.colorArray;for(let c=0,u=n.vertices;c<u;++c){if(r.constructor===Array){let E=r[c];s=E.r,h=E.g,a=E.b}o[c*3]=s,o[c*3+1]=h,o[c*3+2]=a}}}static drawArrow(e,r,s){var h=s.start,a=s.end,t=s.radius,n=s.radiusRatio,o=s.mid,c=s.midpos;if(!(h&&a))return;var u=r.updateGeoGroup(51),E=new O.Vector3(a.x,a.y,a.z).sub(h);if(c){let ne=E.length();c>0?o=c/ne:o=(ne+c)/ne}E.multiplyScalar(o);var A=new O.Vector3(h.x,h.y,h.z).add(E),I=E.clone().negate();let R=new O.Vector3(h.x,h.y,h.z);e.intersectionShape.cylinder.push(new S.Cylinder(R,A.clone(),t)),e.intersectionShape.sphere.push(new S.Sphere(R,t));var C=[];C[0]=E.clone(),Math.abs(C[0].x)>1e-4?C[0].y+=1:C[0].x+=1,C[0].cross(E),C[0].normalize(),C[4]=C[0].clone(),C[4].crossVectors(C[0],E),C[4].normalize(),C[8]=C[0].clone().negate(),C[12]=C[4].clone().negate(),C[2]=C[0].clone().add(C[4]).normalize(),C[6]=C[4].clone().add(C[8]).normalize(),C[10]=C[8].clone().add(C[12]).normalize(),C[14]=C[12].clone().add(C[0]).normalize(),C[1]=C[0].clone().add(C[2]).normalize(),C[3]=C[2].clone().add(C[4]).normalize(),C[5]=C[4].clone().add(C[6]).normalize(),C[7]=C[6].clone().add(C[8]).normalize(),C[9]=C[8].clone().add(C[10]).normalize(),C[11]=C[10].clone().add(C[12]).normalize(),C[13]=C[12].clone().add(C[14]).normalize(),C[15]=C[14].clone().add(C[0]).normalize();var z=u.vertices,V=u.vertexArray,G=u.faceArray,B=u.normalArray,F=u.lineArray,N,j,U;for(j=0,U=C.length;j<U;++j){N=3*(z+3*j);var k=C[j].clone().multiplyScalar(t).add(h),te=C[j].clone().multiplyScalar(t).add(A),he=C[j].clone().multiplyScalar(t*n).add(A);if(V[N]=k.x,V[N+1]=k.y,V[N+2]=k.z,V[N+3]=te.x,V[N+4]=te.y,V[N+5]=te.z,V[N+6]=he.x,V[N+7]=he.y,V[N+8]=he.z,j>0){var re=V[N-3],ae=V[N-2],pe=V[N-1],oe=new O.Vector3(re,ae,pe),se=new O.Vector3(a.x,a.y,a.z),Ce=A.clone(),_e=new O.Vector3(he.x,he.y,he.z);e.intersectionShape.triangle.push(new S.Triangle(_e,se,oe)),e.intersectionShape.triangle.push(new S.Triangle(oe.clone(),Ce,_e.clone()))}}u.vertices+=48,N=u.vertices*3,V[N]=h.x,V[N+1]=h.y,V[N+2]=h.z,V[N+3]=A.x,V[N+4]=A.y,V[N+5]=A.z,V[N+6]=a.x,V[N+7]=a.y,V[N+8]=a.z,u.vertices+=3;var Se,fe,xe,Ee,We,Ge,Ne,Be,Te,Re,Pe,Ue,ze,Ze,He,X,Z,J,ce,ue=u.vertices-3,Le=u.vertices-2,De=u.vertices-1,K=ue*3,de=Le*3,me=De*3;for(j=0,U=C.length-1;j<U;++j){var Ie=z+3*j;N=Ie*3,fe=u.faceidx,xe=u.lineidx,Ee=Ie,Re=Ee*3,We=Ie+1,Pe=We*3,Ge=Ie+2,Ue=Ge*3,Ne=Ie+4,ze=Ne*3,Be=Ie+5,Ze=Be*3,Te=Ie+3,He=Te*3,X=Z=C[j],J=ce=C[j+1],B[Re]=X.x,B[Pe]=Z.x,B[He]=ce.x,B[Re+1]=X.y,B[Pe+1]=Z.y,B[He+1]=ce.y,B[Re+2]=X.z,B[Pe+2]=Z.z,B[He+2]=ce.z,B[Pe]=Z.x,B[ze]=J.x,B[He]=ce.x,B[Pe+1]=Z.y,B[ze+1]=J.y,B[He+1]=ce.y,B[Pe+2]=Z.z,B[ze+2]=J.z,B[He+2]=ce.z,B[Ue]=Z.x,B[Ze]=J.x,B[Ue+1]=Z.y,B[Ze+1]=J.y,B[Ue+2]=Z.z,B[Ze+2]=J.z,G[fe]=Ee,G[fe+1]=We,G[fe+2]=Te,G[fe+3]=We,G[fe+4]=Ne,G[fe+5]=Te,G[fe+6]=Ee,G[fe+7]=Te,G[fe+8]=ue,G[fe+9]=Ge,G[fe+10]=Le,G[fe+11]=Be,G[fe+12]=Ge,G[fe+13]=De,G[fe+14]=Be,F[xe]=Ee,F[xe+1]=We,F[xe+2]=Ee,F[xe+3]=Te,F[xe+4]=Ne,F[xe+5]=Te,F[xe+6]=Ee,F[xe+7]=Te,F[xe+8]=Ge,F[xe+9]=We,F[xe+10]=Ge,F[xe+11]=Be,F[xe+12]=Ne,F[xe+13]=Be,F[xe+14]=Ge,F[xe+15]=De,F[xe+16]=Ge,F[xe+17]=Be,F[xe+18]=De,F[xe+19]=Be,u.faceidx+=15,u.lineidx+=20}Se=[z+45,z+46,z+1,z,z+47,z+2],fe=u.faceidx,xe=u.lineidx,Ee=Se[0],Re=Ee*3,We=Se[1],Pe=We*3,Ge=Se[4],Ue=Ge*3,Ne=Se[2],ze=Ne*3,Be=Se[5],Ze=Be*3,Te=Se[3],He=Te*3,X=Z=C[15],J=ce=C[0],B[Re]=X.x,B[Pe]=Z.x,B[He]=ce.x,B[Re+1]=X.y,B[Pe+1]=Z.y,B[He+1]=ce.y,B[Re+2]=X.z,B[Pe+2]=Z.z,B[He+2]=ce.z,B[Pe]=Z.x,B[ze]=J.x,B[He]=ce.x,B[Pe+1]=Z.y,B[ze+1]=J.y,B[He+1]=ce.y,B[Pe+2]=Z.z,B[ze+2]=J.z,B[He+2]=ce.z,B[Ue]=Z.x,B[Ze]=J.x,B[Ue+1]=Z.y,B[Ze+1]=J.y,B[Ue+2]=Z.z,B[Ze+2]=J.z,E.normalize(),I.normalize(),B[K]=I.x,B[de]=B[me]=E.x,B[K+1]=I.y,B[de+1]=B[me+1]=E.y,B[K+2]=I.z,B[de+2]=B[me+2]=E.z,G[fe]=Ee,G[fe+1]=We,G[fe+2]=Te,G[fe+3]=We,G[fe+4]=Ne,G[fe+5]=Te,G[fe+6]=Ee,G[fe+7]=Te,G[fe+8]=ue,G[fe+9]=Ge,G[fe+10]=Le,G[fe+11]=Be,G[fe+12]=Ge,G[fe+13]=De,G[fe+14]=Be,F[xe]=Ee,F[xe+1]=We,F[xe+2]=Ee,F[xe+3]=Te,F[xe+4]=Ne,F[xe+5]=Te,F[xe+6]=Ee,F[xe+7]=Te,F[xe+8]=Ge,F[xe+9]=We,F[xe+10]=Ge,F[xe+11]=Be,F[xe+12]=Ne,F[xe+13]=Be,F[xe+14]=Ge,F[xe+15]=De,F[xe+16]=Ge,F[xe+17]=Be,F[xe+18]=De,F[xe+19]=Be,u.faceidx+=15,u.lineidx+=20}static updateBoundingFromPoints(e,r,s,h){e.center.set(0,0,0);let a=1/0,t=1/0,n=1/0,o=-1/0,c=-1/0,u=-1/0;e.box&&(a=e.box.min.x,o=e.box.max.x,t=e.box.min.y,c=e.box.max.y,n=e.box.min.z,u=e.box.max.z);for(let R=0,C=h;R<C;R++){var E=s[R*3],A=s[R*3+1],I=s[R*3+2];E<a&&(a=E),A<t&&(t=A),I<n&&(n=I),E>o&&(o=E),A>c&&(c=A),I>u&&(u=I)}e.center.set((o+a)/2,(c+t)/2,(u+n)/2),e.radius=e.center.distanceTo({x:o,y:c,z:u}),e.box={min:{x:a,y:t,z:n},max:{x:o,y:c,z:u}}}static addCustomGeo(e,r,s,h,a){var t=r.addGeoGroup(),n=s.vertexArr,o=s.normalArr,c=s.faceArr;t.vertices=n.length,t.faceidx=c.length;var u,E,A,I,R,C,z,V,G,B=t.vertexArray,F=t.colorArray;for(h.constructor!==Array&&(V=h.r,G=h.g,I=h.b),C=0,z=t.vertices;C<z;++C)u=C*3,E=n[C],B[u]=E.x,B[u+1]=E.y,B[u+2]=E.z,h.constructor===Array&&(R=h[C],V=R.r,G=R.g,I=R.b),F[u]=V,F[u+1]=G,F[u+2]=I;if(a)for(C=0,z=t.faceidx/3;C<z;++C){u=C*3,A=c[u],I=c[u+1],R=c[u+2];var N=new O.Vector3,j=new O.Vector3,U=new O.Vector3;e.intersectionShape.triangle.push(new S.Triangle(N.copy(n[A]),j.copy(n[I]),U.copy(n[R])))}if(a){var k=new O.Vector3(0,0,0),te=0;for(let ae=0;ae<r.geometryGroups.length;ae++)k.add(r.geometryGroups[ae].getCentroid()),te++;k.divideScalar(te),x.updateBoundingFromPoints(e.boundingSphere,{centroid:k},B,t.vertices)}if(t.faceArray=new Uint16Array(c),t.truncateArrayBuffers(!0,!0),o.length<t.vertices)t.setNormals();else{var he=t.normalArray=new Float32Array(t.vertices*3),re;for(C=0,z=t.vertices;C<z;++C)u=C*3,re=o[C],he[u]=re.x,he[u+1]=re.y,he[u+2]=re.z}t.setLineIndices(),t.lineidx=t.lineArray.length}static updateFromStyle(e,r){typeof r.color<"u"?(e.color=r.color||new P.Color,r.color instanceof P.Color||(e.color=P.CC.color(r.color))):e.color=P.CC.color(0),e.wireframe=!!r.wireframe,e.opacity=r.alpha?(0,O.clamp)(r.alpha,0,1):1,typeof r.opacity<"u"&&(e.opacity=(0,O.clamp)(r.opacity,0,1)),e.side=r.side!==void 0?r.side:w.DoubleSide,e.linewidth=typeof r.linewidth>"u"?1:r.linewidth,e.clickable=!!r.clickable,e.callback=(0,M.makeFunction)(r.callback),e.hoverable=!!r.hoverable,e.hover_callback=(0,M.makeFunction)(r.hover_callback),e.unhover_callback=(0,M.makeFunction)(r.unhover_callback),e.hidden=r.hidden,e.frame=r.frame}constructor(e){this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.side=w.DoubleSide,this.stylespec=e||{},this.boundingSphere=new S.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},x.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new w.Geometry(!0),this.linegeo=new w.Geometry(!0)}updateStyle(e){for(var r in e)this.stylespec[r]=e[r];if(x.updateFromStyle(this,this.stylespec),e.voldata&&e.volscheme){(0,M.adjustVolumeStyle)(e);const s=e.volscheme,h=e.voldata,a=P.CC,t=s.range()||[-1,1];this.geo.setColors(function(n,o,c){let u=h.getVal(n,o,c);return a.color(s.valueToHex(u,t))}),delete this.color}}addCustom(e){e.vertexArr=e.vertexArr||[],e.faceArr=e.faceArr||[],e.normalArr=e.normalArr||[],x.drawCustom(this,this.geo,e)}addSphere(e){e.center||(e.center=new O.Vector3(0,0,0)),e.radius=e.radius?(0,O.clamp)(e.radius,0,1/0):1.5,e.color=P.CC.color(e.color),this.intersectionShape.sphere.push(new S.Sphere(e.center,e.radius)),L.GLDraw.drawSphere(this.geo,e.center,e.radius,e.color,e.quality),this.components.push({centroid:new O.Vector3(e.center.x,e.center.y,e.center.z)});var r=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,r.vertexArray,r.vertices)}addBox(e){var r=e.dimensions||{w:1,h:1,d:1},s;typeof r.w=="number"?s={x:r.w,y:0,z:0}:s=r.w;var h;typeof r.h=="number"?h={x:0,y:r.h,z:0}:h=r.h;var a;typeof r.d=="number"?a={x:0,y:0,z:r.d}:a=r.d;var t=e.corner;t==null&&(e.center!==void 0?t={x:e.center.x-.5*(s.x+h.x+a.x),y:e.center.y-.5*(s.y+h.y+a.y),z:e.center.z-.5*(s.z+h.z+a.z)}:t={x:0,y:0,z:0});var n=[{x:t.x,y:t.y,z:t.z},{x:t.x+s.x,y:t.y+s.y,z:t.z+s.z},{x:t.x+h.x,y:t.y+h.y,z:t.z+h.z},{x:t.x+s.x+h.x,y:t.y+s.y+h.y,z:t.z+s.z+h.z},{x:t.x+a.x,y:t.y+a.y,z:t.z+a.z},{x:t.x+s.x+a.x,y:t.y+s.y+a.y,z:t.z+s.z+a.z},{x:t.x+h.x+a.x,y:t.y+h.y+a.y,z:t.z+h.z+a.z},{x:t.x+s.x+h.x+a.x,y:t.y+s.y+h.y+a.y,z:t.z+s.z+h.z+a.z}],o=[],c=[];o.splice(o.length,0,n[0],n[1],n[2],n[3]),c.splice(c.length,0,0,2,1,1,2,3);var u=4;o.splice(o.length,0,n[2],n[3],n[6],n[7]),c.splice(c.length,0,u+0,u+2,u+1,u+1,u+2,u+3),u+=4,o.splice(o.length,0,n[4],n[5],n[0],n[1]),c.splice(c.length,0,u+0,u+2,u+1,u+1,u+2,u+3),u+=4,o.splice(o.length,0,n[6],n[7],n[4],n[5]),c.splice(c.length,0,u+0,u+2,u+1,u+1,u+2,u+3),u+=4,o.splice(o.length,0,n[3],n[1],n[7],n[5]),c.splice(c.length,0,u+0,u+2,u+1,u+1,u+2,u+3),u+=4,o.splice(o.length,0,n[2],n[6],n[0],n[4]),c.splice(c.length,0,u+0,u+2,u+1,u+1,u+2,u+3),u+=4;var E=(0,M.extend)({},e);E.vertexArr=o,E.faceArr=c,E.normalArr=[],x.drawCustom(this,this.geo,E);var A=new O.Vector3;this.components.push({centroid:A.addVectors(n[0],n[7]).multiplyScalar(.5)});var I=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,I.vertexArray,I.vertices)}addCylinder(e){var r,s;e.start?r=new O.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):r=new O.Vector3(0,0,0),e.end?(s=new O.Vector3(e.end.x,e.end.y||0,e.end.z||0),typeof s.x>"u"&&(s.x=3)):s=new O.Vector3(0,0,0);var h=e.radius||.1,a=P.CC.color(e.color);this.intersectionShape.cylinder.push(new S.Cylinder(r,s,h)),L.GLDraw.drawCylinder(this.geo,r,s,h,a,e.fromCap,e.toCap);var t=new O.Vector3;this.components.push({centroid:t.addVectors(r,s).multiplyScalar(.5)});var n=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,n.vertexArray,n.vertices)}addDashedCylinder(e){e.dashLength=e.dashLength||.25,e.gapLength=e.gapLength||.25;var r;e.start?r=new O.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):r=new O.Vector3(0,0,0);var s;e.end?(s=new O.Vector3(e.end.x,e.end.y||0,e.end.z||0),typeof s.x>"u"&&(s.x=3)):s=new O.Vector3(3,0,0);for(var h=e.radius||.1,a=P.CC.color(e.color),t=Math.sqrt(Math.pow(r.x-s.x,2)+Math.pow(r.y-s.y,2)+Math.pow(r.z-s.z,2)),n=t/(e.gapLength+e.dashLength),o=new O.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),c=new O.Vector3(e.end.x,e.end.y||0,e.end.z||0),u=new O.Vector3((s.x-r.x)/(t/e.gapLength),(s.y-r.y)/(t/e.gapLength),(s.z-r.z)/(t/e.gapLength)),E=new O.Vector3((s.x-r.x)/(t/e.dashLength),(s.y-r.y)/(t/e.dashLength),(s.z-r.z)/(t/e.dashLength)),A=0;A<n;A++)c=new O.Vector3(o.x+E.x,o.y+E.y,o.z+E.z),this.intersectionShape.cylinder.push(new S.Cylinder(o,c,h)),L.GLDraw.drawCylinder(this.geo,o,c,h,a,e.fromCap,e.toCap),o=new O.Vector3(c.x+u.x,c.y+u.y,c.z+u.z);var I=new O.Vector3;this.components.push({centroid:I.addVectors(r,s).multiplyScalar(.5)});var R=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,R.vertexArray,R.vertices)}addCurve(e){e.points=e.points||[],e.smooth=e.smooth||10,typeof e.fromCap>"u"&&(e.fromCap=2),typeof e.toCap>"u"&&(e.toCap=2);var r=(0,g.subdivide_spline)(e.points,e.smooth);if(r.length<3){console.log("Too few points in addCurve");return}var s=e.radius||.1,h=P.CC.color(e.color),a=0,t=r.length-1,n=r[0].distanceTo(r[1]),o=Math.ceil(2*s/n);if(e.toArrow){t-=o;let A={start:r[t],end:r[r.length-1],radius:s,color:h,mid:1e-4};this.addArrow(A)}if(e.fromArrow){a+=o;let A={start:r[a],end:r[0],radius:s,color:h,mid:1e-4};this.addArrow(A)}for(var c=Math.ceil(r.length/2),u={radius:s,color:h,fromCap:2,toCap:2},E=a;E<t;E++)u.start=r[E],u.end=r[E+1],u.fromCap=2,u.toCap=2,E<c?(u.fromCap=2,u.toCap=0):E>c?(u.fromCap=0,u.toCap=2):(u.fromCap=2,u.toCap=2),this.addCylinder(u)}addLine(e){var r,s;e.start?r=new O.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):r=new O.Vector3(0,0,0),e.end?(s=new O.Vector3(e.end.x,e.end.y||0,e.end.z||0),typeof s.x>"u"&&(s.x=3)):s=new O.Vector3(3,0,0);var h=this.geo.updateGeoGroup(2),a=h.vertices,t=a*3,n=h.vertexArray;n[t]=r.x,n[t+1]=r.y,n[t+2]=r.z,n[t+3]=s.x,n[t+4]=s.y,n[t+5]=s.z,h.vertices+=2;var o=h.lineArray,c=h.lineidx;o[c]=a,o[c+1]=a+1,h.lineidx+=2;var u=new O.Vector3;this.components.push({centroid:u.addVectors(r,s).multiplyScalar(.5)}),h=this.geo.updateGeoGroup(0),x.updateBoundingFromPoints(this.boundingSphere,this.components,h.vertexArray,h.vertices)}addArrow(e){if(e.start?e.start=new O.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):e.start=new O.Vector3(0,0,0),e.dir instanceof O.Vector3&&typeof e.length=="number"){var r=e.dir.clone().multiplyScalar(e.length).add(e.start);e.end=r}else e.end?(e.end=new O.Vector3(e.end.x,e.end.y||0,e.end.z||0),typeof e.end.x>"u"&&(e.end.x=3)):e.end=new O.Vector3(3,0,0);e.radius=e.radius||.1,e.radiusRatio=e.radiusRatio||1.618034,e.mid=0<e.mid&&e.mid<1?e.mid:.618034,x.drawArrow(this,this.geo,e);var s=new O.Vector3;this.components.push({centroid:s.addVectors(e.start,e.end).multiplyScalar(.5)});var h=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,h.vertexArray,h.vertices)}static distance_from(e,r){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)+Math.pow(e.z-r.z,2))}static inSelectedRegion(e,r,s){for(var h=0;h<r.length;h++)if(x.distance_from(r[h],e)<=s)return!0;return!1}addIsosurface(e,r,s){var h=r.isoval!==void 0&&typeof r.isoval=="number"?r.isoval:0,a=!!r.voxel,t=r.smoothness===void 0?1:r.smoothness,n=e.size.x,o=e.size.y,c=e.size.z,u=new Int16Array(n*o*c),E=e.data,A,I;for(A=0,I=u.length;A<I;++A)u[A]=-1;var R=new Uint8Array(n*o*c);for(A=0,I=E.length;A<I;++A){var C=h>=0?E[A]-h:h-E[A];C>0&&(R[A]|=x.ISDONE)}var z=[],V=[];v.MarchingCube.march(R,z,V,{fulltable:!0,voxel:a,unitCube:e.unit,origin:e.origin,matrix:e.matrix,nX:n,nY:o,nZ:c}),!a&&t>0&&v.MarchingCube.laplacianSmooth(t,z,V);var G=[],B=[],F=[];if(r.selectedRegion&&r.coords===void 0&&(r.coords=r.selectedRegion),r.coords!==void 0){var N=r.coords[0].x,j=r.coords[0].y,U=r.coords[0].z,k=r.coords[0].x,te=r.coords[0].y,he=r.coords[0].z;for(let fe=0;fe<r.coords.length;fe++)r.coords[fe].x>N?N=r.coords[fe].x:r.coords[fe].x<k&&(k=r.coords[fe].x),r.coords[fe].y>j?j=r.coords[fe].y:r.coords[fe].y<te&&(te=r.coords[fe].y),r.coords[fe].z>U?U=r.coords[fe].z:r.coords[fe].z<he&&(he=r.coords[fe].z);var re=2;r.radius!==void 0&&(re=r.radius),r.selectedOffset!==void 0&&(re=r.selectedOffset),r.seldist!==void 0&&(re=r.seldist),k-=re,N+=re,te-=re,j+=re,he-=re,U+=re;for(let fe=0;fe<z.length;fe++)z[fe].x>k&&z[fe].x<N&&z[fe].y>te&&z[fe].y<j&&z[fe].z>he&&z[fe].z<U&&x.inSelectedRegion(z[fe],r.coords,re)?(G.push(B.length),B.push(z[fe])):G.push(-1);for(let fe=0;fe+2<V.length;fe+=3)G[V[fe]]!==-1&&G[V[fe+1]]!==-1&&G[V[fe+2]]!==-1&&(F.push(V[fe]-(V[fe]-G[V[fe]])),F.push(V[fe+1]-(V[fe+1]-G[V[fe+1]])),F.push(V[fe+2]-(V[fe+2]-G[V[fe+2]])));z=B,V=F}x.drawCustom(this,this.geo,{vertexArr:z,faceArr:V,normalArr:[],clickable:r.clickable,hoverable:r.hoverable}),this.updateStyle(r);var ae=new O.Vector3(e.origin.x,e.origin.y,e.origin.z),pe=new O.Vector3(e.size.x*e.unit.x,e.size.y*e.unit.y,e.size.z*e.unit.z),oe=new O.Vector3(0,0,0),se=ae.clone(),Ce=ae.clone().add(pe);for(let fe=0;fe<z.length;fe++)oe.add(z[fe]),se.max(z[fe]),Ce.min(z[fe]);oe.divideScalar(z.length);var _e=oe.distanceTo(Ce),Se=oe.distanceTo(se);this.boundingSphere.center=oe,this.boundingSphere.radius=Math.max(_e,Se),typeof s=="function"&&s()}addVolumetricData(e,r,s){e=new _.VolumeData(e,r),this.addIsosurface(e,s)}finalize(){return x.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(e){if(this.renderedShapeObj&&(e.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){x.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),typeof this.color<"u"&&x.updateColor(this.geo,this.color),this.shapeObj=new w.Object3D;var r=null;this.side==w.DoubleSide?r=new w.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:w.Coloring.VertexColors}):r=new w.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:w.Coloring.VertexColors});var s=new w.Mesh(this.geo,r);this.shapeObj.add(s);var h=new w.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),a=new w.Line(this.linegeo,h,w.LineStyle.LinePieces);this.shapeObj.add(a),this.renderedShapeObj=this.shapeObj.clone(),e.add(this.renderedShapeObj)}}removegl(e){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),e.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}x.ISDONE=2,x.drawCustom=function(y,e,r){var s=r,h=s.vertexArr,a=s.faceArr;(h.length===0||a.length===0)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var t=r.color;typeof t>"u"&&(t=y.color),t=P.CC.color(t);for(var n=p(s),o=0,c=n.length;o<c;o++)x.addCustomGeo(y,e,n[o],n[o].colorArr?n[o].colorArr:t,r.clickable)};function p(y){var e=64e3;if(y.vertexArr.length<e)return[y];var r=[{vertexArr:[],normalArr:[],faceArr:[]}];y.colorArr&&(r.colorArr=[]);var s=[],h=[],a=0,t=y.faceArr;for(let o=0,c=t.length;o<c;o+=3){let u=r[a];for(let E=0;E<3;E++){var n=t[o+E];s[n]!==a&&(s[n]=a,h[n]=u.vertexArr.length,u.vertexArr.push(y.vertexArr[n]),y.normalArr&&y.normalArr[n]&&u.normalArr.push(y.normalArr[n]),y.colorArr&&y.colorArr[n]&&u.colorArr.push(y.colorArr[n])),u.faceArr.push(h[n])}u.vertexArr.length>=e&&(r.push({vertexArr:[],normalArr:[],faceArr:[]}),y.colorArr&&(r.colorArr=[]),a++)}return r}},"./src/GLViewer.ts":($,T,f)=>{f.r(T),f.d(T,{GLViewer:()=>e,createStereoViewer:()=>h,createViewer:()=>r,createViewerGrid:()=>s});var w=f("./src/WebGL/index.ts"),S=f("./src/WebGL/math/index.ts"),O=f("./src/colors.ts"),P=f("./src/utilities.ts"),v=f("./src/Gradient.ts"),_=f("./src/GLModel.ts"),L=f("./src/Label.ts"),g=f("./src/GLShape.ts"),M=f("./src/VolumeData.ts"),x=f("./src/ProteinSurface4.ts"),p=f("./src/VolumetricRender.ts"),y=f("./node_modules/upng-js/UPNG.js");class e{getRect(){let t=this.container,n=t.getBoundingClientRect();if(n.width==0&&n.height==0&&t.style.display==="none"){let o=t.style.position,c=t.style.visibility;t.style.display="block",t.style.visibility="hidden",t.style.position="absolute",n=t.getBoundingClientRect(),t.style.display="none",t.style.visibility=c,t.style.position=o}return n}getWidth(){return this.getRect().width}getHeight(){return this.getRect().height}setupRenderer(){this.renderer=new w.Renderer({antialias:this.config.antialias,preserveDrawingBuffer:!0,premultipliedAlpha:!1,id:this.config.id,row:this.config.row,col:this.config.col,rows:this.config.rows,cols:this.config.cols,canvas:this.config.canvas,containerWidth:this.WIDTH||1,containerHeight:this.HEIGHT||1}),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new w.Scene,this.scene.fog=new w.Fog(this.bgColor,100,200),this.modelGroup=new w.Object3D,this.rotationGroup=new w.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new S.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var t=new w.Light(16777215);t.position=new S.Vector3(.2,.2,1).normalize(),t.intensity=1,this.scene.add(t)}initContainer(t){this.container=t,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var t=0;for(let o in this.surfaces)if(this.surfaces.hasOwnProperty(o)){var n=parseInt(o);isNaN(n)||n>t&&(t=n)}return t+1}setSlabAndFog(){let t=this.camera.position.z-this.rotationGroup.position.z;t<1&&(t=1),this.camera.near=t+this.slabNear,this.camera.near<1&&(this.camera.near=1),this.camera.far=t+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=t*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.far,this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(t){if(this.renderer.setViewport(),!!this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!t&&this.linkedViewers.length>0))for(var n=this._viewer.getView(),o=0;o<this.linkedViewers.length;o++){var c=this.linkedViewers[o];c.setView(n,!0)}}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledAtoms.splice(0,this.contextMenuEnabledAtoms.length);for(let t=0,n=this.models.length;t<n;t++){let o=this.models[t];if(o){let c=o.selectedAtoms({clickable:!0}),u=o.selectedAtoms({hoverable:!0}),E=o.selectedAtoms({contextMenuEnabled:!0});for(let A=0;A<u.length;A++)this.hoverables.push(u[A]);for(let A=0;A<c.length;A++)this.clickables.push(c[A]);for(let A=0;A<E.length;A++)this.contextMenuEnabledAtoms.push(E[A])}}for(let t=0,n=this.shapes.length;t<n;t++){let o=this.shapes[t];o&&o.clickable&&this.clickables.push(o),o&&o.hoverable&&this.hoverables.push(o)}}handleClickSelection(t,n,o){let c=this.targetedObjects(t,n,this.clickables);if(c.length){var u=c[0].clickable;u.callback!==void 0&&(typeof u.callback!="function"&&(u.callback=(0,P.makeFunction)(u.callback)),typeof u.callback=="function"&&u.callback(u,this._viewer,o,this.container,c))}}canvasOffset(){let t=this.glDOM,n=t.getBoundingClientRect(),o=t.ownerDocument,c=o.documentElement,u=o.defaultView;return{top:n.top+u.pageYOffset-c.clientTop,left:n.left+u.pageXOffset-c.clientLeft}}setHover(t,n,o){this.current_hover!=t&&(this.current_hover&&(typeof this.current_hover.unhover_callback!="function"&&(this.current_hover.unhover_callback=(0,P.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,n,this.container,o)),this.current_hover=t,t&&t.hover_callback!==void 0&&(typeof t.hover_callback!="function"&&(t.hover_callback=(0,P.makeFunction)(t.hover_callback)),typeof t.hover_callback=="function"&&t.hover_callback(t,this._viewer,n,this.container,o)))}handleHoverSelection(t,n,o){if(this.hoverables.length==0)return;let c=this.targetedObjects(t,n,this.hoverables);if(c.length){var u=c[0].clickable;this.setHover(u,o,c),this.current_hover=u}else this.setHover(null)}handleHoverContinue(t,n){let o=this.targetedObjects(t,n,this.hoverables);(o.length==0||o[0]===void 0)&&this.setHover(null),o[0]!==void 0&&o[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(t,{allowTolerance:n=t.targetTouches,tolerance:o=5}={}){const c=this.getX(t),u=this.getY(t);if(n){const E=Math.abs(c-this.mouseStartX),A=Math.abs(u-this.mouseStartY);return E<=o&&A<=o}else return c===this.mouseStartX&&u===this.mouseStartY}calcTouchDistance(t){var n=t.targetTouches[0].pageX-t.targetTouches[1].pageX,o=t.targetTouches[0].pageY-t.targetTouches[1].pageY;return Math.sqrt(n*n+o*o)}getX(t){var n=t.pageX;return n==null&&(n=t.pageX),t.targetTouches&&t.targetTouches[0]?n=t.targetTouches[0].pageX:t.changedTouches&&t.changedTouches[0]&&(n=t.changedTouches[0].pageX),n}getY(t){var n=t.pageY;return n==null&&(n=t.pageY),t.targetTouches&&t.targetTouches[0]?n=t.targetTouches[0].pageY:t.changedTouches&&t.changedTouches[0]&&(n=t.changedTouches[0].pageY),n}isInViewer(t,n){if(this.viewers!=null&&!this.control_all){var o=this.WIDTH/this.cols,c=this.HEIGHT/this.rows,u=this.canvasOffset(),E=t-u.left,A=n-u.top,I=this.rows-Math.floor(A/c)-1,R=Math.floor(E/o);if(I!=this.row||R!=this.col)return!1}return!0}adjustZoomToLimits(t){if(this.config.lowerZoomLimit&&this.config.lowerZoomLimit>0){let n=this.CAMERA_Z-this.config.lowerZoomLimit;t>n&&(t=n)}if(this.config.upperZoomLimit&&this.config.upperZoomLimit>0){let n=this.CAMERA_Z-this.config.upperZoomLimit;t<n&&(t=n)}return t>this.CAMERA_Z&&(t=this.CAMERA_Z*.999),t}static slerp(t,n,o){if(o==1)return n.clone();if(o==0)return t.clone();let c=t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w;if(c>.9995){let z=new S.Quaternion(t.x+o*(n.x-t.x),t.y+o*(n.y-t.y),t.z+o*(n.z-t.z),t.w+o*(n.w-t.w));return z.normalize(),z}c<0&&(n=n.clone().multiplyScalar(-1),c=-c),c>1?c=1:c<-1&&(c=-1);var u=Math.acos(c),E=u*o,A=n.clone();A.sub(t.clone().multiplyScalar(c)),A.normalize();var I=Math.cos(E),R=Math.sin(E),C=new S.Quaternion(t.x*I+A.x*R,t.y*I+A.y*R,t.z*I+A.z*R,t.w*I+A.w*R);return C.normalize(),C}constructor(t,n={}){this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledAtoms=[],this.current_hover=null,this.hoverDuration=500,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.slabNear=-50,this.slabFar=50,this.cq=new S.Quaternion(0,0,0,1),this.dq=new S.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=n,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=O.elementColors.defaultColors),this.nomouse=this.config.nomouse,this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",typeof this.config.backgroundColor<"u"&&(this.bgColor=O.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=this.config.backgroundAlpha==null?1:this.config.backgroundAlpha,this.camerax=0,typeof this.config.camerax<"u"&&(this.camerax=parseFloat(this.config.camerax)),this._viewer=this,this.container=t,this.config.hoverDuration!=null&&(this.hoverDuration=this.config.hoverDuration),this.config.antialias===void 0&&(this.config.antialias=!0),this.config.cartoonQuality===void 0&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=this.config.row,this.col=this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new w.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new S.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new S.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new w.Raycaster(new S.Vector3(0,0,0),new S.Vector3(0,0,0)),this.projector=new w.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=O.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),typeof window.ResizeObserver<"u"&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container));try{typeof this.callback=="function"&&this.callback(this)}catch(o){console.log("error with glviewer callback: "+o)}}targetedObjects(t,n,o){var c={x:t,y:n,z:-1};return Array.isArray(o)||(o=this.selectedAtoms(o)),o.length==0?[]:(this.raycaster.setFromCamera(c,this.camera),this.raycaster.intersectObjects(this.modelGroup,o))}modelToScreen(t){let n=!1;Array.isArray(t)||(t=[t],n=!0);let o=[],c=this.canvasOffset();return t.forEach(u=>{let E=new S.Vector3(u.x,u.y,u.z);E.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(E,this.camera);let A=this.WIDTH*(E.x+1)/2+c.left,I=-this.HEIGHT*(E.y-1)/2+c.top;o.push({x:A,y:I})}),n&&(o=o[0]),o}screenOffsetToModel(t,n,o){var c=t/this.WIDTH,u=n/this.HEIGHT,E=o===void 0?this.rotationGroup.position.z:o,A=this.rotationGroup.quaternion,I=new S.Vector3(0,0,E);return this.projector.projectVector(I,this.camera),I.x+=c*2,I.y-=u*2,this.projector.unprojectVector(I,this.camera),I.z=0,I.applyQuaternion(A),I}screenToModelDistance(t,n){let o=this.canvasOffset(),c=new S.Vector3(n.x,n.y,n.z);c.applyMatrix4(this.modelGroup.matrixWorld);let u=c.clone();this.projector.projectVector(c,this.camera);let E=new S.Vector3((t.x-o.left)*2/this.WIDTH-1,(t.y-o.top)*2/-this.HEIGHT+1,c.z);return this.projector.unprojectVector(E,this.camera),E.distanceTo(u)}setViewChangeCallback(t){(typeof t=="function"||t==null)&&(this.viewChangeCallback=t)}setStateChangeCallback(t){(typeof t=="function"||t==null)&&(this.stateChangeCallback=t)}getConfig(){return this.config}setConfig(t){this.config=t}getInternalState(){var t={models:[],surfaces:[],shapes:[],labels:[]};for(let n=0;n<this.models.length;n++)this.models[n]&&(t.models[n]=this.models[n].getInternalState());return t}setInternalState(t){this.clear();var n=t.models;for(let o=0;o<n.length;o++)n[o]&&(this.models[o]=new _.GLModel(o),this.models[o].setInternalState(n[o]));this.render()}setZoomLimits(t,n){typeof t<"u"&&(this.config.lowerZoomLimit=t),n&&(this.config.upperZoomLimit=n),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(t){t.fov!==void 0&&(this.fov=t.fov,this.camera.fov=this.fov),t.z!==void 0&&(this.CAMERA_Z=t.z,this.camera.z=this.CAMERA_Z),t.orthographic!==void 0&&(this.camera.ortho=t.orthographic)}_handleMouseDown(t){if(t.preventDefault(),!this.scene)return;var n=this.getX(t),o=this.getY(t);if(n===void 0)return;this.isDragging=!0,this.mouseButton=t.which,this.mouseStartX=n,this.mouseStartY=o,this.touchHold=!0,this.touchDistanceStart=0,t.targetTouches&&t.targetTouches.length==2&&(this.touchDistanceStart=this.calcTouchDistance(t)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let c=this;setTimeout(function(){t.targetTouches&&c.touchHold==!0&&(c.glDOM=c.renderer.domElement,c.glDOM.dispatchEvent(new Event("contextmenu")))},1e3)}_handleMouseUp(t){if(this.touchHold=!1,this.isDragging&&this.scene){var n=this.getX(t),o=this.getY(t);if(this.closeEnoughForClick(t)){var c=this.canvasOffset(),u=(n-c.left)/this.WIDTH*2-1,E=-((o-c.top)/this.HEIGHT)*2+1;this.handleClickSelection(u,E,t)}}this.isDragging=!1}_handleMouseScroll(t){if(t.preventDefault(),!!this.scene){var n=this.getX(t),o=this.getY(t);if(n!==void 0&&this.isInViewer(n,o)){var c=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,u=1;t.ctrlKey&&(u=-1),t.detail?this.rotationGroup.position.z+=u*c*t.detail/10:t.wheelDelta&&(this.rotationGroup.position.z-=u*c*t.wheelDelta/400),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}}}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(t){let n=this;return t=t||1,new Promise(function(o){let c=0,u=n.viewChangeCallback,E=[],A=[],I=Date.now();n.viewChangeCallback=function(){A.push(Date.now()-I),I=Date.now(),E.push(new Promise(R=>{n.getCanvas().toBlob(function(C){C.arrayBuffer().then(R)},"image/png")})),c+=1,c==t&&(n.viewChangeCallback=u,Promise.all(E).then(R=>{let C=[];for(let N=0;N<R.length;N++){let j=(0,y.decode)(R[N]);C.push((0,y.toRGBA8)(j)[0])}let z=n.getCanvas().width,V=n.getCanvas().height,G=(0,y.encode)(C,z,V,0,A),B=new Blob([G],{type:"image/png"}),F=new FileReader;F.onload=function(N){o(N.target.result)},F.readAsDataURL(B)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(t){this.hoverDuration=t}_handleMouseMove(t){clearTimeout(this.hoverTimeout);var n=this.canvasOffset(),o=(this.getX(t)-n.left)/this.WIDTH*2-1,c=-((this.getY(t)-n.top)/this.HEIGHT)*2+1;let u=this;if(this.current_hover!==null&&this.handleHoverContinue(o,c),this.hoverables.length>0&&(this.hoverTimeout=setTimeout(function(){u.handleHoverSelection(o,c,t)},this.hoverDuration)),t.preventDefault(),!!this.scene&&this.isDragging){var E=0,A=this.getX(t),I=this.getY(t);if(A!==void 0&&this.isInViewer(A,I)){var R=(A-this.mouseStartX)/this.WIDTH,C=(I-this.mouseStartY)/this.HEIGHT;if(this.touchDistanceStart!=0&&t.targetTouches&&t.targetTouches.length==2){var z=this.calcTouchDistance(t);E=2,C=(z-this.touchDistanceStart)*2/(this.WIDTH+this.HEIGHT)}else t.targetTouches&&t.targetTouches.length==3&&(E=1);var V=this.renderer.getXRatio(),G=this.renderer.getYRatio();R*=V,C*=G;var B=Math.sqrt(R*R+C*C),F;if(E==3||this.mouseButton==3&&t.ctrlKey)this.slabNear=this.cslabNear+R*100,this.slabFar=this.cslabFar-C*100;else if(E==2||this.mouseButton==3||t.shiftKey)F=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,F<80&&(F=80),this.rotationGroup.position.z=this.cz+C*F,this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z);else if(E==1||this.mouseButton==2||t.ctrlKey){var N=this.screenOffsetToModel(V*(A-this.mouseStartX),G*(I-this.mouseStartY));this.modelGroup.position.addVectors(this.currentModelPos,N)}else if((E===0||this.mouseButton==1)&&B!==0){var j=Math.sin(B*Math.PI)/B;this.dq.x=Math.cos(B*Math.PI),this.dq.y=0,this.dq.z=j*R,this.dq.w=-j*C,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)}this.show()}}}_handleContextMenu(t){t.preventDefault();var n=this.getX(t),o=this.getY(t);if(!(n!=this.mouseStartX||o!=this.mouseStartY)){var I=this.mouseStartX,R=this.mouseStartY,A=this.canvasOffset(),c=(I-A.left)/this.WIDTH*2-1,u=-((R-A.top)/this.HEIGHT)*2+1;let C=this.targetedObjects(c,u,this.contextMenuEnabledAtoms);var E=null;C.length&&(E=C[0].clickable);var A=this.canvasOffset(),I=this.mouseStartX-A.left,R=this.mouseStartY-A.top;this.userContextMenuHandler&&this.userContextMenuHandler(E,I,R,C)}}setContainer(t){let n=(0,P.getElement)(t)||this.container;return this.initContainer(n),this}setBackgroundColor(t,n){(typeof n>"u"||n<0||n>1)&&(n=1);var o=O.CC.color(t);return this.scene.fog.color=o,this.bgColor=o.getHex(),this.renderer.setClearColorHex(o.getHex(),n),this.show(),this}setProjection(t){this.camera.ortho=t==="orthographic",this.setSlabAndFog()}setViewStyle(t){if(t.style==="outline"){var n={};t.color&&(n.color=O.CC.color(t.color)),t.width&&(n.width=t.width),this.renderer.enableOutline(n)}else this.renderer.disableOutline();return this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(t){return this.WIDTH=t||this.WIDTH,this.updateSize(),this}setHeight(t){return this.HEIGHT=t||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let t=!1;if(this.renderer.isLost()&&this.WIDTH>0&&this.HEIGHT>0&&(this.container.querySelector("canvas").remove(),this.setupRenderer(),this.initContainer(this.container),t=!0),this.WIDTH==0||this.HEIGHT==0?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),t){let n=this.renderer.supportedExtensions();n.regen=!0,this._viewer.render(null,n)}else this.show();return this}getModel(t){return t===void 0?this.models.length==0?null:this.models[this.models.length-1]:t instanceof _.GLModel?t:t in this.models?this.models[t]:this.models.length==0?null:this.models[this.models.length-1]}spin(t,n=1){if(clearInterval(this.spinInterval),typeof t>"u"&&(t="y"),typeof t=="boolean")if(t)t="y";else return;Array.isArray(t)&&(t={x:t[0],y:t[1],z:t[2]});var o=this;this.spinInterval=setInterval(function(){!o.getCanvas().isConnected&&o.renderer.isLost()&&clearInterval(o.spinInterval),o.rotate(1*n,t)},25)}animateMotion(t,n,o,c,u,E){var A=20,I=Math.ceil(t/A);I<1&&(I=1),this.incAnim();var R={mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()};if(n){let V=new Array(I);for(let N=0;N<I;N++){let j=(N+1)/I,U={mpos:R.mpos,rz:R.rz,rot:R.rot};U.mpos=o.clone().sub(R.mpos).multiplyScalar(j).add(R.mpos),U.rz=R.rz+j*(c-R.rz),U.rot=e.slerp(R.rot,u,j),U.cam=E.clone().sub(R.cam).multiplyScalar(j).add(R.cam),V[N]=U}let G=0,B=this,F=function(){var N=V[G];G+=1,B.modelGroup.position=N.mpos,B.rotationGroup.position.z=N.rz,B.rotationGroup.quaternion=N.rot,B.camera.lookAt(N.cam),G<V.length?setTimeout(F,A):B.decAnim(),B.show()};setTimeout(F,A)}else{var C={};let V=1/I;if(o&&(C.mpos=o.clone().sub(R.mpos).multiplyScalar(V)),typeof c<"u"&&c!=null&&(C.rz=V*(c-R.rz)),u){var z=e.slerp(R.rot,u,V);C.rot=R.rot.clone().inverse().multiply(z)}E&&(C.cam=E.clone().sub(R.cam).multiplyScalar(V));let G=0,B=this,F=function(){G+=1,C.mpos&&B.modelGroup.position.add(C.mpos),C.rz&&(B.rotationGroup.position.z+=C.rz),C.rot&&B.rotationGroup.quaternion.multiply(C.rot),C.cam&&(B.lookingAt.add(C.cam),B.camera.lookAt(B.lookingAt)),G<I?setTimeout(F,A):B.decAnim(),B.show()};setTimeout(F,A)}}rotate(t,n="y",o=0,c=!1){if(n=="x"?n={x:1,y:0,z:0}:n=="y"?n={x:0,y:1,z:0}:n=="z"&&(n={x:0,y:0,z:1}),n=="vx"?n={vx:1,vy:0,vz:0}:n=="vy"?n={vx:0,vy:1,vz:0}:n=="vz"&&(n={vx:0,vy:0,vz:1}),typeof n.vx<"u"){var u=new S.Vector3(n.vx,n.vy,n.vz);u.applyQuaternion(this.rotationGroup.quaternion),n={x:u.x,y:u.y,z:u.z}}var E=function(C){var z=Math.sin(C/2),V=Math.cos(C/2),G=0,B=0,F=0;return G=n.x*z,B=n.y*z,F=n.z*z,new S.Quaternion(G,B,F,V).normalize()},A=Math.PI*t/180,I=E(A);if(o){var R=new S.Quaternion().copy(this.rotationGroup.quaternion).multiply(I);this.animateMotion(o,c,this.modelGroup.position,this.rotationGroup.position.z,R,this.lookingAt)}else this.rotationGroup.quaternion.multiply(I),this.show();return this}surfacesFinished(){for(var t in this.surfaces)if(!this.surfaces[t][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var t=this.modelGroup.position,n=this.rotationGroup.quaternion;return[t.x,t.y,t.z,this.rotationGroup.position.z,n.x,n.y,n.z,n.w]}setView(t,n){return t===void 0||!(t instanceof Array||t.length!==8)?this:!this.modelGroup||!this.rotationGroup?this:(this.modelGroup.position.x=t[0],this.modelGroup.position.y=t[1],this.modelGroup.position.z=t[2],this.rotationGroup.position.z=t[3],this.rotationGroup.quaternion.x=t[4],this.rotationGroup.quaternion.y=t[5],this.rotationGroup.quaternion.z=t[6],this.rotationGroup.quaternion.w=t[7],typeof t[8]<"u"&&(this.rotationGroup.position.x=t[8],this.rotationGroup.position.y=t[9]),this.show(n),this)}render(t,n){this.renderer.setViewport(),this.updateClickables();var o=this.getView();this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState());var c,u;for(n||(n=this.renderer.supportedExtensions()),c=0;c<this.models.length;c++)this.models[c]&&this.models[c].globj(this.modelGroup,n);for(c=0;c<this.shapes.length;c++)this.shapes[c]&&(typeof this.shapes[c].frame>"u"||this.viewer_frame<0||this.shapes[c].frame<0||this.shapes[c].frame==this.viewer_frame?this.shapes[c].globj(this.modelGroup,n):this.shapes[c].removegl(this.modelGroup));for(c=0;c<this.labels.length;c++)this.labels[c]&&typeof this.labels[c].frame<"u"&&this.labels[c].frame>=0&&(this.modelGroup.remove(this.labels[c].sprite),(this.viewer_frame<0||this.labels[c].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[c].sprite));for(c in this.surfaces)if(this.surfaces.hasOwnProperty(c)){var E=this.surfaces[c];for(u=0;u<E.length;u++)if(E.hasOwnProperty(u)){var A=E[u].geo;if(!E[u].finished||n.regen){A.verticesNeedUpdate=!0,A.elementsNeedUpdate=!0,A.normalsNeedUpdate=!0,A.colorsNeedUpdate=!0,A.buffersNeedUpdate=!0,A.boundingSphere=null,E[u].done&&(E[u].finished=!0),E[u].lastGL&&this.modelGroup.remove(E[u].lastGL);var I=null;if(E[u].mat instanceof w.LineBasicMaterial?I=new w.Line(A,E[u].mat):I=new w.Mesh(A,E[u].mat),E[u].mat.transparent&&E[u].mat.opacity==0?I.visible=!1:I.visible=!0,E[u].symmetries.length>1||E[u].symmetries.length==1&&!E[u].symmetries[u].isIdentity()){var R,C=new w.Object3D;for(R=0;R<E[u].symmetries.length;R++){var z=I.clone();z.matrix=E[u].symmetries[R],z.matrixAutoUpdate=!1,C.add(z)}E[u].lastGL=C,this.modelGroup.add(C)}else E[u].lastGL=I,this.modelGroup.add(I)}}}return this.setView(o),typeof t=="function"&&t(this),this}getModelList(t){let n=[];if(typeof t>"u"||typeof t.model>"u")for(let c=0;c<this.models.length;c++)this.models[c]&&n.push(this.models[c]);else{let c=t.model;Array.isArray(c)||(c=[c]);for(let u=0;u<c.length;u++)if(typeof c[u]=="number"){var o=c[u];o<0&&(o+=this.models.length),n.push(this.models[o])}else n.push(c[u])}return n}getAtomsFromSel(t){var n=[];typeof t>"u"&&(t={});var o=this.getModelList(t);for(let c=0;c<o.length;c++)n=n.concat(o[c].selectedAtoms(t));return n}atomIsSelected(t,n){typeof n>"u"&&(n={});for(var o=this.getModelList(n),c=0;c<o.length;c++)if(o[c].atomIsSelected(t,n))return!0;return!1}selectedAtoms(t){return this.getAtomsFromSel(t)}getUniqueValues(t,n){typeof n>"u"&&(n={});var o=this.getAtomsFromSel(n),c={};for(var u in o)if(o[u].hasOwnProperty(t)){var E=o[u][t];c[E]=!0}return Object.keys(c)}pdbData(t){for(var n=this.getAtomsFromSel(t),o="",c=0,u=n.length;c<u;++c)o+=n[c].pdbline+`
`;return o}zoom(t=2,n=0,o=!1){var c=(this.CAMERA_Z-this.rotationGroup.position.z)/t,u=this.CAMERA_Z-c;return n>0?this.animateMotion(n,o,this.modelGroup.position,this.adjustZoomToLimits(u),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(u),this.show()),this}translate(t,n,o=0,c=!1){var u=t/this.WIDTH,E=n/this.HEIGHT,A=new S.Vector3(0,0,-this.CAMERA_Z);this.projector.projectVector(A,this.camera),A.x-=u,A.y-=E,this.projector.unprojectVector(A,this.camera),A.z=0;var I=this.lookingAt.clone().add(A);return o>0?this.animateMotion(o,c,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,I):(this.lookingAt=I,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(t,n,o=0,c=!1){var u=this.screenOffsetToModel(t,n),E=this.modelGroup.position.clone().add(u);return o>0?this.animateMotion(o,c,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=E,this.show()),this}fitSlab(t){t=t||{};var n=this.getAtomsFromSel(t),o=(0,P.getExtent)(n),c=o[1][0]-o[0][0],u=o[1][1]-o[0][1],E=o[1][2]-o[0][2],A=Math.sqrt(c*c+u*u+E*E);return A<5&&(A=5),this.slabNear=-A/1.9,this.slabFar=A/2,this}center(t={},n=0,o=!1){var c,u,E=this.getAtomsFromSel(t),A=(0,P.getExtent)(E);(0,P.isEmptyObject)(t)?(this.shapes.forEach(j=>{if(j&&j.boundingSphere&&j.boundingSphere.center){var U=j.boundingSphere.center,k=j.boundingSphere.radius;k>0?(E.push(new S.Vector3(U.x+k,U.y,U.z)),E.push(new S.Vector3(U.x-k,U.y,U.z)),E.push(new S.Vector3(U.x,U.y+k,U.z)),E.push(new S.Vector3(U.x,U.y-k,U.z)),E.push(new S.Vector3(U.x,U.y,U.z+k)),E.push(new S.Vector3(U.x,U.y,U.z-k))):E.push(U)}}),A=(0,P.getExtent)(E),c=E,u=A):(c=this.getAtomsFromSel({}),u=(0,P.getExtent)(c));var I=new S.Vector3(A[2][0],A[2][1],A[2][2]),R=u[1][0]-u[0][0],C=u[1][1]-u[0][1],z=u[1][2]-u[0][2],V=Math.sqrt(R*R+C*C+z*z);V<5&&(V=5),this.slabNear=-V/1.9,this.slabFar=V/2,R=A[1][0]-A[0][0],C=A[1][1]-A[0][1],z=A[1][2]-A[0][2],V=Math.sqrt(R*R+C*C+z*z),V<5&&(V=5);for(var G=25,B=0;B<E.length;B++)if(E[B]){var F=I.distanceToSquared(E[B]);F>G&&(G=F)}V=Math.sqrt(G)*2;var N=I.clone().multiplyScalar(-1);return n>0?this.animateMotion(n,o,N,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=N,this.show()),this}zoomTo(t={},n=0,o=!1){let c=this.getAtomsFromSel(t),u=(0,P.getExtent)(c),E=u;if((0,P.isEmptyObject)(t)){let U=c&&c.length;if(this.shapes.forEach(k=>{if(k&&k.boundingSphere){if(k.boundingSphere.box){let re=k.boundingSphere.box;c.push(new S.Vector3(re.min.x,re.min.y,re.min.z)),c.push(new S.Vector3(re.max.x,re.max.y,re.max.z))}else if(k.boundingSphere.center){var te=k.boundingSphere.center,he=k.boundingSphere.radius;he>0?(c.push(new S.Vector3(te.x+he,te.y,te.z)),c.push(new S.Vector3(te.x-he,te.y,te.z)),c.push(new S.Vector3(te.x,te.y+he,te.z)),c.push(new S.Vector3(te.x,te.y-he,te.z)),c.push(new S.Vector3(te.x,te.y,te.z+he)),c.push(new S.Vector3(te.x,te.y,te.z-he))):c.push(te)}}}),E=(0,P.getExtent)(c),!U)for(let k=0;k<3;k++)u[2][k]=(E[0][k]+E[1][k])/2}else{let U=this.getAtomsFromSel({});E=(0,P.getExtent)(U)}var A=new S.Vector3(u[2][0],u[2][1],u[2][2]),I=E[1][0]-E[0][0],R=E[1][1]-E[0][1],C=E[1][2]-E[0][2],z=Math.sqrt(I*I+R*R+C*C);z<5&&(z=5),this.slabNear=-z/1.9,this.slabFar=z/2,Object.keys(t).length===0&&(this.slabNear=Math.min(-z*2,-50),this.slabFar=Math.max(z*2,50));var V=this.config.minimumZoomToDistance||5;I=u[1][0]-u[0][0],R=u[1][1]-u[0][1],C=u[1][2]-u[0][2],z=Math.sqrt(I*I+R*R+C*C),z<V&&(z=V);for(var G=V*V,B=0;B<c.length;B++)if(c[B]){var F=A.distanceToSquared(c[B]);F>G&&(G=F)}z=Math.sqrt(G)*2;var N=A.clone().multiplyScalar(-1),j=-(z*.5/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z);return j=this.adjustZoomToLimits(j),n>0?this.animateMotion(n,o,N,j,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=N,this.rotationGroup.position.z=j,this.show()),this}setSlab(t,n){this.slabNear=t,this.slabFar=n}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(t,n={},o,c=!1){if(o){var u=(0,P.getExtent)(this.getAtomsFromSel(o));n.position={x:u[2][0],y:u[2][1],z:u[2][2]}}var E=new L.Label(t,n);return E.setContext(),this.modelGroup.add(E.sprite),this.labels.push(E),c||this.show(),E}addResLabels(t,n,o=!1){let c=this.labels.length;return this.applyToModels("addResLabels",t,this,n,o),this.show(),this.labels.slice(c)}addPropertyLabels(t,n,o){return this.applyToModels("addPropertyLabels",t,n,this,o),this.show(),this}removeLabel(t){for(var n=0;n<this.labels.length;n++)if(this.labels[n]==t){this.labels.splice(n,1),t.dispose(),this.modelGroup.remove(t.sprite);break}return this.show(),this}removeAllLabels(){for(var t=0;t<this.labels.length;t++)this.labels[t]&&this.labels[t].sprite&&this.modelGroup.remove(this.labels[t].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}setLabelStyle(t,n){return this.modelGroup.remove(t.sprite),t.dispose(),t.stylespec=n,t.setContext(),this.modelGroup.add(t.sprite),this.show(),t}setLabelText(t,n){return this.modelGroup.remove(t.sprite),t.dispose(),t.text=n,t.setContext(),this.modelGroup.add(t.sprite),this.show(),t}addShape(t){t=t||{};var n=new g.GLShape(t);return n.shapePosition=this.shapes.length,this.shapes.push(n),n}removeShape(t){if(!t)return this;for(t.removegl(this.modelGroup),delete this.shapes[t.shapePosition];this.shapes.length>0&&typeof this.shapes[this.shapes.length-1]>"u";)this.shapes.pop();return this}removeAllShapes(){for(var t=0;t<this.shapes.length;t++){var n=this.shapes[t];n&&n.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(t){if(t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z"))return t;var n=this.getAtomsFromSel(t);if(n.length==0)return{x:0,y:0,z:0};var o=(0,P.getExtent)(n);return{x:o[0][0]+(o[1][0]-o[0][0])/2,y:o[0][1]+(o[1][1]-o[0][1])/2,z:o[0][2]+(o[1][2]-o[0][2])/2}}addSphere(t){t=t||{},t.center=this.getSelectionCenter(t.center);var n=new g.GLShape(t);return n.shapePosition=this.shapes.length,n.addSphere(t),this.shapes.push(n),n.finalize(),n}addBox(t={}){t.corner!=null&&(t.corner=this.getSelectionCenter(t.corner)),t.center!=null&&(t.center=this.getSelectionCenter(t.center));var n=new g.GLShape(t);return n.shapePosition=this.shapes.length,n.addBox(t),this.shapes.push(n),n.finalize(),n}addArrow(t={}){t.start=this.getSelectionCenter(t.start),t.end=this.getSelectionCenter(t.end);var n=new g.GLShape(t);return n.shapePosition=this.shapes.length,n.addArrow(t),this.shapes.push(n),n.finalize(),n}addCylinder(t={}){t.start=this.getSelectionCenter(t.start),t.end=this.getSelectionCenter(t.end);var n=new g.GLShape(t);return n.shapePosition=this.shapes.length,t.dashed?n.addDashedCylinder(t):n.addCylinder(t),this.shapes.push(n),n.finalize(),n}addCurve(t={}){var n=new g.GLShape(t);return n.shapePosition=this.shapes.length,n.addCurve(t),this.shapes.push(n),n.finalize(),n}addLine(t={}){t.start=this.getSelectionCenter(t.start),t.end=this.getSelectionCenter(t.end),t.wireframe=!0;var n=new g.GLShape(t);return n.shapePosition=this.shapes.length,t.dashed?n=this.addLineDashed(t,n):n.addLine(t),this.shapes.push(n),n.finalize(),n}addUnitCell(t,n){t=this.getModel(t),n=n||{alabel:"a",blabel:"b",clabel:"c"},n.box=n.box||{},n.astyle=n.astyle||{color:"red",radius:.1,midpos:-1},n.bstyle=n.bstyle||{color:"green",radius:.1,midpos:-1},n.cstyle=n.cstyle||{color:"blue",radius:.1,midpos:-1},n.alabelstyle=n.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},n.blabelstyle=n.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},n.clabelstyle=n.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},t.unitCellObjects&&this.removeUnitCell(t),t.unitCellObjects={shapes:[],labels:[]};var o=t.getCrystData(),c=null;if(o){if(o.matrix)c=o.matrix;else{var u=o.a,E=o.b,A=o.c,I=o.alpha,R=o.beta,C=o.gamma;I=I*Math.PI/180,R=R*Math.PI/180,C=C*Math.PI/180;var z,V,G;z=Math.cos(R),V=(Math.cos(I)-Math.cos(R)*Math.cos(C))/Math.sin(C),G=Math.sqrt(Math.max(0,1-z*z-V*V)),c=new S.Matrix3(u,E*Math.cos(C),A*z,0,E*Math.sin(C),A*V,0,0,A*G)}var B=[new S.Vector3(0,0,0),new S.Vector3(1,0,0),new S.Vector3(0,1,0),new S.Vector3(0,0,1),new S.Vector3(1,1,0),new S.Vector3(0,1,1),new S.Vector3(1,0,1),new S.Vector3(1,1,1)];if(o.matrix4)for(let N=0;N<B.length;N++)o.size&&B[N].multiplyVectors(B[N],o.size),B[N]=B[N].applyMatrix4(o.matrix4);else for(let N=0;N<B.length;N++)B[N]=B[N].applyMatrix3(c);if(n.box&&!n.box.hidden){n.box.wireframe=!0;var F=new g.GLShape(n.box);F.shapePosition=this.shapes.length,F.addLine({start:B[0],end:B[1]}),F.addLine({start:B[0],end:B[2]}),F.addLine({start:B[1],end:B[4]}),F.addLine({start:B[2],end:B[4]}),F.addLine({start:B[0],end:B[3]}),F.addLine({start:B[3],end:B[5]}),F.addLine({start:B[2],end:B[5]}),F.addLine({start:B[1],end:B[6]}),F.addLine({start:B[4],end:B[7]}),F.addLine({start:B[6],end:B[7]}),F.addLine({start:B[3],end:B[6]}),F.addLine({start:B[5],end:B[7]}),this.shapes.push(F),t.unitCellObjects.shapes.push(F),F.finalize()}if(!n.astyle.hidden){n.astyle.start=B[0],n.astyle.end=B[1];let N=this.addArrow(n.astyle);t.unitCellObjects.shapes.push(N)}if(!n.bstyle.hidden){n.bstyle.start=B[0],n.bstyle.end=B[2];let N=this.addArrow(n.bstyle);t.unitCellObjects.shapes.push(N)}if(!n.cstyle.hidden){n.cstyle.start=B[0],n.cstyle.end=B[3];let N=this.addArrow(n.cstyle);t.unitCellObjects.shapes.push(N)}if(n.alabel){n.alabelstyle.position=B[1];let N=this.addLabel(n.alabel,n.alabelstyle);t.unitCellObjects.labels.push(N)}if(n.blabel){n.blabelstyle.position=B[2];let N=this.addLabel(n.blabel,n.blabelstyle);t.unitCellObjects.labels.push(N)}if(n.clabel){n.clabelstyle.position=B[3];let N=this.addLabel(n.clabel,n.clabelstyle);t.unitCellObjects.labels.push(N)}}}removeUnitCell(t){if(t=this.getModel(t),t.unitCellObjects){let n=this;t.unitCellObjects.shapes.forEach(function(o){n.removeShape(o)}),t.unitCellObjects.labels.forEach(function(o){n.removeLabel(o)})}delete t.unitCellObjects}replicateUnitCell(t=3,n=t,o=n,c,u){c=this.getModel(c);let E=c.getCrystData();if(E){const A=c.selectedAtoms({}),I=E.matrix;let R=function(C){return C%2==0?-C/2:Math.ceil(C/2)};for(let C=0;C<t;C++)for(let z=0;z<n;z++)for(let V=0;V<o;V++){if(C==0&&z==0&&V==0)continue;let G=new S.Vector3(R(C),R(z),R(V));G.applyMatrix3(I);let B=[];for(let F=0;F<A.length;F++){let N={};for(let j in A[F])N[j]=A[F][j];N.x+=G.x,N.y+=G.y,N.z+=G.z,B.push(N)}c.addAtoms(B)}u&&c.assignBonds()}}addLineDashed(t,n){t.dashLength=t.dashLength||.5,t.gapLength=t.gapLength||.5;var o;t.start?o=new S.Vector3(t.start.x||0,t.start.y||0,t.start.z||0):o=new S.Vector3(0,0,0);var c;t.end?c=new S.Vector3(t.end.x,t.end.y||0,t.end.z||0):c=new S.Vector3(0,0,0);var u=new S.Vector3,E=new S.Vector3,A=new S.Vector3,I,R,C,z=o.clone(),V=0;for(u.subVectors(c,o),I=u.length(),u.normalize(),E=u.clone(),A=u.clone(),E.multiplyScalar(t.dashLength),A.multiplyScalar(t.gapLength),R=E.length(),C=A.length();V<I;){if(V+R>I){t.start=o,t.end=c,n.addLine(t);break}z.addVectors(o,E),t.start=o,t.end=z,n.addLine(t),o=z.clone(),V+=R,z.addVectors(o,A),o=z.clone(),V+=C}return n.finalize(),n}addCustom(t){t=t||{};var n=new g.GLShape(t);return n.shapePosition=this.shapes.length,n.addCustom(t),this.shapes.push(n),n.finalize(),n}addVolumetricData(t,n,o={}){var c=new M.VolumeData(t,n);return o.hasOwnProperty("transferfn")?this.addVolumetricRender(c,o):this.addIsosurface(c,o)}addIsosurface(t,n={},o){var c=new g.GLShape(n);return c.shapePosition=this.shapes.length,c.addIsosurface(t,n,o),this.shapes.push(c),c}addVolumetricRender(t,n){n=n||{};var o=new p.GLVolumetricRender(t,n);return o.shapePosition=this.shapes.length,this.shapes.push(o),o}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(t){t?this.scene.fog=new w.Fog(this.bgColor,100,200):(this.config.disableFog=!0,this.show())}setFrame(t){this.viewer_frame=t;let n=this;return new Promise(function(o){var c=n.models.map(function(u){return u.setFrame(t,n)});Promise.all(c).then(function(){o()})})}getFrame(){return this.viewer_frame}getNumFrames(){var t=0;for(let n=0;n<this.models.length;n++)this.models[n].getNumFrames()>t&&(t=this.models[n].getNumFrames());for(let n=0;n<this.shapes.length;n++)this.shapes[n].frame&&this.shapes[n].frame>=t&&(t=this.shapes[n].frame+1);for(let n=0;n<this.labels.length;n++)this.labels[n].frame&&this.labels[n].frame>=t&&(t=this.labels[n].frame+1);return t}animate(t){this.incAnim();var n=100,o="forward",c=0;t=t||{},t.interval&&(n=t.interval),t.loop&&(o=t.loop),t.reps&&(c=t.reps);var u=this.getNumFrames(),E=this,A=0;t.startFrame&&(A=t.startFrame%u);var I=1;t.step&&(I=t.step,c/=I);var R=0,C=u*c,z=new Date,V,G,B=function(F){z=new Date,F=="forward"?E.setFrame(A).then(function(){A=(A+I)%u,V()}):F=="backward"?E.setFrame(u-1-A).then(function(){A=(A+I)%u,V()}):E.setFrame(A).then(function(){A+=I,I*=A%(u-1)==0?-1:1,V()})};return V=function(){if(E.render(),!E.getCanvas().isConnected)E.stopAnimate();else if(++R==C||!E.isAnimated())G.cancel(),E.animationTimers.delete(G),E.decAnim();else{var F=n-(new Date().getTime()-z.getTime());F=F>0?F:0,E.animationTimers.delete(G),G=new P.PausableTimer(B,F,o),E.animationTimers.add(G)}},G=new P.PausableTimer(B,0,o),this.animationTimers.add(G),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(t){t.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(t){t.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(t){t.resume()}),this}isAnimated(){return this.animated>0}addModel(t,n="",o){o&&!o.defaultcolors?(o.defaultcolors=this.defaultcolors,o.cartoonQuality=o.cartoonQuality||this.config.cartoonQuality):typeof o>"u"&&(o={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality});var c=new _.GLModel(this.models.length,o);return c.addMolData(t,n,o),this.models.push(c),c}addModels(t,n,o){o=o||{},o.multimodel=!0,o.frames=!0;for(var c=_.GLModel.parseMolData(t,n,o),u=0;u<c.length;u++){var E=new _.GLModel(this.models.length,this.defaultcolors);E.setAtomDefaults(c[u]),E.addFrame(c[u]),E.setFrame(0),c.modelData&&E.setModelData(c.modelData[u]),E.setDontDuplicateAtoms(!o.duplicateAssemblyAtoms),this.models.push(E)}return this.models}addModelsAsFrames(t,n,o){o=o||{},o.multimodel=!0,o.frames=!0;var c=new _.GLModel(this.models.length,this.defaultcolors);return c.addMolData(t,n,o),this.models.push(c),c}addAsOneMolecule(t,n,o){o=o||{},o.multimodel=!0,o.onemol=!0;var c=new _.GLModel(this.models.length,this.defaultcolors);return c.addMolData(t,n,o),this.models.push(c),c}removeModel(t){if(t=this.getModel(t),!!t){for(t.removegl(this.modelGroup),delete this.models[t.getID()];this.models.length>0&&typeof this.models[this.models.length-1]>"u";)this.models.pop();return this}}removeAllModels(){for(var t=0;t<this.models.length;t++){var n=this.models[t];n&&n.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(t,n){var o={};return n===void 0?o.m=this.models.map(function(c){return c.toCDObject(t)}):o.m=[this.models[n].toCDObject()],JSON.stringify(o)}exportVRML(){var t=this.modelGroup;this.applyToModels("removegl",this.modelGroup),this.modelGroup=new w.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var n=`#VRML V2.0 utf8
`+this.modelGroup.vrml()+`
`;return this.applyToModels("removegl",this.modelGroup),this.modelGroup=t,n}createModelFrom(t,n=!1){for(var o=new _.GLModel(this.models.length,this.defaultcolors),c=0;c<this.models.length;c++)if(this.models[c]){var u=this.models[c].selectedAtoms(t);o.addAtoms(u),n&&this.models[c].removeAtoms(u)}return this.models.push(o),o}applyToModels(t,n,o,c,u,E,A){for(var I=this.getModelList(n),R=0;R<I.length;R++)I[R][t](n,o,c,u,E,A)}setStyle(t,n){return typeof n>"u"&&(n=t,t={}),this.applyToModels("setStyle",t,n,!1),this}addStyle(t,n){return typeof n>"u"&&(n=t,t={}),this.applyToModels("setStyle",t,n,!0),this}setClickable(t,n,o){return this.applyToModels("setClickable",t,n,o),this}setHoverable(t,n,o,c){return this.applyToModels("setHoverable",t,n,o,c),this}enableContextMenu(t,n){return this.applyToModels("enableContextMenu",t,n),this}vibrate(t,n,o,c){return this.applyToModels("vibrate",t,n,o,this,c),this}setColorByProperty(t,n,o,c){return this.applyToModels("setColorByProperty",t,n,o,c),this}setColorByElement(t,n){return this.applyToModels("setColorByElement",t,n),this}static getAtomsWithin(t,n){var o=[];for(let u=0;u<t.length;u++){var c=t[u];typeof c>"u"||c.x<n[0][0]||c.x>n[1][0]||c.y<n[0][1]||c.y>n[1][1]||c.z<n[0][2]||c.z>n[1][2]||o.push(c)}return o}static volume(t){var n=t[1][0]-t[0][0],o=t[1][1]-t[0][1],c=t[1][2]-t[0][2];return n*o*c}carveUpExtent(t,n,o){let c=[],u={};for(let z=0,V=n.length;z<V;z++)u[n[z].index]=z;let E=function(z){let V=[];for(let G=0,B=z.length;G<B;G++)z[G].index in u&&V.push(u[z[G].index]);return V},A=function(z){let V=[];return V[0]=[z[0][0],z[0][1],z[0][2]],V[1]=[z[1][0],z[1][1],z[1][2]],V},I=function(z){if(e.volume(z)<e.maxVolume)return[z];var V=z[1][0]-z[0][0],G=z[1][1]-z[0][1],B=z[1][2]-z[0][2],F;V>G&&V>B?F=0:G>V&&G>B?F=1:F=2;var N=A(z),j=A(z),U=(z[1][F]-z[0][F])/2+z[0][F];N[1][F]=U,j[0][F]=U;var k=I(N),te=I(j);return k.concat(te)},R=I(t),C=6;for(let z=0,V=R.length;z<V;z++){let G=A(R[z]);G[0][0]-=C,G[0][1]-=C,G[0][2]-=C,G[1][0]+=C,G[1][1]+=C,G[1][2]+=C;let B=e.getAtomsWithin(n,G),F=e.getAtomsWithin(o,R[z]);c.push({extent:R[z],atoms:E(B),toshow:E(F)})}return c}static generateSurfaceMesh(t,n,o){var c=new w.Geometry(!0),u=c.updateGeoGroup(0),E=[];for(let _e=0,Se=t.length;_e<Se;_e++){var A=t[_e];A&&(typeof A.surfaceColor<"u"?E[_e]=A.surfaceColor:A.color&&(E[_e]=O.CC.color(A.color)))}var I=u.vertexArray,R=n.vertices;for(let _e=0,Se=R.length;_e<Se;_e++){let fe=u.vertices*3;I[fe]=R[_e].x,I[fe+1]=R[_e].y,I[fe+2]=R[_e].z,u.vertices++}var C=u.colorArray;if(o.voldata&&o.volscheme){var z=o.volscheme,V=o.voldata,G=z.range()||[-1,1];for(let _e=0,Se=R.length;_e<Se;_e++){let fe=V.getVal(R[_e].x,R[_e].y,R[_e].z),xe=O.CC.color(z.valueToHex(fe,G)),Ee=_e*3;C[Ee]=xe.r,C[Ee+1]=xe.g,C[Ee+2]=xe.b}}else if(E.length>0)for(let _e=0,Se=R.length;_e<Se;_e++){let fe=R[_e].atomid,xe=_e*3;C[xe]=E[fe].r,C[xe+1]=E[fe].g,C[xe+2]=E[fe].b}var B=n.faces;u.faceidx=B.length,c.initTypedArrays();var F=u.vertexArray,N=u.normalArray,j,U,k,te;for(let _e=0,Se=B.length;_e<Se;_e+=3){var he=B[_e],re=B[_e+1],ae=B[_e+2],pe=he*3,oe=re*3,se=ae*3;j=new S.Vector3(F[pe],F[pe+1],F[pe+2]),U=new S.Vector3(F[oe],F[oe+1],F[oe+2]),k=new S.Vector3(F[se],F[se+1],F[se+2]),k.subVectors(k,U),j.subVectors(j,U),k.cross(j),te=k,te.normalize(),N[pe]+=te.x,N[oe]+=te.x,N[se]+=te.x,N[pe+1]+=te.y,N[oe+1]+=te.y,N[se+1]+=te.y,N[pe+2]+=te.z,N[oe+2]+=te.z,N[se+2]+=te.z}u.faceArray=new Uint16Array(B);var Ce=new w.Mesh(c,o);return Ce}static generateMeshSyncHelper(t,n,o,c,u,E){var A=new x.ProteinSurface;return A.initparm(n,t!==1,E),A.fillvoxels(u,o),A.buildboundary(),(t==x.SurfaceType.SES||t==x.SurfaceType.MS)&&(A.fastdistancemap(),A.boundingatom(!1),A.fillvoxelswaals(u,o)),A.marchingcube(t),A.getFacesAndVertices(c)}static getMatWithStyle(t){var n=new w.MeshLambertMaterial;n.vertexColors=w.Coloring.VertexColors;for(var o in t)o==="color"||o==="map"||t.hasOwnProperty(o)&&(n[o]=t[o]);return t.opacity!==void 0&&(t.opacity===1?n.transparent=!1:n.transparent=!0),n}addMesh(t){var n={geo:t.geometry,mat:t.material,done:!0,finished:!1},o=this.nextSurfID();return this.surfaces[o]=n,o}static shallowCopy(t){var n=[];let o=t.length;for(let c=0;c<o;c++)n[c]=(0,P.extend)({},t[c]);return n}addSurface(t,n={},o={},c,u,E){let A=this.nextSurfID(),I=null,R=this,C=x.SurfaceType.VDW;typeof t=="string"?e.surfaceTypeMap[t.toUpperCase()]!==void 0?C=e.surfaceTypeMap[t]:console.log("Surface type : "+t+" is not recognized"):typeof t=="number"&&(C=t);var z=null,V=null,G=e.shallowCopy(this.getAtomsFromSel(o));c?z=e.shallowCopy(this.getAtomsFromSel(c)):z=G,(0,P.adjustVolumeStyle)(n);var B=!1,F;for(F=0;F<this.models.length;F++)if(this.models[F]){var N=this.models[F].getSymmetries();if(N.length>1||N.length==1&&!N[0].isIdentity()){B=!0;break}}var j=function(pe,oe,se){u?V=e.shallowCopy(R.getAtomsFromSel(u)):V=se;var Ce,_e=(0,P.getExtent)(se,!0);if(n.map&&n.map.prop){var Se=n.map.prop;let Ue=(0,v.getGradient)(n.map.scheme||n.map.gradient||new v.Gradient.RWB),ze=Ue.range();ze||(ze=(0,P.getPropertyRange)(se,Se)),n.colorscheme={prop:Se,gradient:Ue}}for(let Ue=0,ze=oe.length;Ue<ze;Ue++)Ce=oe[Ue],Ce.surfaceColor=(0,P.getColorFromStyle)(Ce,n);var fe=e.volume(_e),xe=R.carveUpExtent(_e,oe,se);if(V&&V.length&&V.length>0){var Ee=(0,P.getExtent)(V,!0),We=function(Ue,ze){var Ze=function(Z,J){var ce=Z.extent,ue=ce[1][0]-ce[0][0],Le=ce[1][1]-ce[0][1],De=ce[1][2]-ce[0][2],K=ue-J[2][0];K*=K;var de=Le-J[2][1];de*=de;var me=De-J[2][2];return me*=me,K+de+me},He=Ze(Ue,Ee),X=Ze(ze,Ee);return He-X};xe.sort(We)}var Ge=[];for(let Ue=0,ze=oe.length;Ue<ze;Ue++)Ce=oe[Ue],Ge[Ue]={x:Ce.x,y:Ce.y,z:Ce.z,serial:Ue,elem:Ce.elem};var Ne=!!x.syncSurface;if(Ne){var Be=function(ze){return new Promise(function(Ze){for(var He=e.generateMeshSyncHelper(C,xe[ze].extent,xe[ze].atoms,xe[ze].toshow,Ge,fe),X=(0,g.splitMesh)({vertexArr:He.vertices,faceArr:He.faces}),Z=0,J=X.length;Z<J;Z++){He={vertices:X[Z].vertexArr,faces:X[Z].faceArr};var ce=e.generateSurfaceMesh(oe,He,I);(0,P.mergeGeos)(pe.geo,ce)}R.render(),Ze()})},Te=[];for(let Ue=0;Ue<xe.length;Ue++)Te.push(Be(Ue));return Promise.all(Te).then(function(){return pe.done=!0,Promise.resolve(A)})}else{var Re=[];C<0&&(C=0);for(let Ue=0,ze=e.numWorkers;Ue<ze;Ue++){var Pe=new Worker($3Dmol.SurfaceWorker);Re.push(Pe),Pe.postMessage({type:-1,atoms:Ge,volume:fe})}return new Promise(function(Ue,ze){var Ze=0,He=function(){!Re||!Re.length||Re.forEach(function(ce){ce&&ce.terminate&&ce.terminate()})},X=function(ce){for(var ue=(0,g.splitMesh)({vertexArr:ce.data.vertices,faceArr:ce.data.faces}),Le=0,De=ue.length;Le<De;Le++){var K={vertices:ue[Le].vertexArr,faces:ue[Le].faceArr},de=e.generateSurfaceMesh(oe,K,I);(0,P.mergeGeos)(pe.geo,de)}R.render(),Ze++,Ze==xe.length&&(pe.done=!0,He(),Ue(A))},Z=function(ce){He(),console.log(ce.message+" ("+ce.filename+":"+ce.lineno+")"),ze(ce)};for(let ce=0;ce<xe.length;ce++){var J=Re[ce%Re.length];J.onmessage=X,J.onerror=Z,J.postMessage({type:C,expandedExtent:xe[ce].extent,extendedAtoms:xe[ce].atoms,atomsToShow:xe[ce].toshow})}})}};n=n||{},I=e.getMatWithStyle(n);var U=[];U.style=n,U.atomsel=o,U.allsel=c,U.focus=u;var k=null;if(B){var te={},he={};for(F=0;F<this.models.length;F++)te[F]=[],he[F]=[];for(F=0;F<z.length;F++)te[z[F].model].push(z[F]);for(F=0;F<G.length;F++)he[G[F].model].push(G[F]);var re=[];for(F=0;F<this.models.length;F++)he[F].length>0&&(U.push({geo:new w.Geometry(!0),mat:I,done:!1,finished:!1,symmetries:this.models[F].getSymmetries()}),re.push(j(U[U.length-1],te[F],he[F])));k=Promise.all(re)}else U.push({geo:new w.Geometry(!0),mat:I,done:!1,finished:!1,symmetries:[new S.Matrix4]}),k=j(U[U.length-1],z,G);return this.surfaces[A]=U,k.surfid=A,E&&typeof E=="function"?(k.then(function(ae){E(ae)}),A):k}setSurfaceMaterialStyle(t,n){if((0,P.adjustVolumeStyle)(n),this.surfaces[t]){var o=this.surfaces[t];o.style=n;for(var c=0;c<o.length;c++){var u=o[c].mat=e.getMatWithStyle(n);if(o[c].mat.side=w.FrontSide,n.color){o[c].mat.color=n.color,o[c].geo.colorsNeedUpdate=!0;const E=O.CC.color(n.color);o[c].geo.setColors(function(){return E})}else if(u.voldata&&u.volscheme){const E=u.volscheme,A=u.voldata,I=O.CC,R=E.range()||[-1,1];o[c].geo.setColors(function(C,z,V){let G=A.getVal(C,z,V);return I.color(E.valueToHex(G,R))})}o[c].finished=!1}}return this}getSurface(t){return this.surfaces[t]}removeSurface(t){for(var n=this.surfaces[t],o=0;o<n.length;o++)n[o]&&n[o].lastGL&&(n[o].geo!==void 0&&n[o].geo.dispose(),n[o].mat!==void 0&&n[o].mat.dispose(),this.modelGroup.remove(n[o].lastGL));return delete this.surfaces[t],this.show(),this}removeAllSurfaces(){for(var t in this.surfaces)if(this.surfaces.hasOwnProperty(t)){for(var n=this.surfaces[t],o=0;o<n.length;o++)n[o]&&n[o].lastGL&&(n[o].geo!==void 0&&n[o].geo.dispose(),n[o].mat!==void 0&&n[o].mat.dispose(),this.modelGroup.remove(n[o].lastGL));delete this.surfaces[t]}return this.show(),this}jmolMoveTo(){var t=this.modelGroup.position,n="center { "+-t.x+" "+-t.y+" "+-t.z+" }; ",o=this.rotationGroup.quaternion;return n+="moveto .5 quaternion { "+o.x+" "+o.y+" "+o.z+" "+o.w+" };",n}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(t,n){n=n||{};var o=this.getAtomsFromSel(n);if(typeof t=="function")for(let E=0,A=o.length;E<A;E++){let I=o[E];t(I)}else for(let E=0,A=o.length;E<A;E++){var c=o[E];for(let I=0,R=t.length;I<R;I++){let C=t[I];if(C.props)for(var u in C.props)C.props.hasOwnProperty(u)&&this.atomIsSelected(c,C)&&(c.properties||(c.properties={}),c.properties[u]=C.props[u])}}return this}linkViewer(t){return this.linkedViewers.push(t),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(t){this.rotationGroup.position.z=this.CAMERA_Z-t}setAutoEyeSeparation(t,n){var o=this.getPerceivedDistance();return n||(n=5),t||this.camera.position.x>0?this.camera.position.x=o*Math.tan(Math.PI/180*n):this.camera.position.x=-o*Math.tan(Math.PI/180*n),this.camera.lookAt(new S.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(t){this.config.cartoonQuality=t}}e.numWorkers=4,e.maxVolume=64e3,e.surfaceTypeMap={VDW:x.SurfaceType.VDW,MS:x.SurfaceType.MS,SAS:x.SurfaceType.SAS,SES:x.SurfaceType.SES};function r(a,t){if(a=(0,P.getElement)(a),!!a){t=t||{};try{var n=new e(a,t);return n}catch(o){throw"error creating viewer: "+o}}}function s(a,t={},n={}){if(a=(0,P.getElement)(a),!!a){var o=[],c=document.createElement("canvas");n.rows=t.rows,n.cols=t.cols,n.control_all=t.control_all!=null?t.control_all:!1,a.appendChild(c);try{for(var u=0;u<t.rows;u++){for(var E=[],A=0;A<t.cols;A++){n.row=u,n.col=A,n.canvas=c,n.viewers=o,n.control_all=t.control_all;var I=r(a,n);E.push(I)}o.unshift(E)}}catch(R){throw"error creating viewer grid: "+R}return o}}function h(a){var t=this;if(a=(0,P.getElement)(a),!!a){var n=s(a,{rows:1,cols:2,control_all:!0});this.glviewer1=n[0][0],this.glviewer2=n[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var o=Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(u){return typeof t.glviewer1[u]=="function"}),c=0;c<o.length;c++)this[o[c]]=function(u){return function(){var E=this.glviewer1[u].apply(this.glviewer1,arguments),A=this.glviewer2[u].apply(this.glviewer2,arguments);return[E,A]}}(o[c]);this.setCoordinates=function(u,E,A){for(var I=0;I<u.length;I++)u[I].setCoordinates(E,A)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(u){this.glviewer1.render(),this.glviewer2.render(),u&&u(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}}},"./src/Gradient.ts":($,T,f)=>{f.r(T),f.d(T,{CustomLinear:()=>g,Gradient:()=>x,GradientType:()=>S,ROYGB:()=>_,RWB:()=>v,Sinebow:()=>L,builtinGradients:()=>M,getGradient:()=>P,normalizeValue:()=>O});var w=f("./src/colors.ts");class S{}function O(p,y,e){return y>=p?(e<p&&(e=p),e>y&&(e=y),{lo:p,hi:y,val:e}):(e>p&&(e=p),e<y&&(e=y),e=p-e+y,{lo:y,hi:p,val:e})}function P(p){if(p instanceof S)return p;if(p.gradient!==void 0&&M[p.gradient]){let y=p.min===void 0?-1:p.min,e=p.max===void 0?1:p.max;return p.mid===void 0?p.colors===void 0?new M[p.gradient](y,e):new M[p.gradient](y,e,p.colors):new M[p.gradient](y,e,p.mid)}return p}class v extends S{constructor(y,e,r){super(),this.gradient="RWB",this.mult=1,this.mid=r,this.min=y,this.max=e,typeof e>"u"&&Array.isArray(y)&&y.length>=2?(this.max=y[1],this.min=y[0]):y&&e&&!Array.isArray(y)&&(this.min=y,this.max=e)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(y,e){var r,s;if(y=this.mult*y,e?(r=e[0],s=e[1]):(r=this.min,s=this.max),y===void 0)return 16777215;var h=O(r,s,y);r=h.lo,s=h.hi,y=h.val;var a=(s+r)/2;e&&typeof e[2]<"u"?a=e[2]:typeof this.mid<"u"?a=this.mid:a=(r+s)/2;var t,n;return y<a?(t=Math.floor(255*Math.sqrt((y-r)/(a-r))),n=16711680+256*t+t,n):y>a?(t=Math.floor(255*Math.sqrt(1-(y-a)/(s-a))),n=65536*t+256*t+255,n):16777215}}class _ extends S{constructor(y,e){super(),this.gradient="ROYGB",this.mult=1,this.min=y,this.max=e,typeof e>"u"&&Array.isArray(y)&&y.length>=2?(this.max=y[1],this.min=y[0]):y&&e&&!Array.isArray(y)&&(this.min=y,this.max=e)}valueToHex(y,e){var r,s;if(y=this.mult*y,e?(r=e[0],s=e[1]):(r=this.min,s=this.max),typeof y>"u")return 16777215;var h=O(r,s,y);r=h.lo,s=h.hi,y=h.val;var a=(r+s)/2,t=(r+a)/2,n=(a+s)/2,o,c;return y<t?(o=Math.floor(255*Math.sqrt((y-r)/(t-r))),c=16711680+256*o+0,c):y<a?(o=Math.floor(255*Math.sqrt(1-(y-t)/(a-t))),c=65536*o+65280+0,c):y<n?(o=Math.floor(255*Math.sqrt((y-a)/(n-a))),c=65280+1*o,c):(o=Math.floor(255*Math.sqrt(1-(y-n)/(s-n))),c=0+256*o+255,c)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class L extends S{constructor(y,e){super(),this.gradient="Sinebow",this.mult=1,this.min=y,this.max=e,typeof e>"u"&&Array.isArray(y)&&y.length>=2&&(this.max=y[1],this.min=y[0]),e<y&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(y,e){var r,s;if(y=this.mult*y,e?(r=e[0],s=e[1]):(r=this.min,s=this.max),typeof y>"u")return 16777215;var h=x.normalizeValue(r,s,y);r=h.lo,s=h.hi,y=h.val;var a=(y-r)/(s-r),t=5*a/6+.5,n=Math.sin(Math.PI*t);n*=n*255;var o=Math.sin(Math.PI*(t+1/3));o*=o*255;var c=Math.sin(Math.PI*(t+2/3));return c*=c*255,65536*Math.floor(n)+256*Math.floor(c)+1*Math.floor(o)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class g extends S{constructor(y,e,r){super(),this.gradient="linear",this.colors=new Array;var s;if(Array.isArray(y)&&y.length>=2?(this.max=y[1],this.min=y[0],s=e):(this.min=y,this.max=e,s=r),s)for(let h of s)this.colors.push(w.CC.color(h));else this.colors.push(w.CC.color(0))}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(y,e){var r,s;if(e?(r=e[0],s=e[1]):(r=this.min,s=this.max),y===void 0)return 16777215;var h=O(r,s,y);r=h.lo,s=h.hi,y=h.val;let a=this.colors.length,t=(s-r)/a,n=Math.min(Math.floor((y-r)/t),a-1),o=Math.min(n+1,a-1),c=(y-r-n*t)/t,u=this.colors[n],E=this.colors[o];return new w.Color(u.r+c*(E.r-u.r),u.g+c*(E.g-u.g),u.b+c*(E.b-u.b)).getHex()}}const M={rwb:v,RWB:v,roygb:_,ROYGB:_,sinebow:L,linear:g};class x extends S{valueToHex(y,e){return 0}range(){return null}}x.RWB=v,x.ROYGB=_,x.Sinebow=L,x.CustomLinear=g,x.builtinGradients=M,x.normalizeValue=O,x.getGradient=P},"./src/Label.ts":($,T,f)=>{f.r(T),f.d(T,{Label:()=>L,LabelCount:()=>P});var w=f("./src/WebGL/index.ts"),S=f("./src/Gradient.ts"),O=f("./src/colors.ts");let P=0;function v(g,M,x,p,y,e,r){g.beginPath(),g.moveTo(M+e,x),g.lineTo(M+p-e,x),g.quadraticCurveTo(M+p,x,M+p,x+e),g.lineTo(M+p,x+y-e),g.quadraticCurveTo(M+p,x+y,M+p-e,x+y),g.lineTo(M+e,x+y),g.quadraticCurveTo(M,x+y,M,x+y-e),g.lineTo(M,x+e),g.quadraticCurveTo(M,x,M+e,x),g.closePath(),g.fill(),r&&g.stroke()}function _(g,M,x){var p=x;return typeof g<"u"&&(g instanceof O.Color?p=g.scaled():(p=O.CC.color(g),typeof p.scaled<"u"&&(p=p.scaled()))),typeof M<"u"&&(p.a=parseFloat(M)),p}class L{constructor(M,x){this.id=P++,this.stylespec=x||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new w.Sprite,this.text=M,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}setContext(){var M=this.stylespec,x=typeof M.useScreen>"u"?!1:M.useScreen,p=M.showBackground;(p==="0"||p==="false")&&(p=!1),typeof p>"u"&&(p=!0);var y=M.font?M.font:"sans-serif",e=parseInt(M.fontSize)?parseInt(M.fontSize):18,r=_(M.fontColor,M.fontOpacity,{r:255,g:255,b:255,a:1}),s=M.padding?M.padding:4,h=M.borderThickness?M.borderThickness:0,a=_(M.backgroundColor,M.backgroundOpacity,{r:0,g:0,b:0,a:1}),t=_(M.borderColor,M.borderOpacity,a),n=M.position?M.position:{x:-10,y:1,z:1},o=M.inFront!==void 0?M.inFront:!0;(o==="false"||o==="0")&&(o=!1);var c=M.alignment||w.SpriteAlignment.topLeft;typeof c=="string"&&c in w.SpriteAlignment&&(c=w.SpriteAlignment[c]);var u="";M.bold&&(u="bold "),this.context.font=u+e+"px  "+y;var E=this.context.measureText(this.text),A=E.width;p||(h=0);var I=A+2.5*h+2*s,R=e*1.25+2*h+2*s;if(M.backgroundImage){var C=M.backgroundImage,z=M.backgroundWidth?M.backgroundWidth:C.width,V=M.backgroundHeight?M.backgroundHeight:C.height;z>I&&(I=z),V>R&&(R=V)}if(this.canvas.width=I,this.canvas.height=R,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),u="",M.bold&&(u="bold "),this.context.font=u+e+"px  "+y,this.context.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",this.context.strokeStyle="rgba("+t.r+","+t.g+","+t.b+","+t.a+")",M.backgroundGradient){let B=this.context.createLinearGradient(0,R/2,I,R/2),F=S.Gradient.getGradient(M.backgroundGradient),N=F.range(),j=-1,U=1;N&&(j=N[0],U=N[1]);let k=U-j;for(let te=0;te<1.01;te+=.1){let he=_(F.valueToHex(j+k*te)),re="rgba("+he.r+","+he.g+","+he.b+","+he.a+")";B.addColorStop(te,re)}this.context.fillStyle=B}this.context.lineWidth=h,p&&v(this.context,h,h,I-2*h,R-2*h,6,h>0),M.backgroundImage&&this.context.drawImage(C,0,0,I,R),this.context.fillStyle="rgba("+r.r+","+r.g+","+r.b+","+r.a+")",this.context.fillText(this.text,h+s,e+h+s,A);var G=new w.Texture(this.canvas);G.needsUpdate=!0,this.sprite.material=new w.SpriteMaterial({map:G,useScreenCoordinates:x,alignment:c,depthTest:!o,screenOffset:M.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(n.x,n.y,n.z)}dispose(){this.sprite.material.map!==void 0&&this.sprite.material.map.dispose(),this.sprite.material!==void 0&&this.sprite.material.dispose()}}},"./src/ProteinSurface4.ts":($,T,f)=>{f.r(T),f.d(T,{MarchingCube:()=>_,MarchingCubeInitializer:()=>v,PointGrid:()=>L,ProteinSurface:()=>g,SurfaceType:()=>S,setSyncSurface:()=>P,syncSurface:()=>O});var w=f("./src/WebGL/math/index.ts"),S;(function(M){M[M.VDW=1]="VDW",M[M.MS=2]="MS",M[M.SAS=3]="SAS",M[M.SES=4]="SES"})(S||(S={}));var O=!1;function P(M){O=M}(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(O=!0);class v{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(x,p,y,e){let r=!!e.fulltable,s=e.hasOwnProperty("origin")&&e.origin.hasOwnProperty("x")?e.origin:{x:0,y:0,z:0},h=!!e.voxel,a=e.matrix,t=e.nX||0,n=e.nY||0,o=e.nZ||0,c=e.scale||1,u=null;e.unitCube?u=e.unitCube:u={x:c,y:c,z:c};let E=new Int32Array(t*n*o),A,I;for(A=0,I=E.length;A<I;++A)E[A]=-1;let R=function(G,B,F,N,j,U){let k={x:0,y:0,z:0},te=!!(N&1<<j),he=!!(N&1<<U),re=j;if(!te&&he&&(re=U),re&1&&F++,re&2&&B++,re&4&&G++,a){let pe=new w.Vector3(G,B,F);pe=pe.applyMatrix4(a),k={x:pe.x,y:pe.y,z:pe.z}}else k.x=s.x+u.x*G,k.y=s.y+u.y*B,k.z=s.z+u.z*F;let ae=(n*G+B)*o+F;return h?(p.push(k),p.length-1):(E[ae]<0&&(E[ae]=p.length,p.push(k)),E[ae])},C=new Int32Array(12),z=r?this.edgeTable2:this.edgeTable,V=r?this.triTable2:this.triTable;for(A=0;A<t-1;++A)for(let G=0;G<n-1;++G)for(let B=0;B<o-1;++B){let F=0;for(let U=0;U<8;++U){let k=(n*(A+((U&4)>>2))+G+((U&2)>>1))*o+B+(U&1),te=!!(x[k]&this.ISDONE);F|=te<<U}if(F===0||F===255)continue;let N=z[F];if(N===0)continue;let j=V[F];N&1&&(C[0]=R(A,G,B,F,0,1)),N&2&&(C[1]=R(A,G,B,F,1,3)),N&4&&(C[2]=R(A,G,B,F,3,2)),N&8&&(C[3]=R(A,G,B,F,2,0)),N&16&&(C[4]=R(A,G,B,F,4,5)),N&32&&(C[5]=R(A,G,B,F,5,7)),N&64&&(C[6]=R(A,G,B,F,7,6)),N&128&&(C[7]=R(A,G,B,F,6,4)),N&256&&(C[8]=R(A,G,B,F,0,4)),N&512&&(C[9]=R(A,G,B,F,1,5)),N&1024&&(C[10]=R(A,G,B,F,3,7)),N&2048&&(C[11]=R(A,G,B,F,2,6));for(let U=0;U<j.length;U+=3){let k=C[j[U]],te=C[j[U+1]],he=C[j[U+2]];h&&U>=3&&(p.push(p[k]),k=p.length-1,p.push(p[te]),te=p.length-1,p.push(p[he]),he=p.length-1),y.push(k),y.push(te),y.push(he)}}}laplacianSmooth(x,p,y){let e=new Array(p.length),r,s,h,a,t;for(r=0,s=p.length;r<s;r++)e[r]={x:0,y:0,z:0};let n=new Array(20),o;for(r=0;r<20;r++)n[r]=new Array(p.length);for(r=0,s=p.length;r<s;r++)n[0][r]=0;for(r=0,s=y.length/3;r<s;r++){let E=r*3,A=r*3+1,I=r*3+2;for(o=!0,h=0,a=n[0][y[E]];h<a;h++)if(y[A]==n[h+1][y[E]]){o=!1;break}for(o&&(n[0][y[E]]++,n[n[0][y[E]]][y[E]]=y[A]),o=!0,h=0,a=n[0][y[E]];h<a;h++)if(y[I]==n[h+1][y[E]]){o=!1;break}for(o&&(n[0][y[E]]++,n[n[0][y[E]]][y[E]]=y[I]),o=!0,h=0,a=n[0][y[A]];h<a;h++)if(y[E]==n[h+1][y[A]]){o=!1;break}for(o&&(n[0][y[A]]++,n[n[0][y[A]]][y[A]]=y[E]),o=!0,h=0,a=n[0][y[A]];h<a;h++)if(y[I]==n[h+1][y[A]]){o=!1;break}for(o&&(n[0][y[A]]++,n[n[0][y[A]]][y[A]]=y[I]),o=!0,h=0;h<n[0][y[I]];h++)if(y[E]==n[h+1][y[I]]){o=!1;break}for(o&&(n[0][y[I]]++,n[n[0][y[I]]][y[I]]=y[E]),o=!0,h=0,a=n[0][y[I]];h<a;h++)if(y[A]==n[h+1][y[I]]){o=!1;break}o&&(n[0][y[I]]++,n[n[0][y[I]]][y[I]]=y[A])}let c=1,u=.5;for(t=0;t<x;t++){for(r=0,s=p.length;r<s;r++)if(n[0][r]<3)e[r].x=p[r].x,e[r].y=p[r].y,e[r].z=p[r].z;else if(n[0][r]==3||n[0][r]==4){for(e[r].x=0,e[r].y=0,e[r].z=0,h=0,a=n[0][r];h<a;h++)e[r].x+=p[n[h+1][r]].x,e[r].y+=p[n[h+1][r]].y,e[r].z+=p[n[h+1][r]].z;e[r].x+=u*p[r].x,e[r].y+=u*p[r].y,e[r].z+=u*p[r].z,e[r].x/=u+n[0][r],e[r].y/=u+n[0][r],e[r].z/=u+n[0][r]}else{for(e[r].x=0,e[r].y=0,e[r].z=0,h=0,a=n[0][r];h<a;h++)e[r].x+=p[n[h+1][r]].x,e[r].y+=p[n[h+1][r]].y,e[r].z+=p[n[h+1][r]].z;e[r].x+=c*p[r].x,e[r].y+=c*p[r].y,e[r].z+=c*p[r].z,e[r].x/=c+n[0][r],e[r].y/=c+n[0][r],e[r].z/=c+n[0][r]}for(r=0,s=p.length;r<s;r++)p[r].x=e[r].x,p[r].y=e[r].y,p[r].z=e[r].z}}}let _=new v;class L{constructor(x,p,y){this.data=new Int32Array(x*p*y*3),this.width=p,this.height=y}set(x,p,y,e){let r=((x*this.width+p)*this.height+y)*3;this.data[r]=e.ix,this.data[r+1]=e.iy,this.data[r+2]=e.iz}get(x,p,y){let e=((x*this.width+p)*this.height+y)*3;return{ix:this.data[e],iy:this.data[e+1],iz:this.data[e+2]}}}class g{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])]}getVDWIndex(x){return!x.elem||typeof this.vdwRadii[x.elem]>"u"?"X":x.elem}getFacesAndVertices(x){let p={};for(let r=0,s=x.length;r<s;r++)p[x[r]]=!0;let y=this.verts;for(let r=0,s=y.length;r<s;r++)y[r].x=y[r].x/this.scaleFactor-this.ptranx,y[r].y=y[r].y/this.scaleFactor-this.ptrany,y[r].z=y[r].z/this.scaleFactor-this.ptranz;let e=[];for(let r=0,s=this.faces.length;r<s;r+=3){let h=this.faces[r],a=this.faces[r+1],t=this.faces[r+2],n=y[h].atomid,o=y[a].atomid,c=y[t].atomid,u=n;o<u&&(u=o),c<u&&(u=c),p[u]&&h!==a&&a!==t&&h!==t&&(e.push(h),e.push(a),e.push(t))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:y,faces:e}}initparm(x,p,y){y>1e6&&(this.scaleFactor=this.defaultScaleFactor/2);let e=1/this.scaleFactor*5.5;this.pminx=x[0][0],this.pmaxx=x[1][0],this.pminy=x[0][1],this.pmaxy=x[1][1],this.pminz=x[0][2],this.pmaxz=x[1][2],p?(this.pminx-=this.probeRadius+e,this.pminy-=this.probeRadius+e,this.pminz-=this.probeRadius+e,this.pmaxx+=this.probeRadius+e,this.pmaxy+=this.probeRadius+e,this.pmaxz+=this.probeRadius+e):(this.pminx-=e,this.pminy-=e,this.pminz-=e,this.pmaxx+=e,this.pmaxy+=e,this.pmaxz+=e),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(p),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(x){let p={};for(const y in this.vdwRadii){let e=this.vdwRadii[y];x?p[y]=(e+this.probeRadius)*this.scaleFactor+.5:p[y]=e*this.scaleFactor+.5;let r=p[y]*p[y];this.widxz[y]=Math.floor(p[y])+1,this.depty[y]=new Int32Array(this.widxz[y]*this.widxz[y]);let s=0;for(let h=0;h<this.widxz[y];h++)for(let a=0;a<this.widxz[y];a++){let t=h*h+a*a;if(t>r)this.depty[y][s]=-1;else{let n=Math.sqrt(r-t);this.depty[y][s]=Math.floor(n)}s++}}}fillvoxels(x,p){for(let y=0,e=this.vpBits.length;y<e;y++)this.vpBits[y]=0,this.vpDistance[y]=-1,this.vpAtomID[y]=-1;for(let y in p){let e=x[p[y]];e!==void 0&&this.fillAtom(e,x)}for(let y=0,e=this.vpBits.length;y<e;y++)this.vpBits[y]&this.INOUT&&(this.vpBits[y]|=this.ISDONE)}fillAtom(x,p){let y=Math.floor(.5+this.scaleFactor*(x.x+this.ptranx)),e=Math.floor(.5+this.scaleFactor*(x.y+this.ptrany)),r=Math.floor(.5+this.scaleFactor*(x.z+this.ptranz)),s=this.getVDWIndex(x),h=0,a=this.pWidth*this.pHeight;for(let t=0,n=this.widxz[s];t<n;t++)for(let o=0;o<n;o++){if(this.depty[s][h]!=-1){for(let c=-1;c<2;c++)for(let u=-1;u<2;u++)for(let E=-1;E<2;E++)if(c!==0&&u!==0&&E!==0){let A=c*t,I=E*o;for(let R=0;R<=this.depty[s][h];R++){let C=R*u,z=y+A,V=e+C,G=r+I;if(z<0||V<0||G<0||z>=this.pLength||V>=this.pWidth||G>=this.pHeight)continue;let B=z*a+V*this.pHeight+G;if(!(this.vpBits[B]&this.INOUT))this.vpBits[B]|=this.INOUT,this.vpAtomID[B]=x.serial;else{let F=p[this.vpAtomID[B]];if(F.serial!=x.serial){let N=y+A-Math.floor(.5+this.scaleFactor*(F.x+this.ptranx)),j=e+C-Math.floor(.5+this.scaleFactor*(F.y+this.ptrany)),U=r+I-Math.floor(.5+this.scaleFactor*(F.z+this.ptranz));A*A+C*C+I*I<N*N+j*j+U*U&&(this.vpAtomID[B]=x.serial)}}}}}h++}}fillvoxelswaals(x,p){for(let y=0,e=this.vpBits.length;y<e;y++)this.vpBits[y]&=~this.ISDONE;for(let y in p){let e=x[p[y]];e!==void 0&&this.fillAtomWaals(e,x)}}fillAtomWaals(x,p){let y=0,e=Math.floor(.5+this.scaleFactor*(x.x+this.ptranx)),r=Math.floor(.5+this.scaleFactor*(x.y+this.ptrany)),s=Math.floor(.5+this.scaleFactor*(x.z+this.ptranz)),h=this.getVDWIndex(x),a=this.pWidth*this.pHeight;for(let t=0,n=this.widxz[h];t<n;t++)for(let o=0;o<n;o++){if(this.depty[h][y]!=-1){for(let c=-1;c<2;c++)for(let u=-1;u<2;u++)for(let E=-1;E<2;E++)if(c!==0&&u!==0&&E!==0){let A=c*t,I=E*o;for(let R=0;R<=this.depty[h][y];R++){let C=R*u,z=e+A,V=r+C,G=s+I;if(z<0||V<0||G<0||z>=this.pLength||V>=this.pWidth||G>=this.pHeight)continue;let B=z*a+V*this.pHeight+G;if(!(this.vpBits[B]&this.ISDONE))this.vpBits[B]|=this.ISDONE,this.vpAtomID[B]=x.serial;else{let F=p[this.vpAtomID[B]];if(F.serial!=x.serial){let N=e+A-Math.floor(.5+this.scaleFactor*(F.x+this.ptranx)),j=r+C-Math.floor(.5+this.scaleFactor*(F.y+this.ptrany)),U=s+I-Math.floor(.5+this.scaleFactor*(F.z+this.ptranz));A*A+C*C+I*I<N*N+j*j+U*U&&(this.vpAtomID[B]=x.serial)}}}}}y++}}buildboundary(){let x=this.pWidth*this.pHeight;for(let p=0;p<this.pLength;p++)for(let y=0;y<this.pHeight;y++)for(let e=0;e<this.pWidth;e++){let r=p*x+e*this.pHeight+y;if(this.vpBits[r]&this.INOUT){let s=0;for(;s<26;){let h=p+this.nb[s][0],a=y+this.nb[s][2],t=e+this.nb[s][1];if(h>-1&&h<this.pLength&&t>-1&&t<this.pWidth&&a>-1&&a<this.pHeight&&!(this.vpBits[h*x+t*this.pHeight+a]&this.INOUT)){this.vpBits[r]|=this.ISBOUND;break}else s++}}}}fastdistancemap(){let x=new L(this.pLength,this.pWidth,this.pHeight),p=this.pWidth*this.pHeight,y=this.cutRadius*this.cutRadius,e=[],r=[],s;for(let t=0;t<this.pLength;t++)for(let n=0;n<this.pWidth;n++)for(let o=0;o<this.pHeight;o++)if(s=t*p+n*this.pHeight+o,this.vpBits[s]&=~this.ISDONE,this.vpBits[s]&this.INOUT&&this.vpBits[s]&this.ISBOUND){let c={ix:t,iy:n,iz:o};x.set(t,n,o,c),e.push(c),this.vpDistance[s]=0,this.vpBits[s]|=this.ISDONE,this.vpBits[s]&=~this.ISBOUND}do{r=this.fastoneshell(e,x),e=[];for(let t=0,n=r.length;t<n;t++)s=p*r[t].ix+this.pHeight*r[t].iy+r[t].iz,this.vpBits[s]&=~this.ISBOUND,this.vpDistance[s]<=1.0404*y&&e.push({ix:r[t].ix,iy:r[t].iy,iz:r[t].iz})}while(e.length!==0);e=[],r=[],x=null;let h=this.scaleFactor-.5;h<0&&(h=0);let a=y-.5/(.1+h);for(let t=0;t<this.pLength;t++)for(let n=0;n<this.pWidth;n++)for(let o=0;o<this.pHeight;o++)s=t*p+n*this.pHeight+o,this.vpBits[s]&=~this.ISBOUND,this.vpBits[s]&this.INOUT&&(!(this.vpBits[s]&this.ISDONE)||this.vpBits[s]&this.ISDONE&&this.vpDistance[s]>=a)&&(this.vpBits[s]|=this.ISBOUND)}fastoneshell(x,p){let y,e,r,s,h,a,t,n,o,c=[];if(x.length===0)return c;let u={ix:-1,iy:-1,iz:-1},E=this.pWidth*this.pHeight;for(let A=0,I=x.length;A<I;A++){y=x[A].ix,e=x[A].iy,r=x[A].iz,n=p.get(y,e,r);for(let R=0;R<6;R++)u.ix=y+this.nb[R][0],u.iy=e+this.nb[R][1],u.iz=r+this.nb[R][2],u.ix<this.pLength&&u.ix>-1&&u.iy<this.pWidth&&u.iy>-1&&u.iz<this.pHeight&&u.iz>-1&&(o=u.ix*E+this.pHeight*u.iy+u.iz,this.vpBits[o]&this.INOUT&&!(this.vpBits[o]&this.ISDONE)?(p.set(u.ix,u.iy,r+this.nb[R][2],n),s=u.ix-n.ix,h=u.iy-n.iy,a=u.iz-n.iz,t=s*s+h*h+a*a,this.vpDistance[o]=t,this.vpBits[o]|=this.ISDONE,this.vpBits[o]|=this.ISBOUND,c.push({ix:u.ix,iy:u.iy,iz:u.iz})):this.vpBits[o]&this.INOUT&&this.vpBits[o]&this.ISDONE&&(s=u.ix-n.ix,h=u.iy-n.iy,a=u.iz-n.iz,t=s*s+h*h+a*a,t<this.vpDistance[o]&&(p.set(u.ix,u.iy,u.iz,n),this.vpDistance[o]=t,this.vpBits[o]&this.ISBOUND||(this.vpBits[o]|=this.ISBOUND,c.push({ix:u.ix,iy:u.iy,iz:u.iz})))))}for(let A=0,I=x.length;A<I;A++){y=x[A].ix,e=x[A].iy,r=x[A].iz,n=p.get(y,e,r);for(let R=6;R<18;R++)u.ix=y+this.nb[R][0],u.iy=e+this.nb[R][1],u.iz=r+this.nb[R][2],u.ix<this.pLength&&u.ix>-1&&u.iy<this.pWidth&&u.iy>-1&&u.iz<this.pHeight&&u.iz>-1&&(o=u.ix*E+this.pHeight*u.iy+u.iz,this.vpBits[o]&this.INOUT&&!(this.vpBits[o]&this.ISDONE)?(p.set(u.ix,u.iy,r+this.nb[R][2],n),s=u.ix-n.ix,h=u.iy-n.iy,a=u.iz-n.iz,t=s*s+h*h+a*a,this.vpDistance[o]=t,this.vpBits[o]|=this.ISDONE,this.vpBits[o]|=this.ISBOUND,c.push({ix:u.ix,iy:u.iy,iz:u.iz})):this.vpBits[o]&this.INOUT&&this.vpBits[o]&this.ISDONE&&(s=u.ix-n.ix,h=u.iy-n.iy,a=u.iz-n.iz,t=s*s+h*h+a*a,t<this.vpDistance[o]&&(p.set(u.ix,u.iy,u.iz,n),this.vpDistance[o]=t,this.vpBits[o]&this.ISBOUND||(this.vpBits[o]|=this.ISBOUND,c.push({ix:u.ix,iy:u.iy,iz:u.iz})))))}for(let A=0,I=x.length;A<I;A++){y=x[A].ix,e=x[A].iy,r=x[A].iz,n=p.get(y,e,r);for(let R=18;R<26;R++)u.ix=y+this.nb[R][0],u.iy=e+this.nb[R][1],u.iz=r+this.nb[R][2],u.ix<this.pLength&&u.ix>-1&&u.iy<this.pWidth&&u.iy>-1&&u.iz<this.pHeight&&u.iz>-1&&(o=u.ix*E+this.pHeight*u.iy+u.iz,this.vpBits[o]&this.INOUT&&!(this.vpBits[o]&this.ISDONE)?(p.set(u.ix,u.iy,r+this.nb[R][2],n),s=u.ix-n.ix,h=u.iy-n.iy,a=u.iz-n.iz,t=s*s+h*h+a*a,this.vpDistance[o]=t,this.vpBits[o]|=this.ISDONE,this.vpBits[o]|=this.ISBOUND,c.push({ix:u.ix,iy:u.iy,iz:u.iz})):this.vpBits[o]&this.INOUT&&this.vpBits[o]&this.ISDONE&&(s=u.ix-n.ix,h=u.iy-n.iy,a=u.iz-n.iz,t=s*s+h*h+a*a,t<this.vpDistance[o]&&(p.set(u.ix,u.iy,u.iz,n),this.vpDistance[o]=t,this.vpBits[o]&this.ISBOUND||(this.vpBits[o]|=this.ISBOUND,c.push({ix:u.ix,iy:u.iy,iz:u.iz})))))}return c}marchingcubeinit(x){for(let p=0,y=this.vpBits.length;p<y;p++)x==1?this.vpBits[p]&=~this.ISBOUND:x==4?(this.vpBits[p]&=~this.ISDONE,this.vpBits[p]&this.ISBOUND&&(this.vpBits[p]|=this.ISDONE),this.vpBits[p]&=~this.ISBOUND):x==2?this.vpBits[p]&this.ISBOUND&&this.vpBits[p]&this.ISDONE?this.vpBits[p]&=~this.ISBOUND:this.vpBits[p]&this.ISBOUND&&!(this.vpBits[p]&this.ISDONE)&&(this.vpBits[p]|=this.ISDONE):x==3&&(this.vpBits[p]&=~this.ISBOUND)}marchingcube(x){this.marchingcubeinit(x),this.verts=[],this.faces=[],_.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let p=this.pWidth*this.pHeight;for(let y=0,e=this.verts.length;y<e;y++)this.verts[y].atomid=this.vpAtomID[this.verts[y].x*p+this.pHeight*this.verts[y].y+this.verts[y].z];_.laplacianSmooth(1,this.verts,this.faces)}}},"./src/VolumeData.ts":($,T,f)=>{f.r(T),f.d(T,{VolumeData:()=>_});var w=f("./src/utilities.ts"),S=f("./src/WebGL/math/index.ts"),O=f("./src/parsers/VASP.ts"),P=f("./src/parsers/CUBE.ts"),v=f("./node_modules/pako/dist/pako.esm.mjs");class _{constructor(g,M,x){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(s){var h=s/(this.size.y*this.size.z),a=s%(this.size.y*this.size.z),t=s%this.size.z;return h*=this.unit.x,a*=this.unit.y,t*=this.unit.z,h+=this.origin.x,a+=this.origin.y,t+=this.origin.z,{x:h,y:a,z:t}},this.vasp=function(s){var h=s.replace(/^\s+/,"").split(/[\n\r]/),a=(0,O.VASP)(s)[0],t=a.length;if(t==0){console.log("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var n=1.889725992,o=.036749309,c=parseFloat(h[1]),u;u=h[2].replace(/^\s+/,"").split(/\s+/);var E=new S.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])).multiplyScalar(c*n);u=h[3].replace(/^\s+/,"").split(/\s+/);var A=new S.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])).multiplyScalar(c*n);u=h[4].replace(/^\s+/,"").split(/\s+/);var I=new S.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])).multiplyScalar(c*n),R=E.x*(A.y*I.z-I.y*A.z)-A.x*(E.y*I.z-I.y*E.z)+I.x*(E.y*A.z-A.y*E.z);R=Math.abs(R)/Math.pow(n,3);var C=1/R;h.splice(0,8+t+1);var z=h[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),V=Math.abs(z[0]),G=Math.abs(z[1]),B=Math.abs(z[2]),F=this.origin=new S.Vector3(0,0,0);this.size={x:V,y:G,z:B},this.unit=new S.Vector3(E.x,A.y,I.z),E=E.multiplyScalar(1/(n*V)),A=A.multiplyScalar(1/(n*G)),I=I.multiplyScalar(1/(n*B)),(E.y!=0||E.z!=0||A.x!=0||A.z!=0||I.x!=0||I.y!=0)&&(this.matrix=new S.Matrix4(E.x,A.x,I.x,0,E.y,A.y,I.y,0,E.z,A.z,I.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new S.Matrix4().makeTranslation(F.x,F.y,F.z)),this.origin=new S.Vector3(0,0,0),this.unit=new S.Vector3(1,1,1)),h.splice(0,1);var N=h.join(" ");N=N.replace(/^\s+/,""),N=N.split(/[\s\r]+/),N.splice(V*G*B+1);for(var j=new Float32Array(N),U=0;U<j.length;U++)j[U]=j[U]*C*o;this.data=j},this.dx=function(s){var h=s.split(/[\n\r]+/),a,t=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,n=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,o=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,c=/data follows/,u=0;for(u=0;u<h.length;u++){var E=h[u];if(a=t.exec(E)){var A=parseInt(a[1]),I=parseInt(a[2]),R=parseInt(a[3]);this.size={x:A,y:I,z:R}}else if(a=o.exec(E)){var C=parseFloat(a[1]);if((parseFloat(a[2])!=0||parseFloat(a[3])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),u+=1,E=h[u],a=o.exec(E),a==null){console.log("Parse error in dx delta matrix");return}var z=parseFloat(a[2]);if((parseFloat(a[1])!=0||parseFloat(a[3])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),u+=1,E=h[u],a=o.exec(E),a==null){console.log("Parse error in dx delta matrix");return}var V=parseFloat(a[3]);(parseFloat(a[1])!=0||parseFloat(a[2])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new S.Vector3(C,z,V)}else if(a=n.exec(E)){var G=parseFloat(a[1]),B=parseFloat(a[2]),F=parseFloat(a[3]);this.origin=new S.Vector3(G,B,F)}else if(a=c.exec(E))break}if(u+=1,!this.size||!this.origin||!this.unit||!this.size){console.log("Error parsing dx format");return}var N=h.splice(u).join(" ");N=N.split(/[\s\r]+/),this.data=new Float32Array(N)},M=M.toLowerCase(),/\.gz$/.test(M)){M=M.replace(/\.gz$/,"");try{this[M]&&this.isbinary.has(M)?(typeof g=="string"&&(g=(0,w.base64ToArray)(g)),g=(0,v.inflate)(g)):g=new TextDecoder("utf-8").decode((0,v.inflate)(g))}catch(s){console.log(s)}}if(this[M]&&(this.isbinary.has(M)&&typeof g=="string"&&(g=(0,w.base64ToArray)(g)),this[M](g)),x){if(x.negate)for(let s=0,h=this.data.length;s<h;s++)this.data[s]=-this.data[s];if(x.normalize){var p=0;for(let s=0,h=this.data.length;s<h;s++)p+=this.data[s];var y=p/this.data.length;p=0;for(let s=0,h=this.data.length;s<h;s++){var e=this.data[s]-y;p+=e*e}var r=p/this.data.length;for(let s=0,h=this.data.length;s<h;s++)this.data[s]=(this.data[s]-y)/r}}}getIndex(g,M,x){if(this.matrix){this.inversematrix==null&&(this.inversematrix=new S.Matrix4().getInverse(this.matrix));var p=new S.Vector3(g,M,x);p=p.applyMatrix4(this.inversematrix),g=p.x,M=p.y,x=p.z}else g-=this.origin.x,M-=this.origin.y,x-=this.origin.z,g/=this.unit.x,M/=this.unit.y,x/=this.unit.z;return g=Math.round(g),M=Math.round(M),x=Math.round(x),g<0||g>=this.size.x||M<0||M>=this.size.y||x<0||x>=this.size.z?-1:g*this.size.y*this.size.z+M*this.size.z+x}getVal(g,M,x){let p=this.getIndex(g,M,x);return p<0?0:this.data[p]}cube(g){var M=g.split(/\r?\n/);if(!(M.length<6)){var x=(0,P.CUBE)(g,{}).modelData[0].cryst,p=M[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),y=parseFloat(p[0]),e=Math.abs(y);this.origin=x.origin,this.size=x.size,this.unit=x.unit,this.matrix=x.matrix4;var r=6;y<0&&r++;var s=M.splice(e+r).join(" ");s=s.replace(/^\s+/,""),s=s.split(/[\s\r]+/),this.data=new Float32Array(s)}}ccp4(g){var M={};g=new Int8Array(g);var x=new Int32Array(g.buffer,0,56),p=new Float32Array(g.buffer,0,56),y=new DataView(g.buffer);if(M.MAP=String.fromCharCode(y.getUint8(208),y.getUint8(209),y.getUint8(210),y.getUint8(211)),M.MACHST=[y.getUint8(212),y.getUint8(213)],M.MACHST[0]===17&&M.MACHST[1]===17)for(var e=g.byteLength,r=0;r<e;r+=4)y.setFloat32(r,y.getFloat32(r),!0);M.NX=x[0],M.NY=x[1],M.NZ=x[2],M.MODE=x[3],M.NXSTART=x[4],M.NYSTART=x[5],M.NZSTART=x[6],M.MX=x[7],M.MY=x[8],M.MZ=x[9],M.xlen=p[10],M.ylen=p[11],M.zlen=p[12],M.alpha=p[13],M.beta=p[14],M.gamma=p[15],M.MAPC=x[16],M.MAPR=x[17],M.MAPS=x[18],M.DMIN=p[19],M.DMAX=p[20],M.DMEAN=p[21],M.ISPG=x[22],M.NSYMBT=x[23],M.LSKFLG=x[24],M.originX=p[49],M.originY=p[50],M.originZ=p[51],M.ARMS=p[54];var s=M,h=[s.xlen,0,0],a=[s.ylen*Math.cos(Math.PI/180*s.gamma),s.ylen*Math.sin(Math.PI/180*s.gamma),0],t=[s.zlen*Math.cos(Math.PI/180*s.beta),s.zlen*(Math.cos(Math.PI/180*s.alpha)-Math.cos(Math.PI/180*s.gamma)*Math.cos(Math.PI/180*s.beta))/Math.sin(Math.PI/180*s.gamma),0];t[2]=Math.sqrt(s.zlen*s.zlen*Math.sin(Math.PI/180*s.beta)*Math.sin(Math.PI/180*s.beta)-t[1]*t[1]);var n=[0,h,a,t],o=[0,s.MX,s.MY,s.MZ],c=[0,s.MAPC,s.MAPR,s.MAPS];this.matrix=new S.Matrix4,this.matrix.set(n[c[1]][0]/o[c[1]],n[c[2]][0]/o[c[2]],n[c[3]][0]/o[c[3]],0,n[c[1]][1]/o[c[1]],n[c[2]][1]/o[c[2]],n[c[3]][1]/o[c[3]],0,n[c[1]][2]/o[c[1]],n[c[2]][2]/o[c[2]],n[c[3]][2]/o[c[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new S.Matrix4().makeTranslation(s.NXSTART+s.originX,s.NYSTART+s.originY,s.NZSTART+s.originZ)),this.origin=new S.Vector3(0,0,0),this.unit=new S.Vector3(1,1,1),this.size={x:M.NX,y:M.NY,z:M.NZ},this.dimensionorder=[M.MAPC,M.MAPR,M.MAPS];var u=new Float32Array(g.buffer,1024+M.NSYMBT),E=M.NX,A=M.NY,I=M.NZ;this.data=new Float32Array(E*A*I);for(let R=0;R<E;R++)for(let C=0;C<A;C++)for(let z=0;z<I;z++)this.data[(R*A+C)*I+z]=u[(z*A+C)*E+R]}}},"./src/VolumetricRender.ts":($,T,f)=>{f.r(T),f.d(T,{GLVolumetricRender:()=>_});var w=f("./src/WebGL/shapes/index.ts"),S=f("./src/WebGL/math/index.ts"),O=f("./src/WebGL/index.ts"),P=f("./src/colors.ts"),v=f("./src/GLShape.ts");class _{static interpolateArray(g,M){function x(t,n,o){return t+(n-t)*o}var p=[],y=(g.length-1)/(M-1);p[0]=g[0];for(var e=1;e<M-1;e++){var r=e*y,s=Math.floor(r),h=Math.ceil(r),a=r-s;p[e]=x(g[s],g[h],a)}return p[M-1]=g[g.length-1],p}constructor(g,M){this.hidden=!1,this.boundingSphere=new w.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,M=M||{};var x=Object.assign([],M.transferfn);this.subsamples=M.subsamples||5;let p=256;x.forEach(function(E){E.value=parseFloat(E.value)}),x.sort(function(E,A){return E.value-A.value}),this.min=x[0].value,x.length==0&&x.push(x[0]),this.max=x[x.length-1].value;var y,e,r,s,h,a,t,n,o,c;for(let E=0;E<x.length-1;E++)if(r=P.CC.color(x[E].color),s=P.CC.color(x[E+1].color),o=x[E].opacity,c=x[E+1].opacity,y=Math.floor((x[E].value-this.min)*p/(this.max-this.min)),e=Math.floor((x[E+1].value-this.min)*p/(this.max-this.min)),y!=e){h=_.interpolateArray([r.r*255,s.r*255],e-y),a=_.interpolateArray([r.g*255,s.g*255],e-y),t=_.interpolateArray([r.b*255,s.b*255],e-y),n=_.interpolateArray([o*255,c*255],e-y);for(let A=0;A<h.length;A++)this.transferfunctionbuffer.push(h[A]),this.transferfunctionbuffer.push(a[A]),this.transferfunctionbuffer.push(t[A]),this.transferfunctionbuffer.push(n[A])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),g.matrix){let E=new S.Vector3(0,0,0),A=new S.Vector3(g.size.x,g.size.y,g.size.z),I=new S.Vector3(1,1,1);E.applyMatrix4(g.matrix),A.applyMatrix4(g.matrix),I.applyMatrix4(g.matrix).sub(E),this.extent=[[E.x,E.y,E.z],[A.x,A.y,A.z]];for(let V=1;V<7;V++)A.x=V&1?g.size.x:0,A.y=V&2?g.size.y:0,A.z=V&4?g.size.z:0,A.applyMatrix4(g.matrix),this.extent[0][0]=Math.min(this.extent[0][0],A.x),this.extent[0][1]=Math.min(this.extent[0][1],A.y),this.extent[0][2]=Math.min(this.extent[0][2],A.z),this.extent[1][0]=Math.max(this.extent[1][0],A.x),this.extent[1][1]=Math.max(this.extent[1][1],A.y),this.extent[1][2]=Math.max(this.extent[1][2],A.z);let R=A.x-E.x,C=A.y-E.y,z=A.z-E.z;this.maxdepth=Math.sqrt(R*R+C*C+z*z),this.minunit=Math.min(Math.min(I.x,I.y),I.z),this.texmatrix=new S.Matrix4().identity().scale({x:g.size.x,y:g.size.y,z:g.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(g.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=new S.Matrix4().identity();let E=g.unit.x*g.size.x,A=g.unit.y*g.size.y,I=g.unit.z*g.size.z;this.texmatrix.makeTranslation(-g.origin.x/E,-g.origin.y/A,-g.origin.z/I),this.texmatrix.scale({x:1/E,y:1/A,z:1/I}),this.minunit=Math.min(Math.min(g.unit.x,g.unit.y),g.unit.z),this.extent=[[g.origin.x,g.origin.y,g.origin.z],[g.origin.x+E,g.origin.y+A,g.origin.z+I]],this.maxdepth=Math.sqrt(E*E+A*A+I*I)}var u=new v.GLShape({});if(u.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=u.finalize(),this.boundingSphere.center=new S.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,M.coords!==void 0&&M.seldist!==void 0){let E=new Uint8Array(g.data.length),A=M.seldist,I=A*A;for(let R=0,C=M.coords.length;R<C;R++){let z=M.coords[R],V=z.x-A,G=z.y-A,B=z.z-A,F=z.x+A,N=z.y+A,j=z.z+A;if(g.getIndex(V,G,B)>=0||g.getIndex(F,N,j)>=0)for(let U=V;U<F;U+=this.minunit)for(let k=G;k<N;k+=this.minunit)for(let te=B;te<j;te+=this.minunit){let he=g.getIndex(U,k,te);he>=0&&!E[he]&&(U-z.x)*(U-z.x)+(k-z.y)*(k-z.y)+(te-z.z)*(te-z.z)<I&&(E[he]=1)}}for(let R=0,C=g.data.length;R<C;R++)E[R]==0&&(g.data[R]=1/0)}this.data=g}globj(g){if(this.renderedShapeObj&&(g.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){this.shapeObj=new O.Object3D;var M=null,x=new O.Texture(this.data,!0),p=new O.Texture(this.transferfunctionbuffer,!1);x.needsUpdate=!0,p.needsUpdate=!0,p.flipY=!1,M=new O.VolumetricMaterial({transferfn:p,transfermin:this.min,transfermax:this.max,map:x,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples});var y=new O.Mesh(this.geo,M);this.shapeObj.add(y),this.renderedShapeObj=this.shapeObj.clone(),g.add(this.renderedShapeObj)}}removegl(g){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),g.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}},"./src/WebGL/Camera.ts":($,T,f)=>{f.r(T),f.d(T,{Camera:()=>O});var w=f("./src/WebGL/core/index.ts"),S=f("./src/WebGL/math/index.ts");class O extends w.Object3D{constructor(v=50,_=1,L=.1,g=2e3,M=!1){super(),this.projectionMatrix=new S.Matrix4,this.projectionMatrixInverse=new S.Matrix4,this.matrixWorldInverse=new S.Matrix4,this.fov=v,this.aspect=_,this.near=L,this.far=g;var x=this.position.z;this.right=x*Math.tan(Math.PI/180*v),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!M,this.updateProjectionMatrix()}lookAt(v){this.matrix.lookAt(this.position,v,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1&&this.rotation instanceof S.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}},"./src/WebGL/Fog.ts":($,T,f)=>{f.r(T),f.d(T,{Fog:()=>S});var w=f("./src/colors.ts");class S{constructor(P,v=1,_=1e3){this.name="",this.color=new w.Color(P),this.near=v,this.far=_}clone(){return new S(this.color.getHex(),this.near,this.far)}}},"./src/WebGL/Renderer.ts":($,T,f)=>{f.r(T),f.d(T,{Renderer:()=>p});var w=f("./src/WebGL/Camera.ts"),S=f("./src/WebGL/constants/Sides.ts"),O=f("./src/WebGL/constants/TextureConstants.ts"),P=f("./src/WebGL/core/index.ts"),v=f("./src/colors.ts"),_=f("./src/WebGL/materials/index.ts"),L=f("./src/WebGL/math/index.ts"),g=f("./src/WebGL/objects/index.ts"),M=f("./src/WebGL/shaders/index.ts"),x=f("./src/WebGL/SpritePlugin.ts");class p{constructor(e){this.context=null,this.devicePixelRatio=1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldBlending=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._projScreenMatrix=new L.Matrix4,this._vector3=new L.Vector3,this._worldInverse=new L.Matrix4,this._projInverse=new L.Matrix4,this._textureMatrix=new L.Matrix4,this._direction=new L.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new x.SpritePlugin,this._screenshader=null,this._vertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,e=e||{},this.row=e.row,this.col=e.col,this.rows=e.rows,this.cols=e.cols,this._canvas=e.canvas!==void 0?e.canvas:document.createElement("canvas"),this._precision=e.precision!==void 0?e.precision:"highp",this._alpha=e.alpha!==void 0?e.alpha:!0,this._premultipliedAlpha=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,this._antialias=e.antialias!==void 0?e.antialias:!1,this._stencil=e.stencil!==void 0?e.stencil:!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,this._clearColor=e.clearColor!==void 0?new v.Color(e.clearColor):new v.Color(0),this._clearAlpha=e.clearAlpha!==void 0?e.clearAlpha:0,this._outlineMaterial=new _.MeshOutlineMaterial(e.outline),this._outlineSphereImposterMaterial=new _.SphereImposterOutlineMaterial(e.outline),this._outlineStickImposterMaterial=new _.StickImposterOutlineMaterial(e.outline),this._outlineEnabled=!!e.outline,this.domElement=this._canvas,this._canvas.id=e.id,this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this)}supportedExtensions(){return{supportsAIA:!!this._extInstanced,supportsImposters:!!this._extFragDepth||!this.isWebGL1()}}getContext(){return this._gl}isLost(){return this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(e,r){this._clearColor.setHex(e),this._clearAlpha=r,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(e){this._outlineMaterial=new _.MeshOutlineMaterial(e),this._outlineSphereImposterMaterial=new _.SphereImposterOutlineMaterial(e),this._outlineStickImposterMaterial=new _.StickImposterOutlineMaterial(e),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}setViewport(){if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var e=this._canvas.width/this.cols,r=this._canvas.height/this.rows;this._viewportWidth=e,this._viewportHeight=r,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(e*this.col,r*this.row,e,r),this._gl.viewport(e*this.col,r*this.row,e,r)}}setSize(e,r){if(this.devicePixelRatio=window.devicePixelRatio!==void 0?window.devicePixelRatio:1,this._antialias&&this.devicePixelRatio<2&&(this.devicePixelRatio*=2),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var s=e/this.cols,h=r/this.rows;this._canvas.width=e*this.devicePixelRatio,this._canvas.height=r*this.devicePixelRatio,this._viewportWidth=s*this.devicePixelRatio,this._viewportHeight=h*this.devicePixelRatio,this._canvas.style.width=e+"px",this._canvas.style.height=r+"px",this.setViewport()}else this._viewportWidth=this._canvas.width=e*this.devicePixelRatio,this._viewportHeight=this._canvas.height=r*this.devicePixelRatio,this._canvas.style.width=e+"px",this._canvas.style.height=r+"px",this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight);this.initFrameBuffer()}clear(e,r,s){var h=0;(e===void 0||e)&&(h|=this._gl.COLOR_BUFFER_BIT),(r===void 0||r)&&(h|=this._gl.DEPTH_BUFFER_BIT),(s===void 0||s)&&(h|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(h)}clearTarget(e,r,s){this.clear(e,r,s)}setMaterialFaces(e,r){var s=e.side===S.DoubleSide,h=e.side===S.BackSide;e.imposter||(h=r?!h:h),this._oldDoubleSided!==s&&(s?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=s),this._oldFlipSided!==h&&(h?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=h),this._gl.cullFace(this._gl.BACK)}setDepthTest(e){this._oldDepthTest!==e&&(e?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=e)}setDepthWrite(e){this._oldDepthWrite!==e&&(this._gl.depthMask(e),this._oldDepthWrite=e)}setBlending(e){e?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND),this._oldBlending=e}initMaterial(e,r,s,h){e.addEventListener("dispose",this.onMaterialDispose.bind(this));var a,t;if(t=e.shaderID,t){var n=M.ShaderLib[t];e.vertexShader=n.vertexShader,e.fragmentShader=n.fragmentShader,e.uniforms=M.ShaderUtils.clone(n.uniforms)}a={wireframe:e.wireframe,fragdepth:e.imposter,volumetric:e.volumetric},e.program=this.buildProgram(e.fragmentShader,e.vertexShader,e.uniforms,a)}renderBuffer(e,r,s,h,a,t){if(h.visible){var n,o;n=this.setProgram(e,r,s,h,t,this),o=n.attributes;var c=!1,u=h.wireframe?1:0,E=a.id*16777215+n.id*2+u;E!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=E,c=!0),c&&(this.disableAttributes(),o.position>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a.__webglVertexBuffer),this.enableAttribute(o.position),this._gl.vertexAttribPointer(o.position,3,this._gl.FLOAT,!1,0,0)),o.color>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a.__webglColorBuffer),this.enableAttribute(o.color),this._gl.vertexAttribPointer(o.color,3,this._gl.FLOAT,!1,0,0)),o.normal>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a.__webglNormalBuffer),this.enableAttribute(o.normal),this._gl.vertexAttribPointer(o.normal,3,this._gl.FLOAT,!1,0,0)),o.offset>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a.__webglOffsetBuffer),this.enableAttribute(o.offset),this._gl.vertexAttribPointer(o.offset,3,this._gl.FLOAT,!1,0,0)),o.radius>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a.__webglRadiusBuffer),this.enableAttribute(o.radius),this._gl.vertexAttribPointer(o.radius,1,this._gl.FLOAT,!1,0,0)));var A,I;if(t instanceof g.Mesh){if(h.shaderID==="instanced"){var R=h.sphere.geometryGroups[0];c&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,R.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,R.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,R.faceArray,this._gl.STATIC_DRAW)),A=R.faceidx,this._extInstanced.vertexAttribDivisorANGLE(o.offset,1),this._extInstanced.vertexAttribDivisorANGLE(o.radius,1),this._extInstanced.vertexAttribDivisorANGLE(o.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,A,this._gl.UNSIGNED_SHORT,0,a.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(o.offset,0),this._extInstanced.vertexAttribDivisorANGLE(o.radius,0),this._extInstanced.vertexAttribDivisorANGLE(o.color,0)}else h.wireframe?(I=a.lineidx,this.setLineWidth(h.wireframeLinewidth),c&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,I,this._gl.UNSIGNED_SHORT,0)):(A=a.faceidx,c&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,A,this._gl.UNSIGNED_SHORT,0));this.info.render.calls++,this.info.render.vertices+=A,this.info.render.faces+=A/3}else t instanceof g.Line&&(I=a.vertices,this.setLineWidth(h.linewidth),this._gl.drawArrays(this._gl.LINES,0,I),this.info.render.calls++)}}render(e,r,s){if(!(r instanceof w.Camera)){console.error("Renderer.render: camera is not an instance of Camera.");return}var h,a,t,n,o,c=e.__lights,u=e.fog;this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&e.updateMatrixWorld(),r.parent===void 0&&r.updateMatrixWorld(),r.matrixWorldInverse.getInverse(r.matrixWorld),this._projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this.autoUpdateObjects&&this.initWebGLObjects(e),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),(this.autoClear||s)&&(this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)),o=e.__webglObjects;var E=!1;for(h=0,a=o.length;h<a;h++)t=o[h],n=t.object,t.render=!1,n.visible&&(this.setupMatrices(n,r),this.unrollBufferMaterial(t),t.render=!0,t.volumetric&&(E=!0));var A=null;this.setBlending(!1),this.renderObjects(e.__webglObjects,!0,"opaque",r,c,u,!1,A),this.renderSprites(e,r,!1),this.renderObjects(e.__webglObjects,!0,"blank",r,c,u,!0,A),this.renderObjects(e.__webglObjects,!1,"transparent",r,c,u,!0,A),E&&this._fb&&(this.reinitFrameBuffer(),this.renderObjects(e.__webglObjects,!1,"volumetric",r,c,u,!0,A)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(e,r,!0)}reinitFrameBuffer(){this.isWebGL1()||(this._fb=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0))}setFrameBuffer(){if(this.isWebGL1()||!this._fb)return;let e=this._viewportWidth,r=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,e,r),this._gl.viewport(0,0,e,r),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,e,r,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,e,r,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}initFrameBuffer(){if(this.isWebGL1())return;let e=this._viewportWidth,r=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,e,r),this._gl.viewport(0,0,e,r),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer();var s=M.ShaderLib.screen;this._screenshader=this.buildProgram(s.fragmentShader,s.vertexShader,s.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition");var h=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(h),this._gl.STATIC_DRAW)}renderFrameBuffertoScreen(){this.isWebGL1()||this._fb===null||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(e){if(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]),e.__objectsAdded.length){for(;e.__objectsAdded.length;)this.addObject(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;e.__objectsRemoved.length;)this.removeObject(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var r=0,s=e.__webglObjects.length;r<s;r++)this.updateObject(e.__webglObjects[r].object)}getYRatio(){return this.rows!==void 0&&this.row!==void 0?this.rows:1}getXRatio(){return this.cols!==void 0&&this.col!==void 0?this.cols:1}getAspect(e,r){(e==null||r==null)&&(e=this._canvas.width,r=this._canvas.height);var s=e/r;if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var h=e/this.cols,a=r/this.rows;s=h/a}return s}setTexture(e,r,s){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",this.onTextureDispose.bind(this)),e.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+r);var h=s?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D;this._gl.bindTexture(h,e.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,e.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,e.unpackAlignment);var a=this.paramToGL(e.format),t=this.paramToGL(e.type);if(s)this.setTextureParameters(this._gl.TEXTURE_3D,e),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,e.image.size.z,e.image.size.y,e.image.size.x,0,this._gl.RED,this._gl.FLOAT,e.image.data);else{var n=e.image,o=n.width,c=n.height;typeof o>"u"&&(o=n.length,a==this._gl.RGBA&&(o/=4),c=1),this.setTextureParameters(this._gl.TEXTURE_2D,e),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,a,t,e.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,o,c,0,a,t,e.image)}e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else this._gl.activeTexture(this._gl.TEXTURE0+r),s?this._gl.bindTexture(this._gl.TEXTURE_3D,e.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,e.__webglTexture)}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(e){this._enabledAttributes[e]||(this._gl.enableVertexAttribArray(e),this._enabledAttributes[e]=!0)}disableAttributes(){for(let e in this._enabledAttributes)this._enabledAttributes[e]&&(this._gl.disableVertexAttribArray(e),this._enabledAttributes[e]=!1)}setPolygonOffset(e,r,s){this._oldPolygonOffset!==e&&(e?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(e){e!==this._oldLineWidth&&(this._gl.lineWidth(e),this._oldLineWidth=e)}deallocateGeometry(e){if(e.__webglInit=void 0,e.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(e.__webglVertexBuffer),e.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(e.__webglColorBuffer),e.geometryGroups!==void 0)for(var r=0,s=e.groups;r<s;r++){var h=e.geometryGroups[r];h.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(h.__webglVertexBuffer),h.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(h.__webglColorBuffer),h.__webglNormalBuffer!==void 0&&this._gl.deleteBuffer(h.__webglNormalBuffer),h.__webglFaceBuffer!==void 0&&this._gl.deleteBuffer(h.__webglFaceBuffer),h.__webglLineBuffer!==void 0&&this._gl.deleteBuffer(h.__webglLineBuffer)}}deallocateMaterial(e){var r=e.program;if(r!==void 0){e.program=void 0;var s,h,a,t=!1;for(s=0,h=this._programs.length;s<h;s++)if(a=this._programs[s],a.program===r){a.usedTimes--,a.usedTimes===0&&(t=!0);break}if(t===!0){var n=[];for(s=0,h=this._programs.length;s<h;s++)a=this._programs[s],a.program!==r&&n.push(a);this._programs=n,this._gl.deleteProgram(r),this.info.memory.programs--}}}deallocateTexture(e){if(e.image&&e.image.__webglTextureCube)this._gl.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,this._gl.deleteTexture(e.__webglTexture)}}onGeometryDispose(e){var r=e.target;r.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(r),this.info.memory.geometries--}onTextureDispose(e){var r=e.target;r.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(r),this.info.memory.textures--}onMaterialDispose(e){var r=e.target;r.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(r)}getShader(e,r){var s;return!this.isWebGL1()&&!r.startsWith("#version")&&(r=r.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),e=="fragment"?r=r.replace(/varying/g,"in"):r=r.replace(/varying/g,"out"),r=r.replace(/attribute/g,"in"),r=r.replace(/texture2D/g,"texture"),r=r.replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;"),r=r.replace(/gl_FragColor/g,"glFragColor"),r=`#version 300 es
`+r),e==="fragment"?s=this._gl.createShader(this._gl.FRAGMENT_SHADER):e==="vertex"&&(s=this._gl.createShader(this._gl.VERTEX_SHADER)),this._gl.shaderSource(s,r),this._gl.compileShader(s),this._gl.getShaderParameter(s,this._gl.COMPILE_STATUS)?s:(console.error(this._gl.getShaderInfoLog(s)),console.error("could not initialize shader"),null)}buildProgram(e,r,s,h){var a,t,n,o,c=[];c.push(e),c.push(r);for(a in h)c.push(a),c.push(h[a]);for(o=c.join(),a=0,t=this._programs.length;a<t;a++){var u=this._programs[a];if(u.code===o)return u.usedTimes++,u.program}if(this.isWebGL1()&&h.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");n=this._gl.createProgram();var E=this._precision,A="precision "+E+" float;",I=[h.volumetric?"#version 300 es":"",A].join(`
`),R=[h.volumetric?"#version 300 es":"",h.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",h.wireframe?"#define WIREFRAME 1":"",A].join(`
`),C=this.getShader("fragment",R+e),z=this.getShader("vertex",I+r);this._gl.attachShader(n,z),this._gl.attachShader(n,C),this._gl.linkProgram(n),this._gl.getProgramParameter(n,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),n.uniforms={},n.attributes={};var V,G,B;V=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix"];for(G in s)V.push(G);for(B=0;B<V.length;B++){var F=V[B];n.uniforms[F]=this._gl.getUniformLocation(n,F)}for(V=["position","normal","color","lineDistance","offset","radius"],B=0;B<V.length;B++){var N=V[B];n.attributes[N]=this._gl.getAttribLocation(n,N)}return n.id=this._programs_counter++,this._programs.push({program:n,code:o,usedTimes:1}),this.info.memory.programs=this._programs.length,n}setProgram(e,r,s,h,a,t){h.needsUpdate&&(h.program&&this.deallocateMaterial(h),this.initMaterial(h,r,s,a),h.needsUpdate=!1);var n=!1,o=h.program,c=o.uniforms,u=h.uniforms;if(o!=this._currentProgram&&(this._gl.useProgram(o),this._currentProgram=o,n=!0),h.id!=this._currentMaterialId&&(this._currentMaterialId=h.id,n=!0),e!=this._currentCamera&&(this._currentCamera=e,n=!0),this._gl.uniformMatrix4fv(c.projectionMatrix,!1,e.projectionMatrix.elements),this._gl.uniformMatrix4fv(c.modelViewMatrix,!1,a._modelViewMatrix.elements),this._gl.uniformMatrix3fv(c.normalMatrix,!1,a._normalMatrix.elements),n){if(u.fogColor.value=s.color,u.fogNear.value=s.near,u.fogFar.value=s.far,h.shaderID.startsWith("lambert")||h.shaderID==="instanced"||h.shaderID.endsWith("imposter"))this._gl.uniformMatrix4fv(c.viewMatrix,!1,e.matrixWorldInverse.elements),this._lightsNeedUpdate&&(this.setupLights(o,r),this._lightsNeedUpdate=!1),u.directionalLightColor.value=this._lights.directional.colors,u.directionalLightDirection.value=this._lights.directional.positions;else if(h.shaderID.endsWith("outline"))u.outlineColor.value=h.outlineColor,u.outlineWidth.value=h.outlineWidth,u.outlinePushback.value=h.outlinePushback;else if(h.shaderID==="volumetric"){a._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(a._modelViewMatrix),this._projInverse.getInverse(e.projectionMatrix),this._textureMatrix.multiplyMatrices(a.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(c.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(c.projinv,!1,this._projInverse.elements);let E=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z);u.step.value=a.material.unit*E,u.maxdepth.value=a.material.maxdepth*E,u.transfermax.value=a.material.transfermax,u.transfermin.value=a.material.transfermin,u.subsamples.value=a.material.subsamples,t.setTexture(a.material.transferfn,4,!1),t.setTexture(a.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)}u.opacity.value=h.opacity,this.loadMaterialUniforms(c,u)}return o}loadMaterialUniforms(e,r){var s,h,a,t;for(s in r)e[s]&&(h=r[s].type,a=r[s].value,t=e[s],h==="f"?this._gl.uniform1f(t,a):h==="i"?this._gl.uniform1i(t,a):h==="fv"?this._gl.uniform3fv(t,a):h==="c"?this._gl.uniform3f(t,a.r,a.g,a.b):h==="f4"&&this._gl.uniform4f(t,a[0],a[1],a[2],a[3]))}addObject(e,r){var s,h,a,t;if(!e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new L.Matrix4,e._normalMatrix=new L.Matrix3,e.geometry!==void 0&&e.geometry.__webglInit===void 0&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),e instanceof g.Mesh||e instanceof g.Line))for(a=e.geometry,e.material,s=0,h=a.geometryGroups.length;s<h;s++)t=a.geometryGroups[s],t.id=this._geometryGroupCounter++,t.__webglVertexBuffer||(e instanceof g.Mesh?(this.createMeshBuffers(t),a.elementsNeedUpdate=!0,a.normalsNeedUpdate=!0):e instanceof g.Line&&this.createLineBuffers(t),a.verticesNeedUpdate=!0,a.colorsNeedUpdate=!0);if(!e.__webglActive){if(e instanceof g.Mesh||e instanceof g.Line)for(a=e.geometry,s=0,h=a.geometryGroups.length;s<h;s++)t=a.geometryGroups[s],this.addBuffer(r.__webglObjects,t,e);else e instanceof g.Sprite&&r.__webglSprites.push(e);e.__webglActive=!0}}updateObject(e){var r=e.geometry,s;if(e instanceof g.Mesh||e instanceof g.Line){for(var h=0,a=r.geometryGroups.length;h<a;h++)s=r.geometryGroups[h],(r.verticesNeedUpdate||r.elementsNeedUpdate||r.colorsNeedUpdate||r.normalsNeedUpdate)&&this.setBuffers(s,this._gl.STATIC_DRAW);r.verticesNeedUpdate=!1,r.elementsNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.buffersNeedUpdate=!1}}removeObject(e,r){e instanceof g.Mesh||e instanceof g.Line?this.removeInstances(r.__webglObjects,e):e instanceof g.Sprite&&this.removeInstancesDirect(r.__webglSprites,e),e.__webglActive=!1}removeInstances(e,r){for(var s=e.length-1;s>=0;--s)e[s].object===r&&e.splice(s,1)}removeInstancesDirect(e,r){for(var s=e.length-1;s>=0;--s)e[s]===r&&e.splice(s,1)}unrollBufferMaterial(e){var r=e.object,s=r.material;if(s.volumetric)e.opaque=null,e.transparent=null,e.volumetric=s;else if(s.transparent){if(e.opaque=null,e.volumetric=null,e.transparent=s,!s.wireframe){var h=s.clone();h.opacity=0,e.blank=h}}else e.opaque=s,e.transparent=null,e.volumetric=null}setBuffers(e,r){var s=e.vertexArray,h=e.colorArray;if(e.__webglOffsetBuffer!==void 0?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglOffsetBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,s,r)):(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,s,r)),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,h,r),e.normalArray&&e.__webglNormalBuffer!==void 0){var a=e.normalArray;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,a,r)}if(e.radiusArray&&e.__webglRadiusBuffer!==void 0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,e.radiusArray,r)),e.faceArray&&e.__webglFaceBuffer!==void 0){var t=e.faceArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,t,r)}if(e.lineArray&&e.__webglLineBuffer!==void 0){var n=e.lineArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,r)}}createMeshBuffers(e){e.radiusArray&&(e.__webglRadiusBuffer=this._gl.createBuffer()),e.useOffset&&(e.__webglOffsetBuffer=this._gl.createBuffer()),e.__webglVertexBuffer=this._gl.createBuffer(),e.__webglNormalBuffer=this._gl.createBuffer(),e.__webglColorBuffer=this._gl.createBuffer(),e.__webglFaceBuffer=this._gl.createBuffer(),e.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(e){e.__webglVertexBuffer=this._gl.createBuffer(),e.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(e,r,s){e.push({buffer:r,object:s,opaque:null,transparent:null})}setupMatrices(e,r){e._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}filterFallback(e){return this._gl.LINEAR}setTextureParameters(e,r){e==this._gl.TEXTURE_2D?(this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(e,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(r.magFilter)),this._gl.texParameteri(e,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(r.minFilter))):(this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(e,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(e,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(e,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(e,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(e){return e===O.UnsignedByteType?this._gl.UNSIGNED_BYTE:e===O.RGBAFormat?this._gl.RGBA:e===O.NearestFilter?this._gl.NEAREST:0}setupLights(e,r){var s,h,a,t=0,n=0,o=0,c,u,E=this._lights,A=E.directional.colors,I=E.directional.positions,R=0,C=0;for(s=0,h=r.length;s<h;s++)if(a=r[s],c=a.color,u=a.intensity,a.distance,a instanceof P.Light){if(this._direction.getPositionFromMatrix(a.matrixWorld),this._vector3.getPositionFromMatrix(a.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),this._direction.x===0&&this._direction.y===0&&this._direction.z===0)continue;I[C]=this._direction.x,I[C+1]=this._direction.y,I[C+2]=this._direction.z,A[C]=c.r*u,A[C+1]=c.g*u,A[C+2]=c.b*u,C+=3,R++}E.ambient[0]=t,E.ambient[1]=n,E.ambient[2]=o,E.directional.length=R}initGL(){try{if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context.";var e=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(e[6])}catch(r){console.error(r)}}isWebGL1(){return this._webglversion==1}setDefaultGLState(){this._gl.clearColor(0,0,0,1),this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(e,r,s,h,a,t,n,A){var c,u,E,A,I,R,C;r?(I=e.length-1,R=-1,C=-1):(I=0,R=e.length,C=1);for(var z=I;z!==R;z+=C)if(c=e[z],c.render){if(u=c.object,E=c.buffer,A=c[s],!A)continue;n&&this.setBlending(!0),this.setDepthTest(A.depthTest),this.setDepthWrite(A.depthWrite),this.setPolygonOffset(A.polygonOffset,A.polygonOffsetFactor,A.polygonOffsetUnits);var V=u._modelViewMatrix.isReflected();this.setMaterialFaces(A,V),this.renderBuffer(h,a,t,A,E,u),(this._outlineEnabled||A.outline)&&(A.shaderID=="sphereimposter"?this.renderBuffer(h,a,t,this._outlineSphereImposterMaterial,E,u):A.shaderID=="stickimposter"?this.renderBuffer(h,a,t,this._outlineStickImposterMaterial,E,u):!A.wireframe&&A.shaderID!=="basic"&&A.opacity!==0&&this.renderBuffer(h,a,t,this._outlineMaterial,E,u))}}renderSprites(e,r,s){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldBlending=-1,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(e,r,this._currentWidth,this._currentHeight,s),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldBlending=-1,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}},"./src/WebGL/SpritePlugin.ts":($,T,f)=>{f.r(T),f.d(T,{SpritePlugin:()=>S});var w=f("./src/WebGL/shaders/index.ts");class S{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(v){this.gl=v.context,this.renderer=v,this.precision=v.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);var _=0;this.sprite.vertices[_++]=-1,this.sprite.vertices[_++]=-1,this.sprite.vertices[_++]=0,this.sprite.vertices[_++]=0,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=-1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=0,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=-1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=0,this.sprite.vertices[_++]=1,_=0,this.sprite.faces[_++]=0,this.sprite.faces[_++]=1,this.sprite.faces[_++]=2,this.sprite.faces[_++]=0,this.sprite.faces[_++]=2,this.sprite.faces[_++]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(w.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const L={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),L.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),L.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),L.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),L.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),L.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),L.color=this.gl.getUniformLocation(this.sprite.program,"color"),L.map=this.gl.getUniformLocation(this.sprite.program,"map"),L.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),L.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),L.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),L.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),L.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),L.fogType=this.gl.getUniformLocation(this.sprite.program,"fogType"),L.fogDensity=this.gl.getUniformLocation(this.sprite.program,"fogDensity"),L.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),L.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),L.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),L.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=L}render(v,_,L,g,M){var x,p,y,e,r,s,h,a,t,n;if(!this.gl)throw new Error("WebGLRenderer not initialized");let o=[];(x=v==null?void 0:v.__webglSprites)===null||x===void 0||x.forEach(te=>{(M&&te.material.depthTest==!1||!M&&te.material.depthTest)&&o.push(te)});let c=o.length;if(!c)return;const u=this.sprite.attributes,E=this.sprite.uniforms;if(!E)throw new Error("Uniforms not defined");var A=L*.5,I=g*.5;this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(u.position),this.gl.enableVertexAttribArray(u.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(u.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(u.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(E.projectionMatrix,!1,_.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(E.map,0);var R=0,C=0,z=v.fog;z?(this.gl.uniform3f(E.fogColor,z.color.r,z.color.g,z.color.b),this.gl.uniform1f(E.fogNear,z.near),this.gl.uniform1f(E.fogFar,z.far),this.gl.uniform1i(E.fogType,1),R=1,C=1):(this.gl.uniform1i(E.fogType,0),R=0,C=0);var V;let G,B,F,N,j=[];for(V=0;V<c;V++)G=o[V],B=G.material,B&&(B.depthTest==!1&&!M||!G.visible||B.opacity===0||(B.useScreenCoordinates?G.z=-G.position.z:(G._modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,G.matrixWorld),G.z=-G._modelViewMatrix.elements[14])));for(o.sort(O),V=0;V<c;V++)if(G=o[V],B=G.material,!!B&&!(!G.visible||B.opacity===0)&&B.map&&B.map.image&&B.map.image.width){this.gl.uniform1f((E==null?void 0:E.alphaTest)||null,B.alphaTest);var U=B.map.image.width,k=B.map.image.height;j[0]=U*this.renderer.devicePixelRatio/L,j[1]=k*this.renderer.devicePixelRatio/g,B.useScreenCoordinates===!0?(this.gl.uniform1i(E.useScreenCoordinates,1),this.gl.uniform3f(E.screenPosition,(G.position.x*this.renderer.devicePixelRatio-A)/A,(I-G.position.y*this.renderer.devicePixelRatio)/I,Math.max(0,Math.min(1,G.position.z)))):(this.gl.uniform1i(E.useScreenCoordinates,0),this.gl.uniformMatrix4fv(E.modelViewMatrix,!1,G._modelViewMatrix.elements)),v.fog&&B.fog?N=C:N=0,R!==N&&(this.gl.uniform1i(E.fogType,N),R=N),F=1/(B.scaleByViewport?g:1),j[0]*=F*G.scale.x,j[1]*=F*G.scale.y;let te=(p=B==null?void 0:B.alignment)===null||p===void 0?void 0:p.x,he=(y=B==null?void 0:B.alignment)===null||y===void 0?void 0:y.y;B.screenOffset&&(te=(te||0)+2*B.screenOffset.x/U,he=(he||0)+2*B.screenOffset.y/k),this.gl.uniform2f(E.uvScale,((e=B==null?void 0:B.uvScale)===null||e===void 0?void 0:e.x)||1,((r=B==null?void 0:B.uvScale)===null||r===void 0?void 0:r.y)||1),this.gl.uniform2f(E.uvOffset,((s=B==null?void 0:B.uvOffset)===null||s===void 0?void 0:s.x)||0,((h=B==null?void 0:B.uvOffset)===null||h===void 0?void 0:h.y)||0),this.gl.uniform2f(E.alignment,te||0,he||0),this.gl.uniform1f(E.opacity,B.opacity),this.gl.uniform3f(E.color,((a=B==null?void 0:B.color)===null||a===void 0?void 0:a.r)||0,((t=B==null?void 0:B.color)===null||t===void 0?void 0:t.g)||0,((n=B==null?void 0:B.color)===null||n===void 0?void 0:n.b)||0),this.gl.uniform1f(E.rotation,G.rotation),this.gl.uniform2fv(E.scale,j),this.renderer.setDepthTest(B.depthTest),this.renderer.setDepthWrite(B.depthWrite),this.renderer.setTexture(B.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}createProgram(v,_){if(!this.gl)throw new Error("WebGL Rendering context not found");var L=this.gl.createProgram();if(!L)throw new Error("Error creating webgl program");var g=this.gl.createShader(this.gl.FRAGMENT_SHADER),M=this.gl.createShader(this.gl.VERTEX_SHADER);if(!g)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!M)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");var x="precision "+_+` float;
`;if(this.gl.shaderSource(g,x+v.fragmentShader),this.gl.shaderSource(M,x+v.vertexShader),this.gl.compileShader(g),this.gl.compileShader(M),!this.gl.getShaderParameter(g,this.gl.COMPILE_STATUS)||!this.gl.getShaderParameter(M,this.gl.COMPILE_STATUS))throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(g)} 
      ${this.gl.getShaderInfoLog(M)}`);return this.gl.attachShader(L,g),this.gl.attachShader(L,M),this.gl.linkProgram(L),this.gl.getProgramParameter(L,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),L}}function O(P,v){return P.z!==v.z?v.z-P.z:v.id-P.id}},"./src/WebGL/constants/Coloring.ts":($,T,f)=>{f.r(T),f.d(T,{Coloring:()=>w});var w;(function(S){S[S.NoColors=0]="NoColors",S[S.FaceColors=1]="FaceColors",S[S.VertexColors=2]="VertexColors"})(w||(w={}))},"./src/WebGL/constants/Shading.ts":($,T,f)=>{f.r(T),f.d(T,{Shading:()=>w});var w;(function(S){S[S.NoShading=0]="NoShading",S[S.FlatShading=1]="FlatShading",S[S.SmoothShading=2]="SmoothShading"})(w||(w={}))},"./src/WebGL/constants/Sides.ts":($,T,f)=>{f.r(T),f.d(T,{BackSide:()=>S,DoubleSide:()=>O,FrontSide:()=>w});const w=0,S=1,O=2},"./src/WebGL/constants/SpriteAlignment.ts":($,T,f)=>{f.r(T),f.d(T,{SpriteAlignment:()=>S});var w=f("./src/WebGL/math/index.ts");const S={topLeft:new w.Vector2(1,-1),topCenter:new w.Vector2(0,-1),topRight:new w.Vector2(-1,-1),centerLeft:new w.Vector2(1,0),center:new w.Vector2(0,0),centerRight:new w.Vector2(-1,0),bottomLeft:new w.Vector2(1,1),bottomCenter:new w.Vector2(0,1),bottomRight:new w.Vector2(-1,1)}},"./src/WebGL/constants/TextureConstants.ts":($,T,f)=>{f.r(T),f.d(T,{ClampToEdgeWrapping:()=>w,FloatType:()=>_,LinearFilter:()=>S,LinearMipMapLinearFilter:()=>P,NearestFilter:()=>O,R32Format:()=>M,RFormat:()=>g,RGBAFormat:()=>L,UnsignedByteType:()=>v});const w=1001,S=1006,O=1007,P=1008,v=1009,_=1010,L=1021,g=1022,M=1023},"./src/WebGL/constants/TextureOperations.ts":($,T,f)=>{f.r(T),f.d(T,{TextureOperations:()=>w});var w;(function(S){S[S.MultiplyOperation=0]="MultiplyOperation",S[S.MixOperation=1]="MixOperation",S[S.AddOperation=2]="AddOperation"})(w||(w={}))},"./src/WebGL/constants/index.ts":($,T,f)=>{f.r(T),f.d(T,{BackSide:()=>S.BackSide,ClampToEdgeWrapping:()=>v.ClampToEdgeWrapping,Coloring:()=>w.Coloring,DoubleSide:()=>S.DoubleSide,FloatType:()=>v.FloatType,FrontSide:()=>S.FrontSide,LinearFilter:()=>v.LinearFilter,LinearMipMapLinearFilter:()=>v.LinearMipMapLinearFilter,NearestFilter:()=>v.NearestFilter,R32Format:()=>v.R32Format,RFormat:()=>v.RFormat,RGBAFormat:()=>v.RGBAFormat,Shading:()=>O.Shading,SpriteAlignment:()=>P.SpriteAlignment,TextureOperations:()=>_.TextureOperations,UnsignedByteType:()=>v.UnsignedByteType});var w=f("./src/WebGL/constants/Coloring.ts"),S=f("./src/WebGL/constants/Sides.ts"),O=f("./src/WebGL/constants/Shading.ts"),P=f("./src/WebGL/constants/SpriteAlignment.ts"),v=f("./src/WebGL/constants/TextureConstants.ts"),_=f("./src/WebGL/constants/TextureOperations.ts")},"./src/WebGL/core/EventDispatcher.ts":($,T,f)=>{f.r(T),f.d(T,{EventDispatcher:()=>w});class w{constructor(){this.listeners={}}dispatchEvent(O){var P=this.listeners[O.type];if(P!==void 0){O.target=this;for(var v=0,_=P.length;v<_;v++)P[v].call(this,O)}}removeEventListener(O,P){if(!P)this.listeners[O]=[];else{var v=this.listeners[O].indexOf(P);v!==-1&&this.listeners[O].splice(v,1)}}addEventListener(O,P){this.listeners[O]===void 0&&(this.listeners[O]=[]),this.listeners[O].indexOf(P)===-1&&this.listeners[O].push(P)}}},"./src/WebGL/core/Geometry.ts":($,T,f)=>{f.r(T),f.d(T,{Geometry:()=>L,GeometryGroup:()=>_,GeometryIDCount:()=>g});var w=f("./src/WebGL/materials/LineBasicMaterial.ts"),S=f("./src/WebGL/core/EventDispatcher.ts"),O=f("./src/WebGL/math/index.ts"),P=f("./src/colors.ts");const v=65535;class _{constructor(x=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=x}setColors(x){var p=this.vertexArray,y=this.colorArray;if(!p)throw new Error("vertex array not initialized");if(!y)throw new Error("color array not initialized");if(p.length!=y.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var e=0;e<p.length;e+=3){var r=x(p[e],p[e+1],p[e+2]);r instanceof P.Color||(r=P.CC.color(r)),y[e]=r.r,y[e+1]=r.g,y[e+2]=r.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var x=new O.Vector3,p,y,e,r,s=0;s<this.vertices;++s)p=s*3,y=this.vertexArray[p],e=this.vertexArray[p+1],r=this.vertexArray[p+2],x.x+=y,x.y+=e,x.z+=r;return x.divideScalar(this.vertices),x}setNormals(){var x=this.faceArray,p=this.vertexArray,y=this.normalArray;if(!(!this.vertices||!this.faceidx)){if(!x)throw new Error("face array not initialized");if(!p)throw new Error("vertex array not initialized");if(!y)throw new Error("normal array not initialized");for(var e,r,s,h,a,t,n,o=0;o<x.length/3;++o)e=x[o*3]*3,r=x[o*3+1]*3,s=x[o*3+2]*3,h=new O.Vector3(p[e],p[e+1],p[e+2]),a=new O.Vector3(p[r],p[r+1],p[r+2]),t=new O.Vector3(p[s],p[s+1],p[s+2]),h.subVectors(h,a),t.subVectors(t,a),t.cross(h),n=t,n.normalize(),y[e]+=n.x,y[r]+=n.x,y[s]+=n.x,y[e+1]+=n.y,y[r+1]+=n.y,y[s+1]+=n.y,y[e+2]+=n.z,y[r+2]+=n.z,y[s+2]+=n.z}}setLineIndices(){if(this.faceidx&&!(this.lineArray&&this.lineArray.length==this.faceidx*2&&this.lineidx==this.faceidx*2)){var x=this.faceArray,p=this.lineArray=new Uint16Array(this.faceidx*2);if(this.lineidx=this.faceidx*2,!x)throw new Error("face array not initialized");for(var y=0;y<this.faceidx/3;++y){var e=y*3,r=e*2,s=x[e],h=x[e+1],a=x[e+2];p[r]=s,p[r+1]=h,p[r+2]=s,p[r+3]=a,p[r+4]=h,p[r+5]=a}}}vrml(x,p){var y,e,r,s,h,a,t,n,o,c,u,E,A,I,R,C="";C+=x+`Shape {
`+x+` appearance Appearance {
`+x+`  material Material {
`+x+"   diffuseColor "+((y=p==null?void 0:p.color)===null||y===void 0?void 0:y.r)+" "+((e=p==null?void 0:p.color)===null||e===void 0?void 0:e.g)+" "+((r=p==null?void 0:p.color)===null||r===void 0?void 0:r.b)+`
`,p!=null&&p.transparent&&(C+=x+"   transparency "+(1-p.opacity)+`
`),C+=x+`  }
`,C+=x+` }
`;var z=x;if(x+=" ",p instanceof w.LineBasicMaterial){C+=x+`geometry IndexedLineSet {
`+x+` colorPerVertex TRUE
`+x+` coord Coordinate {
`+x+`  point [
`;let G,B,F;for(let N=0;N<this.vertices;++N){let j=N*3;G=(s=this.vertexArray)===null||s===void 0?void 0:s[j],B=(h=this.vertexArray)===null||h===void 0?void 0:h[j+1],F=(a=this.vertexArray)===null||a===void 0?void 0:a[j+2],C+=x+"   "+G+" "+B+" "+F+`,
`}if(C+=x+`  ]
`,C+=x+` }
`,this.colorArray){C+=x+` color Color {
`+x+`  color [
`;for(let N=0;N<this.vertices;++N){let j=N*3;G=this.colorArray[j],B=this.colorArray[j+1],F=this.colorArray[j+2],C+=x+"   "+G+" "+B+" "+F+`,
`}C+=x+`  ]
`,C+=x+` }
`}C+=x+` coordIndex [
`;for(let N=0;N<this.vertices;N+=2)C+=x+"  "+N+", "+(N+1)+`, -1,
`;C+=x+` ]
`,C+=x+`}
`}else{C+=x+`geometry IndexedFaceSet {
`+x+` colorPerVertex TRUE
`+x+` normalPerVertex TRUE
`+x+` solid FALSE
`,C+=x+` coord Coordinate {
`+x+`  point [
`;let G,B,F;for(let N=0;N<this.vertices;++N){let j=N*3;G=(t=this.vertexArray)===null||t===void 0?void 0:t[j],B=(n=this.vertexArray)===null||n===void 0?void 0:n[j+1],F=(o=this.vertexArray)===null||o===void 0?void 0:o[j+2],C+=x+"   "+G+" "+B+" "+F+`,
`}C+=x+`  ]
`,C+=x+` }
`,C+=x+` normal Normal {
`+x+`  vector [
`;for(let N=0;N<this.vertices;++N){let j=N*3;G=(c=this.normalArray)===null||c===void 0?void 0:c[j],B=(u=this.normalArray)===null||u===void 0?void 0:u[j+1],F=(E=this.normalArray)===null||E===void 0?void 0:E[j+2],C+=x+"   "+G+" "+B+" "+F+`,
`}if(C+=x+`  ]
`,C+=x+` }
`,this.colorArray){C+=x+` color Color {
`+x+`  color [
`;for(let N=0;N<this.vertices;++N){let j=N*3;G=this.colorArray[j],B=this.colorArray[j+1],F=this.colorArray[j+2],C+=x+"   "+G+" "+B+" "+F+`,
`}C+=x+`  ]
`,C+=x+` }
`}C+=x+` coordIndex [
`;for(var V=0;V<this.faceidx;V+=3)G=(A=this.faceArray)===null||A===void 0?void 0:A[V],B=(I=this.faceArray)===null||I===void 0?void 0:I[V+1],F=(R=this.faceArray)===null||R===void 0?void 0:R[V+2],C+=x+"  "+G+", "+B+", "+F+`, -1,
`;C+=x+` ]
`,C+=x+`}
`}return C+=z+"}",C}truncateArrayBuffers(x=!0,p=!1){var y=this.vertexArray,e=this.colorArray,r=this.normalArray,s=this.faceArray,h=this.lineArray,a=this.radiusArray;this.vertexArray=(y==null?void 0:y.subarray(0,this.vertices*3))||null,this.colorArray=(e==null?void 0:e.subarray(0,this.vertices*3))||null,x?(this.normalArray=(r==null?void 0:r.subarray(0,this.vertices*3))||null,this.faceArray=(s==null?void 0:s.subarray(0,this.faceidx))||null,this.lineidx>0?this.lineArray=(h==null?void 0:h.subarray(0,this.lineidx))||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),a&&(this.radiusArray=a.subarray(0,this.vertices)),p&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class L extends S.EventDispatcher{constructor(x=!1,p=!1,y=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=g++,this.mesh=x,this.radii=p,this.offset=y}updateGeoGroup(x=0){var p,y=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!y||y.vertices+x>(((p=y==null?void 0:y.vertexArray)===null||p===void 0?void 0:p.length)||0)/3)&&(y=this.addGeoGroup()),y}vrml(x,p){for(var y="",e=this.geometryGroups.length,r=0;r<e;r++){var s=this.geometryGroups[r];y+=s.vrml(x,p)+`,
`}return y}addGeoGroup(){var x=new _(this.geometryGroups.length);return this.geometryGroups.push(x),this.groups=this.geometryGroups.length,x.vertexArray=new Float32Array(v*3),x.colorArray=new Float32Array(v*3),this.mesh&&(x.normalArray=new Float32Array(v*3),x.faceArray=new Uint16Array(v*6),x.lineArray=new Uint16Array(v*6)),this.radii&&(x.radiusArray=new Float32Array(v)),x.useOffset=this.offset,x}setUpNormals(...x){for(var p=0;p<this.groups;p++){var y=this.geometryGroups[p];y.setNormals(...x)}}setColors(...x){for(var p=this.geometryGroups.length,y=0;y<p;y++){var e=this.geometryGroups[y];e.setColors(...x)}}setUpWireframe(...x){for(var p=0;p<this.groups;p++){var y=this.geometryGroups[p];y.setLineIndices(...x)}}initTypedArrays(){for(var x=0;x<this.groups;x++){var p=this.geometryGroups[x];p.__inittedArrays!==!0&&p.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var x=0,p=0;p<this.groups;p++)x+=this.geometryGroups[p].vertices;return x}}let g=0},"./src/WebGL/core/Object3D.ts":($,T,f)=>{f.r(T),f.d(T,{Light:()=>_,Object3D:()=>P,Object3DIDCount:()=>O,Scene:()=>v});var w=f("./src/WebGL/math/index.ts"),S=f("./src/colors.ts");let O=0;class P{constructor(){this.id=O++,this.name="",this.children=[],this.position=new w.Vector3,this.rotation=new w.Vector3,this.matrix=new w.Matrix4,this.matrixWorld=new w.Matrix4,this.quaternion=new w.Quaternion,this.eulerOrder="XYZ",this.up=new w.Vector3(0,1,0),this.scale=new w.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(g){this.matrix.lookAt(g,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?console.error("Unimplemented math operation."):this.rotation instanceof w.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(g){if(g===this){console.error("Can't add $3Dmol.Object3D to itself");return}g.parent=this,this.children.push(g);for(var M=this;M.parent!==void 0;)M=M.parent;M!==void 0&&M instanceof v&&M.__addObject(g)}remove(g){var M=this.children.indexOf(g);if(M!==-1){g.parent=void 0,this.children.splice(M,1);for(var x=this;x.parent!==void 0;)x=x.parent;x!==void 0&&x instanceof v&&x.__removeObject(g)}}vrml(g){g||(g=" ");var M=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),x=0,p=0,y=0;if(M!=0){let s=Math.sin(M/2);x=this.quaternion.x/s,p=this.quaternion.y/s,y=this.quaternion.z/s}var e=g+`Transform {
`+g+" center "+this.position.x+" "+this.position.y+" "+this.position.z+`
`+g+" rotation "+x+" "+p+" "+y+" "+M+`
`+g+` children [
`;this.geometry&&(e+=this.geometry.vrml(g,this.material));for(var r=0;r<this.children.length;r++)e+=this.children[r].vrml(g+" ")+`,
`;return e+=` ]
`,e+="}",e}updateMatrix(){this.matrix.setPosition(this.position),this.useQuaternion===!1&&this.rotation instanceof w.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(g){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||g===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var M=0;M<this.children.length;M++)this.children[M].updateMatrixWorld(!0)}clone(g){g===void 0&&(g=new P),g.name=this.name,g.up.copy(this.up),g.position.copy(this.position),g.rotation instanceof w.Vector3&&this.rotation instanceof w.Vector3?g.rotation.copy(this.rotation):g.rotation=this.rotation,g.eulerOrder=this.eulerOrder,g.scale.copy(this.scale),g.rotationAutoUpdate=this.rotationAutoUpdate,g.matrix.copy(this.matrix),g.matrixWorld.copy(this.matrixWorld),g.quaternion.copy(this.quaternion),g.matrixAutoUpdate=this.matrixAutoUpdate,g.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,g.useQuaternion=this.useQuaternion,g.visible=this.visible;for(var M=0;M<this.children.length;M++){var x=this.children[M];g.add(x.clone())}return g}setVisible(g){this.visible=g;for(var M=0;M<this.children.length;M++){var x=this.children[M];x.setVisible(g)}}}class v extends P{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(g){if(g instanceof _)this.__lights.indexOf(g)===-1&&this.__lights.push(g),g.target&&g.target.parent===void 0&&this.add(g.target);else if(this.__objects.indexOf(g)===-1){this.__objects.push(g),this.__objectsAdded.push(g);var M=this.__objectsRemoved.indexOf(g);M!==-1&&this.__objectsRemoved.splice(M,1)}for(var x=0;x<g.children.length;x++)this.__addObject(g.children[x])}__removeObject(g){var M;if(g instanceof _)M=this.__lights.indexOf(g),M!==-1&&this.__lights.splice(M,1);else if(M=this.__objects.indexOf(g),M!==-1){this.__objects.splice(M,1),this.__objectsRemoved.push(g);var x=this.__objectsAdded.indexOf(g);x!==-1&&this.__objectsAdded.splice(M,1)}for(var p=0;p<g.children.length;p++)this.__removeObject(g.children[p])}}class _ extends P{constructor(g,M=1){super(),this.position=new w.Vector3(0,1,0),this.target=new P,this.castShadow=!1,this.onlyShadow=!1,this.color=new S.Color(g),this.intensity=M}}},"./src/WebGL/core/Projector.ts":($,T,f)=>{f.r(T),f.d(T,{Projector:()=>O});var w=f("./src/WebGL/math/index.ts");const S=new w.Matrix4;class O{static unprojectVector(v,_){return _.projectionMatrixInverse.getInverse(_.projectionMatrix),S.multiplyMatrices(_.matrixWorld,_.projectionMatrixInverse),v.applyProjection(S)}static projectVector(v,_){return _.matrixWorldInverse.getInverse(_.matrixWorld),S.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),v.applyProjection(S)}projectVector(v,_){return O.projectVector(v,_)}unprojectVector(v,_){return O.unprojectVector(v,_)}}},"./src/WebGL/core/Raycaster.ts":($,T,f)=>{f.r(T),f.d(T,{Raycaster:()=>v,intersectObject:()=>s});var w=f("./src/WebGL/math/index.ts"),S=f("./src/WebGL/shapes/index.ts");const O=(h,a)=>h.distance-a.distance,P=new w.Matrix4;class v{constructor(a,t,n,o){this.precision=1e-4,this.linePrecision=.2,this.ray=new w.Ray(a,t),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=o||0,this.far=n||1/0}set(a,t){this.ray.set(a,t)}setFromCamera(a,t){t.ortho?(this.ray.origin.set(a.x,a.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(a.x,a.y,a.z),t.projectionMatrixInverse.getInverse(t.projectionMatrix),P.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),this.ray.direction.applyProjection(P),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(a,t){for(var n=[],o=0,c=t.length;o<c;o++)s(a,t[o],this,n);return n.sort(O),n}}const _=h=>Math.min(Math.max(h,-1),1);var L=new S.Sphere,g=new S.Cylinder,M=new S.Triangle,x=new w.Vector3,p=new w.Vector3,y=new w.Vector3,e=new w.Vector3,r=new w.Vector3;function s(h,a,t,n){if(r.getPositionFromMatrix(h.matrixWorld),a.intersectionShape===void 0)return n;var o=a.intersectionShape,c=t.linePrecision;c*=h.matrixWorld.getMaxScaleOnAxis();var u=c*c;if(a.boundingSphere!==void 0&&a.boundingSphere instanceof S.Sphere&&(L.copy(a.boundingSphere),L.applyMatrix4(h.matrixWorld),!t.ray.isIntersectionSphere(L)))return n;var E,A,I,R,C,z,V,G,B,F,N,j,U,k;for(E=0,A=o.triangle.length;E<A;E++)if(o.triangle[E]instanceof S.Triangle){if(M.copy(o.triangle[E]),M.applyMatrix4(h.matrixWorld),I=M.getNormal(),R=t.ray.direction.dot(I),R>=0||(x.subVectors(M.a,t.ray.origin),V=I.dot(x)/R,V<0))continue;p.copy(t.ray.direction).multiplyScalar(V).add(t.ray.origin),p.sub(M.a),y.copy(M.b).sub(M.a),e.copy(M.c).sub(M.a);var te=y.dot(e),he=y.lengthSq(),re=e.lengthSq();if(j=(he*p.dot(e)-te*p.dot(y))/(he*re-te*te),j<0||j>1||(N=(p.dot(y)-j*te)/he,N<0||N>1||N+j>1))continue;n.push({clickable:a,distance:V})}for(E=0,A=o.cylinder.length;E<A;E++)if(o.cylinder[E]instanceof S.Cylinder){if(g.copy(o.cylinder[E]),g.applyMatrix4(h.matrixWorld),x.subVectors(g.c1,t.ray.origin),C=x.dot(g.direction),z=x.dot(t.ray.direction),R=_(t.ray.direction.dot(g.direction)),B=1-R*R,B===0)continue;U=(R*z-C)/B,k=(z-R*C)/B,p.copy(g.direction).multiplyScalar(U).add(g.c1),y.copy(t.ray.direction).multiplyScalar(k).add(t.ray.origin),G=e.subVectors(p,y).lengthSq();var ae=g.radius*g.radius;if(G<=ae){if(F=(R*C-z)*(R*C-z)-B*(x.lengthSq()-C*C-ae),F<=0?j=V=Math.sqrt(G):j=V=(z-R*C-Math.sqrt(F))/B,N=R*j-C,N<0||N*N>g.lengthSq()||j<0)continue;n.push({clickable:a,distance:V})}}for(E=0,A=o.line.length;E<A;E+=2){p.copy(o.line[E]),p.applyMatrix4(h.matrixWorld),y.copy(o.line[E+1]),y.applyMatrix4(h.matrixWorld),e.subVectors(y,p);var pe=e.lengthSq();e.normalize(),x.subVectors(p,t.ray.origin);var oe=x.dot(e);z=x.dot(t.ray.direction),R=_(t.ray.direction.dot(e)),B=1-R*R,B!==0&&(U=(R*z-oe)/B,k=(z-R*oe)/B,p.add(e.multiplyScalar(U)),y.copy(t.ray.direction).multiplyScalar(k).add(t.ray.origin),G=e.subVectors(y,p).lengthSq(),G<u&&U*U<pe&&n.push({clickable:a,distance:k}))}for(E=0,A=o.sphere.length;E<A;E++)if(o.sphere[E]instanceof S.Sphere&&(L.copy(o.sphere[E]),L.applyMatrix4(h.matrixWorld),t.ray.isIntersectionSphere(L))){p.subVectors(L.center,t.ray.origin);var se=p.dot(t.ray.direction);if(F=se*se-(p.lengthSq()-L.radius*L.radius),se<0)return n;F<=0?V=se:V=se-Math.sqrt(F),n.push({clickable:a,distance:V})}return n}},"./src/WebGL/core/Texture.ts":($,T,f)=>{f.r(T),f.d(T,{Texture:()=>v,TextureIdCount:()=>_});var w=f("./src/WebGL/constants/TextureConstants.ts"),S=f("./src/WebGL/math/index.ts"),O=f("./src/WebGL/core/EventDispatcher.ts"),P=f("./src/WebGL/core/UVMapping.ts");class v extends O.EventDispatcher{constructor(g,M){super(),this.id=_++,this.name="",this.image=g,this.mapping=new P.UVMapping,this.wrapS=w.ClampToEdgeWrapping,this.wrapT=w.ClampToEdgeWrapping,this.anisotropy=1,M?(this.format=w.RFormat,this.type=w.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=w.NearestFilter,this.minFilter=w.NearestFilter):(this.format=w.RGBAFormat,this.type=w.UnsignedByteType,this.offset=new S.Vector2(0,0),this.repeat=new S.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=w.LinearFilter,this.minFilter=w.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(g=new v){return g.image=this.image,g.mapping=this.mapping,g.wrapS=this.wrapS,g.wrapT=this.wrapT,g.magFilter=this.magFilter,g.minFilter=this.minFilter,g.anisotropy=this.anisotropy,g.format=this.format,g.type=this.type,g.offset.copy(this.offset),g.repeat.copy(this.repeat),g.premultiplyAlpha=this.premultiplyAlpha,g.flipY=this.flipY,g.unpackAlignment=this.unpackAlignment,g}dispose(){this.dispatchEvent({type:"dispose"})}}let _=0},"./src/WebGL/core/UVMapping.ts":($,T,f)=>{f.r(T),f.d(T,{UVMapping:()=>w});class w{}},"./src/WebGL/core/index.ts":($,T,f)=>{f.r(T),f.d(T,{EventDispatcher:()=>w.EventDispatcher,Geometry:()=>S.Geometry,GeometryGroup:()=>S.GeometryGroup,GeometryIDCount:()=>S.GeometryIDCount,Light:()=>O.Light,Object3D:()=>O.Object3D,Object3DIDCount:()=>O.Object3DIDCount,Projector:()=>P.Projector,Raycaster:()=>v.Raycaster,Scene:()=>O.Scene,Texture:()=>_.Texture,TextureIdCount:()=>_.TextureIdCount,UVMapping:()=>L.UVMapping,intersectObject:()=>v.intersectObject});var w=f("./src/WebGL/core/EventDispatcher.ts"),S=f("./src/WebGL/core/Geometry.ts"),O=f("./src/WebGL/core/Object3D.ts"),P=f("./src/WebGL/core/Projector.ts"),v=f("./src/WebGL/core/Raycaster.ts"),_=f("./src/WebGL/core/Texture.ts"),L=f("./src/WebGL/core/UVMapping.ts")},"./src/WebGL/index.ts":($,T,f)=>{f.r(T),f.d(T,{BackSide:()=>w.BackSide,Camera:()=>g.Camera,ClampToEdgeWrapping:()=>w.ClampToEdgeWrapping,Coloring:()=>w.Coloring,Cylinder:()=>L.Cylinder,DoubleSide:()=>w.DoubleSide,EventDispatcher:()=>S.EventDispatcher,FloatType:()=>w.FloatType,Fog:()=>M.Fog,FrontSide:()=>w.FrontSide,Geometry:()=>S.Geometry,GeometryGroup:()=>S.GeometryGroup,GeometryIDCount:()=>S.GeometryIDCount,ImposterMaterial:()=>O.ImposterMaterial,InstancedMaterial:()=>O.InstancedMaterial,Light:()=>S.Light,Line:()=>v.Line,LineBasicMaterial:()=>O.LineBasicMaterial,LineStyle:()=>v.LineStyle,LinearFilter:()=>w.LinearFilter,LinearMipMapLinearFilter:()=>w.LinearMipMapLinearFilter,Material:()=>O.Material,MaterialIdCount:()=>O.MaterialIdCount,Matrix3:()=>P.Matrix3,Matrix4:()=>P.Matrix4,Mesh:()=>v.Mesh,MeshDoubleLambertMaterial:()=>O.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>O.MeshLambertMaterial,MeshOutlineMaterial:()=>O.MeshOutlineMaterial,NearestFilter:()=>w.NearestFilter,Object3D:()=>S.Object3D,Object3DIDCount:()=>S.Object3DIDCount,Projector:()=>S.Projector,Quaternion:()=>P.Quaternion,R32Format:()=>w.R32Format,RFormat:()=>w.RFormat,RGBAFormat:()=>w.RGBAFormat,Ray:()=>P.Ray,Raycaster:()=>S.Raycaster,Renderer:()=>x.Renderer,Scene:()=>S.Scene,ShaderLib:()=>_.ShaderLib,ShaderUtils:()=>_.ShaderUtils,Shading:()=>w.Shading,Sphere:()=>L.Sphere,SphereImposterMaterial:()=>O.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>O.SphereImposterOutlineMaterial,Sprite:()=>v.Sprite,SpriteAlignment:()=>w.SpriteAlignment,SpriteMaterial:()=>O.SpriteMaterial,SpritePlugin:()=>p.SpritePlugin,StickImposterMaterial:()=>O.StickImposterMaterial,StickImposterOutlineMaterial:()=>O.StickImposterOutlineMaterial,Texture:()=>S.Texture,TextureIdCount:()=>S.TextureIdCount,TextureOperations:()=>w.TextureOperations,Triangle:()=>L.Triangle,UVMapping:()=>S.UVMapping,UnsignedByteType:()=>w.UnsignedByteType,Vector2:()=>P.Vector2,Vector3:()=>P.Vector3,VolumetricMaterial:()=>O.VolumetricMaterial,basic:()=>_.basic,clamp:()=>P.clamp,clone:()=>_.clone,conversionMatrix3:()=>P.conversionMatrix3,degToRad:()=>P.degToRad,instanced:()=>_.instanced,intersectObject:()=>S.intersectObject,lambert:()=>_.lambert,lambertdouble:()=>_.lambertdouble,outline:()=>_.outline,screen:()=>_.screen,screenaa:()=>_.screenaa,sphereimposter:()=>_.sphereimposter,sphereimposteroutline:()=>_.sphereimposteroutline,sprite:()=>_.sprite,stickimposter:()=>_.stickimposter,stickimposteroutline:()=>_.stickimposteroutline,volumetric:()=>_.volumetric});var w=f("./src/WebGL/constants/index.ts"),S=f("./src/WebGL/core/index.ts"),O=f("./src/WebGL/materials/index.ts"),P=f("./src/WebGL/math/index.ts"),v=f("./src/WebGL/objects/index.ts"),_=f("./src/WebGL/shaders/index.ts"),L=f("./src/WebGL/shapes/index.ts"),g=f("./src/WebGL/Camera.ts"),M=f("./src/WebGL/Fog.ts"),x=f("./src/WebGL/Renderer.ts"),p=f("./src/WebGL/SpritePlugin.ts")},"./src/WebGL/materials/ImposterMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{ImposterMaterial:()=>_});var w=f("./src/WebGL/constants/Coloring.ts"),S=f("./src/WebGL/constants/Shading.ts"),O=f("./src/colors.ts"),P=f("./src/WebGL/math/index.ts"),v=f("./src/WebGL/materials/Material.ts");class _ extends v.Material{constructor(g){super(),this.color=new O.Color(16777215),this.ambient=new O.Color(1048575),this.emissive=new O.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new P.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID=null,this.vertexColors=w.Coloring.NoColors,this.skinning=!1,this.setValues(g)}clone(g=new _){return super.clone.call(this,g),g.color.copy(this.color),g.ambient.copy(this.ambient),g.emissive.copy(this.emissive),g.wrapAround=this.wrapAround,g.wrapRGB.copy(this.wrapRGB),g.map=this.map,g.lightMap=this.lightMap,g.specularMap=this.specularMap,g.envMap=this.envMap,g.combine=this.combine,g.reflectivity=this.reflectivity,g.refractionRatio=this.refractionRatio,g.fog=this.fog,g.shading=this.shading,g.shaderID=this.shaderID,g.vertexColors=this.vertexColors,g.skinning=this.skinning,g.morphTargets=this.morphTargets,g.morphNormals=this.morphNormals,g}}},"./src/WebGL/materials/InstancedMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{InstancedMaterial:()=>_});var w=f("./src/WebGL/constants/Coloring.ts"),S=f("./src/WebGL/constants/Shading.ts"),O=f("./src/colors.ts"),P=f("./src/WebGL/math/index.ts"),v=f("./src/WebGL/materials/Material.ts");class _ extends v.Material{constructor(g){super(),this.color=new O.Color(16777215),this.ambient=new O.Color(1048575),this.emissive=new O.Color(0),this.wrapAround=!1,this.wrapRGB=new P.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=w.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(g)}clone(g=new _){return super.clone.call(this,g),g.color.copy(this.color),g.ambient.copy(this.ambient),g.emissive.copy(this.emissive),g.wrapAround=this.wrapAround,g.wrapRGB.copy(this.wrapRGB),g.map=this.map,g.lightMap=this.lightMap,g.specularMap=this.specularMap,g.envMap=this.envMap,g.combine=this.combine,g.reflectivity=this.reflectivity,g.refractionRatio=this.refractionRatio,g.fog=this.fog,g.shading=this.shading,g.shaderID=this.shaderID,g.vertexColors=this.vertexColors,g.skinning=this.skinning,g.morphTargets=this.morphTargets,g.morphNormals=this.morphNormals,g.sphere=this.sphere,g}}},"./src/WebGL/materials/LineBasicMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{LineBasicMaterial:()=>O});var w=f("./src/colors.ts"),S=f("./src/WebGL/materials/Material.ts");class O extends S.Material{constructor(v){super(),this.color=new w.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(v)}clone(v=new O){return super.clone.call(this,v),v.color.copy(this.color),v}}},"./src/WebGL/materials/Material.ts":($,T,f)=>{f.r(T),f.d(T,{Material:()=>v,MaterialIdCount:()=>_});var w=f("./src/WebGL/constants/Sides.ts"),S=f("./src/WebGL/core/index.ts"),O=f("./src/WebGL/math/index.ts"),P=f("./src/colors.ts");class v extends S.EventDispatcher{constructor(){super(...arguments),this.id=_++,this.name="",this.side=w.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.stencilTest=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1}setValues(g={}){if(g!==void 0)for(var M in g){var x=g[M];if(x===void 0){console.warn("$3Dmol.Material: '"+M+"' parameter is undefined.");continue}if(M in this){var p=this[M];p instanceof P.Color&&x instanceof P.Color?p.copy(x):p instanceof P.Color?p.set(x):p instanceof O.Vector3&&x instanceof O.Vector3?p.copy(x):this[M]=x}}}clone(g=new v){return g.name=this.name,g.side=this.side,g.opacity=this.opacity,g.transparent=this.transparent,g.depthTest=this.depthTest,g.depthWrite=this.depthWrite,g.stencilTest=this.stencilTest,g.polygonOffset=this.polygonOffset,g.polygonOffsetFactor=this.polygonOffsetFactor,g.polygonOffsetUnits=this.polygonOffsetUnits,g.alphaTest=this.alphaTest,g.overdraw=this.overdraw,g.visible=this.visible,g}dispose(){this.dispatchEvent({type:"dispose"})}}let _=0},"./src/WebGL/materials/MeshDoubleLambertMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{MeshDoubleLambertMaterial:()=>O});var w=f("./src/WebGL/constants/Sides.ts"),S=f("./src/WebGL/materials/MeshLambertMaterial.ts");class O extends S.MeshLambertMaterial{constructor(v){super(v),this.shaderID="lambertdouble",this.side=w.DoubleSide,this.outline=!1}clone(v=new O){return super.clone.call(this,v),v}}},"./src/WebGL/materials/MeshLambertMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{MeshLambertMaterial:()=>_});var w=f("./src/WebGL/constants/Coloring.ts"),S=f("./src/WebGL/constants/Shading.ts"),O=f("./src/WebGL/materials/Material.ts"),P=f("./src/colors.ts"),v=f("./src/WebGL/math/index.ts");class _ extends O.Material{constructor(g){super(),this.color=new P.Color(16777215),this.ambient=new P.Color(1048575),this.emissive=new P.Color(0),this.wrapAround=!1,this.wrapRGB=new v.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=w.Coloring.NoColors,this.skinning=!1,this.setValues(g)}clone(g=new _){return super.clone.call(this,g),g.color.copy(this.color),g.ambient.copy(this.ambient),g.emissive.copy(this.emissive),g.wrapAround=this.wrapAround,g.wrapRGB.copy(this.wrapRGB),g.map=this.map,g.lightMap=this.lightMap,g.specularMap=this.specularMap,g.envMap=this.envMap,g.combine=this.combine,g.reflectivity=this.reflectivity,g.refractionRatio=this.refractionRatio,g.fog=this.fog,g.shading=this.shading,g.shaderID=this.shaderID,g.vertexColors=this.vertexColors,g.skinning=this.skinning,g.morphTargets=this.morphTargets,g.morphNormals=this.morphNormals,g}}},"./src/WebGL/materials/MeshOutlineMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{MeshOutlineMaterial:()=>O});var w=f("./src/colors.ts"),S=f("./src/WebGL/materials/Material.ts");class O extends S.Material{constructor(v){super(),v=v||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=v.color||new w.Color(0,0,0),this.outlineWidth=v.width||.1,this.outlinePushback=v.pushback||1}clone(v=new O){return super.clone.call(this,v),v.fog=this.fog,v.shaderID=this.shaderID,v.wireframe=this.wireframe,v}}},"./src/WebGL/materials/SphereImposterMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{SphereImposterMaterial:()=>S});var w=f("./src/WebGL/materials/ImposterMaterial.ts");class S extends w.ImposterMaterial{constructor(P){super(P),this.shaderID="sphereimposter",this.setValues(P)}clone(P=new S){return super.clone.call(this,P),P}}},"./src/WebGL/materials/SphereImposterOutlineMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{SphereImposterOutlineMaterial:()=>O});var w=f("./src/colors.ts"),S=f("./src/WebGL/materials/ImposterMaterial.ts");class O extends S.ImposterMaterial{constructor(v){super(v),v=v||{},this.shaderID="sphereimposteroutline",this.outlineColor=v.color||new w.Color(0,0,0),this.outlineWidth=v.width||.1,this.outlinePushback=v.pushback||1,this.setValues(v)}clone(v=new O){return super.clone.call(this,v),v.outlineColor=this.outlineColor,v.outlineWidth=this.outlineWidth,v.outlinePushback=this.outlinePushback,v}}},"./src/WebGL/materials/SpriteMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{SpriteMaterial:()=>_});var w=f("./src/WebGL/constants/SpriteAlignment.ts"),S=f("./src/WebGL/core/Texture.ts"),O=f("./src/colors.ts"),P=f("./src/WebGL/math/index.ts"),v=f("./src/WebGL/materials/Material.ts");class _ extends v.Material{constructor(g){super(),this.color=new O.Color(16777215),this.map=new S.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new P.Vector2(0,0),this.uvScale=new P.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=w.SpriteAlignment.center.clone(),this.setValues(g),g=g||{},g.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),g.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),g.scaleByViewPort===void 0&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(g=new _){return super.clone.call(this,g),g.color.copy(this.color),g.map=this.map,g.useScreenCoordinates=this.useScreenCoordinates,g.screenOffset=this.screenOffset,g.sizeAttenuation=this.sizeAttenuation,g.scaleByViewport=this.scaleByViewPort,g.alignment.copy(this.alignment),g.uvOffset.copy(this.uvOffset),g}}},"./src/WebGL/materials/StickImposterMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{StickImposterMaterial:()=>S});var w=f("./src/WebGL/materials/ImposterMaterial.ts");class S extends w.ImposterMaterial{constructor(P){super(P),this.shaderID="stickimposter",this.setValues(P)}clone(P=new S){return super.clone.call(this,P),P}}},"./src/WebGL/materials/StickImposterOutlineMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{StickImposterOutlineMaterial:()=>O});var w=f("./src/colors.ts"),S=f("./src/WebGL/materials/ImposterMaterial.ts");class O extends S.ImposterMaterial{constructor(v={}){super(v),this.shaderID="stickimposteroutline",this.outlineColor=new w.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,v.color&&(this.outlineColor=v.color),v.width&&(this.outlineWidth=v.width),v.pushback&&(this.outlinePushback=v.pushback),this.setValues(v)}clone(v=new O){return super.clone.call(this,v),v.outlineColor=this.outlineColor,v.outlineWidth=this.outlineWidth,v.outlinePushback=this.outlinePushback,v}}},"./src/WebGL/materials/VolumetricMaterial.ts":($,T,f)=>{f.r(T),f.d(T,{VolumetricMaterial:()=>P});var w=f("./src/WebGL/constants/Sides.ts"),S=f("./src/colors.ts"),O=f("./src/WebGL/materials/Material.ts");class P extends O.Material{constructor(_){super(),this.transparent=!1,this.volumetric=!0,this.color=new S.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=w.FrontSide,this.setValues(_)}clone(_=new P){return super.clone.call(this,_),_.transparent=this.transparent,_.volumetric=this.volumetric,_.color=this.color,_.transferfn=this.transferfn,_.map=this.map,_.extent=this.extent,_.maxdepth=this.maxdepth,_.unit=this.unit,_.texmatrix=this.texmatrix,_.transfermin=this.transfermin,_.transfermax=this.transfermax,_.subsamples=this.subsamples,_.shaderID=this.shaderID,_.side=this.side,_}}},"./src/WebGL/materials/index.ts":($,T,f)=>{f.r(T),f.d(T,{ImposterMaterial:()=>w.ImposterMaterial,InstancedMaterial:()=>S.InstancedMaterial,LineBasicMaterial:()=>O.LineBasicMaterial,Material:()=>P.Material,MaterialIdCount:()=>P.MaterialIdCount,MeshDoubleLambertMaterial:()=>v.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>_.MeshLambertMaterial,MeshOutlineMaterial:()=>L.MeshOutlineMaterial,SphereImposterMaterial:()=>g.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>M.SphereImposterOutlineMaterial,SpriteMaterial:()=>x.SpriteMaterial,StickImposterMaterial:()=>p.StickImposterMaterial,StickImposterOutlineMaterial:()=>y.StickImposterOutlineMaterial,VolumetricMaterial:()=>e.VolumetricMaterial});var w=f("./src/WebGL/materials/ImposterMaterial.ts"),S=f("./src/WebGL/materials/InstancedMaterial.ts"),O=f("./src/WebGL/materials/LineBasicMaterial.ts"),P=f("./src/WebGL/materials/Material.ts"),v=f("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),_=f("./src/WebGL/materials/MeshLambertMaterial.ts"),L=f("./src/WebGL/materials/MeshOutlineMaterial.ts"),g=f("./src/WebGL/materials/SphereImposterMaterial.ts"),M=f("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),x=f("./src/WebGL/materials/SpriteMaterial.ts"),p=f("./src/WebGL/materials/StickImposterMaterial.ts"),y=f("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),e=f("./src/WebGL/materials/VolumetricMaterial.ts")},"./src/WebGL/math/Quaternion.ts":($,T,f)=>{f.r(T),f.d(T,{Quaternion:()=>w});class w{constructor(O,P,v,_){this.x=O||0,this.y=P||0,this.z=v||0,this.w=_!==void 0?_:1}set(O,P,v,_){return this.x=O,this.y=P,this.z=v,this.w=_,this}copy(O){return this.x=O.x,this.y=O.y,this.z=O.z,this.w=O.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let O=this.length();return O===0?(this.x=0,this.y=0,this.z=0,this.w=1):(O=1/O,this.x*=O,this.y*=O,this.z*=O,this.w*=O),this}multiply(O){return this.multiplyQuaternions(this,O)}multiplyScalar(O){return this.x*=O,this.y*=O,this.z*=O,this.w*=O,this}multiplyQuaternions(O,P){const v=O.x,_=O.y,L=O.z,g=O.w,M=P.x,x=P.y,p=P.z,y=P.w;return this.x=v*y+g*M+_*p-L*x,this.y=_*y+g*x+L*M-v*p,this.z=L*y+g*p+v*x-_*M,this.w=g*y-v*M-_*x-L*p,this}sub(O){return this.x-=O.x,this.y-=O.y,this.z-=O.z,this.w-=O.w,this}clone(){return new w(this.x,this.y,this.z,this.w)}setFromEuler(O){const P=Math.cos(O.x/2),v=Math.cos(O.y/2),_=Math.cos(O.z/2),L=Math.sin(O.x/2),g=Math.sin(O.y/2),M=Math.sin(O.z/2);return this.x=L*v*_+P*g*M,this.y=P*g*_-L*v*M,this.z=P*v*M+L*g*_,this.w=P*v*_-L*g*M,this}}},"./src/WebGL/math/Vector2.ts":($,T,f)=>{f.r(T),f.d(T,{Vector2:()=>w});class w{constructor(O,P){this.x=O||0,this.y=P||0}set(O,P){return this.x=O,this.y=P,this}subVectors(O,P){return this.x=O.x-P.x,this.y=O.y-P.y,this}copy(O){return this.x=O.x,this.y=O.y,this}clone(){return new w(this.x,this.y)}}},"./src/WebGL/math/index.ts":($,T,f)=>{f.r(T),f.d(T,{Matrix3:()=>_.Matrix3,Matrix4:()=>_.Matrix4,Quaternion:()=>w.Quaternion,Ray:()=>_.Ray,Vector2:()=>S.Vector2,Vector3:()=>_.Vector3,clamp:()=>O.clamp,conversionMatrix3:()=>P.conversionMatrix3,degToRad:()=>v.degToRad});var w=f("./src/WebGL/math/Quaternion.ts"),S=f("./src/WebGL/math/Vector2.ts"),O=f("./src/WebGL/math/utils/clamp.ts"),P=f("./src/WebGL/math/utils/conversionMatrix3.ts"),v=f("./src/WebGL/math/utils/degToRad.ts"),_=f("./src/WebGL/math/math.ts")},"./src/WebGL/math/math.ts":($,T,f)=>{f.r(T),f.d(T,{Matrix3:()=>x,Matrix4:()=>g,Ray:()=>p,Vector3:()=>M});var w=f("./src/WebGL/math/utils/degToRad.ts"),S=f("./src/WebGL/math/utils/clamp.ts"),O,P,v,_,L;class g{constructor(e=1,r=0,s=0,h=0,a=0,t=1,n=0,o=0,c=0,u=0,E=1,A=0,I=0,R=0,C=0,z=1){typeof e<"u"&&typeof e!="number"?this.elements=new Float32Array(e):(this.elements=new Float32Array(16),this.elements[0]=e,this.elements[4]=r,this.elements[8]=s,this.elements[12]=h,this.elements[1]=a,this.elements[5]=t,this.elements[9]=n,this.elements[13]=o,this.elements[2]=c,this.elements[6]=u,this.elements[10]=E,this.elements[14]=A,this.elements[3]=I,this.elements[7]=R,this.elements[11]=C,this.elements[15]=z)}makeScale(e,r,s){throw new Error("Method not implemented.")}set(e,r,s,h,a,t,n,o,c,u,E,A,I,R,C,z){const V=this.elements;return V[0]=e,V[4]=r,V[8]=s,V[12]=h,V[1]=a,V[5]=t,V[9]=n,V[13]=o,V[2]=c,V[6]=u,V[10]=E,V[14]=A,V[3]=I,V[7]=R,V[11]=C,V[15]=z,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(e){const r=e.elements;return this.set(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]),this}matrix3FromTopLeft(){const e=this.elements;return new x(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10])}setRotationFromEuler(e,r){const s=this.elements,{x:h,y:a,z:t}=e,n=Math.cos(h),o=Math.sin(h),c=Math.cos(a),u=Math.sin(a),E=Math.cos(t),A=Math.sin(t);if(r===void 0||r==="XYZ"){const I=n*E,R=n*A,C=o*E,z=o*A;s[0]=c*E,s[4]=-c*A,s[8]=u,s[1]=R+C*u,s[5]=I-z*u,s[9]=-o*c,s[2]=z-I*u,s[6]=C+R*u,s[10]=n*c}else console.error(`Error with matrix4 setRotationFromEuler. Order: ${r}`);return this}setRotationFromQuaternion(e){const r=this.elements,{x:s,y:h,z:a,w:t}=e,n=s+s,o=h+h,c=a+a,u=s*n,E=s*o,A=s*c,I=h*o,R=h*c,C=a*c,z=t*n,V=t*o,G=t*c;return r[0]=1-(I+C),r[4]=E-G,r[8]=A+V,r[1]=E+G,r[5]=1-(u+C),r[9]=R-z,r[2]=A-V,r[6]=R+z,r[10]=1-(u+I),this}multiplyMatrices(e,r){const s=e.elements,h=r.elements,a=this.elements,t=s[0],n=s[4],o=s[8],c=s[12],u=s[1],E=s[5],A=s[9],I=s[13],R=s[2],C=s[6],z=s[10],V=s[14],G=s[3],B=s[7],F=s[11],N=s[15],j=h[0],U=h[4],k=h[8],te=h[12],he=h[1],re=h[5],ae=h[9],pe=h[13],oe=h[2],se=h[6],Ce=h[10],_e=h[14],Se=h[3],fe=h[7],xe=h[11],Ee=h[15];return a[0]=t*j+n*he+o*oe+c*Se,a[4]=t*U+n*re+o*se+c*fe,a[8]=t*k+n*ae+o*Ce+c*xe,a[12]=t*te+n*pe+o*_e+c*Ee,a[1]=u*j+E*he+A*oe+I*Se,a[5]=u*U+E*re+A*se+I*fe,a[9]=u*k+E*ae+A*Ce+I*xe,a[13]=u*te+E*pe+A*_e+I*Ee,a[2]=R*j+C*he+z*oe+V*Se,a[6]=R*U+C*re+z*se+V*fe,a[10]=R*k+C*ae+z*Ce+V*xe,a[14]=R*te+C*pe+z*_e+V*Ee,a[3]=G*j+B*he+F*oe+N*Se,a[7]=G*U+B*re+F*se+N*fe,a[11]=G*k+B*ae+F*Ce+N*xe,a[15]=G*te+B*pe+F*_e+N*Ee,this}multiplyScalar(e){const r=this.elements;return r[0]*=e,r[4]*=e,r[8]*=e,r[12]*=e,r[1]*=e,r[5]*=e,r[9]*=e,r[13]*=e,r[2]*=e,r[6]*=e,r[10]*=e,r[14]*=e,r[3]*=e,r[7]*=e,r[11]*=e,r[15]*=e,this}makeTranslation(e,r,s){return this.set(1,0,0,e,0,1,0,r,0,0,1,s,0,0,0,1),this}snap(e){const r=Math.pow(10,4),s=this.elements;for(let h=0;h<16;h++){const a=Math.round(s[h]);a===Math.round(s[h]*r)/r&&(s[h]=a)}return this}transpose(){const e=this.elements;let r;return r=e[1],e[1]=e[4],e[4]=r,r=e[2],e[2]=e[8],e[8]=r,r=e[6],e[6]=e[9],e[9]=r,r=e[3],e[3]=e[12],e[12]=r,r=e[7],e[7]=e[13],e[13]=r,r=e[11],e[11]=e[14],e[14]=r,this}setPosition(e){const r=this.elements;return r[12]=e.x,r[13]=e.y,r[14]=e.z,this}translate(e){const r=this.elements;return r[12]+=e.x,r[13]+=e.y,r[14]+=e.z,this}getInverse(e,r){const s=this.elements,h=e.elements,a=h[0],t=h[4],n=h[8],o=h[12],c=h[1],u=h[5],E=h[9],A=h[13],I=h[2],R=h[6],C=h[10],z=h[14],V=h[3],G=h[7],B=h[11],F=h[15];s[0]=E*z*G-A*C*G+A*R*B-u*z*B-E*R*F+u*C*F,s[4]=o*C*G-n*z*G-o*R*B+t*z*B+n*R*F-t*C*F,s[8]=n*A*G-o*E*G+o*u*B-t*A*B-n*u*F+t*E*F,s[12]=o*E*R-n*A*R-o*u*C+t*A*C+n*u*z-t*E*z,s[1]=A*C*V-E*z*V-A*I*B+c*z*B+E*I*F-c*C*F,s[5]=n*z*V-o*C*V+o*I*B-a*z*B-n*I*F+a*C*F,s[9]=o*E*V-n*A*V-o*c*B+a*A*B+n*c*F-a*E*F,s[13]=n*A*I-o*E*I+o*c*C-a*A*C-n*c*z+a*E*z,s[2]=u*z*V-A*R*V+A*I*G-c*z*G-u*I*F+c*R*F,s[6]=o*R*V-t*z*V-o*I*G+a*z*G+t*I*F-a*R*F,s[10]=t*A*V-o*u*V+o*c*G-a*A*G-t*c*F+a*u*F,s[14]=o*u*I-t*A*I-o*c*R+a*A*R+t*c*z-a*u*z,s[3]=E*R*V-u*C*V-E*I*G+c*C*G+u*I*B-c*R*B,s[7]=t*C*V-n*R*V+n*I*G-a*C*G-t*I*B+a*R*B,s[11]=n*u*V-t*E*V-n*c*G+a*E*G+t*c*B-a*u*B,s[15]=t*E*I-n*u*I+n*c*R-a*E*R-t*c*C+a*u*C;const N=a*s[0]+c*s[4]+I*s[8]+V*s[12];if(N===0){const j="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(r)throw new Error(j);return console.warn(j),this.identity(),this}return this.multiplyScalar(1/N),this}isReflected(){const e=this.elements,r=e[0],s=e[4],h=e[8],a=e[1],t=e[5],n=e[9],o=e[2],c=e[6],u=e[10];return r*t*u+a*c*h+o*s*n-o*t*h-a*s*u-r*c*n<0}scale(e){const r=this.elements,{x:s}=e,{y:h}=e,{z:a}=e;return r[0]*=s,r[4]*=h,r[8]*=a,r[1]*=s,r[5]*=h,r[9]*=a,r[2]*=s,r[6]*=h,r[10]*=a,r[3]*=s,r[7]*=h,r[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],h=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(r,Math.max(s,h)))}makeFrustum(e,r,s,h,a,t){const n=this.elements,o=2*a/(r-e),c=2*a/(h-s),u=(r+e)/(r-e),E=(h+s)/(h-s),A=-(t+a)/(t-a),I=-2*t*a/(t-a);return n[0]=o,n[4]=0,n[8]=u,n[12]=0,n[1]=0,n[5]=c,n[9]=E,n[13]=0,n[2]=0,n[6]=0,n[10]=A,n[14]=I,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makePerspective(e,r,s,h){const a=s*Math.tan((0,w.degToRad)(e*.5)),t=-a,n=t*r,o=a*r;return this.makeFrustum(n,o,t,a,s,h)}makeOrthographic(e,r,s,h,a,t){const n=this.elements,o=1/(r-e),c=1/(s-h),u=1/(t-a),E=(r+e)*o,A=(s+h)*c,I=(t+a)*u;return n[0]=2*o,n[4]=0,n[8]=0,n[12]=-E,n[1]=0,n[5]=2*c,n[9]=0,n[13]=-A,n[2]=0,n[6]=0,n[10]=-2*u,n[14]=-I,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}isEqual(e){const r=e.elements,s=this.elements;return s[0]===r[0]&&s[4]===r[4]&&s[8]===r[8]&&s[12]===r[12]&&s[1]===r[1]&&s[5]===r[5]&&s[9]===r[9]&&s[13]===r[13]&&s[2]===r[2]&&s[6]===r[6]&&s[10]===r[10]&&s[14]===r[14]&&s[3]===r[3]&&s[7]===r[7]&&s[11]===r[11]&&s[15]===r[15]}clone(){const e=this.elements;return new g(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}isIdentity(){const e=this.elements;return e[0]===1&&e[4]===0&&e[8]===0&&e[12]===0&&e[1]===0&&e[5]===1&&e[9]===0&&e[13]===0&&e[2]===0&&e[6]===0&&e[10]===1&&e[14]===0&&e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}isNearlyIdentity(e){return this.clone().snap(e).isIdentity()}getScale(e){const r=this.elements;return e=e||new M,v.set(r[0],r[1],r[2]),_.set(r[4],r[5],r[6]),L.set(r[8],r[9],r[10]),e.x=v.length(),e.y=_.length(),e.z=L.length(),e}lookAt(e,r,s){const h=this.elements;return L.subVectors(e,r).normalize(),L.length()===0&&(L.z=1),v.crossVectors(s,L).normalize(),v.length()===0&&(L.x+=1e-4,v.crossVectors(s,L).normalize()),_.crossVectors(L,v),h[0]=v.x,h[4]=_.x,h[8]=L.x,h[1]=v.y,h[5]=_.y,h[9]=L.y,h[2]=v.z,h[6]=_.z,h[10]=L.z,this}compose(e,r,s){const h=this.elements;return O.identity(),O.setRotationFromQuaternion(r),P.makeScale(s.x,s.y,s.z),this.multiplyMatrices(O,P),h[12]=e.x,h[13]=e.y,h[14]=e.z,this}}O=new g,P=new g;class M{constructor(e,r,s){this.x=e||0,this.y=r||0,this.z=s||0,this.atomid=void 0}set(e,r,s){return this.x=e,this.y=r,this.z=s,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addVectors(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this.z=e.z+r.z,this}multiplyVectors(e,r){return this.x=e.x*r.x,this.y=e.y*r.y,this.z=e.z*r.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subVectors(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this.z=e.z-r.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}divideScalar(e){return e!==0?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const r=this.x-e.x,s=this.y-e.y,h=this.z-e.z;return r*r+s*s+h*h}applyMatrix3(e){const{x:r}=this,{y:s}=this,{z:h}=this,a=e.elements;return this.x=a[0]*r+a[3]*s+a[6]*h,this.y=a[1]*r+a[4]*s+a[7]*h,this.z=a[2]*r+a[5]*s+a[8]*h,this}applyMatrix4(e){const{x:r}=this,{y:s}=this,{z:h}=this,a=e.elements;return this.x=a[0]*r+a[4]*s+a[8]*h+a[12],this.y=a[1]*r+a[5]*s+a[9]*h+a[13],this.z=a[2]*r+a[6]*s+a[10]*h+a[14],this}applyProjection(e){const{x:r}=this,{y:s}=this,{z:h}=this,a=e.elements,t=a[3]*r+a[7]*s+a[11]*h+a[15];return this.x=(a[0]*r+a[4]*s+a[8]*h+a[12])/t,this.y=(a[1]*r+a[5]*s+a[9]*h+a[13])/t,this.z=(a[2]*r+a[6]*s+a[10]*h+a[14])/t,this}applyQuaternion(e){const{x:r}=this,{y:s}=this,{z:h}=this,a=e.x,t=e.y,n=e.z,o=e.w,c={};c.x=2*(s*n-h*t),c.y=2*(h*a-r*n),c.z=2*(r*t-s*a);const u={};return u.x=c.y*n-c.z*t,u.y=c.z*a-c.x*n,u.z=c.x*t-c.y*a,this.x=r+o*c.x+u.x,this.y=s+o*c.y+u.y,this.z=h+o*c.z+u.z,this}negate(){return this.multiplyScalar(-1)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(e){const{x:r}=this,{y:s}=this,{z:h}=this;return this.x=s*e.z-h*e.y,this.y=h*e.x-r*e.z,this.z=r*e.y-s*e.x,this}crossVectors(e,r){return this.x=e.y*r.z-e.z*r.y,this.y=e.z*r.x-e.x*r.z,this.z=e.x*r.y-e.y*r.x,this}equals(e){return this.x==e.x&&this.y==e.y&&this.z==e.z}getPositionFromMatrix(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}setEulerFromRotationMatrix(e,r){const s=e.elements,h=s[0],a=s[4],t=s[8],n=s[5],o=s[9],c=s[6],u=s[10];return r===void 0||r==="XYZ"?(this.y=Math.asin((0,S.clamp)(t,-1,1)),Math.abs(t)<.99999?(this.x=Math.atan2(-o,u),this.z=Math.atan2(-a,h)):(this.x=Math.atan2(c,n),this.z=0)):console.error(`Error with vector's setEulerFromRotationMatrix: Unknown order: ${r}`),this}rotateAboutVector(e,r){e.normalize();const s=Math.cos(r),h=Math.sin(r),a=this.clone().multiplyScalar(s),t=e.clone().cross(this).multiplyScalar(h),n=e.clone().multiplyScalar(e.clone().dot(this)).multiplyScalar(1-s),o=a.add(t).add(n);return this.x=o.x,this.y=o.y,this.z=o.z,this}setFromMatrixPosition(e){const r=e.elements;return this.x=r[12],this.y=r[13],this.z=r[14],this}transformDirection(e){const{x:r}=this,{y:s}=this,{z:h}=this,a=e.elements;return this.x=a[0]*r+a[4]*s+a[8]*h,this.y=a[1]*r+a[5]*s+a[9]*h,this.z=a[2]*r+a[6]*s+a[10]*h,this.normalize()}clone(){return new M(this.x,this.y,this.z)}unproject(e){const r=O;return r.multiplyMatrices(e.matrixWorld,r.getInverse(e.projectionMatrix)),this.applyMatrix4(r)}}v=new M,_=new M,L=new M;class x{constructor(e=1,r=0,s=0,h=0,a=1,t=0,n=0,o=0,c=1){this.elements=new Float32Array(9),this.set(e,r,s,h,a,t,n,o,c)}set(e,r,s,h,a,t,n,o,c){const u=this.elements;return u[0]=e,u[3]=r,u[6]=s,u[1]=h,u[4]=a,u[7]=t,u[2]=n,u[5]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const r=e.elements;this.set(r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8])}multiplyScalar(e){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=e,r[4]*=e,r[7]*=e,r[2]*=e,r[5]*=e,r[8]*=e,this}getInverse3(e){const r=e.elements,s=this.elements;s[0]=r[4]*r[8]-r[5]*r[7],s[3]=r[6]*r[5]-r[3]*r[8],s[6]=r[3]*r[7]-r[6]*r[4],s[1]=r[7]*r[2]-r[1]*r[8],s[4]=r[0]*r[8]-r[6]*r[2],s[7]=r[1]*r[6]-r[0]*r[7],s[2]=r[1]*r[5]-r[2]*r[4],s[5]=r[2]*r[3]-r[0]*r[5],s[8]=r[0]*r[4]-r[1]*r[3];const h=r[0]*s[0]+r[3]*s[1]+r[6]*s[2];return this.multiplyScalar(1/h),this}getInverse(e,r){const s=e.elements,h=this.elements;h[0]=s[10]*s[5]-s[6]*s[9],h[1]=-s[10]*s[1]+s[2]*s[9],h[2]=s[6]*s[1]-s[2]*s[5],h[3]=-s[10]*s[4]+s[6]*s[8],h[4]=s[10]*s[0]-s[2]*s[8],h[5]=-s[6]*s[0]+s[2]*s[4],h[6]=s[9]*s[4]-s[5]*s[8],h[7]=-s[9]*s[0]+s[1]*s[8],h[8]=s[5]*s[0]-s[1]*s[4];const a=s[0]*h[0]+s[1]*h[3]+s[2]*h[6];if(a===0){const t="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(r)throw new Error(t);return console.warn(t),this.identity(),this}return this.multiplyScalar(1/a),this}getDeterminant(){const e=this.elements;return e[0]*e[4]*e[8]+e[1]*e[5]*e[6]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6]-e[1]*e[3]*e[8]-e[0]*e[5]*e[7]}transpose(){let e;const r=this.elements;return e=r[1],r[1]=r[3],r[3]=e,e=r[2],r[2]=r[6],r[6]=e,e=r[5],r[5]=r[7],r[7]=e,this}clone(){const e=this.elements;return new x(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}getMatrix4(){const e=this.elements;return new g(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0)}}class p{constructor(e,r){this.origin=e!==void 0?e:new M,this.direction=r!==void 0?r:new M}set(e,r){return this.origin.copy(e),this.direction.copy(r),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,r){return(r||new M).copy(this.direction).multiplyScalar(e).add(this.origin)}recast(e){const r=v;return this.origin.copy(this.at(e,r)),this}closestPointToPoint(e,r){const s=r||new M;s.subVectors(e,this.origin);const h=s.dot(this.direction);return s.copy(this.direction).multiplyScalar(h).add(this.origin)}distanceToPoint(e){const r=v,s=r.subVectors(e,this.origin).dot(this.direction);return r.copy(this.direction).multiplyScalar(s).add(this.origin),r.distanceTo(e)}isIntersectionCylinder(){}isIntersectionSphere(e){return this.distanceToPoint(e.center)<=e.radius}isIntersectionPlane(e){return e.normal.dot(this.direction)!==0||e.distanceToPoint(this.origin)===0}distanceToPlane(e){const r=e.normal.dot(this.direction);return r===0?e.distanceToPoint(this.origin)===0?0:void 0:-(this.origin.dot(e.normal)+e.constant)/r}intersectPlane(e,r){const s=this.distanceToPlane(e);if(s!==void 0)return this.at(s,r)}applyMatrix4(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this}clone(){return new p().copy(this)}}},"./src/WebGL/math/utils/clamp.ts":($,T,f)=>{f.r(T),f.d(T,{clamp:()=>w});function w(S,O,P){return Math.min(Math.max(S,O),P)}},"./src/WebGL/math/utils/conversionMatrix3.ts":($,T,f)=>{f.r(T),f.d(T,{conversionMatrix3:()=>S});var w=f("./src/WebGL/math/math.ts");function S(O,P,v,_,L,g){_=_*Math.PI/180,L=L*Math.PI/180,g=g*Math.PI/180;const M=s=>s*s,x=Math.cos(_),p=Math.cos(L),y=Math.cos(g),e=Math.sin(g);return new w.Matrix3(O,P*y,v*p,0,P*e,v*(x-p*y)/e,0,0,v*Math.sqrt(1-M(x)-M(p)-M(y)+2*x*p*y)/e)}},"./src/WebGL/math/utils/degToRad.ts":($,T,f)=>{f.r(T),f.d(T,{degToRad:()=>S});const w=Math.PI/180;function S(O){return O*w}},"./src/WebGL/objects/Line.ts":($,T,f)=>{f.r(T),f.d(T,{Line:()=>P,LineStyle:()=>O});var w=f("./src/WebGL/materials/index.ts"),S=f("./src/WebGL/core/index.ts"),O;(function(v){v[v.LineStrip=0]="LineStrip",v[v.LinePieces=1]="LinePieces"})(O||(O={}));class P extends S.Object3D{constructor(_,L=new w.LineBasicMaterial({color:Math.random()*16777215}),g=O.LineStrip){super(),this.geometry=_,this.material=L,this.type=g}clone(_=new P(this.geometry,this.material,this.type)){return super.clone.call(this,_),_}}},"./src/WebGL/objects/Mesh.ts":($,T,f)=>{f.r(T),f.d(T,{Mesh:()=>S});var w=f("./src/WebGL/core/index.ts");class S extends w.Object3D{constructor(P,v){super(),this.geometry=P,this.material=v}clone(P){return P===void 0&&(P=new S(this.geometry,this.material)),super.clone.call(this,P),P}}},"./src/WebGL/objects/Sprite.ts":($,T,f)=>{f.r(T),f.d(T,{Sprite:()=>O});var w=f("./src/WebGL/materials/index.ts"),S=f("./src/WebGL/core/index.ts");class O extends S.Object3D{constructor(v=new w.SpriteMaterial){super(),this.material=v,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(v=new O(this.material)){return S.Object3D.prototype.clone.call(this,v),v}}},"./src/WebGL/objects/index.ts":($,T,f)=>{f.r(T),f.d(T,{Line:()=>w.Line,LineStyle:()=>w.LineStyle,Mesh:()=>S.Mesh,Sprite:()=>O.Sprite});var w=f("./src/WebGL/objects/Line.ts"),S=f("./src/WebGL/objects/Mesh.ts"),O=f("./src/WebGL/objects/Sprite.ts")},"./src/WebGL/shaders/ShaderType.ts":($,T,f)=>{f.r(T)},"./src/WebGL/shaders/index.ts":($,T,f)=>{f.r(T),f.d(T,{ShaderLib:()=>w.ShaderLib,ShaderUtils:()=>S.ShaderUtils,basic:()=>w.basic,clone:()=>S.clone,instanced:()=>w.instanced,lambert:()=>w.lambert,lambertdouble:()=>w.lambertdouble,outline:()=>w.outline,screen:()=>w.screen,screenaa:()=>w.screenaa,sphereimposter:()=>w.sphereimposter,sphereimposteroutline:()=>w.sphereimposteroutline,sprite:()=>w.sprite,stickimposter:()=>w.stickimposter,stickimposteroutline:()=>w.stickimposteroutline,volumetric:()=>w.volumetric});var w=f("./src/WebGL/shaders/lib/index.ts"),S=f("./src/WebGL/shaders/utils/index.ts");f("./src/WebGL/shaders/ShaderType.ts")},"./src/WebGL/shaders/lib/basic/index.ts":($,T,f)=>{f.r(T),f.d(T,{basic:()=>P});var w=f("./src/WebGL/shaders/lib/basic/uniforms.ts"),S=f("./src/WebGL/shaders/lib/basic/basic.frag"),O=f("./src/WebGL/shaders/lib/basic/basic.vert");const P={vertexShader:O.default.replace("#define GLSLIFY 1",""),fragmentShader:S.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/basic/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},"./src/WebGL/shaders/lib/index.ts":($,T,f)=>{f.r(T),f.d(T,{ShaderLib:()=>r,basic:()=>w.basic,instanced:()=>S.instanced,lambert:()=>O.lambert,lambertdouble:()=>P.lambertdouble,outline:()=>v.outline,screen:()=>_.screen,screenaa:()=>L.screenaa,sphereimposter:()=>g.sphereimposter,sphereimposteroutline:()=>M.sphereimposteroutline,sprite:()=>x.sprite,stickimposter:()=>p.stickimposter,stickimposteroutline:()=>y.stickimposteroutline,volumetric:()=>e.volumetric});var w=f("./src/WebGL/shaders/lib/basic/index.ts"),S=f("./src/WebGL/shaders/lib/instanced/index.ts"),O=f("./src/WebGL/shaders/lib/lambert/index.ts"),P=f("./src/WebGL/shaders/lib/lambertdouble/index.ts"),v=f("./src/WebGL/shaders/lib/outline/index.ts"),_=f("./src/WebGL/shaders/lib/screen/index.ts"),L=f("./src/WebGL/shaders/lib/screenaa/index.ts"),g=f("./src/WebGL/shaders/lib/sphereimposter/index.ts"),M=f("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),x=f("./src/WebGL/shaders/lib/sprite/index.ts"),p=f("./src/WebGL/shaders/lib/stickimposter/index.ts"),y=f("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),e=f("./src/WebGL/shaders/lib/volumetric/index.ts");const r={basic:w.basic,instanced:S.instanced,lambert:O.lambert,lambertdouble:P.lambertdouble,outline:v.outline,screen:_.screen,screenaa:L.screenaa,sphereimposter:g.sphereimposter,sphereimposteroutline:M.sphereimposteroutline,sprite:x.sprite,stickimposter:p.stickimposter,stickimposteroutline:y.stickimposteroutline,volumetric:e.volumetric}},"./src/WebGL/shaders/lib/instanced/index.ts":($,T,f)=>{f.r(T),f.d(T,{instanced:()=>P});var w=f("./src/WebGL/shaders/lib/instanced/uniforms.ts"),S=f("./src/WebGL/shaders/lib/instanced/instanced.frag"),O=f("./src/WebGL/shaders/lib/instanced/instanced.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/instanced/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambert/index.ts":($,T,f)=>{f.r(T),f.d(T,{lambert:()=>P});var w=f("./src/WebGL/shaders/lib/lambert/uniforms.ts"),S=f("./src/WebGL/shaders/lib/lambert/lambert.frag"),O=f("./src/WebGL/shaders/lib/lambert/lambert.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/lambert/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambertdouble/index.ts":($,T,f)=>{f.r(T),f.d(T,{lambertdouble:()=>P});var w=f("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),S=f("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),O=f("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/outline/index.ts":($,T,f)=>{f.r(T),f.d(T,{outline:()=>P});var w=f("./src/WebGL/shaders/lib/outline/uniforms.ts"),S=f("./src/WebGL/shaders/lib/outline/outline.frag"),O=f("./src/WebGL/shaders/lib/outline/outline.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/outline/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new w.Color(0,0,0)},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/screen/index.ts":($,T,f)=>{f.r(T),f.d(T,{screen:()=>P});var w=f("./src/WebGL/shaders/lib/screen/uniforms.ts"),S=f("./src/WebGL/shaders/lib/screen/screen.frag"),O=f("./src/WebGL/shaders/lib/screen/screen.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/screen/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>w});const w={}},"./src/WebGL/shaders/lib/screenaa/index.ts":($,T,f)=>{f.r(T),f.d(T,{screenaa:()=>P});var w=f("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),S=f("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),O=f("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/screenaa/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>w});const w={}},"./src/WebGL/shaders/lib/sphereimposter/index.ts":($,T,f)=>{f.r(T),f.d(T,{sphereimposter:()=>P});var w=f("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),S=f("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"),O=f("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert");const P={vertexShader:O.default.replace("#define GLSLIFY 1",""),fragmentShader:S.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts":($,T,f)=>{f.r(T),f.d(T,{sphereimposteroutline:()=>P});var w=f("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),S=f("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),O=f("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new w.Color(0,0,0)},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/sprite/index.ts":($,T,f)=>{f.r(T),f.d(T,{sprite:()=>P});var w=f("./src/WebGL/shaders/lib/sprite/uniforms.ts"),S=f("./src/WebGL/shaders/lib/sprite/sprite.frag"),O=f("./src/WebGL/shaders/lib/sprite/sprite.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/sprite/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>w});const w={}},"./src/WebGL/shaders/lib/stickimposter/index.ts":($,T,f)=>{f.r(T),f.d(T,{stickimposter:()=>_});var w=f("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),S=f("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag"),O=f("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),P=f("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const _={fragmentShader:[S.default,O.default].join(`
`).replace("#define GLSLIFY 1",""),vertexShader:P.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/stickimposter/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/stickimposteroutline/index.ts":($,T,f)=>{f.r(T),f.d(T,{stickimposteroutline:()=>v});var w=f("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),S=f("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag"),O=f("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const v={fragmentShader:(S.default+"gl_FragColor = vec4(color,1.0);}").replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new w.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/volumetric/index.ts":($,T,f)=>{f.r(T),f.d(T,{volumetric:()=>P});var w=f("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),S=f("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),O=f("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const P={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:O.default.replace("#define GLSLIFY 1",""),uniforms:w.uniforms}},"./src/WebGL/shaders/lib/volumetric/uniforms.ts":($,T,f)=>{f.r(T),f.d(T,{uniforms:()=>S});var w=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new w.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}},"./src/WebGL/shaders/utils/clone.ts":($,T,f)=>{f.r(T),f.d(T,{clone:()=>S});var w=f("./src/colors.ts");function S(O){let P={};for(const _ in O){P[_]={},P[_].type=O[_].type;var v=O[_].value;v instanceof w.Color?P[_].value=v.clone():typeof v=="number"?P[_].value=v:v instanceof Array?P[_].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return P}},"./src/WebGL/shaders/utils/index.ts":($,T,f)=>{f.r(T),f.d(T,{ShaderUtils:()=>O,clone:()=>w.clone});var w=f("./src/WebGL/shaders/utils/clone.ts"),S=f("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag");const O={clone:w.clone,stickimposterFragmentShader:S.default}},"./src/WebGL/shapes/Cylinder.ts":($,T,f)=>{f.r(T),f.d(T,{Cylinder:()=>O});var w=f("./src/WebGL/math/index.ts");let S=new w.Vector3;class O{constructor(v=new w.Vector3,_=new w.Vector3,L=0){this.c1=v,this.c2=_,this.radius=L,this.direction=new w.Vector3().subVectors(this.c2,this.c1).normalize()}copy(v){return this.c1.copy(v.c1),this.c2.copy(v.c2),this.direction.copy(v.direction),this.radius=v.radius,this}lengthSq(){return S.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(v){return this.direction.add(this.c1).applyMatrix4(v),this.c1.applyMatrix4(v),this.c2.applyMatrix4(v),this.direction.sub(this.c1).normalize(),this.radius=this.radius*v.getMaxScaleOnAxis(),this}}},"./src/WebGL/shapes/Sphere.ts":($,T,f)=>{f.r(T),f.d(T,{Sphere:()=>S});var w=f("./src/WebGL/math/index.ts");class S{constructor(P={x:0,y:0,z:0},v=0){this.center=new w.Vector3(P.x,P.y,P.z),this.radius=v}set(P,v){return this.center.copy(P),this.radius=v,this}copy(P){return this.center.copy(P.center),this.radius=P.radius,this}applyMatrix4(P){return this.center.applyMatrix4(P),this.radius=this.radius*P.getMaxScaleOnAxis(),this}translate(P){return this.center.add(P),this}equals(P){return P.center.equals(this.center)&&P.radius===this.radius}clone(){return new S().copy(this)}}},"./src/WebGL/shapes/Triangle.ts":($,T,f)=>{f.r(T),f.d(T,{Triangle:()=>O});var w=f("./src/WebGL/math/index.ts");const S=new w.Vector3;class O{constructor(v=new w.Vector3,_=new w.Vector3,L=new w.Vector3){this.a=v,this.b=_,this.c=L}copy(v){return this.a.copy(v.a),this.b.copy(v.b),this.c.copy(v.c),this}applyMatrix4(v){return this.a.applyMatrix4(v),this.b.applyMatrix4(v),this.c.applyMatrix4(v),this}getNormal(){var v=this.a.clone();return v.sub(this.b),S.subVectors(this.c,this.b),v.cross(S),v.normalize(),v}}},"./src/WebGL/shapes/index.ts":($,T,f)=>{f.r(T),f.d(T,{Cylinder:()=>S.Cylinder,Sphere:()=>w.Sphere,Triangle:()=>O.Triangle});var w=f("./src/WebGL/shapes/Sphere.ts"),S=f("./src/WebGL/shapes/Cylinder.ts"),O=f("./src/WebGL/shapes/Triangle.ts")},"./src/autoload.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{autoinit:()=>autoinit,autoload:()=>autoload,processing_autoinit:()=>processing_autoinit,viewers:()=>viewers});var _GLViewer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/GLViewer.ts"),_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/ProteinSurface4.ts"),_utilities__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utilities.ts"),_colors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/colors.ts"),autoinit=!1,processing_autoinit=!1,viewers={};function autoload(viewer,callback){var i,dataname,type;if(document.querySelector(".viewer_3Dmoljs")!=null&&(autoinit=!0),autoinit){processing_autoinit=!0,viewer=viewer??null;var nviewers=0;document.querySelectorAll(".viewer_3Dmoljs").forEach(viewerdiv=>{var datauri=[],datatypes=[],uri="";viewerdiv.style.position=="static"&&(viewerdiv.style.position="relative");var UI=null;if(type=null,viewerdiv.dataset.pdb)datauri.push("https://files.rcsb.org/view/"+viewerdiv.dataset.pdb+".pdb"),datatypes.push("pdb");else if(viewerdiv.dataset.cid)datatypes.push("sdf"),datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+viewerdiv.dataset.cid+"/SDF?record_type=3d");else if(viewerdiv.dataset.href||viewerdiv.dataset.url){viewerdiv.dataset.href?uri=viewerdiv.dataset.href:uri=viewerdiv.dataset.url,datauri.push(uri),type=uri.substring(uri.lastIndexOf(".")+1),datatypes.push(type);var molName=uri.substring(uri.lastIndexOf("/")+1,uri.lastIndexOf("."));molName=="/"&&(molName=uri.substring(uri.lastIndexOf("/")+1)),viewerdiv.dataset[datatypes[datatypes.length-1]]=molName}var divdata=viewerdiv.dataset;for(i in divdata)i.substring(0,3)==="pdb"&&i!=="pdb"?(datauri.push("https://files.rcsb.org/view/"+divdata[i]+".pdb"),datatypes.push("pdb")):i.substring(0,4)==="href"&&i!=="href"?(uri=divdata[i],datauri.push(uri),datatypes.push(uri.substr(uri.lastIndexOf(".")+1))):i.substring(0,3)==="cid"&&i!=="cid"&&(datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+divdata[i]+"/SDF?record_type=3d"),datatypes.push("sdf"));var options={};viewerdiv.dataset.options&&(options=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.options));var bgcolor=_colors__WEBPACK_IMPORTED_MODULE_3__.CC.color(viewerdiv.dataset.backgroundcolor),bgalpha=viewerdiv.dataset.backgroundalpha;bgalpha=bgalpha==null?1:parseFloat(bgalpha);var style={line:{}};viewerdiv.dataset.style&&(style=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.style));var select={};viewerdiv.dataset.select&&(select=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.select));var selectstylelist=[],surfaces=[],labels=[],zoomto={},spin=null,d=viewerdiv.dataset,stylere=/style(.+)/,surfre=/surface(.*)/,reslabre=/labelres(.*)/,keys=[];for(dataname in d)Object.prototype.hasOwnProperty.call(d,dataname)&&keys.push(dataname);for(keys.sort(),i=0;i<keys.length;i++){dataname=keys[i];var m=stylere.exec(dataname),selname,newsel,styleobj;m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),selectstylelist.push([newsel,styleobj])),m=surfre.exec(dataname),m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),surfaces.push([newsel,styleobj])),m=reslabre.exec(dataname),m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),labels.push([newsel,styleobj])),dataname=="zoomto"&&(zoomto=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname])),dataname=="spin"&&(spin=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]))}var applyStyles=function($){for($.setStyle(select,style),UI&&UI.createSelectionAndStyle(select,style),i=0;i<selectstylelist.length;i++){let T=selectstylelist[i][0]||{},f=selectstylelist[i][1]||{line:{}};$.setStyle(T,f),UI&&UI.createSelectionAndStyle(select,style)}for(i=0;i<surfaces.length;i++){let T=surfaces[i][0]||{},f=surfaces[i][1]||{};UI?$.addSurface(_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__.SurfaceType.VDW,f,T,T).then(S=>{UI.loadSurface("VDW",T,f,S)}):$.addSurface(_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__.SurfaceType.VDW,f,T,T)}for(i=0;i<labels.length;i++){let T=labels[i][0]||{},f=labels[i][1]||{};$.addResLabels(T,f)}$.render(),$.zoomTo(zoomto),spin&&$.spin(spin.axis,spin.speed)},glviewer=viewer;try{var config=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.config)||{};config.backgroundColor===void 0&&(config.backgroundColor=bgcolor),config.backgroundAlpha===void 0&&(config.backgroundAlpha=bgalpha),glviewer==null?glviewer=viewers[viewerdiv.id||nviewers++]=(0,_GLViewer__WEBPACK_IMPORTED_MODULE_0__.createViewer)(viewerdiv,config):(glviewer.setBackgroundColor(bgcolor,bgalpha),glviewer.setConfig(config),UI&&UI.initiateUI()),viewerdiv.dataset.ui&&$3Dmol.StateManager&&(UI=new $3Dmol.StateManager(glviewer))}catch($){console.log($),viewerdiv.textContent="WebGL appears to be disabled."}if(datauri.length!=0){i=0;var process=function(moldata){uri=datauri[i];var type=viewerdiv.dataset.type||viewerdiv.dataset.datatype||datatypes[i];if(glviewer.addModel(moldata,type,options),UI){var modelName=viewerdiv.dataset[datatypes[i]];UI.setModelTitle(modelName)}if(i+=1,i<datauri.length)(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.get)(datauri[i]).then(process);else{if(applyStyles(glviewer),viewerdiv.dataset.callback){var runres=eval(viewerdiv.dataset.callback);typeof runres=="function"&&runres(glviewer)}processing_autoinit=!1,callback&&callback(glviewer)}};(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.get)(datauri[0]).then(process)}else{if(viewerdiv.dataset.element){var moldataid="#"+viewerdiv.dataset.element,molelem=document.querySelector(moldataid),moldata=molelem?molelem.textContent:"";type=viewerdiv.dataset.type||viewerdiv.dataset.datatype,glviewer.addModel(moldata,type,options)}if(applyStyles(glviewer),viewerdiv.dataset.callback){var runres=eval(viewerdiv.dataset.callback);typeof runres=="function"&&runres(glviewer)}processing_autoinit=!1,callback&&callback(glviewer)}})}}document.onreadystatechange=()=>{document.readyState==="complete"&&autoload()}},"./src/colors.ts":($,T,f)=>{f.r(T),f.d(T,{CC:()=>S,Color:()=>w,builtinColorSchemes:()=>M,chains:()=>g,elementColors:()=>_,htmlColors:()=>O,residues:()=>L,ssColors:()=>P});class w{constructor(p,y,e){return this.r=0,this.g=0,this.b=0,arguments.length>1&&typeof p=="number"?(this.r=p||0,this.g=y||0,this.b=e||0,this):this.set(p||0)}set(p){return p instanceof w?p.clone():(typeof p=="number"?this.setHex(p):typeof p=="object"&&(this.r=(p==null?void 0:p.r)||0,this.g=(p==null?void 0:p.g)||0,this.b=(p==null?void 0:p.b)||0),this)}setHex(p){return p=Math.floor(p),this.r=(p>>16&255)/255,this.g=(p>>8&255)/255,this.b=(p&255)/255,this}getHex(){var p=Math.round(this.r*255),y=Math.round(this.g*255),e=Math.round(this.b*255);return p<<16|y<<8|e}clone(){return new w(this.r,this.g,this.b)}copy(p){return this.r=p.r,this.g=p.g,this.b=p.b,this}scaled(){var p={};return p.r=Math.round(this.r*255),p.g=Math.round(this.g*255),p.b=Math.round(this.b*255),p.a=1,p}}class S{static color(p){if(!p)return S.cache[0];if(p instanceof w)return p;if(typeof p=="number"&&typeof S.cache[p]<"u")return S.cache[p];if(p&&Array.isArray(p))return p.map(S.color);let y=S.getHex(p),e=new w(y);return S.cache[y]=e,e}static getHex(p){var y;if(Array.isArray(p))return p.map(S.getHex);if(typeof p=="string"){let e=p;if(!isNaN(parseInt(e)))return parseInt(e);if(e=e.trim(),e.length==4&&e[0]=="#"&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),e.length==7&&e[0]=="#")return parseInt(e.substring(1),16);let r=S.rgbRegEx.exec(e);if(r){r[1]!=""&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let s=0;for(let h=2;h<5;h++){s*=256;let a=r[h].endsWith("%")?255*parseFloat(r[h])/100:parseFloat(r[h]);s+=Math.round(a)}return s}return((y=window==null?void 0:window.$3Dmol)===null||y===void 0?void 0:y.htmlColors[p.toLowerCase()])||0}return p}}S.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,S.cache={0:new w(0)};const O={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},P={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}},v={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},_={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:v,defaultColors:Object.assign({},v),greenCarbon:Object.assign(Object.assign({},v),{C:65280}),cyanCarbon:Object.assign(Object.assign({},v),{C:65535}),magentaCarbon:Object.assign(Object.assign({},v),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},v),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},v),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},v),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},v),{C:8388736}),blueCarbon:Object.assign(Object.assign({},v),{C:255})},L={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},g={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},M={ssPyMol:{prop:"ss",map:P.pyMol},ssJmol:{prop:"ss",map:P.Jmol},Jmol:{prop:"elem",map:_.Jmol},amino:{prop:"resn",map:L.amino},shapely:{prop:"resn",map:L.shapely},nucleic:{prop:"resn",map:L.nucleic},chain:{prop:"chain",map:g.atom},rasmol:{prop:"elem",map:_.rasmol},default:{prop:"elem",map:_.defaultColors},greenCarbon:{prop:"elem",map:_.greenCarbon},chainHetatm:{prop:"chain",map:g.hetatm},cyanCarbon:{prop:"elem",map:_.cyanCarbon},magentaCarbon:{prop:"elem",map:_.magentaCarbon},purpleCarbon:{prop:"elem",map:_.purpleCarbon},whiteCarbon:{prop:"elem",map:_.whiteCarbon},orangeCarbon:{prop:"elem",map:_.orangeCarbon},yellowCarbon:{prop:"elem",map:_.yellowCarbon},blueCarbon:{prop:"elem",map:_.blueCarbon}}},"./src/glcartoon.ts":($,T,f)=>{f.r(T),f.d(T,{drawCartoon:()=>R,subdivide_spline:()=>g});var w=f("./src/WebGL/math/index.ts"),S=f("./src/WebGL/shapes/index.ts"),O=f("./src/WebGL/index.ts"),P=f("./src/Gradient.ts"),v=f("./src/colors.ts"),_=f("./src/GLDraw.ts"),L=f("./src/utilities.ts");function g(C,z){var V=[],G=C;G=[],G.push(C[0]);var B,F,N,j,U,k,te,he,re;for(B=1,F=C.length-1;B<F;B++)if(U=C[B],k=C[B+1],U.smoothen){var ae=new w.Vector3((U.x+k.x)/2,(U.y+k.y)/2,(U.z+k.z)/2);ae.atom=U.atom,G.push(ae)}else G.push(U);for(G.push(C[C.length-1]),B=-1,N=G.length;B<=N-3;B++)if(j=G[B===-1?0:B],U=G[B+1],k=G[B+2],te=G[B===N-3?N-1:B+3],he=new w.Vector3().subVectors(k,j).multiplyScalar(.5),re=new w.Vector3().subVectors(te,U).multiplyScalar(.5),!k.skip)for(var pe=0;pe<z;pe++){var oe=1/z*pe,se=U.x+oe*he.x+oe*oe*(-3*U.x+3*k.x-2*he.x-re.x)+oe*oe*oe*(2*U.x-2*k.x+he.x+re.x),Ce=U.y+oe*he.y+oe*oe*(-3*U.y+3*k.y-2*he.y-re.y)+oe*oe*oe*(2*U.y-2*k.y+he.y+re.y),_e=U.z+oe*he.z+oe*oe*(-3*U.z+3*k.z-2*he.z-re.z)+oe*oe*oe*(2*U.z-2*k.z+he.z+re.z),Se=new w.Vector3(se,Ce,_e);pe<z/2?Se.atom=U.atom:Se.atom=k.atom,V.push(Se)}return V.push(G[G.length-1]),V}const M=.5,x=1.3,p=.8,y=.4,e=.4;function r(C,z,V,G){for(var B,F,N,j,U=0,k=z.length;U<k;U++){j=Math.round(U*(G.length-1)/k),N=v.CC.color(G[j]);var te=C.updateGeoGroup(2),he=te.vertexArray,re=te.colorArray,ae=te.faceArray;B=te.vertices,F=B*3,he[F]=z[U].x,he[F+1]=z[U].y,he[F+2]=z[U].z,he[F+3]=V[U].x,he[F+4]=V[U].y,he[F+5]=V[U].z;for(var pe=0;pe<6;++pe)re[F+3*pe]=N.r,re[F+1+3*pe]=N.g,re[F+2+3*pe]=N.b;if(U>0){var oe=[B,B+1,B-1,B-2],se=te.faceidx;ae[se]=oe[0],ae[se+1]=oe[1],ae[se+2]=oe[3],ae[se+3]=oe[1],ae[se+4]=oe[2],ae[se+5]=oe[3],te.faceidx+=6}te.vertices+=2}}function s(C,z,V,G,B,F,N){var j,U,k,te;if(k=z.length,k<2||z[0].length<2)return;for(j=0;j<k;j++)z[j]=g(z[j],G);if(te=z[0].length,!B)return r(C,z[0],z[k-1],V);var he,re,ae,pe,oe,se,Ce=[],_e=[],Se=[];for(U=0;U<k;U++)Ce.push(.25+1.5*Math.sqrt((k-1)*U-Math.pow(U,2))/(k-1)),_e.push(.5),Se.push(2*(Math.pow(U/k,2)-U/k)+.6);var fe=[];for(U=0;U<k*2-1;U++)fe[U]=[U,U+1,U+1-2*k,U-2*k];fe[k*2-1]=[U,U+1-2*k,U+1-4*k,U-2*k];var xe,Ee,We,Ge,Ne,Be,Te,Re,Pe,Ue;let ze=C.updateGeoGroup();for(j=0;j<te;j++){let Z=C.groups,J=!1;ze=C.updateGeoGroup(2*k),Z!=C.groups&&j>0&&(j=j-1,J=!0),Be=Math.round(j*(V.length-1)/te),Ne=v.CC.color(V[Be]),oe=ae,se=pe,ae=[],pe=[],he=[],z[0][j].atom!==void 0&&(Ge=z[0][j].atom,N==="oval"?re=Ce:N==="rectangle"?re=_e:N==="parabola"&&(re=Se)),re||(re=_e);var Ze,He;for(U=0;U<k;U++)j<te-1?Ze=z[U][j+1].clone().sub(z[U][j]):Ze=z[U][j-1].clone().sub(z[U][j]).negate(),U<k-1?He=z[U+1][j].clone().sub(z[U][j]):He=z[U-1][j].clone().sub(z[U][j]).negate(),he[U]=He.cross(Ze).normalize().multiplyScalar(B*re[U]);for(U=0;U<k;U++)ae[U]=z[U][j].clone().add(he[U].clone().negate());for(U=0;U<k;U++)pe[U]=z[U][j].clone().add(he[U]);for(Te=ze.vertexArray,Re=ze.colorArray,Pe=ze.faceArray,xe=ze.vertices,Ee=xe*3,U=0;U<k;U++)Te[Ee+3*U+0]=ae[U].x,Te[Ee+3*U+1]=ae[U].y,Te[Ee+3*U+2]=ae[U].z;for(U=0;U<k;U++)Te[Ee+3*U+0+3*k]=pe[k-1-U].x,Te[Ee+3*U+1+3*k]=pe[k-1-U].y,Te[Ee+3*U+2+3*k]=pe[k-1-U].z;for(U=0;U<2*k;++U)Re[Ee+3*U+0]=Ne.r,Re[Ee+3*U+1]=Ne.g,Re[Ee+3*U+2]=Ne.b;if(j>0&&!J){for(U=0;U<k*2;U++)Ue=[xe+fe[U][0],xe+fe[U][1],xe+fe[U][2],xe+fe[U][3]],We=ze.faceidx,Pe[We]=Ue[0],Pe[We+1]=Ue[1],Pe[We+2]=Ue[3],Pe[We+3]=Ue[1],Pe[We+4]=Ue[2],Pe[We+5]=Ue[3],ze.faceidx+=6;if(Ge.clickable||Ge.hoverable){var X=[];X.push(new S.Triangle(oe[0],ae[0],ae[k-1])),X.push(new S.Triangle(oe[0],ae[k-1],oe[k-1])),X.push(new S.Triangle(oe[k-1],ae[k-1],pe[k-1])),X.push(new S.Triangle(oe[k-1],pe[k-1],se[k-1])),X.push(new S.Triangle(pe[0],se[0],se[k-1])),X.push(new S.Triangle(pe[k-1],pe[0],se[k-1])),X.push(new S.Triangle(ae[0],oe[0],se[0])),X.push(new S.Triangle(pe[0],ae[0],se[0]));for(U in X)Ge.intersectionShape.triangle.push(X[U])}}ze.vertices+=2*k}for(Te=ze.vertexArray,Re=ze.colorArray,Pe=ze.faceArray,xe=ze.vertices,Ee=xe*3,We=ze.faceidx,j=0;j<k-1;j++)Ue=[j,j+1,2*k-2-j,2*k-1-j],We=ze.faceidx,Pe[We]=Ue[0],Pe[We+1]=Ue[1],Pe[We+2]=Ue[3],Pe[We+3]=Ue[1],Pe[We+4]=Ue[2],Pe[We+5]=Ue[3],ze.faceidx+=6;for(j=0;j<k-1;j++)Ue=[xe-1-j,xe-2-j,xe-2*k+j+1,xe-2*k+j],We=ze.faceidx,Pe[We]=Ue[0],Pe[We+1]=Ue[1],Pe[We+2]=Ue[3],Pe[We+3]=Ue[1],Pe[We+4]=Ue[2],Pe[We+5]=Ue[3],ze.faceidx+=6}function h(C,z,V,G,B,F){if(!(z.length<2)){var N,j;if(N=z[0],j=z[z.length-1],N=g(N,G),j=g(j,G),!B)return r(C,N,j,V);var U=[],k,te,he,re,ae,pe=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],oe,se,Ce,_e,Se,fe,xe,Ee,We,Ge,Ne,Be,Te,Re,Pe,Ue,ze;for(Ee=0,We=N.length;Ee<We;Ee++){if(Se=Math.round(Ee*(V.length-1)/We),_e=v.CC.color(V[Se]),U.push(te=N[Ee]),U.push(te),U.push(he=j[Ee]),U.push(he),Ee<We-1){var Ze=N[Ee+1].clone().sub(N[Ee]),He=j[Ee].clone().sub(N[Ee]);k=He.cross(Ze).normalize().multiplyScalar(B)}for(U.push(re=N[Ee].clone().add(k)),U.push(re),U.push(ae=j[Ee].clone().add(k)),U.push(ae),te.atom!==void 0&&(fe=te.atom),Re=C.updateGeoGroup(8),Pe=Re.vertexArray,Ue=Re.colorArray,ze=Re.faceArray,oe=Re.vertices,se=oe*3,Pe[se]=te.x,Pe[se+1]=te.y,Pe[se+2]=te.z,Pe[se+3]=te.x,Pe[se+4]=te.y,Pe[se+5]=te.z,Pe[se+6]=he.x,Pe[se+7]=he.y,Pe[se+8]=he.z,Pe[se+9]=he.x,Pe[se+10]=he.y,Pe[se+11]=he.z,Pe[se+12]=re.x,Pe[se+13]=re.y,Pe[se+14]=re.z,Pe[se+15]=re.x,Pe[se+16]=re.y,Pe[se+17]=re.z,Pe[se+18]=ae.x,Pe[se+19]=ae.y,Pe[se+20]=ae.z,Pe[se+21]=ae.x,Pe[se+22]=ae.y,Pe[se+23]=ae.z,Ge=0;Ge<8;++Ge)Ue[se+3*Ge]=_e.r,Ue[se+1+3*Ge]=_e.g,Ue[se+2+3*Ge]=_e.b;if(Ee>0){var X=xe!==void 0&&fe!==void 0&&xe.serial!==fe.serial;for(Ge=0;Ge<4;Ge++){var Z=[oe+pe[Ge][0],oe+pe[Ge][1],oe+pe[Ge][2],oe+pe[Ge][3]];if(Ce=Re.faceidx,ze[Ce]=Z[0],ze[Ce+1]=Z[1],ze[Ce+2]=Z[3],ze[Ce+3]=Z[1],ze[Ce+4]=Z[2],ze[Ce+5]=Z[3],Re.faceidx+=6,fe.clickable||xe.clickable||fe.hoverable||xe.hoverable){var J=U[Z[3]].clone(),ce=U[Z[0]].clone(),ue=U[Z[2]].clone(),Le=U[Z[1]].clone();if(J.atom=U[Z[3]].atom||null,ue.atom=U[Z[2]].atom||null,ce.atom=U[Z[0]].atom||null,Le.atom=U[Z[1]].atom||null,X){var De=J.clone().add(ce).multiplyScalar(.5),K=ue.clone().add(Le).multiplyScalar(.5),de=J.clone().add(Le).multiplyScalar(.5);Ge%2===0?((xe.clickable||xe.hoverable)&&(Ne=new S.Triangle(De,de,J),Be=new S.Triangle(K,ue,de),Te=new S.Triangle(de,ue,J),xe.intersectionShape.triangle.push(Ne),xe.intersectionShape.triangle.push(Be),xe.intersectionShape.triangle.push(Te)),(fe.clickable||fe.hoverable)&&(Ne=new S.Triangle(ce,Le,de),Be=new S.Triangle(Le,K,de),Te=new S.Triangle(ce,de,De),fe.intersectionShape.triangle.push(Ne),fe.intersectionShape.triangle.push(Be),fe.intersectionShape.triangle.push(Te))):((fe.clickable||fe.hoverable)&&(Ne=new S.Triangle(De,de,J),Be=new S.Triangle(K,ue,de),Te=new S.Triangle(de,ue,J),fe.intersectionShape.triangle.push(Ne),fe.intersectionShape.triangle.push(Be),fe.intersectionShape.triangle.push(Te)),(xe.clickable||xe.hoverable)&&(Ne=new S.Triangle(ce,Le,de),Be=new S.Triangle(Le,K,de),Te=new S.Triangle(ce,de,De),xe.intersectionShape.triangle.push(Ne),xe.intersectionShape.triangle.push(Be),xe.intersectionShape.triangle.push(Te)))}else(fe.clickable||fe.hoverable)&&(Ne=new S.Triangle(ce,Le,J),Be=new S.Triangle(Le,ue,J),fe.intersectionShape.triangle.push(Ne),fe.intersectionShape.triangle.push(Be))}}}Re.vertices+=8,xe=fe}var me=U.length-8;for(Re=C.updateGeoGroup(8),Pe=Re.vertexArray,Ue=Re.colorArray,ze=Re.faceArray,oe=Re.vertices,se=oe*3,Ce=Re.faceidx,Ee=0;Ee<4;Ee++){U.push(U[Ee*2]),U.push(U[me+Ee*2]);var Ie=U[Ee*2],ne=U[me+Ee*2];Pe[se+6*Ee]=Ie.x,Pe[se+1+6*Ee]=Ie.y,Pe[se+2+6*Ee]=Ie.z,Pe[se+3+6*Ee]=ne.x,Pe[se+4+6*Ee]=ne.y,Pe[se+5+6*Ee]=ne.z,Ue[se+6*Ee]=_e.r,Ue[se+1+6*Ee]=_e.g,Ue[se+2+6*Ee]=_e.b,Ue[se+3+6*Ee]=_e.r,Ue[se+4+6*Ee]=_e.g,Ue[se+5+6*Ee]=_e.b}me+=8,Ne=[oe,oe+2,oe+6,oe+4],Be=[oe+1,oe+5,oe+7,oe+3],ze[Ce]=Ne[0],ze[Ce+1]=Ne[1],ze[Ce+2]=Ne[3],ze[Ce+3]=Ne[1],ze[Ce+4]=Ne[2],ze[Ce+5]=Ne[3],ze[Ce+6]=Be[0],ze[Ce+7]=Be[1],ze[Ce+8]=Be[3],ze[Ce+9]=Be[1],ze[Ce+10]=Be[2],ze[Ce+11]=Be[3],Re.faceidx+=12,Re.vertices+=8}}function a(C,z,V,G,B,F,N){(!N||N==="default")&&(N="rectangle"),N==="edged"?h(C,z,V,G,B):(N==="rectangle"||N==="oval"||N==="parabola")&&s(C,z,V,G,B,F,N)}function t(C){return C&&C.elem==="C"&&C.atom==="CA"}function n(C,z){if(C&&z&&C.chain===z.chain){if(!C.hetflag&&!z.hetflag&&C.reschain===z.reschain&&(C.resi===z.resi||C.resi===z.resi-1))return!0;if(C.resi<z.resi){var V=C.x-z.x,G=C.y-z.y,B=C.z-z.z,F=V*V+G*G+B*B;if(C.atom=="CA"&&z.atom=="CA"&&F<16)return!0;if((C.atom=="P"||z.atom=="P")&&F<64)return!0}}return!1}function o(C,z,V,G,B){if(!(z==null||z.vertices==0)){B&&(z.initTypedArrays(),z.setUpNormals());var F=new O.MeshDoubleLambertMaterial;F.vertexColors=O.Coloring.FaceColors,typeof V=="number"&&V>=0&&V<1&&(F.transparent=!0,F.opacity=V),F.outline=G;var N=new O.Mesh(z,F);C.add(N)}}function c(C,z,V,G,B,F,N,j,U){var k,te,he,re,ae,pe;if(!(!G||!B||!N)){var oe=B.sub(G);oe.normalize();var se=j[U];for(te=U+1;te<j.length&&(se=j[te],se.atom!=N.atom);te++);if(se=se?new w.Vector3(se.x,se.y,se.z):new w.Vector3(0,0,0),se.sub(G),N.ss==="arrow start"){var Ce=se.clone().multiplyScalar(.3).cross(B);G.add(Ce);var _e=se.clone().cross(oe).normalize();oe.rotateAboutVector(_e,.43)}for(N.style.cartoon.ribbon?k=N.style.cartoon.thickness||y:N.style.cartoon.width?k=N.style.cartoon.width:N.ss==="c"?N.atom==="P"?k=p:k=M:N.ss==="arrow start"?(k=x,ae=!0):N.ss==="arrow end"||N.ss==="h"&&N.style.cartoon.tubes||N.ss==="tube start"?k=M:k=x,F!=null&&oe.dot(F)<0&&oe.negate(),oe.multiplyScalar(k),te=0;te<z;te++)he=-1+te*2/(z-1),re=new w.Vector3(G.x+he*oe.x,G.y+he*oe.y,G.z+he*oe.z),re.atom=N,V&&N.ss==="s"&&(re.smoothen=!0),C[te].push(re);if(ae)for(oe.multiplyScalar(2),te=0;te<z;te++)he=-1+te*2/(z-1),re=new w.Vector3(G.x+he*oe.x,G.y+he*oe.y,G.z+he*oe.z),re.atom=N,re.smoothen=!1,re.skip=!0,C[te].push(re);return pe=N.style.cartoon.style||"default",C.style?C.style!=pe&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),C.style="default"):C.style=pe,(N.ss==="arrow start"||N.ss==="arrow end")&&(N.ss="s"),ae}}const u={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},E={DA:!0,DG:!0,A:!0,G:!0},A={DT:!0,DC:!0,U:!0,C:!0,T:!0},I={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0};function R(C,z,V,G=10){let B=G,F=G;var N,j,U,k,te,he,re,ae,pe,oe,se,Ce,_e,Se,fe,xe,Ee,We,Ge=new O.Geometry(!0),Ne=new O.Geometry(!0),Be=[],Te=[],Re=1,Pe=!1,Ue={};for(var ze in P.Gradient.builtinGradients)P.Gradient.builtinGradients.hasOwnProperty(ze)&&(Ue[ze]=new P.Gradient.builtinGradients[ze](V[1],V[0]));var Ze=function(H,Oe){return V&&Oe.color==="spectrum"?Oe.colorscheme in Ue?Ue[Oe.colorscheme].valueToHex(H.resi):Ue.sinebow.valueToHex(H.resi):(0,L.getColorFromStyle)(H,Oe).getHex()};for(ae=0;ae<B;ae++)Te[ae]=[];var He=!1,X=!1,Z=[];for(ae in z){if(k=z[ae],k.elem==="C"&&k.atom==="CA"){var J=n(U,k);J&&k.ss==="s"?He=!0:He&&(U&&j&&U.style.cartoon.arrows&&j.style.cartoon.arrows&&(U.ss="arrow end",j.ss="arrow start"),He=!1),J&&(U.ss==="h"||U.ss=="tube start")&&U.style.cartoon.tubes?!X&&U.ss!="tube start"&&k.style.cartoon.tubes&&(k.ss="tube start",X=!0):X&&(U.ss==="tube start"?U.ss="tube end":j&&j.style.cartoon.tubes&&(j.ss="tube end"),X=!1),j=U,U=k}k&&k.atom in u&&Z.push(k)}X&&U.style.cartoon.tubes&&(U.ss="tube end",X=!1);var ce=function(H){Te[0].length>0&&a(Ne,Te,Be,F,re,Re,Te.style);var Oe=[],ke=null;if(H){for(ae=0;ae<B;ae++)Oe[ae]=Te[ae][Te[ae].length-1];ke=Be[Be.length-1]}for(Te=[],ae=0;ae<B;ae++)Te[ae]=[];if(Be=[],H){for(ae=0;ae<B;ae++)Te[ae].push(Oe[ae]);Be.push(ke)}o(C,Ne,Re,Pe,!0),o(C,Ge,Re,Pe,!1),Ne=new O.Geometry(!0),Ge=new O.Geometry(!0)};U=void 0;for(var ue=0;ue<Z.length;ue++){k=Z[ue];var Le=k.resn.trim(),De=Le in I;if(Re=1,N=k.style.cartoon,U&&U.style.cartoon&&(Re=U.style.cartoon.opacity),U&&U.style.cartoon&&U.style.cartoon.outline&&(Pe=U.style.cartoon.outline),U&&U.style.cartoon&&(!k.style.cartoon||U.style.cartoon.opacity!=k.style.cartoon.opacity)&&ce(U.chain==k.chain),N.style==="trace"){if(!k.hetflag){if(k.elem==="C"&&k.atom==="CA"||De&&k.atom==="P"||k.atom==="BB"){if(he=Ze(k,N),(0,L.isNumeric)(N.thickness)?re=N.thickness:re=y,n(U,k))if(he==te){var K=v.CC.color(he);_.GLDraw.drawCylinder(Ge,U,k,re,K,2,2)}else{var de=new w.Vector3().addVectors(U,k).multiplyScalar(.5),me=v.CC.color(te),Ie=v.CC.color(he);_.GLDraw.drawCylinder(Ge,U,de,re,me,2,0),_.GLDraw.drawCylinder(Ge,de,k,re,Ie,0,2)}if((k.clickable===!0||k.hoverable)&&k.intersectionShape!==void 0){var ne=new w.Vector3(k.x,k.y,k.z);k.intersectionShape.sphere.push(new S.Sphere(ne,re))}U=k,te=he}}}else{if(t(k)||De&&(k.atom==="P"||k.atom.indexOf("O5")==0)){if(We)if(k.ss==="tube end")We=!1,Ee=new w.Vector3(k.x,k.y,k.z),_.GLDraw.drawCylinder(Ge,xe,Ee,2,v.CC.color(te),1,1),k.ss="h";else if(U.chain!=k.chain||U.ss==="tube end")We=!1,U.ss="h",Ee=new w.Vector3(U.x,U.y,U.z),_.GLDraw.drawCylinder(Ge,xe,Ee,2,v.CC.color(te),1,1);else continue;if(U&&(!n(U,k)||U.ss==="tube start")){for(U.ss==="tube start"&&(We=!0,xe=new w.Vector3(U.x,U.y,U.z),U.ss="h"),fe&&(Ce?Se=new w.Vector3().addVectors(U,Ce).multiplyScalar(.5):Se=new w.Vector3(U.x,U.y,U.z),_.GLDraw.drawCylinder(Ge,Se,fe,e,v.CC.color(fe.color),0,2),c(Te,B,!0,Ce,_e,se,U,Z,ue),Be.push(he),Se=null,fe=null),Te[0].length>0&&a(Ne,Te,Be,F,re,Re,Te.style),Te=[],ae=0;ae<B;ae++)Te[ae]=[];Be=[]}if(U===void 0||U.rescode!=k.rescode||U.resi!=k.resi){if(fe){Se=new w.Vector3().addVectors(U,k).multiplyScalar(.5);var we=Se.clone().sub(fe).multiplyScalar(.02);Se.add(we),_.GLDraw.drawCylinder(Ge,Se,fe,e,v.CC.color(fe.color),0,2),Se=null,fe=null}he=Ze(k,N),Be.push(he),(0,L.isNumeric)(N.thickness)?re=N.thickness:re=y,U=k,pe=new w.Vector3(U.x,U.y,U.z),pe.resi=U.resi,te=he}(k.clickable===!0||k.hoverable===!0)&&(k.intersectionShape===void 0||k.intersectionShape.triangle===void 0)&&(k.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else t(U)&&k.atom==="O"||De&&U.atom==="P"&&(k.atom==="OP2"||k.atom==="O2P")||De&&U.atom.indexOf("O5")==0&&k.atom.indexOf("C5")==0?(oe=new w.Vector3(k.x,k.y,k.z),oe.resi=k.resi,(k.atom==="OP2"||k.atom==="O2P")&&(_e=new w.Vector3(k.x,k.y,k.z))):De&&k.atom.indexOf("O3")==0?Ce=new w.Vector3(k.x,k.y,k.z):(k.atom==="N1"&&Le in E||k.atom==="N3"&&Le in A)&&(fe=new w.Vector3(k.x,k.y,k.z),fe.color=(0,L.getColorFromStyle)(k,N).getHex());oe&&pe&&oe.resi===pe.resi&&(c(Te,B,!0,pe,oe,se,U,Z,ue),se=oe,pe=null,oe=null,Be.push(he))}}fe&&(Ce?Se=new w.Vector3().addVectors(U,Ce).multiplyScalar(.5):Se=new w.Vector3(U.x,U.y,U.z),_.GLDraw.drawCylinder(Ge,Se,fe,e,v.CC.color(fe.color),0,2),c(Te,B,!0,Ce,_e,se,U,Z,ue),Be.push(he)),ce(!1)}},"./src/index.ts":($,T,f)=>{f.r(T),f.d(T,{CAP:()=>e.CAP,CC:()=>S.CC,Color:()=>S.Color,CustomLinear:()=>w.CustomLinear,Cylinder:()=>L.Cylinder,GLDraw:()=>e.GLDraw,GLModel:()=>s.GLModel,GLShape:()=>y.GLShape,GLViewer:()=>h.GLViewer,GLVolumetricRender:()=>p.GLVolumetricRender,Gradient:()=>w.Gradient,GradientType:()=>w.GradientType,Label:()=>O.Label,LabelCount:()=>O.LabelCount,MarchingCube:()=>M.MarchingCube,MarchingCubeInitializer:()=>M.MarchingCubeInitializer,Matrix3:()=>_.Matrix3,Matrix4:()=>_.Matrix4,Parsers:()=>v.Parsers,PausableTimer:()=>g.PausableTimer,PointGrid:()=>M.PointGrid,ProteinSurface:()=>M.ProteinSurface,Quaternion:()=>_.Quaternion,ROYGB:()=>w.ROYGB,RWB:()=>w.RWB,Ray:()=>_.Ray,Sinebow:()=>w.Sinebow,Sphere:()=>L.Sphere,SurfaceType:()=>M.SurfaceType,Triangle:()=>L.Triangle,Vector2:()=>_.Vector2,Vector3:()=>_.Vector3,VolumeData:()=>x.VolumeData,adjustVolumeStyle:()=>g.adjustVolumeStyle,applyPartialCharges:()=>P.applyPartialCharges,autoinit:()=>a.autoinit,autoload:()=>a.autoload,base64ToArray:()=>g.base64ToArray,bondLength:()=>v.bondLength,builtinColorSchemes:()=>S.builtinColorSchemes,builtinGradients:()=>w.builtinGradients,chains:()=>S.chains,clamp:()=>_.clamp,conversionMatrix3:()=>_.conversionMatrix3,createStereoViewer:()=>h.createStereoViewer,createViewer:()=>h.createViewer,createViewerGrid:()=>h.createViewerGrid,deepCopy:()=>g.deepCopy,degToRad:()=>_.degToRad,download:()=>g.download,drawCartoon:()=>r.drawCartoon,elementColors:()=>S.elementColors,extend:()=>g.extend,get:()=>g.get,getAtomProperty:()=>g.getAtomProperty,getColorFromStyle:()=>g.getColorFromStyle,getElement:()=>g.getElement,getExtent:()=>g.getExtent,getGradient:()=>w.getGradient,getPropertyRange:()=>g.getPropertyRange,getbin:()=>g.getbin,htmlColors:()=>S.htmlColors,isEmptyObject:()=>g.isEmptyObject,isNumeric:()=>g.isNumeric,makeFunction:()=>g.makeFunction,mergeGeos:()=>g.mergeGeos,normalizeValue:()=>w.normalizeValue,partialCharges:()=>P.partialCharges,processing_autoinit:()=>a.processing_autoinit,residues:()=>S.residues,setBondLength:()=>v.setBondLength,setSyncSurface:()=>M.setSyncSurface,specStringToObject:()=>g.specStringToObject,splitMesh:()=>y.splitMesh,ssColors:()=>S.ssColors,subdivide_spline:()=>r.subdivide_spline,syncSurface:()=>M.syncSurface,viewers:()=>a.viewers});var w=f("./src/Gradient.ts"),S=f("./src/colors.ts"),O=f("./src/Label.ts"),P=f("./src/partialCharges.ts"),v=f("./src/parsers/index.ts"),_=f("./src/WebGL/math/index.ts"),L=f("./src/WebGL/shapes/index.ts"),g=f("./src/utilities.ts"),M=f("./src/ProteinSurface4.ts"),x=f("./src/VolumeData.ts"),p=f("./src/VolumetricRender.ts"),y=f("./src/GLShape.ts"),e=f("./src/GLDraw.ts"),r=f("./src/glcartoon.ts"),s=f("./src/GLModel.ts"),h=f("./src/GLViewer.ts"),a=f("./src/autoload.ts");f("./src/specs.ts"),window&&(window.$3Dmol=T)},"./src/parsers/CDJSON.ts":($,T,f)=>{f.r(T),f.d(T,{CDJSON:()=>w});function w(S,O){var P=[[]];typeof S=="string"&&(S=JSON.parse(S));for(var v=S.m,_=v[0].a,L=v[0].b,g=v[0].s,M=O!==void 0&&O.parseStyle!==void 0?O.parseStyle:g!==void 0,x=P[P.length-1].length,p=0;p<_.length;p++){var y=_[p],e={};e.id=y.i,e.x=y.x,e.y=y.y,e.z=y.z||0,e.bonds=[],e.bondOrder=[];var r=y.l||"C";e.elem=r[0].toUpperCase()+r.substr(1).toLowerCase(),e.serial=P[P.length-1].length,M&&(e.style=g[y.s||0]),P[P.length-1].push(e)}for(let s=0;s<L.length;s++){let h=L[s],a=h.b+x,t=h.e+x,n=h.o||1,o=P[P.length-1][a],c=P[P.length-1][t];o.bonds.push(t),o.bondOrder.push(n),c.bonds.push(a),c.bondOrder.push(n)}return P}},"./src/parsers/CIF.ts":($,T,f)=>{f.r(T),f.d(T,{CIF:()=>v});var w=f("./src/parsers/utils/assignBonds.ts"),S=f("./src/parsers/utils/computeSecondaryStructure.ts"),O=f("./src/parsers/utils/processSymmetries.ts"),P=f("./src/WebGL/index.ts");function v(_,L={}){var g=[],M=!L.doAssembly,x=g.modelData=[],p=L.assignBonds===void 0?!0:L.assignBonds,y=function(Z,J,ce,ue){return new P.Vector3(J,ce,ue).applyMatrix3(Z)};function e(Z,J){for(var ce=[],ue=0,Le=0;Le<Z.length;){for(;Z.substr(Le,J.length)!==J&&Le<Z.length;){if(Z[Le]==="'")for(Le++;Le<Z.length&&Z[Le]!=="'";)Le++;else if(Z[Le]==='"')for(Le++;Le<Z.length&&Z[Le]!=='"';)Le++;Le++}ce.push(Z.substr(ue,Le-ue)),ue=Le=Le+J.length}return ce}var r=_.split(/\r?\n|\r/),s=[],h=!1;for(let Z=0;Z<r.length;Z++){var a=r[Z].split("#")[0];if(h?a[0]===";"&&(h=!1):a[0]===";"&&(h=!0),h||a!==""){if(!h&&(a=a.trim(),a[0]==="_")){var t=a.split(/\s/)[0].indexOf(".");if(t>-1){let J=a.split("");J[t]="_",a=J.join(""),a=a.substr(0,t)+"_"+a.substr(t+1)}}s.push(a)}}for(var n=0;n<s.length;){for(;!s[n].startsWith("data_")||s[n]==="data_global";)n++;n++;for(var o={};n<s.length&&!s[n].startsWith("data_");)if(s[n][0]===void 0)n++;else if(s[n][0]==="_"){var c=s[n].split(/\s/)[0].toLowerCase(),u=o[c]=o[c]||[],E=s[n].substr(s[n].indexOf(c)+c.length);if(E==="")if(n++,s[n][0]===";"){var A=s[n].substr(1);for(n++;s[n]!==";";)A=A+`
`+s[n],n++;u.push(A)}else u.push(s[n]);else u.push(E.trim());n++}else if(s[n].substr(0,5)==="loop_"){n++;for(var I=[];s[n]===""||s[n][0]==="_";){if(s[n]!==""){let Z=s[n].split(/\s/)[0].toLowerCase(),J=o[Z]=o[Z]||[];I.push(J)}n++}for(var R=0;n<s.length&&s[n][0]!=="_"&&!s[n].startsWith("loop_")&&!s[n].startsWith("data_");){let Z=e(s[n]," ");for(var C=0;C<Z.length;C++)Z[C]!==""&&(I[R].push(Z[C]),R=(R+1)%I.length);n++}}else n++;x.push({symmetries:[]}),g.push([]);var z=o._atom_site_id!==void 0?o._atom_site_id.length:o._atom_site_label.length,V;if(o._cell_length_a!==void 0){var G=parseFloat(o._cell_length_a),B=parseFloat(o._cell_length_b),F=parseFloat(o._cell_length_c),N=parseFloat(o._cell_angle_alpha)||90,j=parseFloat(o._cell_angle_beta)||90,U=parseFloat(o._cell_angle_gamma)||90;V=(0,P.conversionMatrix3)(G,B,F,N,j,U),x[x.length-1].cryst={a:G,b:B,c:F,alpha:N,beta:j,gamma:U}}for(var k=0;k<z;k++)if(!(o._atom_site_group_pdb!==void 0&&o._atom_site_group_pdb[k]==="TER")){var te={};if(o._atom_site_cartn_x!==void 0)te.x=parseFloat(o._atom_site_cartn_x[k]),te.y=parseFloat(o._atom_site_cartn_y[k]),te.z=parseFloat(o._atom_site_cartn_z[k]);else{var he=y(V,parseFloat(o._atom_site_fract_x[k]),parseFloat(o._atom_site_fract_y[k]),parseFloat(o._atom_site_fract_z[k]));te.x=he.x,te.y=he.y,te.z=he.z}te.chain=o._atom_site_auth_asym_id?o._atom_site_auth_asym_id[k]:void 0,te.resi=o._atom_site_auth_seq_id?parseInt(o._atom_site_auth_seq_id[k]):void 0,te.resn=o._atom_site_auth_comp_id?o._atom_site_auth_comp_id[k].trim():void 0,te.atom=o._atom_site_auth_atom_id?o._atom_site_auth_atom_id[k].replace(/"/gm,""):void 0,te.hetflag=!o._atom_site_group_pdb||o._atom_site_group_pdb[k]==="HETA"||o._atom_site_group_pdb[k]==="HETATM";var re="X";o._atom_site_type_symbol?re=o._atom_site_type_symbol[k].replace(/\(?\+?\d+.*/,""):o._atom_site_label&&(re=o._atom_site_label[k].split("_")[0].replace(/\(?\d+.*/,"")),te.elem=re[0].toUpperCase()+re.substr(1,1).toLowerCase(),te.bonds=[],te.ss="c",te.serial=k,te.bondOrder=[],te.properties={},g[g.length-1].push(te)}if(o._pdbx_struct_oper_list_id!==void 0&&!M)for(let Z=0;Z<o._pdbx_struct_oper_list_id.length;Z++){var ae=parseFloat(o["_pdbx_struct_oper_list_matrix[1][1]"][Z]),pe=parseFloat(o["_pdbx_struct_oper_list_matrix[1][2]"][Z]),oe=parseFloat(o["_pdbx_struct_oper_list_matrix[1][3]"][Z]),se=parseFloat(o["_pdbx_struct_oper_list_vector[1]"][Z]),Ce=parseFloat(o["_pdbx_struct_oper_list_matrix[2][1]"][Z]),_e=parseFloat(o["_pdbx_struct_oper_list_matrix[2][2]"][Z]),Se=parseFloat(o["_pdbx_struct_oper_list_matrix[2][3]"][Z]),fe=parseFloat(o["_pdbx_struct_oper_list_vector[2]"][Z]),xe=parseFloat(o["_pdbx_struct_oper_list_matrix[3][1]"][Z]),Ee=parseFloat(o["_pdbx_struct_oper_list_matrix[3][2]"][Z]),We=parseFloat(o["_pdbx_struct_oper_list_matrix[3][3]"][Z]),Ge=parseFloat(o["_pdbx_struct_oper_list_vector[3]"][Z]),Ne=new P.Matrix4(ae,pe,oe,se,Ce,_e,Se,fe,xe,Ee,We,Ge);x[x.length-1].symmetries.push(Ne)}var Be=function(Z){var J=Z.match("-");Z=Z.replace(/[-xyz]/g,"");var ce=Z.split("/"),ue,Le;return ce[1]===void 0?Le=1:Le=parseInt(ce[1]),ce[0]===""?ue=1:ue=parseInt(ce[0]),ue/Le*(J?-1:1)};if(o._symmetry_equiv_pos_as_xyz!==void 0&&!M)for(var Te=0;Te<o._symmetry_equiv_pos_as_xyz.length;Te++){var Re=o._symmetry_equiv_pos_as_xyz[Te].replace(/["' ]/g,""),Pe=Re.split(",").map(function(J){return J.replace(/-/g,"+-")});let Z=new P.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let J=0;J<3;J++){var Ue=Pe[J].split("+");for(let ce=0;ce<Ue.length;ce++){var ze=Ue[ce];if(ze!==""){var Ze=Be(ze);ze.match("x")?Z.elements[J+0]=Ze:ze.match("y")?Z.elements[J+4]=Ze:ze.match("z")?Z.elements[J+8]=Ze:Z.elements[J+12]=Ze}}}var He=V.getMatrix4(),X=new P.Matrix4().getInverse(He,!0);Z=new P.Matrix4().multiplyMatrices(Z,X),Z=new P.Matrix4().multiplyMatrices(He,Z),x[x.length-1].symmetries.push(Z)}}for(let Z=0;Z<g.length;Z++)p&&(0,w.assignBonds)(g[Z]),(0,S.computeSecondaryStructure)(g[Z],L.hbondCutoff),(0,O.processSymmetries)(x[Z].symmetries,g[Z],L,x[Z].cryst),L.duplicateAssemblyAtoms&&!L.dontConnectDuplicatedAtoms&&p&&(0,w.assignBonds)(g[Z]);return g}},"./src/parsers/CUBE.ts":($,T,f)=>{f.r(T),f.d(T,{CUBE:()=>P});var w=f("./src/WebGL/index.ts"),S=f("./src/parsers/utils/assignBonds.ts"),O=f("./src/parsers/utils/anumToSymbol.ts");function P(v,_){_=_||{};var L=[[]],g=v.split(/\r?\n/),M=_.assignBonds===void 0?!0:_.assignBonds;if(g.length<6)return L;var x=g[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),p=Math.abs(parseFloat(x[0]));let y={};var e=y.origin=new w.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3]));x=g[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),x=g[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var r=x[0]>0?.529177:1;e.multiplyScalar(r);var s=Math.abs(x[0]),h=new w.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(r);x=g[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var a=Math.abs(x[0]),t=new w.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(r);x=g[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var n=Math.abs(x[0]),o=new w.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(r);if(y.size={x:s,y:a,z:n},y.unit=new w.Vector3(h.x,t.y,o.z),h.y!=0||h.z!=0||t.x!=0||t.z!=0||o.x!=0||o.y!=0){y.matrix4=new w.Matrix4(h.x,t.x,o.x,0,h.y,t.y,o.y,0,h.z,t.z,o.z,0,0,0,0,1);let C=new w.Matrix4().makeTranslation(e.x,e.y,e.z);y.matrix4=y.matrix4.multiplyMatrices(C,y.matrix4),y.matrix=y.matrix4.matrix3FromTopLeft(),y.origin=new w.Vector3(0,0,0),y.unit=new w.Vector3(1,1,1)}L.modelData=[{cryst:y}],g=g.splice(6,p);for(var c=L[L.length-1].length,u=c+g.length,E=c;E<u;++E){var A={};A.serial=E;var I=g[E-c],R=I.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");A.elem=O.anumToSymbol[R[0]],A.x=parseFloat(R[2])*r,A.y=parseFloat(R[3])*r,A.z=parseFloat(R[4])*r,A.hetflag=!0,A.bonds=[],A.bondOrder=[],A.properties={},L[L.length-1].push(A)}if(M)for(let C=0;C<L.length;C++)(0,S.assignBonds)(L[C]);return L}},"./src/parsers/GRO.ts":($,T,f)=>{f.r(T),f.d(T,{GRO:()=>O});var w=f("./src/parsers/utils/assignPDBBonds.ts"),S=f("./src/parsers/utils/atomNameToElem.ts");function O(P){for(var v=[],_=P.split(/\r?\n|\r/);_.length>0&&!(_.length<3);){var L=parseInt(_[1]);if(isNaN(L)||L<=0||_.length<L+3)break;var g=[];v.push(g);for(var M=2,x=g.length,p=x+L,y=x;y<p;y++){var e=_[M++],r={};r.serial=y,r.atom=e.slice(10,15).trim(),r.elem=(0,S.atomNameToElem)(r.atom,!0),r.x=10*parseFloat(e.slice(20,28)),r.y=10*parseFloat(e.slice(28,36)),r.z=10*parseFloat(e.slice(36,44)),r.resi=parseInt(e.slice(0,5)),r.resn=e.slice(5,10).trim(),r.bonds=[],r.bondOrder=[],r.properties={},e.length>44&&(r.dx=10*parseFloat(e.slice(44,52)),r.dy=10*parseFloat(e.slice(52,60)),r.dz=10*parseFloat(e.slice(60,68))),g[y]=r}if(_.length<=M+3){var s=_[M++],h=s.trim().split(/\s+/);if(h.length==3){for(var a=0;a<3;a++)h[a]=parseFloat(h[a])*10;v.box=h}}_.splice(0,++M)}for(let t=0;t<v.length;t++)(0,w.assignPDBBonds)(v[t]);return v}},"./src/parsers/LAMMPSTRJ.ts":($,T,f)=>{f.r(T),f.d(T,{LAMMPSTRJ:()=>S});var w=f("./src/parsers/utils/assignBonds.ts");function S(O,P){for(var v=[],_={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"},L=O.split(/\r?\n|\r/),g=0,M=0,x=0;x<L.length-9;){for(var p=x;p<L.length;p++)if(L[p].match(/ITEM: NUMBER OF ATOMS/)&&(M=parseInt(L[p+1])),L[p].match(/ITEM: ATOMS/)){g=p+1;break}var y=L[g-1].replace("ITEM: ATOMS ","").split(" ");v.push([]);for(let n=g;n<g+M;n++){for(var e={},r={},s=L[n].split(" "),h=0;h<s.length;h++){var a=_[y[h]];a!=null&&(a=="serial"?e[a]=parseInt(s[h]):a=="x"||a=="y"||a==="z"?e[a]=parseFloat(s[h]):a=="charge"||a=="radius"?r[a]=parseFloat(s[h]):e[a]=s[h]),e.properties=r,e.bonds=[],e.bondOrder=[]}v[v.length-1][n-g]=e}x=g+M-1}if(P.assignBonds)for(var t=0;t<v.length;t++)(0,w.assignBonds)(v[t]);return v}},"./src/parsers/MMTF.ts":($,T,f)=>{f.r(T),f.d(T,{MMTFparser:()=>M});var w=f("./src/utilities.ts"),S=f("./src/WebGL/index.ts"),O=f("./src/parsers/utils/computeSecondaryStructure.ts"),P=f("./src/parsers/utils/processSymmetries.ts"),v=f("./src/vendor/mmtf.js"),_=function(x){return String.fromCharCode.apply(null,x).replace(/\0/g,"")},L=function(x){return x==0||x==2||x==4?"h":x==3?"s":"c"};let g=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);function M(x,p){var y=!p.keepH,e=p.altLoc?p.altLoc:"A",r=!!p.noSecondaryStructure,s=!p.noComputeSecondaryStructure,h=!p.doAssembly,a=p.assemblyIndex?p.assemblyIndex:0;typeof x=="string"?x=(0,w.base64ToArray)(x):x=new Uint8Array(x);var t=v.decode(x),n=[[]],o=n.modelData=[],c=0,u=0,E=0,A=t.secStructList,I=t.insCodeList,R=t.sequenceIndexList,C=t.bFactorList,z=t.altLocList,V=t.occupancyList,G=t.bondAtomList,B=t.bondOrderList,F=t.numModels;if(F==0)return n;p.multimodel||(F=1);var N,j,U,k,te,he,re=[];if(!h&&t.bioAssemblyList&&t.bioAssemblyList.length>0){var ae=t.bioAssemblyList[a].transformList;for(N=0,he=ae.length;N<he;N++){var pe=new S.Matrix4(ae[N].matrix);pe.transpose(),re.push(pe)}}var oe=null;if(t.unitCell){var se=t.unitCell;oe={a:se[0],b:se[1],c:se[2],alpha:se[3],beta:se[4],gamma:se[5]}}let Ce=[];t.entityList.forEach(ie=>{ie.chainIndexList.forEach(ye=>{Ce[ye]=ie.type=="polymer"})});var _e=0;for(te=0;te<F;te++){var Se=t.chainsPerModel[te],fe=n[n.length-1],xe=[];for(o.push({symmetries:re,cryst:oe}),N=0;N<Se;++N){var Ee=t.groupsPerChain[c],We=_(t.chainIdList.subarray(c*4,c*4+4));t.chainNameList&&(We=_(t.chainNameList.subarray(c*4,c*4+4)));var Ge=u,Ne="";for(j=0;j<Ee;++j){var Be=t.groupList[t.groupTypeList[u]],Te=Be.atomNameList.length,Re=0,Pe=!1,Ue=!1;if(A){Re=A[u];var ze=L(Re);(u==0||ze!=Ne)&&(Pe=!0),Ne=ze;var Ze=u+1;(Ze>=A.length||L(A[Ze]!=ze))&&(Ue=!0)}t.insCodeList&&String.fromCharCode(I[u]),R&&R[u];var He=t.groupIdList[u],X=Be.groupName;let ie=Be.chemCompType;var Z=E;let ye=g.has(ie)||!Ce[c];for(U=0;U<Te;++U){var J=Be.elementList[U];if(y&&J=="H"){E+=1;continue}var ce="";C&&(ce=C[E]);var ue="";z&&z[E]&&(ue=String.fromCharCode(z[E]));var Le="";if(V&&(Le=V[E]),ue!=""&&ue!=e&&e!="*"){E+=1;continue}var De=t.atomIdList[E],K=Be.atomNameList[U],de=0;Be.atomChargeList&&(de=Be.atomChargeList[U]);var me=t.xCoordList[E],Ie=t.yCoordList[E],ne=t.zCoordList[E];xe[E]=fe.length,fe.push({resn:X,x:me,y:Ie,z:ne,elem:J,hetflag:ye,chain:We,resi:He,icode:ue,rescode:He+(ue!=" "?"^"+ue:""),serial:De,altLoc:ue,index:E,atom:K,bonds:[],ss:L(Re),ssbegin:Pe,ssend:Ue,bondOrder:[],properties:{charge:de,occupancy:Le},b:ce}),E+=1}var we=Be.bondAtomList;for(U=0,k=Be.bondOrderList.length;U<k;++U){var H=Z+we[U*2],Oe=Z+we[U*2+1],ke=Be.bondOrderList[U],D=xe[H],ge=xe[Oe],be=fe[D],Y=fe[ge];be&&Y&&(be.bonds.push(ge),be.bondOrder.push(ke),Y.bonds.push(D),Y.bondOrder.push(ke))}u+=1}for(u=Ge,j=0;j<Ee;++j)u+=1;c+=1}if(G)for(let ie=_e,ye=G.length;ie<ye;ie+=2){let Ke=G[ie],je=G[ie+1],Ve=B?B[ie/2]:1;if(Ke>=E){_e=ie;break}let tt=xe[Ke],Mt=xe[je],it=fe[tt],qe=fe[Mt];it&&qe&&(it.bonds.push(Mt),it.bondOrder.push(Ve),qe.bonds.push(tt),qe.bondOrder.push(Ve))}p.multimodel&&(p.onemol||n.push([]))}if(!h)for(let ie=0;ie<n.length;ie++)(0,P.processSymmetries)(o[ie].symmetries,n[ie],p,o[ie].cryst);return s&&!r&&(0,O.computeSecondaryStructure)(n,p.hbondCutoff),n}},"./src/parsers/MOL2.ts":($,T,f)=>{f.r(T),f.d(T,{MOL2:()=>S});let w={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"};function S(O,P){var v=[[]],_=!1;typeof P.keepH<"u"&&(_=!P.keepH);var L=O.search(/@<TRIPOS>MOLECULE/),g=O.search(/@<TRIPOS>ATOM/);if(L==-1||g==-1)return v;for(var M=O.substr(L,O.length).split(/\r?\n|\r/);M.length>0;){var x=[],p=M[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),y=parseInt(p[0]),e=0;p.length>1&&(e=parseInt(p[1]));var r=4,s;for(s=3;s<M.length;s++)if(M[s]=="@<TRIPOS>ATOM"){r=s+1;break}var h=v[v.length-1].length,a=h+y,t;for(s=h;s<a;s++){t=M[r++],p=t.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var n={},o=p[5];if(w[o]!==void 0?o=w[o]:(o=o.split(".")[0],o=o[0].toUpperCase()+o.substr(1).toLowerCase()),n.atom=p[1],n.elem=o,!(n.elem=="H"&&_)){var c=v[v.length-1].length,u=parseInt(p[0]);n.serial=u,n.x=parseFloat(p[2]),n.y=parseFloat(p[3]),n.z=parseFloat(p[4]),n.atom=p[5];var E=parseFloat(p[8]);n.index=c,n.bonds=[],n.bondOrder=[],n.properties={charge:E,partialCharge:E},x[u]=c,v[v.length-1].push(n)}}for(var A=!1;r<M.length;)if(M[r++]=="@<TRIPOS>BOND"){A=!0;break}if(A&&e)for(s=0;s<e;s++){t=M[r++],p=t.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var I=parseInt(p[1]),R=v[v.length-1][x[I]],C=parseInt(p[2]),z=v[v.length-1][x[C]],V=parseInt(p[3]);isNaN(V)&&(V=1),R!==void 0&&z!==void 0&&(R.bonds.push(x[C]),R.bondOrder.push(V),z.bonds.push(x[I]),z.bondOrder.push(V))}if(P.multimodel){P.onemol||v.push([]),M.splice(0,r),O=M.join(`
`);continue}else break}return v}},"./src/parsers/PDB.ts":($,T,f)=>{f.r(T),f.d(T,{PDB:()=>S});var w=f("./src/parsers/utils/getSinglePDB.ts");function S(O,P){P=P||{};var v=[],_={};v.modelData=[];for(var L=O.split(/\r?\n|\r/);L.length>0;){var g=(0,w.getSinglePDB)(L,P,_),M=g[0],x=g[1];if(L=g[2],M.length!=0){if(P.multimodel&&P.onemol&&v.length>0)for(var p=v[0].length,y=0;y<M.length;y++){var e=M[y];e.index=y;for(var r=0;r<e.bonds.length;r++)e.bonds[r]+=p;v[0].push(e)}else v.modelData.push(x),v.push(M);if(!P.multimodel)break}}return v}},"./src/parsers/PQR.ts":($,T,f)=>{f.r(T),f.d(T,{PQR:()=>O});var w=f("./src/parsers/utils/assignPDBBonds.ts"),S=f("./src/parsers/utils/computeSecondaryStructure.ts");function O(P,v){var _=[[]],L=!v.noSecondaryStructure;_.modelData=[{symmetries:[]}];var g=[],M=P.split(/\r?\n|\r/),x;for(let A=0;A<M.length;A++){x=M[A].replace(/^\s*/,"");var p=x.substr(0,6);if(p.indexOf("END")==0)if(v.multimodel){v.onemol||_.push([]);continue}else break;else if(p=="ATOM  "||p=="HETATM"){var y;let I=parseInt(x.substr(6,5)),R=x.substr(12,4).replace(/ /g,""),C=x.substr(17,3).trim(),z=x.substr(21,1),V=parseInt(x.substr(22,4));var e=x.substr(30).trim().split(/\s+/),r=parseFloat(e[0]),s=parseFloat(e[1]),h=parseFloat(e[2]),a=parseFloat(e[3]),t=parseFloat(e[4]),n=R[0];R.length>1&&R[1].toUpperCase()!=R[1]&&(n=R.substr(0,2)),x[0]=="H"?y=!0:y=!1,g[I]=_[_.length-1].length,_[_.length-1].push({resn:C,x:r,y:s,z:h,elem:n,hetflag:y,chain:z,resi:V,serial:I,atom:R,bonds:[],ss:"c",bondOrder:[],properties:{charge:a,partialCharge:a,radius:t},pdbline:x})}else if(p=="CONECT"){var o=parseInt(x.substr(6,5)),c=_[_.length-1][g[o]];for(let I=0;I<4;I++){var u=parseInt(x.substr([11,16,21,26][I],5)),E=_[_.length-1][g[u]];c!==void 0&&E!==void 0&&(c.bonds.push(g[u]),c.bondOrder.push(1))}}}for(let A=0;A<_.length;A++)(0,w.assignPDBBonds)(_[A]),L&&(0,S.computeSecondaryStructure)(_[A],v.hbondCutoff);return _}},"./src/parsers/PRMTOP.ts":($,T,f)=>{f.r(T),f.d(T,{PRMTOP:()=>w});function w(S){var O=[],P,v=0,_=S.split(/\r?\n|\r/);if(_.length>0&&_[0].includes("VERSION")){var L=_.filter(function(r){return r.includes("POINTERS")||r.includes("ATOM_NAME")||r.includes("CHARGE")||r.includes("RADII")||r.includes("BONDS_INC_HYDROGEN")||r.includes("BONDS_WITHOUT_HYDROGEN")}),g=y("POINTERS");if(g==-1)return[];var M=e(g),x=parseInt(_[g+1].slice(0,M[1]));if(isNaN(x)||x<=0)return[];if(g=y("ATOM_NAME"),g==-1)return[];M=e(g);var p=M[0];for(let r=0;r<x/M[0];r++){r==parseInt(x/M[0])&&(p=x%M[0]);for(let s=0;s<p;s++){let h={},a={charge:"",radii:""};h.serial=v,h.x=0,h.y=0,h.z=0,h.atom=_[g+1].slice(M[1]*s,M[1]*(s+1)),h.elem=_[g+1].slice(M[1]*s,M[1]*s+1),h.properties=a,h.bonds=[],h.bondOrder=[],O.push(h),v++}g++}if(g=y("CHARGE"),g!=-1){M=e(g),v=0,p=M[0];for(let r=0;r<x/M[0];r++){r==parseInt(x/M[0])&&(p=x%M[0]);for(let s=0;s<p;s++)O[v].properties.charge=parseFloat(_[g+1].slice(M[1]*s,M[1]*(s+1))),v++;g++}}if(g=y("RADII"),g!=-1){M=e(g),v=0,p=M[0];for(let r=0;r<x/M[0];r++){r==parseInt(x/M[0])&&(p=x%M[0]);for(let s=0;s<p;s++)O[v].properties.radii=parseFloat(_[g+1].slice(M[1]*s,M[1]*(s+1))),v++;g++}}if(g=y("BONDS_WITHOUT_HYDROGEN"),g!=-1)for(M=e(g),v=0,p=M[0],g=g+1;!_[g].match(/^%FLAG/);){_[g+1].match(/^%FLAG/)&&(p=x%M[0]);for(let r=0;r<p;r++)v%3==0?P=parseInt(_[g].slice(M[1]*r,M[1]*(r+1))/3):v%3==1&&O[P].bonds.push(parseInt(_[g].slice(M[1]*r,M[1]*(r+1))/3)),v++;g++}if(g=y("BONDS_INC_HYDROGEN"),g!=-1)for(M=e(g),v=0,p=M[0],g=g+1;!_[g].match(/^%FLAG/);){_[g+1].match(/^%FLAG/)&&(p=x%M[0]);for(let r=0;r<p;r++)v%3==0?P=parseInt(_[g].slice(M[1]*r,M[1]*(r+1))/3):v%3==1&&O[P].bonds.push(parseInt(_[g].slice(M[1]*r,M[1]*(r+1))/3)),v++;g++}}else return[];function y(r){var s=_.indexOf(L.filter(function(h){return h.includes(r)})[0]);if(Number.isInteger(s)&&s>0){for(;!_[s].includes("FORMAT");)s++;return s}else return-1}function e(r){var s=_[r].match(/\((\d*)\S*/),h=_[r].match(/[a-zA-Z](\d*)\)\s*/);return h==null&&(h=_[r].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[s[1],h[1]]}return[O]}},"./src/parsers/SDF.ts":($,T,f)=>{f.r(T),f.d(T,{SDF:()=>O});var w=function(P,v){var _=[[]],L=!1;for(typeof v.keepH<"u"&&(L=!v.keepH);P.length>0&&!(P.length<4);){var g=parseInt(P[3].substr(0,3));if(isNaN(g)||g<=0)break;var M=parseInt(P[3].substr(3,3)),x=4;if(P.length<4+g+M)break;var p=[],y=_[_.length-1].length,e=y+g,r,s;for(r=y;r<e;r++,x++){s=P[x];var h={},a=s.substr(31,3).replace(/ /g,"");h.atom=h.elem=a[0].toUpperCase()+a.substr(1).toLowerCase(),(h.elem!=="H"||!L)&&(h.serial=r,p[r]=_[_.length-1].length,h.x=parseFloat(s.substr(0,10)),h.y=parseFloat(s.substr(10,10)),h.z=parseFloat(s.substr(20,10)),h.hetflag=!0,h.bonds=[],h.bondOrder=[],h.properties={},h.index=_[_.length-1].length,_[_.length-1].push(h))}for(r=0;r<M;r++,x++){s=P[x];var t=p[parseInt(s.substr(0,3))-1+y],n=p[parseInt(s.substr(3,3))-1+y],o=parseFloat(s.substr(6));typeof t<"u"&&typeof n<"u"&&(_[_.length-1][t].bonds.push(n),_[_.length-1][t].bondOrder.push(o),_[_.length-1][n].bonds.push(t),_[_.length-1][n].bondOrder.push(o))}if(v.multimodel){for(v.onemol||_.push([]);P[x]!=="$$$$";)x++;P.splice(0,++x)}else break}return _},S=function(P,v){var _=[[]],L=!1;for(typeof v.keepH<"u"&&(L=!v.keepH);P.length>0&&!(P.length<8||!P[4].startsWith("M  V30 BEGIN CTAB")||!P[5].startsWith("M  V30 COUNTS")||P[5].length<14);){var g=P[5].substr(13).match(/\S+/g);if(g.length<2)break;var M=parseInt(g[0]);if(isNaN(M)||M<=0)break;var x=parseInt(g[1]),p=7;if(P.length<8+M+x)break;var y=[],e=_[_.length-1].length,r=e+M,s,h;for(s=e;s<r;s++,p++){h=P[p];var a=h.substr(6).match(/\S+/g);if(a.length>4){var t={},n=a[1].replace(/ /g,"");t.atom=t.elem=n[0].toUpperCase()+n.substr(1).toLowerCase(),(t.elem!=="H"||!L)&&(t.serial=s,y[s]=_[_.length-1].length,t.x=parseFloat(a[2]),t.y=parseFloat(a[3]),t.z=parseFloat(a[4]),t.hetflag=!0,t.bonds=[],t.bondOrder=[],t.properties={},t.index=_[_.length-1].length,_[_.length-1].push(t))}}if(P[p]==="M  V30 END ATOM")p++;else break;if(x!==0&&P[p]==="M  V30 BEGIN BOND")p++;else break;for(s=0;s<x;s++,p++){h=P[p];var o=h.substr(6).match(/\S+/g);if(o.length>3){var c=y[parseInt(o[2])-1+e],u=y[parseInt(o[3])-1+e],E=parseFloat(o[1]);typeof c<"u"&&typeof u<"u"&&(_[_.length-1][c].bonds.push(u),_[_.length-1][c].bondOrder.push(E),_[_.length-1][u].bonds.push(c),_[_.length-1][u].bondOrder.push(E))}}if(v.multimodel){for(v.onemol||_.push([]);P[p]!=="$$$$";)p++;P.splice(0,++p)}else break}return _};function O(P,v){var _="V2000",L=P.split(/\r?\n|\r/);return L.length>3&&L[3].length>38&&(_=L[3].substr(34,5)),_==="V2000"?w(L,v):_==="V3000"?S(L,v):[[]]}},"./src/parsers/VASP.ts":($,T,f)=>{f.r(T),f.d(T,{VASP:()=>S});var w=f("./src/WebGL/index.ts");function S(O){var P=[[]],v={},_=O.replace(/^\s+/,"").split(/\r?\n/);if(_.length<3)return P;if(_[1].match(/\d+/))v.length=parseFloat(_[1]);else return console.log("Warning: second line of the vasp structure file must be a number"),P;if(v.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),P;v.xVec=new Float32Array(_[2].replace(/^\s+/,"").split(/\s+/)),v.yVec=new Float32Array(_[3].replace(/^\s+/,"").split(/\s+/)),v.zVec=new Float32Array(_[4].replace(/^\s+/,"").split(/\s+/));var L=new w.Matrix3(v.xVec[0],v.xVec[1],v.xVec[2],v.yVec[0],v.yVec[1],v.yVec[2],v.zVec[0],v.zVec[1],v.zVec[2]);L.multiplyScalar(v.length),P.modelData=[{symmetries:[],cryst:{matrix:L}}];var g=_[5].replace(/\s+/,"").replace(/\s+$/,"").split(/\s+/),M=new Int16Array(_[6].replace(/^\s+/,"").split(/\s+/)),x=_[7].replace(/\s+/,"");if(x.match(/C/))x="cartesian";else if(x.match(/D/))x="direct";else return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),P;if(g.length!=M.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(g),console.log(M),P;_.splice(0,8);for(var p=0,y=0,e=g.length;y<e;y++){for(var r=g[y],s=0,h=M[y];s<h;s++){var a=new Float32Array(_[p+s].replace(/^\s+/,"").split(/\s+/)),t={};t.elem=r,x=="cartesian"?(t.x=v.length*a[0],t.y=v.length*a[1],t.z=v.length*a[2]):(t.x=v.length*(a[0]*v.xVec[0]+a[1]*v.yVec[0]+a[2]*v.zVec[0]),t.y=v.length*(a[0]*v.xVec[1]+a[1]*v.yVec[1]+a[2]*v.zVec[1]),t.z=v.length*(a[0]*v.xVec[2]+a[1]*v.yVec[2]+a[2]*v.zVec[2])),t.bonds=[],P[0].push(t)}p+=M[y]}return P}},"./src/parsers/XYZ.ts":($,T,f)=>{f.r(T),f.d(T,{XYZ:()=>O});var w=f("./src/WebGL/index.ts"),S=f("./src/parsers/utils/assignBonds.ts");function O(P,v){v=v||{};for(var _=[[]],L=v.assignBonds===void 0?!0:v.assignBonds,g=P.split(/\r?\n|\r/);g.length>0&&!(g.length<3);){var M=parseInt(g[0]);if(isNaN(M)||M<=0||g.length<M+2)break;var x=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi,p=x.exec(g[1]);if(p!=null&&p.length>1){var y=new Float32Array(p[1].split(/\s+/)),e=new w.Matrix3(y[0],y[3],y[6],y[1],y[4],y[7],y[2],y[5],y[8]);_.modelData=[{cryst:{matrix:e}}]}for(var r=2,s=_[_.length-1].length,h=s+M,a=s;a<h;a++){var t=g[r++],n=t.replace(/^\s+/,"").replace(/\s+/g," ").split(" "),o={};o.serial=a;var c=n[0];o.atom=o.elem=c[0].toUpperCase()+c.substr(1,1).toLowerCase(),o.x=parseFloat(n[1]),o.y=parseFloat(n[2]),o.z=parseFloat(n[3]),o.hetflag=!0,o.bonds=[],o.bondOrder=[],o.properties={},_[_.length-1][a]=o,n.length>=7&&(o.dx=parseFloat(n[4]),o.dy=parseFloat(n[5]),o.dz=parseFloat(n[6]))}if(v.multimodel)_.push([]),g.splice(0,r);else break}if(L)for(let E=0;E<_.length;E++)(0,S.assignBonds)(_[E]);if(v.onemol){var u=_;_=[],_.push(u[0]);for(let E=1;E<u.length;E++){let A=_[0].length;for(let I=0;I<u[E].length;I++){let R=u[E][I];for(let C=0;C<R.bonds.length;C++)R.bonds[C]=R.bonds[C]+A;R.index=_[0].length,R.serial=_[0].length,_[0].push(R)}}}return _}},"./src/parsers/index.ts":($,T,f)=>{f.r(T),f.d(T,{Parsers:()=>s,bondLength:()=>r.bondLength,setBondLength:()=>r.setBondLength});var w=f("./src/parsers/VASP.ts"),S=f("./src/parsers/CUBE.ts"),O=f("./src/parsers/XYZ.ts"),P=f("./src/parsers/SDF.ts"),v=f("./src/parsers/CDJSON.ts"),_=f("./src/parsers/CIF.ts"),L=f("./src/parsers/MOL2.ts"),g=f("./src/parsers/PDB.ts"),M=f("./src/parsers/PQR.ts"),x=f("./src/parsers/MMTF.ts"),p=f("./src/parsers/PRMTOP.ts"),y=f("./src/parsers/GRO.ts"),e=f("./src/parsers/LAMMPSTRJ.ts"),r=f("./src/parsers/utils/bondLength.ts");const s={vasp:w.VASP,VASP:w.VASP,cube:S.CUBE,CUBE:S.CUBE,xyz:O.XYZ,XYZ:O.XYZ,sdf:P.SDF,SDF:P.SDF,json:v.CDJSON,cdjson:v.CDJSON,CDJSON:v.CDJSON,mcif:_.CIF,cif:_.CIF,CIF:_.CIF,mol2:L.MOL2,MOL2:L.MOL2,pdb:g.PDB,PDB:g.PDB,pdbqt:g.PDB,PDBQT:g.PDB,pqr:M.PQR,PQR:M.PQR,mmtf:x.MMTFparser,MMTF:x.MMTFparser,prmtop:p.PRMTOP,PRMTOP:p.PRMTOP,gro:y.GRO,GRO:y.GRO,lammpstrj:e.LAMMPSTRJ,LAMMPSTRJ:e.LAMMPSTRJ}},"./src/parsers/utils/anumToSymbol.ts":($,T,f)=>{f.r(T),f.d(T,{anumToSymbol:()=>w});const w={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}},"./src/parsers/utils/areConnected.ts":($,T,f)=>{f.r(T),f.d(T,{areConnected:()=>S});var w=f("./src/parsers/utils/bondLength.ts");function S(O,P){var v=(0,w.bondLength)(O.elem)+(0,w.bondLength)(P.elem);v+=.25,v*=v;var _=O.x-P.x;if(_*=_,_>v)return!1;var L=O.y-P.y;if(L*=L,L>v)return!1;var g=O.z-P.z;if(g*=g,g>v)return!1;var M=_+L+g;return isNaN(M)||M<.5||M>v?!1:!(O.altLoc!=P.altLoc&&O.altLoc!=" "&&P.altLoc!=" ")}},"./src/parsers/utils/assignBackboneHBonds.ts":($,T,f)=>{f.r(T),f.d(T,{assignBackboneHBonds:()=>w});function w(S,O){let P=O||3.2,v=P*P,_=[];for(let r=0,s=S.length;r<s;r++){S[r].index=r;var L=S[r];!L.hetflag&&(L.atom==="N"||L.atom==="O")&&(_.push(L),L.hbondOther=null,L.hbondDistanceSq=Number.POSITIVE_INFINITY)}_.sort(function(r,s){return r.z-s.z});for(let r=0,s=_.length;r<s;r++){var g=_[r];for(let h=r+1;h<s;h++){var M=_[h],x=M.z-g.z;if(x>P)break;if(M.atom!=g.atom){var p=Math.abs(M.y-g.y);if(!(p>P)){var y=Math.abs(M.x-g.x);if(!(y>P)){var e=y*y+p*p+x*x;e>v||M.chain==g.chain&&Math.abs(M.resi-g.resi)<4||(e<g.hbondDistanceSq&&(g.hbondOther=M,g.hbondDistanceSq=e),e<M.hbondDistanceSq&&(M.hbondOther=g,M.hbondDistanceSq=e))}}}}}}},"./src/parsers/utils/assignBonds.ts":($,T,f)=>{f.r(T),f.d(T,{assignBonds:()=>S});var w=f("./src/parsers/utils/areConnected.ts");function S(O){for(var P=0,v=O.length;P<v;P++)O[P].index||(O[P].index=P);for(var _={},L=4.95,g=0;g<O.length;g++){var M=O[g],x=Math.floor(M.x/L),p=Math.floor(M.y/L),y=Math.floor(M.z/L);_[x]||(_[x]={}),_[x][p]||(_[x][p]={}),_[x][p][y]||(_[x][p][y]=[]),_[x][p][y].push(M)}var e=function(s,h){for(var a=0;a<s.length;a++)for(var t=s[a],n=0;n<h.length;n++){var o=h[n];if((0,w.areConnected)(t,o)){var c=t.bonds.indexOf(o.index),u=o.bonds.indexOf(t.index);c==-1&&u==-1?(t.bonds.push(o.index),t.bondOrder.push(1),o.bonds.push(t.index),o.bondOrder.push(1)):c==-1?(t.bonds.push(o.index),t.bondOrder.push(o.bondOrder[u])):u==-1&&(o.bonds.push(t.index),o.bondOrder.push(t.bondOrder[c]))}}},r=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}];for(let s in _){let h=parseInt(s);for(let a in _[h]){let t=parseInt(a);for(let n in _[h][t]){let o=parseInt(n),c=_[h][t][o];for(let u=0;u<c.length;u++){let E=c[u];for(let A=u+1;A<c.length;A++){let I=c[A];(0,w.areConnected)(E,I)&&E.bonds.indexOf(I.index)==-1&&(E.bonds.push(I.index),E.bondOrder.push(1),I.bonds.push(E.index),I.bondOrder.push(1))}}for(let u=0;u<r.length;u++){let E=r[u];if(!_[h+E.x]||!_[h+E.x][t+E.y]||!_[h+E.x][t+E.y][o+E.z])continue;let A=_[h+E.x][t+E.y][o+E.z];e(c,A)}}}}}},"./src/parsers/utils/assignPDBBonds.ts":($,T,f)=>{f.r(T),f.d(T,{assignPDBBonds:()=>P});var w=f("./src/parsers/utils/areConnected.ts"),S=f("./src/parsers/utils/assignBonds.ts"),O=f("./src/parsers/utils/standardResidues.ts");function P(v){var _=[],L=[],g,M;for(g=0,M=v.length;g<M;g++){var x=v[g];x.index=g,x.hetflag||!O.standardResidues.has(x.resn)?L.push(x):_.push(x)}(0,S.assignBonds)(L),_.sort(function(a,t){return a.chain!=t.chain?a.chain<t.chain?-1:1:a.resi-t.resi});var p=-1,y=-1,e;for(g=0,M=_.length;g<M;g++){var r=_[g];r.resi!==p&&(p=r.resi,e||y++,e=!1),r.reschain=y;for(var s=g+1;s<_.length;s++){var h=_[s];if(h.chain!=r.chain||h.resi-r.resi>1)break;(0,w.areConnected)(r,h)&&(r.bonds.indexOf(h.index)===-1&&(r.bonds.push(h.index),r.bondOrder.push(1),h.bonds.push(r.index),h.bondOrder.push(1)),r.resi!==h.resi&&(e=!0))}}}},"./src/parsers/utils/atomNameToElem.ts":($,T,f)=>{f.r(T),f.d(T,{atomNameToElem:()=>S});var w=f("./src/parsers/utils/bondLength.ts");function S(O,P){var v=O.replace(/ /g,"");return v.length>0&&v[0]=="H"&&v!="Hg"&&v!="He"&&v!="Hf"&&v!="Hs"&&v!="Ho"&&(v="H"),v.length>1&&(v=v[0].toUpperCase()+v.substr(1).toLowerCase(),typeof w.bondTable[v]>"u"?v=v[0]:P&&(v=="Ca"||v=="Cd")&&(v="C")),v}},"./src/parsers/utils/bondLength.ts":($,T,f)=>{f.r(T),f.d(T,{bondLength:()=>S,bondTable:()=>w,setBondLength:()=>O});let w={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45};function S(P){return w[P]||1.6}function O(P,v){v<0&&(v=0),w[P]=v}},"./src/parsers/utils/computeSecondaryStructure.ts":($,T,f)=>{f.r(T),f.d(T,{computeSecondaryStructure:()=>S});var w=f("./src/parsers/utils/assignBackboneHBonds.ts");function S(O,P){(0,w.assignBackboneHBonds)(O,P);var v={},_,L,g,M,x,p;for(_=0,L=O.length;_<L;_++)if(x=O[_],typeof v[x.chain]>"u"&&(v[x.chain]=[]),isFinite(x.hbondDistanceSq)){var y=x.hbondOther;typeof v[y.chain]>"u"&&(v[y.chain]=[]),Math.abs(y.resi-x.resi)===4&&(v[x.chain][x.resi]="h")}for(g in v)for(M=1;M<v[g].length-1;M++){var e=v[g][M-1],r=v[g][M+1];p=v[g][M],e=="h"&&e==r&&p!=e&&(v[g][M]=e)}for(_=0,L=O.length;_<L;_++)x=O[_],isFinite(x.hbondDistanceSq)&&v[x.chain][x.resi]!="h"&&x.ss!="h"&&(v[x.chain][x.resi]="maybesheet");for(let s=0,h=O.length;s<h;s++)if(x=O[s],isFinite(x.hbondDistanceSq)&&v[x.chain][x.resi]=="maybesheet"){let a=x.hbondOther,t=v[a.chain][a.resi];(t=="maybesheet"||t=="s")&&(v[x.chain][x.resi]="s",v[a.chain][a.resi]="s")}for(let s in v){for(let h=1;h<v[s].length-1;h++){let a=v[s][h-1],t=v[s][h+1];p=v[s][h],a=="s"&&a==t&&p!=a&&(v[s][h]=a)}for(let h=0;h<v[s].length;h++){let a=v[s][h];(a=="h"||a=="s")&&v[s][h-1]!=a&&v[s][h+1]!=a&&delete v[s][h]}}for(_=0,L=O.length;_<L;_++)x=O[_],p=v[x.chain][x.resi],delete x.hbondOther,delete x.hbondDistanceSq,!(typeof p>"u"||p=="maybesheet")&&(x.ss=p,v[x.chain][x.resi-1]!=p&&(x.ssbegin=!0),v[x.chain][x.resi+1]!=p&&(x.ssend=!0))}},"./src/parsers/utils/getSinglePDB.ts":($,T,f)=>{f.r(T),f.d(T,{getSinglePDB:()=>M});var w=f("./src/WebGL/index.ts"),S=f("./src/parsers/utils/atomNameToElem.ts"),O=f("./src/parsers/utils/bondLength.ts"),P=f("./src/parsers/utils/computeSecondaryStructure.ts"),v=f("./src/parsers/utils/isEmpty.ts"),_=f("./src/parsers/utils/processSymmetries.ts"),L=f("./src/parsers/utils/assignPDBBonds.ts"),g=f("./src/parsers/utils/validateBonds.ts");function M(x,p,y){var e=[],r=p.assignBonds===void 0?!0:p.assignBonds,s=!p.keepH,h=!!p.noSecondaryStructure,a=!p.noComputeSecondaryStructure,t=!p.doAssembly,n=p.altLoc?p.altLoc:"A",o={symmetries:[]},c,u=[],E=[],A,I={};for(let Ze=0;Ze<x.length;Ze++){A=x[Ze].replace(/^\s*/,"");var R=A.substr(0,6),C,z,V;if(R.indexOf("END")==0){if(u=x.slice(Ze+1),R=="END")for(var G in y)y.hasOwnProperty(G)&&delete y[G];break}else if(R=="ATOM  "||R=="HETATM"){var B,F,N,j,U,k,te,he,re,ae,pe,oe;if(pe=A.substr(16,1),pe!=" "&&pe!=n&&n!="*"||(ae=parseInt(A.substr(6,5)),c=A.substr(12,4).replace(/ /g,""),B=A.substr(17,3).replace(/ /g,""),F=A.substr(21,1),N=parseInt(A.substr(22,4)),j=A.substr(26,1),U=parseFloat(A.substr(30,8)),k=parseFloat(A.substr(38,8)),te=parseFloat(A.substr(46,8)),oe=parseFloat(A.substr(60,8)),re=A.substr(76,2).replace(/ /g,""),re===""||typeof O.bondTable[re]>"u"?re=(0,S.atomNameToElem)(A.substr(12,2),A[0]=="A"):re=re[0].toUpperCase()+re.substr(1).toLowerCase(),re=="H"&&s))continue;R[0]=="H"?he=!0:he=!1,E[ae]=e.length,e.push({resn:B,x:U,y:k,z:te,elem:re,hetflag:he,altLoc:pe,chain:F,resi:N,icode:j,rescode:N+(j!=" "?"^"+j:""),serial:ae,atom:c,bonds:[],ss:"c",bondOrder:[],properties:{},b:oe,pdbline:A})}else if(R=="SHEET "){C=A.substr(21,1),z=parseInt(A.substr(22,4)),A.substr(32,1),V=parseInt(A.substr(33,4)),C in y||(y[C]={}),y[C][z]="s1";for(var se=z+1;se<V;se++)y[C][se]="s";y[C][V]="s2"}else if(R=="CONECT"){var Ce=parseInt(A.substr(6,5)),_e=E[Ce],Se=e[_e],fe=[11,16,21,26];for(let He=0;He<4;He++){var xe=parseInt(A.substr(fe[He],5)),Ee=E[xe];let X=_e+":"+Ee;var We=e[Ee];if(Se!==void 0&&We!==void 0)if(!I[X])I[X]=1,(Se.bonds.length==0||Se.bonds[Se.bonds.length-1]!=Ee)&&(Se.bonds.push(Ee),Se.bondOrder.push(1));else{I[X]+=1;for(let Z=0;Z<Se.bonds.length;Z++)if(Se.bonds[Z]==Ee){var Ge=I[X];Ge>=4?Se.bondOrder[Z]=1:Se.bondOrder[Z]=Ge}}}}else if(R=="HELIX "){C=A.substr(19,1),z=parseInt(A.substr(21,4)),A.substr(31,1),V=parseInt(A.substr(33,4)),C in y||(y[C]={}),y[C][z]="h1";for(let He=z+1;He<V;He++)y[C][He]="h";y[C][V]="h2"}else if(!t&&R=="REMARK"&&A.substr(13,5)=="BIOMT"){var Ne,Be=new w.Matrix4;for(Ne=1;Ne<=3;Ne++)if(A=x[Ze].replace(/^\s*/,""),parseInt(A.substr(18,1))==Ne)Be.elements[Ne-1]=parseFloat(A.substr(23,10)),Be.elements[Ne-1+4]=parseFloat(A.substr(33,10)),Be.elements[Ne-1+8]=parseFloat(A.substr(43,10)),Be.elements[Ne-1+12]=parseFloat(A.substr(53)),Ze++;else for(;A.substr(13,5)=="BIOMT";)Ze++,A=x[Ze].replace(/^\s*/,"");Be.elements[3]=0,Be.elements[7]=0,Be.elements[11]=0,Be.elements[15]=1,o.symmetries.push(Be),Ze--}else if(R=="CRYST1"){let He,X,Z,J,ce,ue;He=parseFloat(A.substr(7,8)),X=parseFloat(A.substr(16,8)),Z=parseFloat(A.substr(25,8)),J=parseFloat(A.substr(34,6)),ce=parseFloat(A.substr(41,6)),ue=parseFloat(A.substr(48,6)),o.cryst={a:He,b:X,c:Z,alpha:J,beta:ce,gamma:ue}}else if(R=="ANISOU"){let He=parseInt(A.substr(6,5));var Te=E[He],Re=e[Te];if(Re){var Pe=A.substr(30).trim().split(/\s+/),Ue={u11:parseInt(Pe[0]),u22:parseInt(Pe[1]),u33:parseInt(Pe[2]),u12:parseInt(Pe[3]),u13:parseInt(Pe[4]),u23:parseInt(Pe[5])};Re.uMat=Ue}}}if((0,g.validateBonds)(e,E),r&&(0,L.assignPDBBonds)(e),t||(0,_.processSymmetries)(o.symmetries,e,p,o.cryst),a&&!h&&(0,P.computeSecondaryStructure)(e,p.hbondCutoff),!(0,v.isEmpty)(y)){for(let Ze=0;Ze<e.length;Ze++)if(c=e[Ze],c!==void 0&&c.chain in y&&c.resi in y[c.chain]){var ze=y[c.chain][c.resi];c.ss=ze[0],ze.length>1&&(ze[1]=="1"?c.ssbegin=!0:ze[1]=="2"&&(c.ssend=!0))}}return[e,o,u]}},"./src/parsers/utils/isEmpty.ts":($,T,f)=>{f.r(T),f.d(T,{isEmpty:()=>w});function w(S){var O;for(O in S)return!1;return!0}},"./src/parsers/utils/processSymmetries.ts":($,T,f)=>{f.r(T),f.d(T,{processSymmetries:()=>S});var w=f("./src/WebGL/index.ts");function S(O,P,v,_){var L=!v.duplicateAssemblyAtoms,g=P.length,M=g,x,p,y;let e=-1;if(v.normalizeAssembly&&_){let n=(0,w.conversionMatrix3)(_.a,_.b,_.c,_.alpha,_.beta,_.gamma),o=new w.Matrix3;for(o.getInverse3(n),x=0;x<O.length;x++){let c=new w.Vector3(0,0,0);for(y=0;y<g;y++){let I=new w.Vector3(P[y].x,P[y].y,P[y].z);I.applyMatrix4(O[x]),I.applyMatrix3(o),c.add(I)}c.divideScalar(g);const u=[c.x,c.y,c.z];let E=[0,0,0];for(let I=0;I<3;I++){for(;u[I]<-.001;)u[I]+=1,E[I]+=1;for(;u[I]>1.001;)u[I]-=1,E[I]-=1}const A=new w.Vector3(E[0],E[1],E[2]);A.applyMatrix3(n),O[x].isNearlyIdentity()&&A.lengthSq()>.001&&(e=x),O[x].translate(A)}}if(L){if(O.length>1)for(x=0;x<P.length;x++){var a=[];for(p=0;p<O.length;p++)if(!O[p].isNearlyIdentity()){var t=new w.Vector3;t.set(P[x].x,P[x].y,P[x].z),t.applyMatrix4(O[p]),a.push(t)}P[x].symmetries=a}}else{for(y=0;y<g;y++)P[y].sym=-1;for(x=0;x<O.length;x++)if(!O[x].isNearlyIdentity()&&e!=x){let n=new w.Vector3;for(y=0;y<g;y++){var r=[];for(p=0;p<P[y].bonds.length;p++)r.push(P[y].bonds[p]+M);n.set(P[y].x,P[y].y,P[y].z),n.applyMatrix4(O[x]);var s={};for(var h in P[y])s[h]=P[y][h];s.x=n.x,s.y=n.y,s.z=n.z,s.bonds=r,s.sym=x,s.index=P.length,P.push(s)}M=P.length}else for(y=0;y<g;y++)P[y].sym=x;if(e>=0){let n=new w.Vector3;for(y=0;y<g;y++)n.set(P[y].x,P[y].y,P[y].z),n.applyMatrix4(O[e]),P[y].x=n.x,P[y].y=n.y,P[y].z=n.z}O.length=0}}},"./src/parsers/utils/standardResidues.ts":($,T,f)=>{f.r(T),f.d(T,{standardResidues:()=>w});const w=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])},"./src/parsers/utils/validateBonds.ts":($,T,f)=>{f.r(T),f.d(T,{validateBonds:()=>w});function w(S,O){for(var P=0,v=S.length;P<v;P++)for(var _=S[P],L=0;L<_.bonds.length;L++){var g=_.bonds[L],M=S[g],x=O[_.serial];if(M&&x){var p=M.bonds.indexOf(x);p<0&&(M.bonds.push(x),M.bondOrder.push(_.bondOrder[L]))}}}},"./src/partialCharges.ts":($,T,f)=>{f.r(T),f.d(T,{applyPartialCharges:()=>S,partialCharges:()=>w});const w={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55};function S(O,P){if((!P||typeof O.partialCharge>"u")&&O.resn&&O.atom){var v=O.resn+":"+O.atom;O.properties.partialCharge=w[v]}}},"./src/specs.ts":($,T,f)=>{f.r(T)},"./src/utilities.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts");function extend($,T){for(var f in T)T.hasOwnProperty(f)&&T[f]!==void 0&&($[f]=T[f]);return $}function deepCopy($){let T,f,w;if($==null)return{};if(typeof $!="object"||$===null)return $;T=Array.isArray($)?[]:{};for(w in $)f=$[w],T[w]=deepCopy(f);return T}function isNumeric($){var T=typeof $;return(T==="number"||T==="string")&&!isNaN($-parseFloat($))}function isEmptyObject($){var T;for(T in $)return!1;return!0}function makeFunction(callback){return callback&&typeof callback=="string"&&(callback=eval("("+callback+")")),callback&&typeof callback!="function"?null:callback}function adjustVolumeStyle($){$&&($.volformat&&!($.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData)&&($.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData($.voldata,$.volformat)),$.volscheme&&($.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient($.volscheme)))}function getExtent($,T){var f,w,S,O,P,v,_,L,g,M,x=!T;if(f=w=S=9999,O=P=v=-9999,_=L=g=M=0,$.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var p=0;p<$.length;p++){var y=$[p];if(!(typeof y>"u"||!isFinite(y.x)||!isFinite(y.y)||!isFinite(y.z))&&(M++,_+=y.x,L+=y.y,g+=y.z,f=f<y.x?f:y.x,w=w<y.y?w:y.y,S=S<y.z?S:y.z,O=O>y.x?O:y.x,P=P>y.y?P:y.y,v=v>y.z?v:y.z,y.symmetries&&x))for(var e=0;e<y.symmetries.length;e++)M++,_+=y.symmetries[e].x,L+=y.symmetries[e].y,g+=y.symmetries[e].z,f=f<y.symmetries[e].x?f:y.symmetries[e].x,w=w<y.symmetries[e].y?w:y.symmetries[e].y,S=S<y.symmetries[e].z?S:y.symmetries[e].z,O=O>y.symmetries[e].x?O:y.symmetries[e].x,P=P>y.symmetries[e].y?P:y.symmetries[e].y,v=v>y.symmetries[e].z?v:y.symmetries[e].z}return[[f,w,S],[O,P,v],[_/M,L/M,g/M]]}function getPropertyRange($,T){for(var f=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY,S=0,O=$.length;S<O;S++){var P=$[S],v=getAtomProperty(P,T);v!=null&&(v<f&&(f=v),v>w&&(w=v))}return!isFinite(f)&&!isFinite(w)?f=w=0:isFinite(f)?isFinite(w)||(w=f):f=w,[f,w]}class PausableTimer{constructor(T,f,w){this.total_time_run=0,this.fn=T,this.arg=w,this.countdown=f,this.start_time=new Date().getTime(),this.ident=setTimeout(T,f,w)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=new Date().getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray($){for(var T=window.atob($),f=T.length,w=new Uint8Array(f),S=0;S<f;S++)w[S]=T.charCodeAt(S);return w}function getAtomProperty($,T){var f=null;return $.properties&&typeof $.properties[T]<"u"?f=$.properties[T]:typeof $[T]<"u"&&(f=$[T]),f}function mergeGeos($,T){var f=T.geometry;f!==void 0&&$.geometryGroups.push(f.geometryGroups[0])}function specStringToObject($){if(typeof $=="object")return $;if(typeof $>"u"||$==null)return $;try{return JSON.parse($)}catch{}$=$.replace(/%7E/,"~");var T=function(x){return isNumeric(x)?Math.floor(parseFloat(x))==parseInt(x)||x.indexOf(".")>=0?parseFloat(x):parseInt(x):x==="true"?!0:x==="false"?!1:x},f={};if($==="all")return f;for(var w=$.split(";"),S=0;S<w.length;S++){var O=w[S].split(":"),P=O[0],v={},_=O[1];if(_)if(_=_.replace(/~/g,"="),_.indexOf("=")!==-1)for(var L=_.split(","),g=0;g<L.length;g++){var M=L[g].split("=",2);v[M[0]]=T(M[1])}else _.indexOf(",")!==-1?v=_.split(","):v=T(_);f[P]=v}return f}function checkStatus($){if(!$.ok)throw new Error(`HTTP ${$.status} - ${$.statusText}`);return $}function get($,T){var f=fetch($).then(checkStatus).then(w=>w.text());return T?f.then(T):f}function getbin($,T,f,w){var S;return f=="POST"?S=fetch($,{method:"POST",body:w}).then(O=>checkStatus(O)).then(O=>O.arrayBuffer()):S=fetch($).then(O=>checkStatus(O)).then(O=>O.arrayBuffer()),T?S.then(T):S}function download($,T,f,w){var S="",O="",P="",v="",_=null,L=T.addModel();if($.indexOf(":")<0&&($.length==4?$="pdb:"+$:isNaN($)?$="url:"+$:$="cid:"+$),$.substr(0,5)==="mmtf:")O=f&&f.pdbUri?f.pdbUri:"https://mmtf.rcsb.org/v1.0/full/",$=$.substr(5).toUpperCase(),v=O+$,f&&typeof f.noComputeSecondaryStructure>"u"&&(f.noComputeSecondaryStructure=!0),_=new Promise(function(M){getbin(v).then(function(x){L.addMolData(x,"mmtf",f),T.zoomTo(),T.render(),M(L)},function(){console.log("fetch of "+v+" failed.")})});else{if($.substr(0,4)==="pdb:"){if(S="mmtf",f&&f.format&&(S=f.format),f&&typeof f.noComputeSecondaryStructure>"u"&&(f.noComputeSecondaryStructure=!0),$=$.substr(4).toUpperCase(),!$.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}S=="mmtf"?(P=f&&f.mmtfUri?f.mmtfUri:"https://mmtf.rcsb.org/v1.0/full/",v=P+$.toUpperCase()):(O=f&&f.pdbUri?f.pdbUri:"https://files.rcsb.org/view/",v=O+$+"."+S)}else if($.substr(0,4)=="cid:"){if(S="sdf",$=$.substr(4),!$.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}v="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+$+"/SDF?record_type=3d"}else $.substr(0,4)=="url:"&&(v=$.substr(4),S=v);var g=function(M){L.addMolData(M,S,f),T.zoomTo(),T.render()};_=new Promise(function(M){S=="mmtf"?getbin(v).then(function(x){g(x),M(L)}).catch(function(){O=f&&f.pdbUri?f.pdbUri:"https://files.rcsb.org/view/",v=O+$+".pdb",S="pdb",console.log("falling back to pdb format"),get(v).then(function(x){g(x),M(L)}).catch(function(x){g(""),M(L),console.log("fetch of "+v+" failed: "+x.statusText)})}):get(v).then(function(x){g(x),M(L)}).catch(function(x){g(""),M(L),console.log("fetch of "+v+" failed: "+x.statusText)})})}return w?(_.then(function(M){w(M)}),L):_}function getColorFromStyle($,T){let f=T.colorscheme;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[f]<"u")f=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[f];else if(typeof f=="string"&&f.endsWith("Carbon")){let P=f.substring(0,f.lastIndexOf("Carbon")).toLowerCase();if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[P]<"u"){let v=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);v.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[P],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[f]={prop:"elem",map:v},f=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[f]}}let w=$.color;if(typeof T.color<"u"&&T.color!="spectrum"&&(w=T.color),typeof f<"u"){let P,v;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[f]<"u")f=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[f],typeof f[$[f.prop]]<"u"&&(w=f.map[$[f.prop]]);else if(typeof f[$[f.prop]]<"u")w=f.map[$[f.prop]];else if(typeof f.prop<"u"&&typeof f.gradient<"u"){P=f.prop;var S=f.gradient;typeof _Gradient__WEBPACK_IMPORTED_MODULE_0__.builtinGradients[S]<"u"&&(S=new _Gradient__WEBPACK_IMPORTED_MODULE_0__.builtinGradients[S](f.min,f.max,f.mid?f.mid:f.colors));let _=S.range()||[-1,1];v=getAtomProperty($,P),v!=null&&(w=S.valueToHex(v,_))}else typeof f.prop<"u"&&typeof f.map<"u"?(P=f.prop,v=getAtomProperty($,P),typeof f.map[v]<"u"&&(w=f.map[v])):typeof T.colorscheme[$.elem]<"u"?w=T.colorscheme[$.elem]:console.log("Could not interpret colorscheme "+f)}else typeof T.colorfunc<"u"&&(w=T.colorfunc($));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(w)}function getElement($){let T=$;return typeof $=="string"?T=document.querySelector("#"+$):typeof $=="object"&&$.get&&(T=$.get(0)),T}},"./node_modules/upng-js/UPNG.js":($,T,f)=>{(function(){var w={},S;$.exports=w,S=f("./node_modules/upng-js/node_modules/pako/index.js"),function(O,P){O.toRGBA8=function(v){var _=v.width,L=v.height;if(v.tabs.acTL==null)return[O.toRGBA8.decodeImage(v.data,_,L,v).buffer];var g=[];v.frames[0].data==null&&(v.frames[0].data=v.data);for(var M,x=new Uint8Array(_*L*4),p=0;p<v.frames.length;p++){var y=v.frames[p],e=y.rect.x,r=y.rect.y,s=y.rect.width,h=y.rect.height,a=O.toRGBA8.decodeImage(y.data,s,h,v);if(p==0?M=a:y.blend==0?O._copyTile(a,s,h,M,_,L,e,r,0):y.blend==1&&O._copyTile(a,s,h,M,_,L,e,r,1),g.push(M.buffer),M=M.slice(0),y.dispose!=0){if(y.dispose==1)O._copyTile(x,s,h,M,_,L,e,r,0);else if(y.dispose==2){for(var t=p-1;v.frames[t].dispose==2;)t--;M=new Uint8Array(g[t]).slice(0)}}}return g},O.toRGBA8.decodeImage=function(v,_,L,g){var M=_*L,x=O.decode._getBPP(g),p=Math.ceil(_*x/8),y=new Uint8Array(M*4),e=new Uint32Array(y.buffer),r=g.ctype,s=g.depth,h=O._bin.readUshort;if(r==6){var a=M<<2;if(s==8)for(var t=0;t<a;t++)y[t]=v[t];if(s==16)for(var t=0;t<a;t++)y[t]=v[t<<1]}else if(r==2){var n=g.tabs.tRNS,o=-1,c=-1,u=-1;if(n&&(o=n[0],c=n[1],u=n[2]),s==8)for(var t=0;t<M;t++){var E=t<<2,A=t*3;y[E]=v[A],y[E+1]=v[A+1],y[E+2]=v[A+2],y[E+3]=255,o!=-1&&v[A]==o&&v[A+1]==c&&v[A+2]==u&&(y[E+3]=0)}if(s==16)for(var t=0;t<M;t++){var E=t<<2,A=t*6;y[E]=v[A],y[E+1]=v[A+2],y[E+2]=v[A+4],y[E+3]=255,o!=-1&&h(v,A)==o&&h(v,A+2)==c&&h(v,A+4)==u&&(y[E+3]=0)}}else if(r==3){var I=g.tabs.PLTE,R=g.tabs.tRNS,C=R?R.length:0;if(s==1)for(var z=0;z<L;z++)for(var V=z*p,G=z*_,t=0;t<_;t++){var E=G+t<<2,B=v[V+(t>>3)]>>7-((t&7)<<0)&1,F=3*B;y[E]=I[F],y[E+1]=I[F+1],y[E+2]=I[F+2],y[E+3]=B<C?R[B]:255}if(s==2)for(var z=0;z<L;z++)for(var V=z*p,G=z*_,t=0;t<_;t++){var E=G+t<<2,B=v[V+(t>>2)]>>6-((t&3)<<1)&3,F=3*B;y[E]=I[F],y[E+1]=I[F+1],y[E+2]=I[F+2],y[E+3]=B<C?R[B]:255}if(s==4)for(var z=0;z<L;z++)for(var V=z*p,G=z*_,t=0;t<_;t++){var E=G+t<<2,B=v[V+(t>>1)]>>4-((t&1)<<2)&15,F=3*B;y[E]=I[F],y[E+1]=I[F+1],y[E+2]=I[F+2],y[E+3]=B<C?R[B]:255}if(s==8)for(var t=0;t<M;t++){var E=t<<2,B=v[t],F=3*B;y[E]=I[F],y[E+1]=I[F+1],y[E+2]=I[F+2],y[E+3]=B<C?R[B]:255}}else if(r==4){if(s==8)for(var t=0;t<M;t++){var E=t<<2,N=t<<1,j=v[N];y[E]=j,y[E+1]=j,y[E+2]=j,y[E+3]=v[N+1]}if(s==16)for(var t=0;t<M;t++){var E=t<<2,N=t<<2,j=v[N];y[E]=j,y[E+1]=j,y[E+2]=j,y[E+3]=v[N+2]}}else if(r==0){var o=g.tabs.tRNS?g.tabs.tRNS:-1;if(s==1)for(var t=0;t<M;t++){var j=255*(v[t>>3]>>7-(t&7)&1),U=j==o*255?0:255;e[t]=U<<24|j<<16|j<<8|j}if(s==2)for(var t=0;t<M;t++){var j=85*(v[t>>2]>>6-((t&3)<<1)&3),U=j==o*85?0:255;e[t]=U<<24|j<<16|j<<8|j}if(s==4)for(var t=0;t<M;t++){var j=17*(v[t>>1]>>4-((t&1)<<2)&15),U=j==o*17?0:255;e[t]=U<<24|j<<16|j<<8|j}if(s==8)for(var t=0;t<M;t++){var j=v[t],U=j==o?0:255;e[t]=U<<24|j<<16|j<<8|j}if(s==16)for(var t=0;t<M;t++){var j=v[t<<1],U=h(v,t<<1)==o?0:255;e[t]=U<<24|j<<16|j<<8|j}}return y},O.decode=function(v){for(var _=new Uint8Array(v),L=8,g=O._bin,M=g.readUshort,x=g.readUint,p={tabs:{},frames:[]},y=new Uint8Array(_.length),e=0,r,s=0,h=[137,80,78,71,13,10,26,10],a=0;a<8;a++)if(_[a]!=h[a])throw"The input is not a PNG file!";for(;L<_.length;){var t=g.readUint(_,L);L+=4;var n=g.readASCII(_,L,4);if(L+=4,n=="IHDR")O.decode._IHDR(_,L,p);else if(n=="IDAT"){for(var a=0;a<t;a++)y[e+a]=_[L+a];e+=t}else if(n=="acTL")p.tabs[n]={num_frames:x(_,L),num_plays:x(_,L+4)},r=new Uint8Array(_.length);else if(n=="fcTL"){if(s!=0){var o=p.frames[p.frames.length-1];o.data=O.decode._decompress(p,r.slice(0,s),o.rect.width,o.rect.height),s=0}var c={x:x(_,L+12),y:x(_,L+16),width:x(_,L+4),height:x(_,L+8)},u=M(_,L+22);u=M(_,L+20)/(u==0?100:u);var E={rect:c,delay:Math.round(u*1e3),dispose:_[L+24],blend:_[L+25]};p.frames.push(E)}else if(n=="fdAT"){for(var a=0;a<t-4;a++)r[s+a]=_[L+a+4];s+=t-4}else if(n=="pHYs")p.tabs[n]=[g.readUint(_,L),g.readUint(_,L+4),_[L+8]];else if(n=="cHRM"){p.tabs[n]=[];for(var a=0;a<8;a++)p.tabs[n].push(g.readUint(_,L+a*4))}else if(n=="tEXt"){p.tabs[n]==null&&(p.tabs[n]={});var A=g.nextZero(_,L),I=g.readASCII(_,L,A-L),R=g.readASCII(_,A+1,L+t-A-1);p.tabs[n][I]=R}else if(n=="iTXt"){p.tabs[n]==null&&(p.tabs[n]={});var A=0,C=L;A=g.nextZero(_,C);var I=g.readASCII(_,C,A-C);C=A+1,_[C],_[C+1],C+=2,A=g.nextZero(_,C),g.readASCII(_,C,A-C),C=A+1,A=g.nextZero(_,C),g.readUTF8(_,C,A-C),C=A+1;var R=g.readUTF8(_,C,t-(C-L));p.tabs[n][I]=R}else if(n=="PLTE")p.tabs[n]=g.readBytes(_,L,t);else if(n=="hIST"){var z=p.tabs.PLTE.length/3;p.tabs[n]=[];for(var a=0;a<z;a++)p.tabs[n].push(M(_,L+a*2))}else if(n=="tRNS")p.ctype==3?p.tabs[n]=g.readBytes(_,L,t):p.ctype==0?p.tabs[n]=M(_,L):p.ctype==2&&(p.tabs[n]=[M(_,L),M(_,L+2),M(_,L+4)]);else if(n=="gAMA")p.tabs[n]=g.readUint(_,L)/1e5;else if(n=="sRGB")p.tabs[n]=_[L];else if(n=="bKGD")p.ctype==0||p.ctype==4?p.tabs[n]=[M(_,L)]:p.ctype==2||p.ctype==6?p.tabs[n]=[M(_,L),M(_,L+2),M(_,L+4)]:p.ctype==3&&(p.tabs[n]=_[L]);else if(n=="IEND"){if(s!=0){var o=p.frames[p.frames.length-1];o.data=O.decode._decompress(p,r.slice(0,s),o.rect.width,o.rect.height),s=0}p.data=O.decode._decompress(p,y,p.width,p.height);break}L+=t,g.readUint(_,L),L+=4}return delete p.compress,delete p.interlace,delete p.filter,p},O.decode._decompress=function(v,_,L,g){return v.compress==0&&(_=O.decode._inflate(_)),v.interlace==0?_=O.decode._filterZero(_,v,0,L,g):v.interlace==1&&(_=O.decode._readInterlace(_,v)),_},O.decode._inflate=function(v){return P.inflate(v)},O.decode._readInterlace=function(v,_){for(var L=_.width,g=_.height,M=O.decode._getBPP(_),x=M>>3,p=Math.ceil(L*M/8),y=new Uint8Array(g*p),e=0,r=[0,0,4,0,2,0,1],s=[0,4,0,2,0,1,0],h=[8,8,8,4,4,2,2],a=[8,8,4,4,2,2,1],t=0;t<7;){for(var n=h[t],o=a[t],c=0,u=0,E=r[t];E<g;)E+=n,u++;for(var A=s[t];A<L;)A+=o,c++;var I=Math.ceil(c*M/8);O.decode._filterZero(v,_,e,c,u);for(var R=0,C=r[t];C<g;){for(var z=s[t],V=e+R*I<<3;z<L;){if(M==1){var G=v[V>>3];G=G>>7-(V&7)&1,y[C*p+(z>>3)]|=G<<7-((z&3)<<0)}if(M==2){var G=v[V>>3];G=G>>6-(V&7)&3,y[C*p+(z>>2)]|=G<<6-((z&3)<<1)}if(M==4){var G=v[V>>3];G=G>>4-(V&7)&15,y[C*p+(z>>1)]|=G<<4-((z&1)<<2)}if(M>=8)for(var B=C*p+z*x,F=0;F<x;F++)y[B+F]=v[(V>>3)+F];V+=M,z+=o}R++,C+=n}c*u!=0&&(e+=u*(1+I)),t=t+1}return y},O.decode._getBPP=function(v){var _=[1,null,3,1,2,null,4][v.ctype];return _*v.depth},O.decode._filterZero=function(v,_,L,g,M){var x=O.decode._getBPP(_),p=Math.ceil(g*x/8),y=O.decode._paeth;x=Math.ceil(x/8);for(var e=0;e<M;e++){var r=L+e*p,s=r+e+1,h=v[s-1];if(h==0)for(var a=0;a<p;a++)v[r+a]=v[s+a];else if(h==1){for(var a=0;a<x;a++)v[r+a]=v[s+a];for(var a=x;a<p;a++)v[r+a]=v[s+a]+v[r+a-x]&255}else if(e==0){for(var a=0;a<x;a++)v[r+a]=v[s+a];if(h==2)for(var a=x;a<p;a++)v[r+a]=v[s+a]&255;if(h==3)for(var a=x;a<p;a++)v[r+a]=v[s+a]+(v[r+a-x]>>1)&255;if(h==4)for(var a=x;a<p;a++)v[r+a]=v[s+a]+y(v[r+a-x],0,0)&255}else{if(h==2)for(var a=0;a<p;a++)v[r+a]=v[s+a]+v[r+a-p]&255;if(h==3){for(var a=0;a<x;a++)v[r+a]=v[s+a]+(v[r+a-p]>>1)&255;for(var a=x;a<p;a++)v[r+a]=v[s+a]+(v[r+a-p]+v[r+a-x]>>1)&255}if(h==4){for(var a=0;a<x;a++)v[r+a]=v[s+a]+y(0,v[r+a-p],0)&255;for(var a=x;a<p;a++)v[r+a]=v[s+a]+y(v[r+a-x],v[r+a-p],v[r+a-x-p])&255}}}return v},O.decode._paeth=function(v,_,L){var g=v+_-L,M=Math.abs(g-v),x=Math.abs(g-_),p=Math.abs(g-L);return M<=x&&M<=p?v:x<=p?_:L},O.decode._IHDR=function(v,_,L){var g=O._bin;L.width=g.readUint(v,_),_+=4,L.height=g.readUint(v,_),_+=4,L.depth=v[_],_++,L.ctype=v[_],_++,L.compress=v[_],_++,L.filter=v[_],_++,L.interlace=v[_],_++},O._bin={nextZero:function(v,_){for(;v[_]!=0;)_++;return _},readUshort:function(v,_){return v[_]<<8|v[_+1]},writeUshort:function(v,_,L){v[_]=L>>8&255,v[_+1]=L&255},readUint:function(v,_){return v[_]*16777216+(v[_+1]<<16|v[_+2]<<8|v[_+3])},writeUint:function(v,_,L){v[_]=L>>24&255,v[_+1]=L>>16&255,v[_+2]=L>>8&255,v[_+3]=L&255},readASCII:function(v,_,L){for(var g="",M=0;M<L;M++)g+=String.fromCharCode(v[_+M]);return g},writeASCII:function(v,_,L){for(var g=0;g<L.length;g++)v[_+g]=L.charCodeAt(g)},readBytes:function(v,_,L){for(var g=[],M=0;M<L;M++)g.push(v[_+M]);return g},pad:function(v){return v.length<2?"0"+v:v},readUTF8:function(v,_,L){for(var g="",M,x=0;x<L;x++)g+="%"+O._bin.pad(v[_+x].toString(16));try{M=decodeURIComponent(g)}catch{return O._bin.readASCII(v,_,L)}return M}},O._copyTile=function(v,_,L,g,M,x,p,y,e){for(var r=Math.min(_,M),s=Math.min(L,x),h=0,a=0,t=0;t<s;t++)for(var n=0;n<r;n++)if(p>=0&&y>=0?(h=t*_+n<<2,a=(y+t)*M+p+n<<2):(h=(-y+t)*_-p+n<<2,a=t*M+n<<2),e==0)g[a]=v[h],g[a+1]=v[h+1],g[a+2]=v[h+2],g[a+3]=v[h+3];else if(e==1){var o=v[h+3]*.00392156862745098,c=v[h]*o,u=v[h+1]*o,E=v[h+2]*o,A=g[a+3]*(1/255),I=g[a]*A,R=g[a+1]*A,C=g[a+2]*A,z=1-o,V=o+A*z,G=V==0?0:1/V;g[a+3]=255*V,g[a+0]=(c+I*z)*G,g[a+1]=(u+R*z)*G,g[a+2]=(E+C*z)*G}else if(e==2){var o=v[h+3],c=v[h],u=v[h+1],E=v[h+2],A=g[a+3],I=g[a],R=g[a+1],C=g[a+2];o==A&&c==I&&u==R&&E==C?(g[a]=0,g[a+1]=0,g[a+2]=0,g[a+3]=0):(g[a]=c,g[a+1]=u,g[a+2]=E,g[a+3]=o)}else if(e==3){var o=v[h+3],c=v[h],u=v[h+1],E=v[h+2],A=g[a+3],I=g[a],R=g[a+1],C=g[a+2];if(o==A&&c==I&&u==R&&E==C)continue;if(o<220&&A>20)return!1}return!0},O.encode=function(v,_,L,g,M,x){g==null&&(g=0),x==null&&(x=!1);for(var p=new Uint8Array(v[0].byteLength*v.length+100),y=[137,80,78,71,13,10,26,10],e=0;e<8;e++)p[e]=y[e];var r=8,s=O._bin,h=O.crc.crc,a=s.writeUint,t=s.writeUshort,n=s.writeASCII,o=O.encode.compressPNG(v,_,L,g,x);a(p,r,13),r+=4,n(p,r,"IHDR"),r+=4,a(p,r,_),r+=4,a(p,r,L),r+=4,p[r]=o.depth,r++,p[r]=o.ctype,r++,p[r]=0,r++,p[r]=0,r++,p[r]=0,r++,a(p,r,h(p,r-17,17)),r+=4,a(p,r,1),r+=4,n(p,r,"sRGB"),r+=4,p[r]=1,r++,a(p,r,h(p,r-5,5)),r+=4;var c=v.length>1;if(c&&(a(p,r,8),r+=4,n(p,r,"acTL"),r+=4,a(p,r,v.length),r+=4,a(p,r,0),r+=4,a(p,r,h(p,r-12,12)),r+=4),o.ctype==3){var u=o.plte.length;a(p,r,u*3),r+=4,n(p,r,"PLTE"),r+=4;for(var e=0;e<u;e++){var E=e*3,A=o.plte[e],I=A&255,R=A>>8&255,C=A>>16&255;p[r+E+0]=I,p[r+E+1]=R,p[r+E+2]=C}if(r+=u*3,a(p,r,h(p,r-u*3-4,u*3+4)),r+=4,o.gotAlpha){a(p,r,u),r+=4,n(p,r,"tRNS"),r+=4;for(var e=0;e<u;e++)p[r+e]=o.plte[e]>>24&255;r+=u,a(p,r,h(p,r-u-4,u+4)),r+=4}}for(var z=0,V=0;V<o.frames.length;V++){var G=o.frames[V];c&&(a(p,r,26),r+=4,n(p,r,"fcTL"),r+=4,a(p,r,z++),r+=4,a(p,r,G.rect.width),r+=4,a(p,r,G.rect.height),r+=4,a(p,r,G.rect.x),r+=4,a(p,r,G.rect.y),r+=4,t(p,r,M[V]),r+=2,t(p,r,1e3),r+=2,p[r]=G.dispose,r++,p[r]=G.blend,r++,a(p,r,h(p,r-30,30)),r+=4);var B=G.cimg,u=B.length;a(p,r,u+(V==0?0:4)),r+=4;var F=r;n(p,r,V==0?"IDAT":"fdAT"),r+=4,V!=0&&(a(p,r,z++),r+=4);for(var e=0;e<u;e++)p[r+e]=B[e];r+=u,a(p,r,h(p,F,r-F)),r+=4}return a(p,r,0),r+=4,n(p,r,"IEND"),r+=4,a(p,r,h(p,r-4,4)),r+=4,p.buffer.slice(0,r)},O.encode.compressPNG=function(v,_,L,g,M){for(var x=O.encode.compress(v,_,L,g,!1,M),p=0;p<v.length;p++){var y=x.frames[p];y.rect.width;var e=y.rect.height,r=y.bpl,s=y.bpp,h=new Uint8Array(e*r+e);y.cimg=O.encode._filterZero(y.img,e,s,r,h)}return x},O.encode.compress=function(v,_,L,g,M,x){x==null&&(x=!1);for(var p=6,y=8,e=4,r=255,s=0;s<v.length;s++)for(var h=new Uint8Array(v[s]),a=h.length,t=0;t<a;t+=4)r&=h[t+3];var n=r!=255,o={},c=[];if(v.length!=0&&(o[0]=0,c.push(0),g!=0&&g--),g!=0){var u=O.quantize(v,g,M);v=u.bufs;for(var t=0;t<u.plte.length;t++){var E=u.plte[t].est.rgba;o[E]==null&&(o[E]=c.length,c.push(E))}}else for(var s=0;s<v.length;s++)for(var A=new Uint32Array(v[s]),a=A.length,t=0;t<a;t++){var E=A[t];if((t<_||E!=A[t-1]&&E!=A[t-_])&&o[E]==null&&(o[E]=c.length,c.push(E),c.length>=300))break}var I=n?M:!1,R=c.length;R<=256&&x==!1&&(R<=2?y=1:R<=4?y=2:R<=16?y=4:y=8,M&&(y=8),n=!0);for(var C=[],s=0;s<v.length;s++){var z=new Uint8Array(v[s]),V=new Uint32Array(z.buffer),G=0,B=0,F=_,N=L,j=0;if(s!=0&&!I){for(var U=M||s==1||C[C.length-2].dispose==2?1:2,k=0,te=1e9,he=0;he<U;he++){for(var fe=new Uint8Array(v[s-1-he]),re=new Uint32Array(v[s-1-he]),ae=_,pe=L,oe=-1,se=-1,Ce=0;Ce<L;Ce++)for(var _e=0;_e<_;_e++){var t=Ce*_+_e;V[t]!=re[t]&&(_e<ae&&(ae=_e),_e>oe&&(oe=_e),Ce<pe&&(pe=Ce),Ce>se&&(se=Ce))}var Se=oe==-1?1:(oe-ae+1)*(se-pe+1);Se<te&&(te=Se,k=he,oe==-1?(G=B=0,F=N=1):(G=ae,B=pe,F=oe-ae+1,N=se-pe+1))}var fe=new Uint8Array(v[s-1-k]);k==1&&(C[C.length-1].dispose=2);var xe=new Uint8Array(F*N*4);new Uint32Array(xe.buffer),O._copyTile(fe,_,L,xe,F,N,-G,-B,0),O._copyTile(z,_,L,xe,F,N,-G,-B,3)?(O._copyTile(z,_,L,xe,F,N,-G,-B,2),j=1):(O._copyTile(z,_,L,xe,F,N,-G,-B,0),j=0),z=xe,V=new Uint32Array(z.buffer)}var Ee=4*F;if(R<=256&&x==!1){Ee=Math.ceil(y*F/8);for(var xe=new Uint8Array(Ee*N),Ce=0;Ce<N;Ce++){var t=Ce*Ee,We=Ce*F;if(y==8)for(var _e=0;_e<F;_e++)xe[t+_e]=o[V[We+_e]];else if(y==4)for(var _e=0;_e<F;_e++)xe[t+(_e>>1)]|=o[V[We+_e]]<<4-(_e&1)*4;else if(y==2)for(var _e=0;_e<F;_e++)xe[t+(_e>>2)]|=o[V[We+_e]]<<6-(_e&3)*2;else if(y==1)for(var _e=0;_e<F;_e++)xe[t+(_e>>3)]|=o[V[We+_e]]<<7-(_e&7)*1}z=xe,p=3,e=1}else if(n==!1&&v.length==1){for(var xe=new Uint8Array(F*N*3),Ge=F*N,t=0;t<Ge;t++){var Ne=t*3,Be=t*4;xe[Ne]=z[Be],xe[Ne+1]=z[Be+1],xe[Ne+2]=z[Be+2]}z=xe,p=2,e=3,Ee=3*F}C.push({rect:{x:G,y:B,width:F,height:N},img:z,bpl:Ee,bpp:e,blend:j,dispose:I?1:0})}return{ctype:p,depth:y,plte:c,gotAlpha:n,frames:C}},O.encode._filterZero=function(v,_,L,g,M){for(var x=[],p=0;p<5;p++)if(!(_*g>5e5&&(p==2||p==3||p==4))){for(var y=0;y<_;y++)O.encode._filterLine(M,v,y,g,L,p);if(x.push(P.deflate(M)),L==1)break}for(var e,r=1e9,s=0;s<x.length;s++)x[s].length<r&&(e=s,r=x[s].length);return x[e]},O.encode._filterLine=function(v,_,L,g,M,x){var p=L*g,y=p+L,e=O.decode._paeth;if(v[y]=x,y++,x==0)for(var r=0;r<g;r++)v[y+r]=_[p+r];else if(x==1){for(var r=0;r<M;r++)v[y+r]=_[p+r];for(var r=M;r<g;r++)v[y+r]=_[p+r]-_[p+r-M]+256&255}else if(L==0){for(var r=0;r<M;r++)v[y+r]=_[p+r];if(x==2)for(var r=M;r<g;r++)v[y+r]=_[p+r];if(x==3)for(var r=M;r<g;r++)v[y+r]=_[p+r]-(_[p+r-M]>>1)+256&255;if(x==4)for(var r=M;r<g;r++)v[y+r]=_[p+r]-e(_[p+r-M],0,0)+256&255}else{if(x==2)for(var r=0;r<g;r++)v[y+r]=_[p+r]+256-_[p+r-g]&255;if(x==3){for(var r=0;r<M;r++)v[y+r]=_[p+r]+256-(_[p+r-g]>>1)&255;for(var r=M;r<g;r++)v[y+r]=_[p+r]+256-(_[p+r-g]+_[p+r-M]>>1)&255}if(x==4){for(var r=0;r<M;r++)v[y+r]=_[p+r]+256-e(0,_[p+r-g],0)&255;for(var r=M;r<g;r++)v[y+r]=_[p+r]+256-e(_[p+r-M],_[p+r-g],_[p+r-M-g])&255}}},O.crc={table:function(){for(var v=new Uint32Array(256),_=0;_<256;_++){for(var L=_,g=0;g<8;g++)L&1?L=3988292384^L>>>1:L=L>>>1;v[_]=L}return v}(),update:function(v,_,L,g){for(var M=0;M<g;M++)v=O.crc.table[(v^_[L+M])&255]^v>>>8;return v},crc:function(v,_,L){return O.crc.update(4294967295,v,_,L)^4294967295}},O.quantize=function(v,_,L){for(var g=[],M=0,x=0;x<v.length;x++)g.push(O.encode.alphaMul(new Uint8Array(v[x]),L)),M+=v[x].byteLength;for(var p=new Uint8Array(M),y=new Uint32Array(p.buffer),e=0,x=0;x<g.length;x++){for(var r=g[x],s=r.length,h=0;h<s;h++)p[e+h]=r[h];e+=s}var a={i0:0,i1:p.length,bst:null,est:null,tdst:0,left:null,right:null};a.bst=O.quantize.stats(p,a.i0,a.i1),a.est=O.quantize.estats(a.bst);for(var t=[a];t.length<_;){for(var n=0,o=0,x=0;x<t.length;x++)t[x].est.L>n&&(n=t[x].est.L,o=x);if(n<.001)break;var c=t[o],u=O.quantize.splitPixels(p,y,c.i0,c.i1,c.est.e,c.est.eMq255),E={i0:c.i0,i1:u,bst:null,est:null,tdst:0,left:null,right:null};E.bst=O.quantize.stats(p,E.i0,E.i1),E.est=O.quantize.estats(E.bst);var A={i0:u,i1:c.i1,bst:null,est:null,tdst:0,left:null,right:null};A.bst={R:[],m:[],N:c.bst.N-E.bst.N};for(var x=0;x<16;x++)A.bst.R[x]=c.bst.R[x]-E.bst.R[x];for(var x=0;x<4;x++)A.bst.m[x]=c.bst.m[x]-E.bst.m[x];A.est=O.quantize.estats(A.bst),c.left=E,c.right=A,t[o]=E,t.push(A)}t.sort(function(U,k){return k.bst.N-U.bst.N});for(var I=0;I<g.length;I++){for(var R=O.quantize.planeDst,C=new Uint8Array(g[I].buffer),z=new Uint32Array(g[I].buffer),V=C.length,x=0;x<V;x+=4){for(var G=C[x]*.00392156862745098,B=C[x+1]*(1/255),F=C[x+2]*(1/255),N=C[x+3]*(1/255),j=a;j.left;)j=R(j.est,G,B,F,N)<=0?j.left:j.right;z[x>>2]=j.est.rgba}g[I]=z.buffer}return{bufs:g,plte:t}},O.quantize.getNearest=function(v,_,L,g,M){if(v.left==null)return v.tdst=O.quantize.dist(v.est.q,_,L,g,M),v;var x=O.quantize.planeDst(v.est,_,L,g,M),p=v.left,y=v.right;x>0&&(p=v.right,y=v.left);var e=O.quantize.getNearest(p,_,L,g,M);if(e.tdst<=x*x)return e;var r=O.quantize.getNearest(y,_,L,g,M);return r.tdst<e.tdst?r:e},O.quantize.planeDst=function(v,_,L,g,M){var x=v.e;return x[0]*_+x[1]*L+x[2]*g+x[3]*M-v.eMq},O.quantize.dist=function(v,_,L,g,M){var x=_-v[0],p=L-v[1],y=g-v[2],e=M-v[3];return x*x+p*p+y*y+e*e},O.quantize.splitPixels=function(v,_,L,g,M,x){var p=O.quantize.vecDot;for(g-=4;L<g;){for(;p(v,L,M)<=x;)L+=4;for(;p(v,g,M)>x;)g-=4;if(L>=g)break;var y=_[L>>2];_[L>>2]=_[g>>2],_[g>>2]=y,L+=4,g-=4}for(;p(v,L,M)>x;)L-=4;return L+4},O.quantize.vecDot=function(v,_,L){return v[_]*L[0]+v[_+1]*L[1]+v[_+2]*L[2]+v[_+3]*L[3]},O.quantize.stats=function(v,_,L){for(var g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],M=[0,0,0,0],x=L-_>>2,p=_;p<L;p+=4){var y=v[p]*.00392156862745098,e=v[p+1]*(1/255),r=v[p+2]*(1/255),s=v[p+3]*(1/255);M[0]+=y,M[1]+=e,M[2]+=r,M[3]+=s,g[0]+=y*y,g[1]+=y*e,g[2]+=y*r,g[3]+=y*s,g[5]+=e*e,g[6]+=e*r,g[7]+=e*s,g[10]+=r*r,g[11]+=r*s,g[15]+=s*s}return g[4]=g[1],g[8]=g[2],g[12]=g[3],g[9]=g[6],g[13]=g[7],g[14]=g[11],{R:g,m:M,N:x}},O.quantize.estats=function(v){var _=v.R,L=v.m,g=v.N,M=L[0],x=L[1],p=L[2],y=L[3],e=g==0?0:1/g,r=[_[0]-M*M*e,_[1]-M*x*e,_[2]-M*p*e,_[3]-M*y*e,_[4]-x*M*e,_[5]-x*x*e,_[6]-x*p*e,_[7]-x*y*e,_[8]-p*M*e,_[9]-p*x*e,_[10]-p*p*e,_[11]-p*y*e,_[12]-y*M*e,_[13]-y*x*e,_[14]-y*p*e,_[15]-y*y*e],s=r,h=O.M4,a=[.5,.5,.5,.5],t=0,n=0;if(g!=0)for(var o=0;o<10&&(a=h.multVec(s,a),n=Math.sqrt(h.dot(a,a)),a=h.sml(1/n,a),!(Math.abs(n-t)<1e-9));o++)t=n;var c=[M*e,x*e,p*e,y*e],u=h.dot(h.sml(255,c),a),E=c[3]<.001?0:1/c[3];return{Cov:r,q:c,e:a,L:t,eMq255:u,eMq:h.dot(a,c),rgba:(Math.round(255*c[3])<<24|Math.round(255*c[2]*E)<<16|Math.round(255*c[1]*E)<<8|Math.round(255*c[0]*E)<<0)>>>0}},O.M4={multVec:function(v,_){return[v[0]*_[0]+v[1]*_[1]+v[2]*_[2]+v[3]*_[3],v[4]*_[0]+v[5]*_[1]+v[6]*_[2]+v[7]*_[3],v[8]*_[0]+v[9]*_[1]+v[10]*_[2]+v[11]*_[3],v[12]*_[0]+v[13]*_[1]+v[14]*_[2]+v[15]*_[3]]},dot:function(v,_){return v[0]*_[0]+v[1]*_[1]+v[2]*_[2]+v[3]*_[3]},sml:function(v,_){return[v*_[0],v*_[1],v*_[2],v*_[3]]}},O.encode.alphaMul=function(v,_){for(var L=new Uint8Array(v.length),g=v.length>>2,M=0;M<g;M++){var x=M<<2,p=v[x+3];_&&(p=p<128?0:255);var y=p*(1/255);L[x+0]=v[x+0]*y,L[x+1]=v[x+1]*y,L[x+2]=v[x+2]*y,L[x+3]=p}return L}}(w,S)})()},"./node_modules/upng-js/node_modules/pako/index.js":($,T,f)=>{var w=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign,S=f("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),P=f("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),v={};w(v,S,O,P),$.exports=v},"./node_modules/upng-js/node_modules/pako/lib/deflate.js":($,T,f)=>{var w=f("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),S=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),P=f("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),v=f("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),_=Object.prototype.toString,L=0,g=4,M=0,x=1,p=2,y=-1,e=0,r=8;function s(n){if(!(this instanceof s))return new s(n);this.options=S.assign({level:y,method:r,chunkSize:16384,windowBits:15,memLevel:8,strategy:e,to:""},n||{});var o=this.options;o.raw&&o.windowBits>0?o.windowBits=-o.windowBits:o.gzip&&o.windowBits>0&&o.windowBits<16&&(o.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var c=w.deflateInit2(this.strm,o.level,o.method,o.windowBits,o.memLevel,o.strategy);if(c!==M)throw new Error(P[c]);if(o.header&&w.deflateSetHeader(this.strm,o.header),o.dictionary){var u;if(typeof o.dictionary=="string"?u=O.string2buf(o.dictionary):_.call(o.dictionary)==="[object ArrayBuffer]"?u=new Uint8Array(o.dictionary):u=o.dictionary,c=w.deflateSetDictionary(this.strm,u),c!==M)throw new Error(P[c]);this._dict_set=!0}}s.prototype.push=function(n,o){var c=this.strm,u=this.options.chunkSize,E,A;if(this.ended)return!1;A=o===~~o?o:o===!0?g:L,typeof n=="string"?c.input=O.string2buf(n):_.call(n)==="[object ArrayBuffer]"?c.input=new Uint8Array(n):c.input=n,c.next_in=0,c.avail_in=c.input.length;do{if(c.avail_out===0&&(c.output=new S.Buf8(u),c.next_out=0,c.avail_out=u),E=w.deflate(c,A),E!==x&&E!==M)return this.onEnd(E),this.ended=!0,!1;(c.avail_out===0||c.avail_in===0&&(A===g||A===p))&&(this.options.to==="string"?this.onData(O.buf2binstring(S.shrinkBuf(c.output,c.next_out))):this.onData(S.shrinkBuf(c.output,c.next_out)))}while((c.avail_in>0||c.avail_out===0)&&E!==x);return A===g?(E=w.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===M):(A===p&&(this.onEnd(M),c.avail_out=0),!0)},s.prototype.onData=function(n){this.chunks.push(n)},s.prototype.onEnd=function(n){n===M&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function h(n,o){var c=new s(o);if(c.push(n,!0),c.err)throw c.msg||P[c.err];return c.result}function a(n,o){return o=o||{},o.raw=!0,h(n,o)}function t(n,o){return o=o||{},o.gzip=!0,h(n,o)}T.Deflate=s,T.deflate=h,T.deflateRaw=a,T.gzip=t},"./node_modules/upng-js/node_modules/pako/lib/inflate.js":($,T,f)=>{var w=f("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),S=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),P=f("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),v=f("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),_=f("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),L=f("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),g=Object.prototype.toString;function M(y){if(!(this instanceof M))return new M(y);this.options=S.assign({chunkSize:16384,windowBits:0,to:""},y||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(y&&y.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _,this.strm.avail_out=0;var r=w.inflateInit2(this.strm,e.windowBits);if(r!==P.Z_OK)throw new Error(v[r]);if(this.header=new L,w.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=O.string2buf(e.dictionary):g.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=w.inflateSetDictionary(this.strm,e.dictionary),r!==P.Z_OK)))throw new Error(v[r])}M.prototype.push=function(y,e){var r=this.strm,s=this.options.chunkSize,h=this.options.dictionary,a,t,n,o,c,u=!1;if(this.ended)return!1;t=e===~~e?e:e===!0?P.Z_FINISH:P.Z_NO_FLUSH,typeof y=="string"?r.input=O.binstring2buf(y):g.call(y)==="[object ArrayBuffer]"?r.input=new Uint8Array(y):r.input=y,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new S.Buf8(s),r.next_out=0,r.avail_out=s),a=w.inflate(r,P.Z_NO_FLUSH),a===P.Z_NEED_DICT&&h&&(a=w.inflateSetDictionary(this.strm,h)),a===P.Z_BUF_ERROR&&u===!0&&(a=P.Z_OK,u=!1),a!==P.Z_STREAM_END&&a!==P.Z_OK)return this.onEnd(a),this.ended=!0,!1;r.next_out&&(r.avail_out===0||a===P.Z_STREAM_END||r.avail_in===0&&(t===P.Z_FINISH||t===P.Z_SYNC_FLUSH))&&(this.options.to==="string"?(n=O.utf8border(r.output,r.next_out),o=r.next_out-n,c=O.buf2string(r.output,n),r.next_out=o,r.avail_out=s-o,o&&S.arraySet(r.output,r.output,n,o,0),this.onData(c)):this.onData(S.shrinkBuf(r.output,r.next_out))),r.avail_in===0&&r.avail_out===0&&(u=!0)}while((r.avail_in>0||r.avail_out===0)&&a!==P.Z_STREAM_END);return a===P.Z_STREAM_END&&(t=P.Z_FINISH),t===P.Z_FINISH?(a=w.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===P.Z_OK):(t===P.Z_SYNC_FLUSH&&(this.onEnd(P.Z_OK),r.avail_out=0),!0)},M.prototype.onData=function(y){this.chunks.push(y)},M.prototype.onEnd=function(y){y===P.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg};function x(y,e){var r=new M(e);if(r.push(y,!0),r.err)throw r.msg||v[r.err];return r.result}function p(y,e){return e=e||{},e.raw=!0,x(y,e)}T.Inflate=M,T.inflate=x,T.inflateRaw=p,T.ungzip=x},"./node_modules/upng-js/node_modules/pako/lib/utils/common.js":($,T)=>{var f=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function w(P,v){return Object.prototype.hasOwnProperty.call(P,v)}T.assign=function(P){for(var v=Array.prototype.slice.call(arguments,1);v.length;){var _=v.shift();if(_){if(typeof _!="object")throw new TypeError(_+"must be non-object");for(var L in _)w(_,L)&&(P[L]=_[L])}}return P},T.shrinkBuf=function(P,v){return P.length===v?P:P.subarray?P.subarray(0,v):(P.length=v,P)};var S={arraySet:function(P,v,_,L,g){if(v.subarray&&P.subarray){P.set(v.subarray(_,_+L),g);return}for(var M=0;M<L;M++)P[g+M]=v[_+M]},flattenChunks:function(P){var v,_,L,g,M,x;for(L=0,v=0,_=P.length;v<_;v++)L+=P[v].length;for(x=new Uint8Array(L),g=0,v=0,_=P.length;v<_;v++)M=P[v],x.set(M,g),g+=M.length;return x}},O={arraySet:function(P,v,_,L,g){for(var M=0;M<L;M++)P[g+M]=v[_+M]},flattenChunks:function(P){return[].concat.apply([],P)}};T.setTyped=function(P){P?(T.Buf8=Uint8Array,T.Buf16=Uint16Array,T.Buf32=Int32Array,T.assign(T,S)):(T.Buf8=Array,T.Buf16=Array,T.Buf32=Array,T.assign(T,O))},T.setTyped(f)},"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js":($,T,f)=>{var w=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=!0,O=!0;try{String.fromCharCode.apply(null,[0])}catch{S=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{O=!1}for(var P=new w.Buf8(256),v=0;v<256;v++)P[v]=v>=252?6:v>=248?5:v>=240?4:v>=224?3:v>=192?2:1;P[254]=P[254]=1,T.string2buf=function(L){var g,M,x,p,y,e=L.length,r=0;for(p=0;p<e;p++)M=L.charCodeAt(p),(M&64512)===55296&&p+1<e&&(x=L.charCodeAt(p+1),(x&64512)===56320&&(M=65536+(M-55296<<10)+(x-56320),p++)),r+=M<128?1:M<2048?2:M<65536?3:4;for(g=new w.Buf8(r),y=0,p=0;y<r;p++)M=L.charCodeAt(p),(M&64512)===55296&&p+1<e&&(x=L.charCodeAt(p+1),(x&64512)===56320&&(M=65536+(M-55296<<10)+(x-56320),p++)),M<128?g[y++]=M:M<2048?(g[y++]=192|M>>>6,g[y++]=128|M&63):M<65536?(g[y++]=224|M>>>12,g[y++]=128|M>>>6&63,g[y++]=128|M&63):(g[y++]=240|M>>>18,g[y++]=128|M>>>12&63,g[y++]=128|M>>>6&63,g[y++]=128|M&63);return g};function _(L,g){if(g<65534&&(L.subarray&&O||!L.subarray&&S))return String.fromCharCode.apply(null,w.shrinkBuf(L,g));for(var M="",x=0;x<g;x++)M+=String.fromCharCode(L[x]);return M}T.buf2binstring=function(L){return _(L,L.length)},T.binstring2buf=function(L){for(var g=new w.Buf8(L.length),M=0,x=g.length;M<x;M++)g[M]=L.charCodeAt(M);return g},T.buf2string=function(L,g){var M,x,p,y,e=g||L.length,r=new Array(e*2);for(x=0,M=0;M<e;){if(p=L[M++],p<128){r[x++]=p;continue}if(y=P[p],y>4){r[x++]=65533,M+=y-1;continue}for(p&=y===2?31:y===3?15:7;y>1&&M<e;)p=p<<6|L[M++]&63,y--;if(y>1){r[x++]=65533;continue}p<65536?r[x++]=p:(p-=65536,r[x++]=55296|p>>10&1023,r[x++]=56320|p&1023)}return _(r,x)},T.utf8border=function(L,g){var M;for(g=g||L.length,g>L.length&&(g=L.length),M=g-1;M>=0&&(L[M]&192)===128;)M--;return M<0||M===0?g:M+P[L[M]]>g?M:g}},"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js":$=>{function T(f,w,S,O){for(var P=f&65535|0,v=f>>>16&65535|0,_=0;S!==0;){_=S>2e3?2e3:S,S-=_;do P=P+w[O++]|0,v=v+P|0;while(--_);P%=65521,v%=65521}return P|v<<16|0}$.exports=T},"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js":$=>{$.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js":$=>{function T(){for(var S,O=[],P=0;P<256;P++){S=P;for(var v=0;v<8;v++)S=S&1?3988292384^S>>>1:S>>>1;O[P]=S}return O}var f=T();function w(S,O,P,v){var _=f,L=v+P;S^=-1;for(var g=v;g<L;g++)S=S>>>8^_[(S^O[g])&255];return S^-1}$.exports=w},"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js":($,T,f)=>{var w=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=f("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),P=f("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),v=f("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),_=0,L=1,g=3,M=4,x=5,p=0,y=1,e=-2,r=-3,s=-5,h=-1,a=1,t=2,n=3,o=4,c=0,u=2,E=8,A=9,I=15,R=8,C=29,z=256,V=z+1+C,G=30,B=19,F=2*V+1,N=15,j=3,U=258,k=U+j+1,te=32,he=42,re=69,ae=73,pe=91,oe=103,se=113,Ce=666,_e=1,Se=2,fe=3,xe=4,Ee=3;function We(D,ge){return D.msg=v[ge],ge}function Ge(D){return(D<<1)-(D>4?9:0)}function Ne(D){for(var ge=D.length;--ge>=0;)D[ge]=0}function Be(D){var ge=D.state,be=ge.pending;be>D.avail_out&&(be=D.avail_out),be!==0&&(w.arraySet(D.output,ge.pending_buf,ge.pending_out,be,D.next_out),D.next_out+=be,ge.pending_out+=be,D.total_out+=be,D.avail_out-=be,ge.pending-=be,ge.pending===0&&(ge.pending_out=0))}function Te(D,ge){S._tr_flush_block(D,D.block_start>=0?D.block_start:-1,D.strstart-D.block_start,ge),D.block_start=D.strstart,Be(D.strm)}function Re(D,ge){D.pending_buf[D.pending++]=ge}function Pe(D,ge){D.pending_buf[D.pending++]=ge>>>8&255,D.pending_buf[D.pending++]=ge&255}function Ue(D,ge,be,Y){var ie=D.avail_in;return ie>Y&&(ie=Y),ie===0?0:(D.avail_in-=ie,w.arraySet(ge,D.input,D.next_in,ie,be),D.state.wrap===1?D.adler=O(D.adler,ge,ie,be):D.state.wrap===2&&(D.adler=P(D.adler,ge,ie,be)),D.next_in+=ie,D.total_in+=ie,ie)}function ze(D,ge){var be=D.max_chain_length,Y=D.strstart,ie,ye,Ke=D.prev_length,je=D.nice_match,Ve=D.strstart>D.w_size-k?D.strstart-(D.w_size-k):0,tt=D.window,Mt=D.w_mask,it=D.prev,qe=D.strstart+U,rt=tt[Y+Ke-1],yt=tt[Y+Ke];D.prev_length>=D.good_match&&(be>>=2),je>D.lookahead&&(je=D.lookahead);do if(ie=ge,!(tt[ie+Ke]!==yt||tt[ie+Ke-1]!==rt||tt[ie]!==tt[Y]||tt[++ie]!==tt[Y+1])){Y+=2,ie++;do;while(tt[++Y]===tt[++ie]&&tt[++Y]===tt[++ie]&&tt[++Y]===tt[++ie]&&tt[++Y]===tt[++ie]&&tt[++Y]===tt[++ie]&&tt[++Y]===tt[++ie]&&tt[++Y]===tt[++ie]&&tt[++Y]===tt[++ie]&&Y<qe);if(ye=U-(qe-Y),Y=qe-U,ye>Ke){if(D.match_start=ge,Ke=ye,ye>=je)break;rt=tt[Y+Ke-1],yt=tt[Y+Ke]}}while((ge=it[ge&Mt])>Ve&&--be!==0);return Ke<=D.lookahead?Ke:D.lookahead}function Ze(D){var ge=D.w_size,be,Y,ie,ye,Ke;do{if(ye=D.window_size-D.lookahead-D.strstart,D.strstart>=ge+(ge-k)){w.arraySet(D.window,D.window,ge,ge,0),D.match_start-=ge,D.strstart-=ge,D.block_start-=ge,Y=D.hash_size,be=Y;do ie=D.head[--be],D.head[be]=ie>=ge?ie-ge:0;while(--Y);Y=ge,be=Y;do ie=D.prev[--be],D.prev[be]=ie>=ge?ie-ge:0;while(--Y);ye+=ge}if(D.strm.avail_in===0)break;if(Y=Ue(D.strm,D.window,D.strstart+D.lookahead,ye),D.lookahead+=Y,D.lookahead+D.insert>=j)for(Ke=D.strstart-D.insert,D.ins_h=D.window[Ke],D.ins_h=(D.ins_h<<D.hash_shift^D.window[Ke+1])&D.hash_mask;D.insert&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[Ke+j-1])&D.hash_mask,D.prev[Ke&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=Ke,Ke++,D.insert--,!(D.lookahead+D.insert<j)););}while(D.lookahead<k&&D.strm.avail_in!==0)}function He(D,ge){var be=65535;for(be>D.pending_buf_size-5&&(be=D.pending_buf_size-5);;){if(D.lookahead<=1){if(Ze(D),D.lookahead===0&&ge===_)return _e;if(D.lookahead===0)break}D.strstart+=D.lookahead,D.lookahead=0;var Y=D.block_start+be;if((D.strstart===0||D.strstart>=Y)&&(D.lookahead=D.strstart-Y,D.strstart=Y,Te(D,!1),D.strm.avail_out===0)||D.strstart-D.block_start>=D.w_size-k&&(Te(D,!1),D.strm.avail_out===0))return _e}return D.insert=0,ge===M?(Te(D,!0),D.strm.avail_out===0?fe:xe):(D.strstart>D.block_start&&(Te(D,!1),D.strm.avail_out===0),_e)}function X(D,ge){for(var be,Y;;){if(D.lookahead<k){if(Ze(D),D.lookahead<k&&ge===_)return _e;if(D.lookahead===0)break}if(be=0,D.lookahead>=j&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+j-1])&D.hash_mask,be=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),be!==0&&D.strstart-be<=D.w_size-k&&(D.match_length=ze(D,be)),D.match_length>=j)if(Y=S._tr_tally(D,D.strstart-D.match_start,D.match_length-j),D.lookahead-=D.match_length,D.match_length<=D.max_lazy_match&&D.lookahead>=j){D.match_length--;do D.strstart++,D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+j-1])&D.hash_mask,be=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart;while(--D.match_length!==0);D.strstart++}else D.strstart+=D.match_length,D.match_length=0,D.ins_h=D.window[D.strstart],D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+1])&D.hash_mask;else Y=S._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++;if(Y&&(Te(D,!1),D.strm.avail_out===0))return _e}return D.insert=D.strstart<j-1?D.strstart:j-1,ge===M?(Te(D,!0),D.strm.avail_out===0?fe:xe):D.last_lit&&(Te(D,!1),D.strm.avail_out===0)?_e:Se}function Z(D,ge){for(var be,Y,ie;;){if(D.lookahead<k){if(Ze(D),D.lookahead<k&&ge===_)return _e;if(D.lookahead===0)break}if(be=0,D.lookahead>=j&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+j-1])&D.hash_mask,be=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),D.prev_length=D.match_length,D.prev_match=D.match_start,D.match_length=j-1,be!==0&&D.prev_length<D.max_lazy_match&&D.strstart-be<=D.w_size-k&&(D.match_length=ze(D,be),D.match_length<=5&&(D.strategy===a||D.match_length===j&&D.strstart-D.match_start>4096)&&(D.match_length=j-1)),D.prev_length>=j&&D.match_length<=D.prev_length){ie=D.strstart+D.lookahead-j,Y=S._tr_tally(D,D.strstart-1-D.prev_match,D.prev_length-j),D.lookahead-=D.prev_length-1,D.prev_length-=2;do++D.strstart<=ie&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+j-1])&D.hash_mask,be=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart);while(--D.prev_length!==0);if(D.match_available=0,D.match_length=j-1,D.strstart++,Y&&(Te(D,!1),D.strm.avail_out===0))return _e}else if(D.match_available){if(Y=S._tr_tally(D,0,D.window[D.strstart-1]),Y&&Te(D,!1),D.strstart++,D.lookahead--,D.strm.avail_out===0)return _e}else D.match_available=1,D.strstart++,D.lookahead--}return D.match_available&&(Y=S._tr_tally(D,0,D.window[D.strstart-1]),D.match_available=0),D.insert=D.strstart<j-1?D.strstart:j-1,ge===M?(Te(D,!0),D.strm.avail_out===0?fe:xe):D.last_lit&&(Te(D,!1),D.strm.avail_out===0)?_e:Se}function J(D,ge){for(var be,Y,ie,ye,Ke=D.window;;){if(D.lookahead<=U){if(Ze(D),D.lookahead<=U&&ge===_)return _e;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=j&&D.strstart>0&&(ie=D.strstart-1,Y=Ke[ie],Y===Ke[++ie]&&Y===Ke[++ie]&&Y===Ke[++ie])){ye=D.strstart+U;do;while(Y===Ke[++ie]&&Y===Ke[++ie]&&Y===Ke[++ie]&&Y===Ke[++ie]&&Y===Ke[++ie]&&Y===Ke[++ie]&&Y===Ke[++ie]&&Y===Ke[++ie]&&ie<ye);D.match_length=U-(ye-ie),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=j?(be=S._tr_tally(D,1,D.match_length-j),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(be=S._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),be&&(Te(D,!1),D.strm.avail_out===0))return _e}return D.insert=0,ge===M?(Te(D,!0),D.strm.avail_out===0?fe:xe):D.last_lit&&(Te(D,!1),D.strm.avail_out===0)?_e:Se}function ce(D,ge){for(var be;;){if(D.lookahead===0&&(Ze(D),D.lookahead===0)){if(ge===_)return _e;break}if(D.match_length=0,be=S._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,be&&(Te(D,!1),D.strm.avail_out===0))return _e}return D.insert=0,ge===M?(Te(D,!0),D.strm.avail_out===0?fe:xe):D.last_lit&&(Te(D,!1),D.strm.avail_out===0)?_e:Se}function ue(D,ge,be,Y,ie){this.good_length=D,this.max_lazy=ge,this.nice_length=be,this.max_chain=Y,this.func=ie}var Le;Le=[new ue(0,0,0,0,He),new ue(4,4,8,4,X),new ue(4,5,16,8,X),new ue(4,6,32,32,X),new ue(4,4,16,16,Z),new ue(8,16,32,32,Z),new ue(8,16,128,128,Z),new ue(8,32,128,256,Z),new ue(32,128,258,1024,Z),new ue(32,258,258,4096,Z)];function De(D){D.window_size=2*D.w_size,Ne(D.head),D.max_lazy_match=Le[D.level].max_lazy,D.good_match=Le[D.level].good_length,D.nice_match=Le[D.level].nice_length,D.max_chain_length=Le[D.level].max_chain,D.strstart=0,D.block_start=0,D.lookahead=0,D.insert=0,D.match_length=D.prev_length=j-1,D.match_available=0,D.ins_h=0}function K(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new w.Buf16(F*2),this.dyn_dtree=new w.Buf16((2*G+1)*2),this.bl_tree=new w.Buf16((2*B+1)*2),Ne(this.dyn_ltree),Ne(this.dyn_dtree),Ne(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new w.Buf16(N+1),this.heap=new w.Buf16(2*V+1),Ne(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new w.Buf16(2*V+1),Ne(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function de(D){var ge;return!D||!D.state?We(D,e):(D.total_in=D.total_out=0,D.data_type=u,ge=D.state,ge.pending=0,ge.pending_out=0,ge.wrap<0&&(ge.wrap=-ge.wrap),ge.status=ge.wrap?he:se,D.adler=ge.wrap===2?0:1,ge.last_flush=_,S._tr_init(ge),p)}function me(D){var ge=de(D);return ge===p&&De(D.state),ge}function Ie(D,ge){return!D||!D.state||D.state.wrap!==2?e:(D.state.gzhead=ge,p)}function ne(D,ge,be,Y,ie,ye){if(!D)return e;var Ke=1;if(ge===h&&(ge=6),Y<0?(Ke=0,Y=-Y):Y>15&&(Ke=2,Y-=16),ie<1||ie>A||be!==E||Y<8||Y>15||ge<0||ge>9||ye<0||ye>o)return We(D,e);Y===8&&(Y=9);var je=new K;return D.state=je,je.strm=D,je.wrap=Ke,je.gzhead=null,je.w_bits=Y,je.w_size=1<<je.w_bits,je.w_mask=je.w_size-1,je.hash_bits=ie+7,je.hash_size=1<<je.hash_bits,je.hash_mask=je.hash_size-1,je.hash_shift=~~((je.hash_bits+j-1)/j),je.window=new w.Buf8(je.w_size*2),je.head=new w.Buf16(je.hash_size),je.prev=new w.Buf16(je.w_size),je.lit_bufsize=1<<ie+6,je.pending_buf_size=je.lit_bufsize*4,je.pending_buf=new w.Buf8(je.pending_buf_size),je.d_buf=1*je.lit_bufsize,je.l_buf=3*je.lit_bufsize,je.level=ge,je.strategy=ye,je.method=be,me(D)}function we(D,ge){return ne(D,ge,E,I,R,c)}function H(D,ge){var be,Y,ie,ye;if(!D||!D.state||ge>x||ge<0)return D?We(D,e):e;if(Y=D.state,!D.output||!D.input&&D.avail_in!==0||Y.status===Ce&&ge!==M)return We(D,D.avail_out===0?s:e);if(Y.strm=D,be=Y.last_flush,Y.last_flush=ge,Y.status===he)if(Y.wrap===2)D.adler=0,Re(Y,31),Re(Y,139),Re(Y,8),Y.gzhead?(Re(Y,(Y.gzhead.text?1:0)+(Y.gzhead.hcrc?2:0)+(Y.gzhead.extra?4:0)+(Y.gzhead.name?8:0)+(Y.gzhead.comment?16:0)),Re(Y,Y.gzhead.time&255),Re(Y,Y.gzhead.time>>8&255),Re(Y,Y.gzhead.time>>16&255),Re(Y,Y.gzhead.time>>24&255),Re(Y,Y.level===9?2:Y.strategy>=t||Y.level<2?4:0),Re(Y,Y.gzhead.os&255),Y.gzhead.extra&&Y.gzhead.extra.length&&(Re(Y,Y.gzhead.extra.length&255),Re(Y,Y.gzhead.extra.length>>8&255)),Y.gzhead.hcrc&&(D.adler=P(D.adler,Y.pending_buf,Y.pending,0)),Y.gzindex=0,Y.status=re):(Re(Y,0),Re(Y,0),Re(Y,0),Re(Y,0),Re(Y,0),Re(Y,Y.level===9?2:Y.strategy>=t||Y.level<2?4:0),Re(Y,Ee),Y.status=se);else{var Ke=E+(Y.w_bits-8<<4)<<8,je=-1;Y.strategy>=t||Y.level<2?je=0:Y.level<6?je=1:Y.level===6?je=2:je=3,Ke|=je<<6,Y.strstart!==0&&(Ke|=te),Ke+=31-Ke%31,Y.status=se,Pe(Y,Ke),Y.strstart!==0&&(Pe(Y,D.adler>>>16),Pe(Y,D.adler&65535)),D.adler=1}if(Y.status===re)if(Y.gzhead.extra){for(ie=Y.pending;Y.gzindex<(Y.gzhead.extra.length&65535)&&!(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>ie&&(D.adler=P(D.adler,Y.pending_buf,Y.pending-ie,ie)),Be(D),ie=Y.pending,Y.pending===Y.pending_buf_size));)Re(Y,Y.gzhead.extra[Y.gzindex]&255),Y.gzindex++;Y.gzhead.hcrc&&Y.pending>ie&&(D.adler=P(D.adler,Y.pending_buf,Y.pending-ie,ie)),Y.gzindex===Y.gzhead.extra.length&&(Y.gzindex=0,Y.status=ae)}else Y.status=ae;if(Y.status===ae)if(Y.gzhead.name){ie=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>ie&&(D.adler=P(D.adler,Y.pending_buf,Y.pending-ie,ie)),Be(D),ie=Y.pending,Y.pending===Y.pending_buf_size)){ye=1;break}Y.gzindex<Y.gzhead.name.length?ye=Y.gzhead.name.charCodeAt(Y.gzindex++)&255:ye=0,Re(Y,ye)}while(ye!==0);Y.gzhead.hcrc&&Y.pending>ie&&(D.adler=P(D.adler,Y.pending_buf,Y.pending-ie,ie)),ye===0&&(Y.gzindex=0,Y.status=pe)}else Y.status=pe;if(Y.status===pe)if(Y.gzhead.comment){ie=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>ie&&(D.adler=P(D.adler,Y.pending_buf,Y.pending-ie,ie)),Be(D),ie=Y.pending,Y.pending===Y.pending_buf_size)){ye=1;break}Y.gzindex<Y.gzhead.comment.length?ye=Y.gzhead.comment.charCodeAt(Y.gzindex++)&255:ye=0,Re(Y,ye)}while(ye!==0);Y.gzhead.hcrc&&Y.pending>ie&&(D.adler=P(D.adler,Y.pending_buf,Y.pending-ie,ie)),ye===0&&(Y.status=oe)}else Y.status=oe;if(Y.status===oe&&(Y.gzhead.hcrc?(Y.pending+2>Y.pending_buf_size&&Be(D),Y.pending+2<=Y.pending_buf_size&&(Re(Y,D.adler&255),Re(Y,D.adler>>8&255),D.adler=0,Y.status=se)):Y.status=se),Y.pending!==0){if(Be(D),D.avail_out===0)return Y.last_flush=-1,p}else if(D.avail_in===0&&Ge(ge)<=Ge(be)&&ge!==M)return We(D,s);if(Y.status===Ce&&D.avail_in!==0)return We(D,s);if(D.avail_in!==0||Y.lookahead!==0||ge!==_&&Y.status!==Ce){var Ve=Y.strategy===t?ce(Y,ge):Y.strategy===n?J(Y,ge):Le[Y.level].func(Y,ge);if((Ve===fe||Ve===xe)&&(Y.status=Ce),Ve===_e||Ve===fe)return D.avail_out===0&&(Y.last_flush=-1),p;if(Ve===Se&&(ge===L?S._tr_align(Y):ge!==x&&(S._tr_stored_block(Y,0,0,!1),ge===g&&(Ne(Y.head),Y.lookahead===0&&(Y.strstart=0,Y.block_start=0,Y.insert=0))),Be(D),D.avail_out===0))return Y.last_flush=-1,p}return ge!==M?p:Y.wrap<=0?y:(Y.wrap===2?(Re(Y,D.adler&255),Re(Y,D.adler>>8&255),Re(Y,D.adler>>16&255),Re(Y,D.adler>>24&255),Re(Y,D.total_in&255),Re(Y,D.total_in>>8&255),Re(Y,D.total_in>>16&255),Re(Y,D.total_in>>24&255)):(Pe(Y,D.adler>>>16),Pe(Y,D.adler&65535)),Be(D),Y.wrap>0&&(Y.wrap=-Y.wrap),Y.pending!==0?p:y)}function Oe(D){var ge;return!D||!D.state?e:(ge=D.state.status,ge!==he&&ge!==re&&ge!==ae&&ge!==pe&&ge!==oe&&ge!==se&&ge!==Ce?We(D,e):(D.state=null,ge===se?We(D,r):p))}function ke(D,ge){var be=ge.length,Y,ie,ye,Ke,je,Ve,tt,Mt;if(!D||!D.state||(Y=D.state,Ke=Y.wrap,Ke===2||Ke===1&&Y.status!==he||Y.lookahead))return e;for(Ke===1&&(D.adler=O(D.adler,ge,be,0)),Y.wrap=0,be>=Y.w_size&&(Ke===0&&(Ne(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0),Mt=new w.Buf8(Y.w_size),w.arraySet(Mt,ge,be-Y.w_size,Y.w_size,0),ge=Mt,be=Y.w_size),je=D.avail_in,Ve=D.next_in,tt=D.input,D.avail_in=be,D.next_in=0,D.input=ge,Ze(Y);Y.lookahead>=j;){ie=Y.strstart,ye=Y.lookahead-(j-1);do Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[ie+j-1])&Y.hash_mask,Y.prev[ie&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=ie,ie++;while(--ye);Y.strstart=ie,Y.lookahead=j-1,Ze(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=j-1,Y.match_available=0,D.next_in=Ve,D.input=tt,D.avail_in=je,Y.wrap=Ke,p}T.deflateInit=we,T.deflateInit2=ne,T.deflateReset=me,T.deflateResetKeep=de,T.deflateSetHeader=Ie,T.deflate=H,T.deflateEnd=Oe,T.deflateSetDictionary=ke,T.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js":$=>{function T(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}$.exports=T},"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js":$=>{var T=30,f=12;$.exports=function(S,O){var P,v,_,L,g,M,x,p,y,e,r,s,h,a,t,n,o,c,u,E,A,I,R,C,z;P=S.state,v=S.next_in,C=S.input,_=v+(S.avail_in-5),L=S.next_out,z=S.output,g=L-(O-S.avail_out),M=L+(S.avail_out-257),x=P.dmax,p=P.wsize,y=P.whave,e=P.wnext,r=P.window,s=P.hold,h=P.bits,a=P.lencode,t=P.distcode,n=(1<<P.lenbits)-1,o=(1<<P.distbits)-1;e:do{h<15&&(s+=C[v++]<<h,h+=8,s+=C[v++]<<h,h+=8),c=a[s&n];t:for(;;){if(u=c>>>24,s>>>=u,h-=u,u=c>>>16&255,u===0)z[L++]=c&65535;else if(u&16){E=c&65535,u&=15,u&&(h<u&&(s+=C[v++]<<h,h+=8),E+=s&(1<<u)-1,s>>>=u,h-=u),h<15&&(s+=C[v++]<<h,h+=8,s+=C[v++]<<h,h+=8),c=t[s&o];i:for(;;){if(u=c>>>24,s>>>=u,h-=u,u=c>>>16&255,u&16){if(A=c&65535,u&=15,h<u&&(s+=C[v++]<<h,h+=8,h<u&&(s+=C[v++]<<h,h+=8)),A+=s&(1<<u)-1,A>x){S.msg="invalid distance too far back",P.mode=T;break e}if(s>>>=u,h-=u,u=L-g,A>u){if(u=A-u,u>y&&P.sane){S.msg="invalid distance too far back",P.mode=T;break e}if(I=0,R=r,e===0){if(I+=p-u,u<E){E-=u;do z[L++]=r[I++];while(--u);I=L-A,R=z}}else if(e<u){if(I+=p+e-u,u-=e,u<E){E-=u;do z[L++]=r[I++];while(--u);if(I=0,e<E){u=e,E-=u;do z[L++]=r[I++];while(--u);I=L-A,R=z}}}else if(I+=e-u,u<E){E-=u;do z[L++]=r[I++];while(--u);I=L-A,R=z}for(;E>2;)z[L++]=R[I++],z[L++]=R[I++],z[L++]=R[I++],E-=3;E&&(z[L++]=R[I++],E>1&&(z[L++]=R[I++]))}else{I=L-A;do z[L++]=z[I++],z[L++]=z[I++],z[L++]=z[I++],E-=3;while(E>2);E&&(z[L++]=z[I++],E>1&&(z[L++]=z[I++]))}}else if(u&64){S.msg="invalid distance code",P.mode=T;break e}else{c=t[(c&65535)+(s&(1<<u)-1)];continue i}break}}else if(u&64)if(u&32){P.mode=f;break e}else{S.msg="invalid literal/length code",P.mode=T;break e}else{c=a[(c&65535)+(s&(1<<u)-1)];continue t}break}}while(v<_&&L<M);E=h>>3,v-=E,h-=E<<3,s&=(1<<h)-1,S.next_in=v,S.next_out=L,S.avail_in=v<_?5+(_-v):5-(v-_),S.avail_out=L<M?257+(M-L):257-(L-M),P.hold=s,P.bits=h}},"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js":($,T,f)=>{var w=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=f("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),P=f("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),v=f("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),_=0,L=1,g=2,M=4,x=5,p=6,y=0,e=1,r=2,s=-2,h=-3,a=-4,t=-5,n=8,o=1,c=2,u=3,E=4,A=5,I=6,R=7,C=8,z=9,V=10,G=11,B=12,F=13,N=14,j=15,U=16,k=17,te=18,he=19,re=20,ae=21,pe=22,oe=23,se=24,Ce=25,_e=26,Se=27,fe=28,xe=29,Ee=30,We=31,Ge=32,Ne=852,Be=592,Te=15,Re=Te;function Pe(ne){return(ne>>>24&255)+(ne>>>8&65280)+((ne&65280)<<8)+((ne&255)<<24)}function Ue(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new w.Buf16(320),this.work=new w.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ze(ne){var we;return!ne||!ne.state?s:(we=ne.state,ne.total_in=ne.total_out=we.total=0,ne.msg="",we.wrap&&(ne.adler=we.wrap&1),we.mode=o,we.last=0,we.havedict=0,we.dmax=32768,we.head=null,we.hold=0,we.bits=0,we.lencode=we.lendyn=new w.Buf32(Ne),we.distcode=we.distdyn=new w.Buf32(Be),we.sane=1,we.back=-1,y)}function Ze(ne){var we;return!ne||!ne.state?s:(we=ne.state,we.wsize=0,we.whave=0,we.wnext=0,ze(ne))}function He(ne,we){var H,Oe;return!ne||!ne.state||(Oe=ne.state,we<0?(H=0,we=-we):(H=(we>>4)+1,we<48&&(we&=15)),we&&(we<8||we>15))?s:(Oe.window!==null&&Oe.wbits!==we&&(Oe.window=null),Oe.wrap=H,Oe.wbits=we,Ze(ne))}function X(ne,we){var H,Oe;return ne?(Oe=new Ue,ne.state=Oe,Oe.window=null,H=He(ne,we),H!==y&&(ne.state=null),H):s}function Z(ne){return X(ne,Re)}var J=!0,ce,ue;function Le(ne){if(J){var we;for(ce=new w.Buf32(512),ue=new w.Buf32(32),we=0;we<144;)ne.lens[we++]=8;for(;we<256;)ne.lens[we++]=9;for(;we<280;)ne.lens[we++]=7;for(;we<288;)ne.lens[we++]=8;for(v(L,ne.lens,0,288,ce,0,ne.work,{bits:9}),we=0;we<32;)ne.lens[we++]=5;v(g,ne.lens,0,32,ue,0,ne.work,{bits:5}),J=!1}ne.lencode=ce,ne.lenbits=9,ne.distcode=ue,ne.distbits=5}function De(ne,we,H,Oe){var ke,D=ne.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new w.Buf8(D.wsize)),Oe>=D.wsize?(w.arraySet(D.window,we,H-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(ke=D.wsize-D.wnext,ke>Oe&&(ke=Oe),w.arraySet(D.window,we,H-Oe,ke,D.wnext),Oe-=ke,Oe?(w.arraySet(D.window,we,H-Oe,Oe,0),D.wnext=Oe,D.whave=D.wsize):(D.wnext+=ke,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=ke))),0}function K(ne,we){var H,Oe,ke,D,ge,be,Y,ie,ye,Ke,je,Ve,tt,Mt,it=0,qe,rt,yt,vt,It,St,_t,mt,gt=new w.Buf8(4),Lt,At,Wt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ne||!ne.state||!ne.output||!ne.input&&ne.avail_in!==0)return s;H=ne.state,H.mode===B&&(H.mode=F),ge=ne.next_out,ke=ne.output,Y=ne.avail_out,D=ne.next_in,Oe=ne.input,be=ne.avail_in,ie=H.hold,ye=H.bits,Ke=be,je=Y,mt=y;e:for(;;)switch(H.mode){case o:if(H.wrap===0){H.mode=F;break}for(;ye<16;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(H.wrap&2&&ie===35615){H.check=0,gt[0]=ie&255,gt[1]=ie>>>8&255,H.check=O(H.check,gt,2,0),ie=0,ye=0,H.mode=c;break}if(H.flags=0,H.head&&(H.head.done=!1),!(H.wrap&1)||(((ie&255)<<8)+(ie>>8))%31){ne.msg="incorrect header check",H.mode=Ee;break}if((ie&15)!==n){ne.msg="unknown compression method",H.mode=Ee;break}if(ie>>>=4,ye-=4,_t=(ie&15)+8,H.wbits===0)H.wbits=_t;else if(_t>H.wbits){ne.msg="invalid window size",H.mode=Ee;break}H.dmax=1<<_t,ne.adler=H.check=1,H.mode=ie&512?V:B,ie=0,ye=0;break;case c:for(;ye<16;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(H.flags=ie,(H.flags&255)!==n){ne.msg="unknown compression method",H.mode=Ee;break}if(H.flags&57344){ne.msg="unknown header flags set",H.mode=Ee;break}H.head&&(H.head.text=ie>>8&1),H.flags&512&&(gt[0]=ie&255,gt[1]=ie>>>8&255,H.check=O(H.check,gt,2,0)),ie=0,ye=0,H.mode=u;case u:for(;ye<32;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}H.head&&(H.head.time=ie),H.flags&512&&(gt[0]=ie&255,gt[1]=ie>>>8&255,gt[2]=ie>>>16&255,gt[3]=ie>>>24&255,H.check=O(H.check,gt,4,0)),ie=0,ye=0,H.mode=E;case E:for(;ye<16;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}H.head&&(H.head.xflags=ie&255,H.head.os=ie>>8),H.flags&512&&(gt[0]=ie&255,gt[1]=ie>>>8&255,H.check=O(H.check,gt,2,0)),ie=0,ye=0,H.mode=A;case A:if(H.flags&1024){for(;ye<16;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}H.length=ie,H.head&&(H.head.extra_len=ie),H.flags&512&&(gt[0]=ie&255,gt[1]=ie>>>8&255,H.check=O(H.check,gt,2,0)),ie=0,ye=0}else H.head&&(H.head.extra=null);H.mode=I;case I:if(H.flags&1024&&(Ve=H.length,Ve>be&&(Ve=be),Ve&&(H.head&&(_t=H.head.extra_len-H.length,H.head.extra||(H.head.extra=new Array(H.head.extra_len)),w.arraySet(H.head.extra,Oe,D,Ve,_t)),H.flags&512&&(H.check=O(H.check,Oe,Ve,D)),be-=Ve,D+=Ve,H.length-=Ve),H.length))break e;H.length=0,H.mode=R;case R:if(H.flags&2048){if(be===0)break e;Ve=0;do _t=Oe[D+Ve++],H.head&&_t&&H.length<65536&&(H.head.name+=String.fromCharCode(_t));while(_t&&Ve<be);if(H.flags&512&&(H.check=O(H.check,Oe,Ve,D)),be-=Ve,D+=Ve,_t)break e}else H.head&&(H.head.name=null);H.length=0,H.mode=C;case C:if(H.flags&4096){if(be===0)break e;Ve=0;do _t=Oe[D+Ve++],H.head&&_t&&H.length<65536&&(H.head.comment+=String.fromCharCode(_t));while(_t&&Ve<be);if(H.flags&512&&(H.check=O(H.check,Oe,Ve,D)),be-=Ve,D+=Ve,_t)break e}else H.head&&(H.head.comment=null);H.mode=z;case z:if(H.flags&512){for(;ye<16;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(ie!==(H.check&65535)){ne.msg="header crc mismatch",H.mode=Ee;break}ie=0,ye=0}H.head&&(H.head.hcrc=H.flags>>9&1,H.head.done=!0),ne.adler=H.check=0,H.mode=B;break;case V:for(;ye<32;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}ne.adler=H.check=Pe(ie),ie=0,ye=0,H.mode=G;case G:if(H.havedict===0)return ne.next_out=ge,ne.avail_out=Y,ne.next_in=D,ne.avail_in=be,H.hold=ie,H.bits=ye,r;ne.adler=H.check=1,H.mode=B;case B:if(we===x||we===p)break e;case F:if(H.last){ie>>>=ye&7,ye-=ye&7,H.mode=Se;break}for(;ye<3;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}switch(H.last=ie&1,ie>>>=1,ye-=1,ie&3){case 0:H.mode=N;break;case 1:if(Le(H),H.mode=re,we===p){ie>>>=2,ye-=2;break e}break;case 2:H.mode=k;break;case 3:ne.msg="invalid block type",H.mode=Ee}ie>>>=2,ye-=2;break;case N:for(ie>>>=ye&7,ye-=ye&7;ye<32;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if((ie&65535)!==(ie>>>16^65535)){ne.msg="invalid stored block lengths",H.mode=Ee;break}if(H.length=ie&65535,ie=0,ye=0,H.mode=j,we===p)break e;case j:H.mode=U;case U:if(Ve=H.length,Ve){if(Ve>be&&(Ve=be),Ve>Y&&(Ve=Y),Ve===0)break e;w.arraySet(ke,Oe,D,Ve,ge),be-=Ve,D+=Ve,Y-=Ve,ge+=Ve,H.length-=Ve;break}H.mode=B;break;case k:for(;ye<14;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(H.nlen=(ie&31)+257,ie>>>=5,ye-=5,H.ndist=(ie&31)+1,ie>>>=5,ye-=5,H.ncode=(ie&15)+4,ie>>>=4,ye-=4,H.nlen>286||H.ndist>30){ne.msg="too many length or distance symbols",H.mode=Ee;break}H.have=0,H.mode=te;case te:for(;H.have<H.ncode;){for(;ye<3;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}H.lens[Wt[H.have++]]=ie&7,ie>>>=3,ye-=3}for(;H.have<19;)H.lens[Wt[H.have++]]=0;if(H.lencode=H.lendyn,H.lenbits=7,Lt={bits:H.lenbits},mt=v(_,H.lens,0,19,H.lencode,0,H.work,Lt),H.lenbits=Lt.bits,mt){ne.msg="invalid code lengths set",H.mode=Ee;break}H.have=0,H.mode=he;case he:for(;H.have<H.nlen+H.ndist;){for(;it=H.lencode[ie&(1<<H.lenbits)-1],qe=it>>>24,rt=it>>>16&255,yt=it&65535,!(qe<=ye);){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(yt<16)ie>>>=qe,ye-=qe,H.lens[H.have++]=yt;else{if(yt===16){for(At=qe+2;ye<At;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(ie>>>=qe,ye-=qe,H.have===0){ne.msg="invalid bit length repeat",H.mode=Ee;break}_t=H.lens[H.have-1],Ve=3+(ie&3),ie>>>=2,ye-=2}else if(yt===17){for(At=qe+3;ye<At;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}ie>>>=qe,ye-=qe,_t=0,Ve=3+(ie&7),ie>>>=3,ye-=3}else{for(At=qe+7;ye<At;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}ie>>>=qe,ye-=qe,_t=0,Ve=11+(ie&127),ie>>>=7,ye-=7}if(H.have+Ve>H.nlen+H.ndist){ne.msg="invalid bit length repeat",H.mode=Ee;break}for(;Ve--;)H.lens[H.have++]=_t}}if(H.mode===Ee)break;if(H.lens[256]===0){ne.msg="invalid code -- missing end-of-block",H.mode=Ee;break}if(H.lenbits=9,Lt={bits:H.lenbits},mt=v(L,H.lens,0,H.nlen,H.lencode,0,H.work,Lt),H.lenbits=Lt.bits,mt){ne.msg="invalid literal/lengths set",H.mode=Ee;break}if(H.distbits=6,H.distcode=H.distdyn,Lt={bits:H.distbits},mt=v(g,H.lens,H.nlen,H.ndist,H.distcode,0,H.work,Lt),H.distbits=Lt.bits,mt){ne.msg="invalid distances set",H.mode=Ee;break}if(H.mode=re,we===p)break e;case re:H.mode=ae;case ae:if(be>=6&&Y>=258){ne.next_out=ge,ne.avail_out=Y,ne.next_in=D,ne.avail_in=be,H.hold=ie,H.bits=ye,P(ne,je),ge=ne.next_out,ke=ne.output,Y=ne.avail_out,D=ne.next_in,Oe=ne.input,be=ne.avail_in,ie=H.hold,ye=H.bits,H.mode===B&&(H.back=-1);break}for(H.back=0;it=H.lencode[ie&(1<<H.lenbits)-1],qe=it>>>24,rt=it>>>16&255,yt=it&65535,!(qe<=ye);){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(rt&&!(rt&240)){for(vt=qe,It=rt,St=yt;it=H.lencode[St+((ie&(1<<vt+It)-1)>>vt)],qe=it>>>24,rt=it>>>16&255,yt=it&65535,!(vt+qe<=ye);){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}ie>>>=vt,ye-=vt,H.back+=vt}if(ie>>>=qe,ye-=qe,H.back+=qe,H.length=yt,rt===0){H.mode=_e;break}if(rt&32){H.back=-1,H.mode=B;break}if(rt&64){ne.msg="invalid literal/length code",H.mode=Ee;break}H.extra=rt&15,H.mode=pe;case pe:if(H.extra){for(At=H.extra;ye<At;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}H.length+=ie&(1<<H.extra)-1,ie>>>=H.extra,ye-=H.extra,H.back+=H.extra}H.was=H.length,H.mode=oe;case oe:for(;it=H.distcode[ie&(1<<H.distbits)-1],qe=it>>>24,rt=it>>>16&255,yt=it&65535,!(qe<=ye);){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(!(rt&240)){for(vt=qe,It=rt,St=yt;it=H.distcode[St+((ie&(1<<vt+It)-1)>>vt)],qe=it>>>24,rt=it>>>16&255,yt=it&65535,!(vt+qe<=ye);){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}ie>>>=vt,ye-=vt,H.back+=vt}if(ie>>>=qe,ye-=qe,H.back+=qe,rt&64){ne.msg="invalid distance code",H.mode=Ee;break}H.offset=yt,H.extra=rt&15,H.mode=se;case se:if(H.extra){for(At=H.extra;ye<At;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}H.offset+=ie&(1<<H.extra)-1,ie>>>=H.extra,ye-=H.extra,H.back+=H.extra}if(H.offset>H.dmax){ne.msg="invalid distance too far back",H.mode=Ee;break}H.mode=Ce;case Ce:if(Y===0)break e;if(Ve=je-Y,H.offset>Ve){if(Ve=H.offset-Ve,Ve>H.whave&&H.sane){ne.msg="invalid distance too far back",H.mode=Ee;break}Ve>H.wnext?(Ve-=H.wnext,tt=H.wsize-Ve):tt=H.wnext-Ve,Ve>H.length&&(Ve=H.length),Mt=H.window}else Mt=ke,tt=ge-H.offset,Ve=H.length;Ve>Y&&(Ve=Y),Y-=Ve,H.length-=Ve;do ke[ge++]=Mt[tt++];while(--Ve);H.length===0&&(H.mode=ae);break;case _e:if(Y===0)break e;ke[ge++]=H.length,Y--,H.mode=ae;break;case Se:if(H.wrap){for(;ye<32;){if(be===0)break e;be--,ie|=Oe[D++]<<ye,ye+=8}if(je-=Y,ne.total_out+=je,H.total+=je,je&&(ne.adler=H.check=H.flags?O(H.check,ke,je,ge-je):S(H.check,ke,je,ge-je)),je=Y,(H.flags?ie:Pe(ie))!==H.check){ne.msg="incorrect data check",H.mode=Ee;break}ie=0,ye=0}H.mode=fe;case fe:if(H.wrap&&H.flags){for(;ye<32;){if(be===0)break e;be--,ie+=Oe[D++]<<ye,ye+=8}if(ie!==(H.total&4294967295)){ne.msg="incorrect length check",H.mode=Ee;break}ie=0,ye=0}H.mode=xe;case xe:mt=e;break e;case Ee:mt=h;break e;case We:return a;case Ge:default:return s}return ne.next_out=ge,ne.avail_out=Y,ne.next_in=D,ne.avail_in=be,H.hold=ie,H.bits=ye,(H.wsize||je!==ne.avail_out&&H.mode<Ee&&(H.mode<Se||we!==M))&&De(ne,ne.output,ne.next_out,je-ne.avail_out),Ke-=ne.avail_in,je-=ne.avail_out,ne.total_in+=Ke,ne.total_out+=je,H.total+=je,H.wrap&&je&&(ne.adler=H.check=H.flags?O(H.check,ke,je,ne.next_out-je):S(H.check,ke,je,ne.next_out-je)),ne.data_type=H.bits+(H.last?64:0)+(H.mode===B?128:0)+(H.mode===re||H.mode===j?256:0),(Ke===0&&je===0||we===M)&&mt===y&&(mt=t),mt}function de(ne){if(!ne||!ne.state)return s;var we=ne.state;return we.window&&(we.window=null),ne.state=null,y}function me(ne,we){var H;return!ne||!ne.state||(H=ne.state,!(H.wrap&2))?s:(H.head=we,we.done=!1,y)}function Ie(ne,we){var H=we.length,Oe,ke,D;return!ne||!ne.state||(Oe=ne.state,Oe.wrap!==0&&Oe.mode!==G)?s:Oe.mode===G&&(ke=1,ke=S(ke,we,H,0),ke!==Oe.check)?h:(D=De(ne,we,H,H),D?(Oe.mode=We,a):(Oe.havedict=1,y))}T.inflateReset=Ze,T.inflateReset2=He,T.inflateResetKeep=ze,T.inflateInit=Z,T.inflateInit2=X,T.inflate=K,T.inflateEnd=de,T.inflateGetHeader=me,T.inflateSetDictionary=Ie,T.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js":($,T,f)=>{var w=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=15,O=852,P=592,v=0,_=1,L=2,g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],M=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];$.exports=function(e,r,s,h,a,t,n,o){var c=o.bits,u=0,E=0,A=0,I=0,R=0,C=0,z=0,V=0,G=0,B=0,F,N,j,U,k,te=null,he=0,re,ae=new w.Buf16(S+1),pe=new w.Buf16(S+1),oe=null,se=0,Ce,_e,Se;for(u=0;u<=S;u++)ae[u]=0;for(E=0;E<h;E++)ae[r[s+E]]++;for(R=c,I=S;I>=1&&ae[I]===0;I--);if(R>I&&(R=I),I===0)return a[t++]=20971520,a[t++]=20971520,o.bits=1,0;for(A=1;A<I&&ae[A]===0;A++);for(R<A&&(R=A),V=1,u=1;u<=S;u++)if(V<<=1,V-=ae[u],V<0)return-1;if(V>0&&(e===v||I!==1))return-1;for(pe[1]=0,u=1;u<S;u++)pe[u+1]=pe[u]+ae[u];for(E=0;E<h;E++)r[s+E]!==0&&(n[pe[r[s+E]]++]=E);if(e===v?(te=oe=n,re=19):e===_?(te=g,he-=257,oe=M,se-=257,re=256):(te=x,oe=p,re=-1),B=0,E=0,u=A,k=t,C=R,z=0,j=-1,G=1<<R,U=G-1,e===_&&G>O||e===L&&G>P)return 1;for(;;){Ce=u-z,n[E]<re?(_e=0,Se=n[E]):n[E]>re?(_e=oe[se+n[E]],Se=te[he+n[E]]):(_e=96,Se=0),F=1<<u-z,N=1<<C,A=N;do N-=F,a[k+(B>>z)+N]=Ce<<24|_e<<16|Se|0;while(N!==0);for(F=1<<u-1;B&F;)F>>=1;if(F!==0?(B&=F-1,B+=F):B=0,E++,--ae[u]===0){if(u===I)break;u=r[s+n[E]]}if(u>R&&(B&U)!==j){for(z===0&&(z=R),k+=A,C=u-z,V=1<<C;C+z<I&&(V-=ae[C+z],!(V<=0));)C++,V<<=1;if(G+=1<<C,e===_&&G>O||e===L&&G>P)return 1;j=B&U,a[j]=R<<24|C<<16|k-t|0}}return B!==0&&(a[k+B]=u-z<<24|4194304|0),o.bits=R,0}},"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js":$=>{$.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js":($,T,f)=>{var w=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=4,O=0,P=1,v=2;function _(K){for(var de=K.length;--de>=0;)K[de]=0}var L=0,g=1,M=2,x=3,p=258,y=29,e=256,r=e+1+y,s=30,h=19,a=2*r+1,t=15,n=16,o=7,c=256,u=16,E=17,A=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=512,G=new Array((r+2)*2);_(G);var B=new Array(s*2);_(B);var F=new Array(V);_(F);var N=new Array(p-x+1);_(N);var j=new Array(y);_(j);var U=new Array(s);_(U);function k(K,de,me,Ie,ne){this.static_tree=K,this.extra_bits=de,this.extra_base=me,this.elems=Ie,this.max_length=ne,this.has_stree=K&&K.length}var te,he,re;function ae(K,de){this.dyn_tree=K,this.max_code=0,this.stat_desc=de}function pe(K){return K<256?F[K]:F[256+(K>>>7)]}function oe(K,de){K.pending_buf[K.pending++]=de&255,K.pending_buf[K.pending++]=de>>>8&255}function se(K,de,me){K.bi_valid>n-me?(K.bi_buf|=de<<K.bi_valid&65535,oe(K,K.bi_buf),K.bi_buf=de>>n-K.bi_valid,K.bi_valid+=me-n):(K.bi_buf|=de<<K.bi_valid&65535,K.bi_valid+=me)}function Ce(K,de,me){se(K,me[de*2],me[de*2+1])}function _e(K,de){var me=0;do me|=K&1,K>>>=1,me<<=1;while(--de>0);return me>>>1}function Se(K){K.bi_valid===16?(oe(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):K.bi_valid>=8&&(K.pending_buf[K.pending++]=K.bi_buf&255,K.bi_buf>>=8,K.bi_valid-=8)}function fe(K,de){var me=de.dyn_tree,Ie=de.max_code,ne=de.stat_desc.static_tree,we=de.stat_desc.has_stree,H=de.stat_desc.extra_bits,Oe=de.stat_desc.extra_base,ke=de.stat_desc.max_length,D,ge,be,Y,ie,ye,Ke=0;for(Y=0;Y<=t;Y++)K.bl_count[Y]=0;for(me[K.heap[K.heap_max]*2+1]=0,D=K.heap_max+1;D<a;D++)ge=K.heap[D],Y=me[me[ge*2+1]*2+1]+1,Y>ke&&(Y=ke,Ke++),me[ge*2+1]=Y,!(ge>Ie)&&(K.bl_count[Y]++,ie=0,ge>=Oe&&(ie=H[ge-Oe]),ye=me[ge*2],K.opt_len+=ye*(Y+ie),we&&(K.static_len+=ye*(ne[ge*2+1]+ie)));if(Ke!==0){do{for(Y=ke-1;K.bl_count[Y]===0;)Y--;K.bl_count[Y]--,K.bl_count[Y+1]+=2,K.bl_count[ke]--,Ke-=2}while(Ke>0);for(Y=ke;Y!==0;Y--)for(ge=K.bl_count[Y];ge!==0;)be=K.heap[--D],!(be>Ie)&&(me[be*2+1]!==Y&&(K.opt_len+=(Y-me[be*2+1])*me[be*2],me[be*2+1]=Y),ge--)}}function xe(K,de,me){var Ie=new Array(t+1),ne=0,we,H;for(we=1;we<=t;we++)Ie[we]=ne=ne+me[we-1]<<1;for(H=0;H<=de;H++){var Oe=K[H*2+1];Oe!==0&&(K[H*2]=_e(Ie[Oe]++,Oe))}}function Ee(){var K,de,me,Ie,ne,we=new Array(t+1);for(me=0,Ie=0;Ie<y-1;Ie++)for(j[Ie]=me,K=0;K<1<<I[Ie];K++)N[me++]=Ie;for(N[me-1]=Ie,ne=0,Ie=0;Ie<16;Ie++)for(U[Ie]=ne,K=0;K<1<<R[Ie];K++)F[ne++]=Ie;for(ne>>=7;Ie<s;Ie++)for(U[Ie]=ne<<7,K=0;K<1<<R[Ie]-7;K++)F[256+ne++]=Ie;for(de=0;de<=t;de++)we[de]=0;for(K=0;K<=143;)G[K*2+1]=8,K++,we[8]++;for(;K<=255;)G[K*2+1]=9,K++,we[9]++;for(;K<=279;)G[K*2+1]=7,K++,we[7]++;for(;K<=287;)G[K*2+1]=8,K++,we[8]++;for(xe(G,r+1,we),K=0;K<s;K++)B[K*2+1]=5,B[K*2]=_e(K,5);te=new k(G,I,e+1,r,t),he=new k(B,R,0,s,t),re=new k(new Array(0),C,0,h,o)}function We(K){var de;for(de=0;de<r;de++)K.dyn_ltree[de*2]=0;for(de=0;de<s;de++)K.dyn_dtree[de*2]=0;for(de=0;de<h;de++)K.bl_tree[de*2]=0;K.dyn_ltree[c*2]=1,K.opt_len=K.static_len=0,K.last_lit=K.matches=0}function Ge(K){K.bi_valid>8?oe(K,K.bi_buf):K.bi_valid>0&&(K.pending_buf[K.pending++]=K.bi_buf),K.bi_buf=0,K.bi_valid=0}function Ne(K,de,me,Ie){Ge(K),Ie&&(oe(K,me),oe(K,~me)),w.arraySet(K.pending_buf,K.window,de,me,K.pending),K.pending+=me}function Be(K,de,me,Ie){var ne=de*2,we=me*2;return K[ne]<K[we]||K[ne]===K[we]&&Ie[de]<=Ie[me]}function Te(K,de,me){for(var Ie=K.heap[me],ne=me<<1;ne<=K.heap_len&&(ne<K.heap_len&&Be(de,K.heap[ne+1],K.heap[ne],K.depth)&&ne++,!Be(de,Ie,K.heap[ne],K.depth));)K.heap[me]=K.heap[ne],me=ne,ne<<=1;K.heap[me]=Ie}function Re(K,de,me){var Ie,ne,we=0,H,Oe;if(K.last_lit!==0)do Ie=K.pending_buf[K.d_buf+we*2]<<8|K.pending_buf[K.d_buf+we*2+1],ne=K.pending_buf[K.l_buf+we],we++,Ie===0?Ce(K,ne,de):(H=N[ne],Ce(K,H+e+1,de),Oe=I[H],Oe!==0&&(ne-=j[H],se(K,ne,Oe)),Ie--,H=pe(Ie),Ce(K,H,me),Oe=R[H],Oe!==0&&(Ie-=U[H],se(K,Ie,Oe)));while(we<K.last_lit);Ce(K,c,de)}function Pe(K,de){var me=de.dyn_tree,Ie=de.stat_desc.static_tree,ne=de.stat_desc.has_stree,we=de.stat_desc.elems,H,Oe,ke=-1,D;for(K.heap_len=0,K.heap_max=a,H=0;H<we;H++)me[H*2]!==0?(K.heap[++K.heap_len]=ke=H,K.depth[H]=0):me[H*2+1]=0;for(;K.heap_len<2;)D=K.heap[++K.heap_len]=ke<2?++ke:0,me[D*2]=1,K.depth[D]=0,K.opt_len--,ne&&(K.static_len-=Ie[D*2+1]);for(de.max_code=ke,H=K.heap_len>>1;H>=1;H--)Te(K,me,H);D=we;do H=K.heap[1],K.heap[1]=K.heap[K.heap_len--],Te(K,me,1),Oe=K.heap[1],K.heap[--K.heap_max]=H,K.heap[--K.heap_max]=Oe,me[D*2]=me[H*2]+me[Oe*2],K.depth[D]=(K.depth[H]>=K.depth[Oe]?K.depth[H]:K.depth[Oe])+1,me[H*2+1]=me[Oe*2+1]=D,K.heap[1]=D++,Te(K,me,1);while(K.heap_len>=2);K.heap[--K.heap_max]=K.heap[1],fe(K,de),xe(me,ke,K.bl_count)}function Ue(K,de,me){var Ie,ne=-1,we,H=de[0*2+1],Oe=0,ke=7,D=4;for(H===0&&(ke=138,D=3),de[(me+1)*2+1]=65535,Ie=0;Ie<=me;Ie++)we=H,H=de[(Ie+1)*2+1],!(++Oe<ke&&we===H)&&(Oe<D?K.bl_tree[we*2]+=Oe:we!==0?(we!==ne&&K.bl_tree[we*2]++,K.bl_tree[u*2]++):Oe<=10?K.bl_tree[E*2]++:K.bl_tree[A*2]++,Oe=0,ne=we,H===0?(ke=138,D=3):we===H?(ke=6,D=3):(ke=7,D=4))}function ze(K,de,me){var Ie,ne=-1,we,H=de[0*2+1],Oe=0,ke=7,D=4;for(H===0&&(ke=138,D=3),Ie=0;Ie<=me;Ie++)if(we=H,H=de[(Ie+1)*2+1],!(++Oe<ke&&we===H)){if(Oe<D)do Ce(K,we,K.bl_tree);while(--Oe!==0);else we!==0?(we!==ne&&(Ce(K,we,K.bl_tree),Oe--),Ce(K,u,K.bl_tree),se(K,Oe-3,2)):Oe<=10?(Ce(K,E,K.bl_tree),se(K,Oe-3,3)):(Ce(K,A,K.bl_tree),se(K,Oe-11,7));Oe=0,ne=we,H===0?(ke=138,D=3):we===H?(ke=6,D=3):(ke=7,D=4)}}function Ze(K){var de;for(Ue(K,K.dyn_ltree,K.l_desc.max_code),Ue(K,K.dyn_dtree,K.d_desc.max_code),Pe(K,K.bl_desc),de=h-1;de>=3&&K.bl_tree[z[de]*2+1]===0;de--);return K.opt_len+=3*(de+1)+5+5+4,de}function He(K,de,me,Ie){var ne;for(se(K,de-257,5),se(K,me-1,5),se(K,Ie-4,4),ne=0;ne<Ie;ne++)se(K,K.bl_tree[z[ne]*2+1],3);ze(K,K.dyn_ltree,de-1),ze(K,K.dyn_dtree,me-1)}function X(K){var de=4093624447,me;for(me=0;me<=31;me++,de>>>=1)if(de&1&&K.dyn_ltree[me*2]!==0)return O;if(K.dyn_ltree[18]!==0||K.dyn_ltree[20]!==0||K.dyn_ltree[26]!==0)return P;for(me=32;me<e;me++)if(K.dyn_ltree[me*2]!==0)return P;return O}var Z=!1;function J(K){Z||(Ee(),Z=!0),K.l_desc=new ae(K.dyn_ltree,te),K.d_desc=new ae(K.dyn_dtree,he),K.bl_desc=new ae(K.bl_tree,re),K.bi_buf=0,K.bi_valid=0,We(K)}function ce(K,de,me,Ie){se(K,(L<<1)+(Ie?1:0),3),Ne(K,de,me,!0)}function ue(K){se(K,g<<1,3),Ce(K,c,G),Se(K)}function Le(K,de,me,Ie){var ne,we,H=0;K.level>0?(K.strm.data_type===v&&(K.strm.data_type=X(K)),Pe(K,K.l_desc),Pe(K,K.d_desc),H=Ze(K),ne=K.opt_len+3+7>>>3,we=K.static_len+3+7>>>3,we<=ne&&(ne=we)):ne=we=me+5,me+4<=ne&&de!==-1?ce(K,de,me,Ie):K.strategy===S||we===ne?(se(K,(g<<1)+(Ie?1:0),3),Re(K,G,B)):(se(K,(M<<1)+(Ie?1:0),3),He(K,K.l_desc.max_code+1,K.d_desc.max_code+1,H+1),Re(K,K.dyn_ltree,K.dyn_dtree)),We(K),Ie&&Ge(K)}function De(K,de,me){return K.pending_buf[K.d_buf+K.last_lit*2]=de>>>8&255,K.pending_buf[K.d_buf+K.last_lit*2+1]=de&255,K.pending_buf[K.l_buf+K.last_lit]=me&255,K.last_lit++,de===0?K.dyn_ltree[me*2]++:(K.matches++,de--,K.dyn_ltree[(N[me]+e+1)*2]++,K.dyn_dtree[pe(de)*2]++),K.last_lit===K.lit_bufsize-1}T._tr_init=J,T._tr_stored_block=ce,T._tr_flush_block=Le,T._tr_tally=De,T._tr_align=ue},"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js":$=>{function T(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}$.exports=T},"./src/SurfaceWorker.js":()=>{$3Dmol.workerString=(function(){self.onmessage=function($){var T=$.data,f=T.type;if(f<0)self.atomData=T.atoms,self.volume=T.volume,self.ps=new ProteinSurface;else{var w=self.ps;w.initparm(T.expandedExtent,f!=1,self.volume),w.fillvoxels(self.atomData,T.extendedAtoms),w.buildboundary(),(f===4||f===2)&&(w.fastdistancemap(),w.boundingatom(!1),w.fillvoxelswaals(self.atomData,T.extendedAtoms)),w.marchingcube(f);var S=w.getFacesAndVertices(T.atomsToShow);self.postMessage(S)}}}).toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=`;
`+$3Dmol.Vector3.toString(),$3Dmol.workerString+=`;
`+$3Dmol.MarchingCubeInitializer.toString()+`;
var MarchingCube = new MarchingCubeInitializer();`,$3Dmol.workerString+=`;
`+$3Dmol.PointGrid.toString()+`;
`,$3Dmol.workerString+=`;
var ProteinSurface = `+$3Dmol.ProteinSurface.toString()+`;
`,$3Dmol.workerString=$3Dmol.workerString.replace(/[a-zA-Z_$]{1}[0-9a-zA-Z_$]*WEBPACK_IMPORTED_MODULE_[0-9]__\./g,""),$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0},"./src/exporter.js":$=>{typeof $.exports=="object"&&($.exports=window.$3Dmol)},"./src/vendor/mmtf.js":function($,T){(function(f,w){w(T)})(this,function(f){function w(X,Z,J){for(var ce=(X.byteLength,0),ue=J.length;ue>ce;ce++){var Le=J.charCodeAt(ce);if(128>Le)X.setUint8(Z++,Le>>>0&127|0);else if(2048>Le)X.setUint8(Z++,Le>>>6&31|192),X.setUint8(Z++,Le>>>0&63|128);else if(65536>Le)X.setUint8(Z++,Le>>>12&15|224),X.setUint8(Z++,Le>>>6&63|128),X.setUint8(Z++,Le>>>0&63|128);else{if(!(1114112>Le))throw new Error("bad codepoint "+Le);X.setUint8(Z++,Le>>>18&7|240),X.setUint8(Z++,Le>>>12&63|128),X.setUint8(Z++,Le>>>6&63|128),X.setUint8(Z++,Le>>>0&63|128)}}}function S(X){for(var Z=0,J=0,ce=X.length;ce>J;J++){var ue=X.charCodeAt(J);if(128>ue)Z+=1;else if(2048>ue)Z+=2;else if(65536>ue)Z+=3;else{if(!(1114112>ue))throw new Error("bad codepoint "+ue);Z+=4}}return Z}function O(X,Z,J){var ce=typeof X;if(ce==="string"){var ue=S(X);if(32>ue)return Z.setUint8(J,160|ue),w(Z,J+1,X),1+ue;if(256>ue)return Z.setUint8(J,217),Z.setUint8(J+1,ue),w(Z,J+2,X),2+ue;if(65536>ue)return Z.setUint8(J,218),Z.setUint16(J+1,ue),w(Z,J+3,X),3+ue;if(4294967296>ue)return Z.setUint8(J,219),Z.setUint32(J+1,ue),w(Z,J+5,X),5+ue}if(X instanceof Uint8Array){var ue=X.byteLength,Le=new Uint8Array(Z.buffer);if(256>ue)return Z.setUint8(J,196),Z.setUint8(J+1,ue),Le.set(X,J+2),2+ue;if(65536>ue)return Z.setUint8(J,197),Z.setUint16(J+1,ue),Le.set(X,J+3),3+ue;if(4294967296>ue)return Z.setUint8(J,198),Z.setUint32(J+1,ue),Le.set(X,J+5),5+ue}if(ce==="number"){if(!isFinite(X))throw new Error("Number not finite: "+X);if(Math.floor(X)!==X)return Z.setUint8(J,203),Z.setFloat64(J+1,X),9;if(X>=0){if(128>X)return Z.setUint8(J,X),1;if(256>X)return Z.setUint8(J,204),Z.setUint8(J+1,X),2;if(65536>X)return Z.setUint8(J,205),Z.setUint16(J+1,X),3;if(4294967296>X)return Z.setUint8(J,206),Z.setUint32(J+1,X),5;throw new Error("Number too big 0x"+X.toString(16))}if(X>=-32)return Z.setInt8(J,X),1;if(X>=-128)return Z.setUint8(J,208),Z.setInt8(J+1,X),2;if(X>=-32768)return Z.setUint8(J,209),Z.setInt16(J+1,X),3;if(X>=-2147483648)return Z.setUint8(J,210),Z.setInt32(J+1,X),5;throw new Error("Number too small -0x"+(-X).toString(16).substr(1))}if(X===null)return Z.setUint8(J,192),1;if(ce==="boolean")return Z.setUint8(J,X?195:194),1;if(ce==="object"){var ue,de=0,De=Array.isArray(X);if(De)ue=X.length;else{var K=Object.keys(X);ue=K.length}var de;if(16>ue?(Z.setUint8(J,ue|(De?144:128)),de=1):65536>ue?(Z.setUint8(J,De?220:222),Z.setUint16(J+1,ue),de=3):4294967296>ue&&(Z.setUint8(J,De?221:223),Z.setUint32(J+1,ue),de=5),De)for(var me=0;ue>me;me++)de+=O(X[me],Z,J+de);else for(var me=0;ue>me;me++){var Ie=K[me];de+=O(Ie,Z,J+de),de+=O(X[Ie],Z,J+de)}return de}throw new Error("Unknown type "+ce)}function P(X){var Z=typeof X;if(Z==="string"){var J=S(X);if(32>J)return 1+J;if(256>J)return 2+J;if(65536>J)return 3+J;if(4294967296>J)return 5+J}if(X instanceof Uint8Array){var J=X.byteLength;if(256>J)return 2+J;if(65536>J)return 3+J;if(4294967296>J)return 5+J}if(Z==="number"){if(Math.floor(X)!==X)return 9;if(X>=0){if(128>X)return 1;if(256>X)return 2;if(65536>X)return 3;if(4294967296>X)return 5;throw new Error("Number too big 0x"+X.toString(16))}if(X>=-32)return 1;if(X>=-128)return 2;if(X>=-32768)return 3;if(X>=-2147483648)return 5;throw new Error("Number too small -0x"+X.toString(16).substr(1))}if(Z==="boolean"||X===null)return 1;if(Z==="object"){var J,ce=0;if(Array.isArray(X)){J=X.length;for(var ue=0;J>ue;ue++)ce+=P(X[ue])}else{var Le=Object.keys(X);J=Le.length;for(var ue=0;J>ue;ue++){var De=Le[ue];ce+=P(De)+P(X[De])}}if(16>J)return 1+ce;if(65536>J)return 3+ce;if(4294967296>J)return 5+ce;throw new Error("Array or object too long 0x"+J.toString(16))}throw new Error("Unknown type "+Z)}function v(X){var Z=new ArrayBuffer(P(X)),J=new DataView(Z);return O(X,J,0),new Uint8Array(Z)}function _(X,Z,J){return Z?new X(Z.buffer,Z.byteOffset,Z.byteLength/(J||1)):void 0}function L(X){return _(DataView,X)}function g(X){return _(Uint8Array,X)}function M(X){return _(Int8Array,X)}function x(X){return _(Int32Array,X,4)}function p(X){return _(Float32Array,X,4)}function y(X,Z){var J=X.length/2;Z||(Z=new Int16Array(J));for(var ce=0,ue=0;J>ce;++ce,ue+=2)Z[ce]=X[ue]<<8^X[ue+1]<<0;return Z}function e(X,Z){var J=X.length;Z||(Z=new Uint8Array(2*J));for(var ce=L(Z),ue=0;J>ue;++ue)ce.setInt16(2*ue,X[ue]);return g(Z)}function r(X,Z){var J=X.length/4;Z||(Z=new Int32Array(J));for(var ce=0,ue=0;J>ce;++ce,ue+=4)Z[ce]=X[ue]<<24^X[ue+1]<<16^X[ue+2]<<8^X[ue+3]<<0;return Z}function s(X,Z){var J=X.length;Z||(Z=new Uint8Array(4*J));for(var ce=L(Z),ue=0;J>ue;++ue)ce.setInt32(4*ue,X[ue]);return g(Z)}function h(X,Z){var J=X.length;Z||(Z=new Float32Array(J/4));for(var ce=L(Z),ue=L(X),Le=0,De=0,K=J/4;K>Le;++Le,De+=4)ce.setFloat32(De,ue.getFloat32(De),!0);return Z}function a(X,Z,J){var ce=X.length,ue=1/Z;J||(J=new Float32Array(ce));for(var Le=0;ce>Le;++Le)J[Le]=X[Le]*ue;return J}function t(X,Z,J){var ce=X.length;J||(J=new Int32Array(ce));for(var ue=0;ce>ue;++ue)J[ue]=Math.round(X[ue]*Z);return J}function n(X,Z){var J,ce;if(!Z){var ue=0;for(J=0,ce=X.length;ce>J;J+=2)ue+=X[J+1];Z=new X.constructor(ue)}var Le=0;for(J=0,ce=X.length;ce>J;J+=2)for(var De=X[J],K=X[J+1],de=0;K>de;++de)Z[Le]=De,++Le;return Z}function o(X){if(X.length===0)return new Int32Array;var Z,J,ce=2;for(Z=1,J=X.length;J>Z;++Z)X[Z-1]!==X[Z]&&(ce+=2);var ue=new Int32Array(ce),Le=0,De=1;for(Z=1,J=X.length;J>Z;++Z)X[Z-1]!==X[Z]?(ue[Le]=X[Z-1],ue[Le+1]=De,De=1,Le+=2):++De;return ue[Le]=X[X.length-1],ue[Le+1]=De,ue}function c(X,Z){var J=X.length;Z||(Z=new X.constructor(J)),J&&(Z[0]=X[0]);for(var ce=1;J>ce;++ce)Z[ce]=X[ce]+Z[ce-1];return Z}function u(X,Z){var J=X.length;Z||(Z=new X.constructor(J)),Z[0]=X[0];for(var ce=1;J>ce;++ce)Z[ce]=X[ce]-X[ce-1];return Z}function E(X,Z){var J,ce,ue=X instanceof Int8Array?127:32767,Le=-ue-1,De=X.length;if(!Z){var K=0;for(J=0;De>J;++J)X[J]<ue&&X[J]>Le&&++K;Z=new Int32Array(K)}for(J=0,ce=0;De>J;){for(var de=0;X[J]===ue||X[J]===Le;)de+=X[J],++J;de+=X[J],++J,Z[ce]=de,++ce}return Z}function A(X,Z){var J,ce=Z?127:32767,ue=-ce-1,Le=X.length,De=0;for(J=0;Le>J;++J){var K=X[J];K===0?++De:K>0?(De+=Math.ceil(K/ce),K%ce===0&&(De+=1)):(De+=Math.ceil(K/ue),K%ue===0&&(De+=1))}var de=Z?new Int8Array(De):new Int16Array(De),me=0;for(J=0;Le>J;++J){var K=X[J];if(K>=0)for(;K>=ce;)de[me]=ce,++me,K-=ce;else for(;ue>=K;)de[me]=ue,++me,K-=ue;de[me]=K,++me}return de}function I(X,Z){return c(n(X),Z)}function R(X){return o(u(X))}function C(X,Z,J){return a(n(X,x(J)),Z,J)}function z(X,Z){return o(t(X,Z))}function V(X,Z,J){return a(c(X,x(J)),Z,J)}function G(X,Z,J){return u(t(X,Z),J)}function B(X,Z,J){return a(E(X,x(J)),Z,J)}function F(X,Z,J){var ce=E(X,x(J));return V(ce,Z,p(ce))}function N(X,Z,J){return A(G(X,Z),J)}function j(Le){var Z=L(Le),J=Z.getInt32(0),ce=Z.getInt32(4),ue=Le.subarray(8,12),Le=Le.subarray(12);return[J,Le,ce,ue]}function U(X,Z,J,ce){var ue=new ArrayBuffer(12+ce.byteLength),Le=new Uint8Array(ue),De=new DataView(ue);return De.setInt32(0,X),De.setInt32(4,Z),J&&Le.set(J,8),Le.set(ce,12),Le}function k(X){var Z=X.length,J=g(X);return U(2,Z,void 0,J)}function te(X){var Z=X.length,J=s(X);return U(4,Z,void 0,J)}function he(X,Z){var J=X.length/Z,ce=s([Z]),ue=g(X);return U(5,J,ce,ue)}function re(X){var Z=X.length,J=s(o(X));return U(6,Z,void 0,J)}function ae(X){var Z=X.length,J=s(R(X));return U(8,Z,void 0,J)}function pe(X,Z){var J=X.length,ce=s([Z]),ue=s(z(X,Z));return U(9,J,ce,ue)}function oe(X,Z){var J=X.length,ce=s([Z]),ue=e(N(X,Z));return U(10,J,ce,ue)}function se(X){var Z={};return Te.forEach(function(J){X[J]!==void 0&&(Z[J]=X[J])}),X.bondAtomList&&(Z.bondAtomList=te(X.bondAtomList)),X.bondOrderList&&(Z.bondOrderList=k(X.bondOrderList)),Z.xCoordList=oe(X.xCoordList,1e3),Z.yCoordList=oe(X.yCoordList,1e3),Z.zCoordList=oe(X.zCoordList,1e3),X.bFactorList&&(Z.bFactorList=oe(X.bFactorList,100)),X.atomIdList&&(Z.atomIdList=ae(X.atomIdList)),X.altLocList&&(Z.altLocList=re(X.altLocList)),X.occupancyList&&(Z.occupancyList=pe(X.occupancyList,100)),Z.groupIdList=ae(X.groupIdList),Z.groupTypeList=te(X.groupTypeList),X.secStructList&&(Z.secStructList=k(X.secStructList)),X.insCodeList&&(Z.insCodeList=re(X.insCodeList)),X.sequenceIndexList&&(Z.sequenceIndexList=ae(X.sequenceIndexList)),Z.chainIdList=he(X.chainIdList,4),X.chainNameList&&(Z.chainNameList=he(X.chainNameList,4)),Z}function Ce(X){function Z(de){for(var me={},Ie=0;de>Ie;Ie++){var ne=Le();me[ne]=Le()}return me}function J(de){var me=X.subarray(De,De+de);return De+=de,me}function ce(de){var me=X.subarray(De,De+de);De+=de;var Ie=65535;if(de>Ie){for(var ne=[],we=0;we<me.length;we+=Ie)ne.push(String.fromCharCode.apply(null,me.subarray(we,we+Ie)));return ne.join("")}return String.fromCharCode.apply(null,me)}function ue(de){for(var me=new Array(de),Ie=0;de>Ie;Ie++)me[Ie]=Le();return me}function Le(){var de,me,Ie=X[De];if(!(128&Ie))return De++,Ie;if((240&Ie)===128)return me=15&Ie,De++,Z(me);if((240&Ie)===144)return me=15&Ie,De++,ue(me);if((224&Ie)===160)return me=31&Ie,De++,ce(me);if((224&Ie)===224)return de=K.getInt8(De),De++,de;switch(Ie){case 192:return De++,null;case 194:return De++,!1;case 195:return De++,!0;case 196:return me=K.getUint8(De+1),De+=2,J(me);case 197:return me=K.getUint16(De+1),De+=3,J(me);case 198:return me=K.getUint32(De+1),De+=5,J(me);case 202:return de=K.getFloat32(De+1),De+=5,de;case 203:return de=K.getFloat64(De+1),De+=9,de;case 204:return de=X[De+1],De+=2,de;case 205:return de=K.getUint16(De+1),De+=3,de;case 206:return de=K.getUint32(De+1),De+=5,de;case 208:return de=K.getInt8(De+1),De+=2,de;case 209:return de=K.getInt16(De+1),De+=3,de;case 210:return de=K.getInt32(De+1),De+=5,de;case 217:return me=K.getUint8(De+1),De+=2,ce(me);case 218:return me=K.getUint16(De+1),De+=3,ce(me);case 219:return me=K.getUint32(De+1),De+=5,ce(me);case 220:return me=K.getUint16(De+1),De+=3,ue(me);case 221:return me=K.getUint32(De+1),De+=5,ue(me);case 222:return me=K.getUint16(De+1),De+=3,Z(me);case 223:return me=K.getUint32(De+1),De+=5,Z(me)}throw new Error("Unknown type 0x"+Ie.toString(16))}var De=0,K=new DataView(X.buffer);return Le()}function _e(X,Z,J,ce){switch(X){case 1:return h(Z);case 2:return M(Z);case 3:return y(Z);case 4:return r(Z);case 5:return g(Z);case 6:return n(r(Z),new Uint8Array(J));case 7:return n(r(Z));case 8:return I(r(Z));case 9:return C(r(Z),r(ce)[0]);case 10:return F(y(Z),r(ce)[0]);case 11:return a(y(Z),r(ce)[0]);case 12:return B(y(Z),r(ce)[0]);case 13:return B(M(Z),r(ce)[0]);case 14:return E(y(Z));case 15:return E(M(Z))}}function Se(X,Z){Z=Z||{};var J=Z.ignoreFields,ce={};return Pe.forEach(function(ue){var Le=J?J.indexOf(ue)!==-1:!1,De=X[ue];Le||De===void 0||(De instanceof Uint8Array?ce[ue]=_e.apply(null,j(De)):ce[ue]=De)}),ce}function fe(X){return String.fromCharCode.apply(null,X).replace(/\0/g,"")}function xe(X,Z,J){J=J||{};var ce,ue,Le,De,K,de,me=J.firstModelOnly,Ie=Z.onModel,ne=Z.onChain,we=Z.onGroup,H=Z.onAtom,Oe=Z.onBond,ke=0,D=0,ge=0,be=0,Y=0,ie=-1,ye=X.chainNameList,Ke=X.secStructList,je=X.insCodeList,Ve=X.sequenceIndexList,tt=X.atomIdList,Mt=X.bFactorList,it=X.altLocList,qe=X.occupancyList,rt=X.bondAtomList,yt=X.bondOrderList;for(ce=0,ue=X.chainsPerModel.length;ue>ce&&!(me&&ke>0);++ce){var vt=X.chainsPerModel[ke];for(Ie&&Ie({chainCount:vt,modelIndex:ke}),Le=0;vt>Le;++Le){var It=X.groupsPerChain[D];if(ne){var St=fe(X.chainIdList.subarray(4*D,4*D+4)),_t=null;ye&&(_t=fe(ye.subarray(4*D,4*D+4))),ne({groupCount:It,chainIndex:D,modelIndex:ke,chainId:St,chainName:_t})}for(De=0;It>De;++De){var mt=X.groupList[X.groupTypeList[ge]],gt=mt.atomNameList.length;if(we){var Lt=null;Ke&&(Lt=Ke[ge]);var At=null;X.insCodeList&&(At=String.fromCharCode(je[ge]));var Wt=null;Ve&&(Wt=Ve[ge]),we({atomCount:gt,groupIndex:ge,chainIndex:D,modelIndex:ke,groupId:X.groupIdList[ge],groupType:X.groupTypeList[ge],groupName:mt.groupName,singleLetterCode:mt.singleLetterCode,chemCompType:mt.chemCompType,secStruct:Lt,insCode:At,sequenceIndex:Wt})}for(K=0;gt>K;++K){if(H){var di=null;tt&&(di=tt[be]);var Gt=null;Mt&&(Gt=Mt[be]);var ci=null;it&&(ci=String.fromCharCode(it[be]));var ui=null;qe&&(ui=qe[be]),H({atomIndex:be,groupIndex:ge,chainIndex:D,modelIndex:ke,atomId:di,element:mt.elementList[K],atomName:mt.atomNameList[K],formalCharge:mt.formalChargeList[K],xCoord:X.xCoordList[be],yCoord:X.yCoordList[be],zCoord:X.zCoordList[be],bFactor:Gt,altLoc:ci,occupancy:ui})}be+=1}if(Oe){var vi=mt.bondAtomList;for(K=0,de=mt.bondOrderList.length;de>K;++K)Oe({atomIndex1:be-gt+vi[2*K],atomIndex2:be-gt+vi[2*K+1],bondOrder:mt.bondOrderList[K]})}ge+=1}D+=1}if(Y=ie+1,ie=be-1,Oe&&rt)for(K=0,de=rt.length;de>K;K+=2){var qt=rt[K],gi=rt[K+1];(qt>=Y&&ie>=qt||gi>=Y&&ie>=gi)&&Oe({atomIndex1:qt,atomIndex2:gi,bondOrder:yt?yt[K/2]:null})}ke+=1}}function Ee(X){return v(se(X))}function We(X,Z){X instanceof ArrayBuffer&&(X=new Uint8Array(X));var J;return J=X instanceof Uint8Array?Ce(X):X,Se(J,Z)}function Ge(X,Z,J,ce){function ue(){try{var De=We(Le.response);J(De)}catch(K){ce(K)}}var Le=new XMLHttpRequest;Le.addEventListener("load",ue,!0),Le.addEventListener("error",ce,!0),Le.responseType="arraybuffer",Le.open("GET",Z+X.toUpperCase()),Le.send()}function Ne(X,Z,J){Ge(X,Ze,Z,J)}function Be(X,Z,J){Ge(X,He,Z,J)}var Te=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],Re=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],Pe=Te.concat(Re),Ue="v1.0.1",ze="//mmtf.rcsb.org/v1.0/",Ze=ze+"full/",He=ze+"reduced/";f.encode=Ee,f.decode=We,f.traverse=xe,f.fetch=Ne,f.fetchReduced=Be,f.version=Ue,f.fetchUrl=Ze,f.fetchReducedUrl=He,f.encodeMsgpack=v,f.encodeMmtf=se,f.decodeMsgpack=Ce,f.decodeMmtf=Se})},"./node_modules/pako/dist/pako.esm.mjs":($,T,f)=>{f.r(T),f.d(T,{Deflate:()=>Nr,Inflate:()=>Hr,constants:()=>Xr,default:()=>Hs,deflate:()=>Vr,deflateRaw:()=>kr,gzip:()=>jr,inflate:()=>Kr,inflateRaw:()=>Zr,ungzip:()=>Yr});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const w=4,S=0,O=1,P=2;function v(l){let W=l.length;for(;--W>=0;)l[W]=0}const _=0,L=1,g=2,M=3,x=258,p=29,y=256,e=y+1+p,r=30,s=19,h=2*e+1,a=15,t=16,n=7,o=256,c=16,u=17,E=18,A=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),I=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),R=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),z=512,V=new Array((e+2)*2);v(V);const G=new Array(r*2);v(G);const B=new Array(z);v(B);const F=new Array(x-M+1);v(F);const N=new Array(p);v(N);const j=new Array(r);v(j);function U(l,W,b,Q,ee){this.static_tree=l,this.extra_bits=W,this.extra_base=b,this.elems=Q,this.max_length=ee,this.has_stree=l&&l.length}let k,te,he;function re(l,W){this.dyn_tree=l,this.max_code=0,this.stat_desc=W}const ae=l=>l<256?B[l]:B[256+(l>>>7)],pe=(l,W)=>{l.pending_buf[l.pending++]=W&255,l.pending_buf[l.pending++]=W>>>8&255},oe=(l,W,b)=>{l.bi_valid>t-b?(l.bi_buf|=W<<l.bi_valid&65535,pe(l,l.bi_buf),l.bi_buf=W>>t-l.bi_valid,l.bi_valid+=b-t):(l.bi_buf|=W<<l.bi_valid&65535,l.bi_valid+=b)},se=(l,W,b)=>{oe(l,b[W*2],b[W*2+1])},Ce=(l,W)=>{let b=0;do b|=l&1,l>>>=1,b<<=1;while(--W>0);return b>>>1},_e=l=>{l.bi_valid===16?(pe(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=l.bi_buf&255,l.bi_buf>>=8,l.bi_valid-=8)},Se=(l,W)=>{const b=W.dyn_tree,Q=W.max_code,ee=W.stat_desc.static_tree,q=W.stat_desc.has_stree,Me=W.stat_desc.extra_bits,ve=W.stat_desc.extra_base,$e=W.stat_desc.max_length;let le,Ae,ft,Xe,Fe,Qe,bt=0;for(Xe=0;Xe<=a;Xe++)l.bl_count[Xe]=0;for(b[l.heap[l.heap_max]*2+1]=0,le=l.heap_max+1;le<h;le++)Ae=l.heap[le],Xe=b[b[Ae*2+1]*2+1]+1,Xe>$e&&(Xe=$e,bt++),b[Ae*2+1]=Xe,!(Ae>Q)&&(l.bl_count[Xe]++,Fe=0,Ae>=ve&&(Fe=Me[Ae-ve]),Qe=b[Ae*2],l.opt_len+=Qe*(Xe+Fe),q&&(l.static_len+=Qe*(ee[Ae*2+1]+Fe)));if(bt!==0){do{for(Xe=$e-1;l.bl_count[Xe]===0;)Xe--;l.bl_count[Xe]--,l.bl_count[Xe+1]+=2,l.bl_count[$e]--,bt-=2}while(bt>0);for(Xe=$e;Xe!==0;Xe--)for(Ae=l.bl_count[Xe];Ae!==0;)ft=l.heap[--le],!(ft>Q)&&(b[ft*2+1]!==Xe&&(l.opt_len+=(Xe-b[ft*2+1])*b[ft*2],b[ft*2+1]=Xe),Ae--)}},fe=(l,W,b)=>{const Q=new Array(a+1);let ee=0,q,Me;for(q=1;q<=a;q++)ee=ee+b[q-1]<<1,Q[q]=ee;for(Me=0;Me<=W;Me++){let ve=l[Me*2+1];ve!==0&&(l[Me*2]=Ce(Q[ve]++,ve))}},xe=()=>{let l,W,b,Q,ee;const q=new Array(a+1);for(b=0,Q=0;Q<p-1;Q++)for(N[Q]=b,l=0;l<1<<A[Q];l++)F[b++]=Q;for(F[b-1]=Q,ee=0,Q=0;Q<16;Q++)for(j[Q]=ee,l=0;l<1<<I[Q];l++)B[ee++]=Q;for(ee>>=7;Q<r;Q++)for(j[Q]=ee<<7,l=0;l<1<<I[Q]-7;l++)B[256+ee++]=Q;for(W=0;W<=a;W++)q[W]=0;for(l=0;l<=143;)V[l*2+1]=8,l++,q[8]++;for(;l<=255;)V[l*2+1]=9,l++,q[9]++;for(;l<=279;)V[l*2+1]=7,l++,q[7]++;for(;l<=287;)V[l*2+1]=8,l++,q[8]++;for(fe(V,e+1,q),l=0;l<r;l++)G[l*2+1]=5,G[l*2]=Ce(l,5);k=new U(V,A,y+1,e,a),te=new U(G,I,0,r,a),he=new U(new Array(0),R,0,s,n)},Ee=l=>{let W;for(W=0;W<e;W++)l.dyn_ltree[W*2]=0;for(W=0;W<r;W++)l.dyn_dtree[W*2]=0;for(W=0;W<s;W++)l.bl_tree[W*2]=0;l.dyn_ltree[o*2]=1,l.opt_len=l.static_len=0,l.sym_next=l.matches=0},We=l=>{l.bi_valid>8?pe(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},Ge=(l,W,b,Q)=>{const ee=W*2,q=b*2;return l[ee]<l[q]||l[ee]===l[q]&&Q[W]<=Q[b]},Ne=(l,W,b)=>{const Q=l.heap[b];let ee=b<<1;for(;ee<=l.heap_len&&(ee<l.heap_len&&Ge(W,l.heap[ee+1],l.heap[ee],l.depth)&&ee++,!Ge(W,Q,l.heap[ee],l.depth));)l.heap[b]=l.heap[ee],b=ee,ee<<=1;l.heap[b]=Q},Be=(l,W,b)=>{let Q,ee,q=0,Me,ve;if(l.sym_next!==0)do Q=l.pending_buf[l.sym_buf+q++]&255,Q+=(l.pending_buf[l.sym_buf+q++]&255)<<8,ee=l.pending_buf[l.sym_buf+q++],Q===0?se(l,ee,W):(Me=F[ee],se(l,Me+y+1,W),ve=A[Me],ve!==0&&(ee-=N[Me],oe(l,ee,ve)),Q--,Me=ae(Q),se(l,Me,b),ve=I[Me],ve!==0&&(Q-=j[Me],oe(l,Q,ve)));while(q<l.sym_next);se(l,o,W)},Te=(l,W)=>{const b=W.dyn_tree,Q=W.stat_desc.static_tree,ee=W.stat_desc.has_stree,q=W.stat_desc.elems;let Me,ve,$e=-1,le;for(l.heap_len=0,l.heap_max=h,Me=0;Me<q;Me++)b[Me*2]!==0?(l.heap[++l.heap_len]=$e=Me,l.depth[Me]=0):b[Me*2+1]=0;for(;l.heap_len<2;)le=l.heap[++l.heap_len]=$e<2?++$e:0,b[le*2]=1,l.depth[le]=0,l.opt_len--,ee&&(l.static_len-=Q[le*2+1]);for(W.max_code=$e,Me=l.heap_len>>1;Me>=1;Me--)Ne(l,b,Me);le=q;do Me=l.heap[1],l.heap[1]=l.heap[l.heap_len--],Ne(l,b,1),ve=l.heap[1],l.heap[--l.heap_max]=Me,l.heap[--l.heap_max]=ve,b[le*2]=b[Me*2]+b[ve*2],l.depth[le]=(l.depth[Me]>=l.depth[ve]?l.depth[Me]:l.depth[ve])+1,b[Me*2+1]=b[ve*2+1]=le,l.heap[1]=le++,Ne(l,b,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],Se(l,W),fe(b,$e,l.bl_count)},Re=(l,W,b)=>{let Q,ee=-1,q,Me=W[0*2+1],ve=0,$e=7,le=4;for(Me===0&&($e=138,le=3),W[(b+1)*2+1]=65535,Q=0;Q<=b;Q++)q=Me,Me=W[(Q+1)*2+1],!(++ve<$e&&q===Me)&&(ve<le?l.bl_tree[q*2]+=ve:q!==0?(q!==ee&&l.bl_tree[q*2]++,l.bl_tree[c*2]++):ve<=10?l.bl_tree[u*2]++:l.bl_tree[E*2]++,ve=0,ee=q,Me===0?($e=138,le=3):q===Me?($e=6,le=3):($e=7,le=4))},Pe=(l,W,b)=>{let Q,ee=-1,q,Me=W[0*2+1],ve=0,$e=7,le=4;for(Me===0&&($e=138,le=3),Q=0;Q<=b;Q++)if(q=Me,Me=W[(Q+1)*2+1],!(++ve<$e&&q===Me)){if(ve<le)do se(l,q,l.bl_tree);while(--ve!==0);else q!==0?(q!==ee&&(se(l,q,l.bl_tree),ve--),se(l,c,l.bl_tree),oe(l,ve-3,2)):ve<=10?(se(l,u,l.bl_tree),oe(l,ve-3,3)):(se(l,E,l.bl_tree),oe(l,ve-11,7));ve=0,ee=q,Me===0?($e=138,le=3):q===Me?($e=6,le=3):($e=7,le=4)}},Ue=l=>{let W;for(Re(l,l.dyn_ltree,l.l_desc.max_code),Re(l,l.dyn_dtree,l.d_desc.max_code),Te(l,l.bl_desc),W=s-1;W>=3&&l.bl_tree[C[W]*2+1]===0;W--);return l.opt_len+=3*(W+1)+5+5+4,W},ze=(l,W,b,Q)=>{let ee;for(oe(l,W-257,5),oe(l,b-1,5),oe(l,Q-4,4),ee=0;ee<Q;ee++)oe(l,l.bl_tree[C[ee]*2+1],3);Pe(l,l.dyn_ltree,W-1),Pe(l,l.dyn_dtree,b-1)},Ze=l=>{let W=4093624447,b;for(b=0;b<=31;b++,W>>>=1)if(W&1&&l.dyn_ltree[b*2]!==0)return S;if(l.dyn_ltree[9*2]!==0||l.dyn_ltree[10*2]!==0||l.dyn_ltree[13*2]!==0)return O;for(b=32;b<y;b++)if(l.dyn_ltree[b*2]!==0)return O;return S};let He=!1;const X=l=>{He||(xe(),He=!0),l.l_desc=new re(l.dyn_ltree,k),l.d_desc=new re(l.dyn_dtree,te),l.bl_desc=new re(l.bl_tree,he),l.bi_buf=0,l.bi_valid=0,Ee(l)},Z=(l,W,b,Q)=>{oe(l,(_<<1)+(Q?1:0),3),We(l),pe(l,b),pe(l,~b),b&&l.pending_buf.set(l.window.subarray(W,W+b),l.pending),l.pending+=b},J=l=>{oe(l,L<<1,3),se(l,o,V),_e(l)},ce=(l,W,b,Q)=>{let ee,q,Me=0;l.level>0?(l.strm.data_type===P&&(l.strm.data_type=Ze(l)),Te(l,l.l_desc),Te(l,l.d_desc),Me=Ue(l),ee=l.opt_len+3+7>>>3,q=l.static_len+3+7>>>3,q<=ee&&(ee=q)):ee=q=b+5,b+4<=ee&&W!==-1?Z(l,W,b,Q):l.strategy===w||q===ee?(oe(l,(L<<1)+(Q?1:0),3),Be(l,V,G)):(oe(l,(g<<1)+(Q?1:0),3),ze(l,l.l_desc.max_code+1,l.d_desc.max_code+1,Me+1),Be(l,l.dyn_ltree,l.dyn_dtree)),Ee(l),Q&&We(l)},ue=(l,W,b)=>(l.pending_buf[l.sym_buf+l.sym_next++]=W,l.pending_buf[l.sym_buf+l.sym_next++]=W>>8,l.pending_buf[l.sym_buf+l.sym_next++]=b,W===0?l.dyn_ltree[b*2]++:(l.matches++,W--,l.dyn_ltree[(F[b]+y+1)*2]++,l.dyn_dtree[ae(W)*2]++),l.sym_next===l.sym_end);var Le=X,De=Z,K=ce,de=ue,me=J,Ie={_tr_init:Le,_tr_stored_block:De,_tr_flush_block:K,_tr_tally:de,_tr_align:me},we=(l,W,b,Q)=>{let ee=l&65535|0,q=l>>>16&65535|0,Me=0;for(;b!==0;){Me=b>2e3?2e3:b,b-=Me;do ee=ee+W[Q++]|0,q=q+ee|0;while(--Me);ee%=65521,q%=65521}return ee|q<<16|0};const H=()=>{let l,W=[];for(var b=0;b<256;b++){l=b;for(var Q=0;Q<8;Q++)l=l&1?3988292384^l>>>1:l>>>1;W[b]=l}return W},Oe=new Uint32Array(H());var D=(l,W,b,Q)=>{const ee=Oe,q=Q+b;l^=-1;for(let Me=Q;Me<q;Me++)l=l>>>8^ee[(l^W[Me])&255];return l^-1},ge={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},be={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Y,_tr_stored_block:ie,_tr_flush_block:ye,_tr_tally:Ke,_tr_align:je}=Ie,{Z_NO_FLUSH:Ve,Z_PARTIAL_FLUSH:tt,Z_FULL_FLUSH:Mt,Z_FINISH:it,Z_BLOCK:qe,Z_OK:rt,Z_STREAM_END:yt,Z_STREAM_ERROR:vt,Z_DATA_ERROR:It,Z_BUF_ERROR:St,Z_DEFAULT_COMPRESSION:_t,Z_FILTERED:mt,Z_HUFFMAN_ONLY:gt,Z_RLE:Lt,Z_FIXED:At,Z_DEFAULT_STRATEGY:Wt,Z_UNKNOWN:di,Z_DEFLATED:Gt}=be,ci=9,ui=15,vi=8,qt=29,Li=256+1+qt,Qr=30,Jr=19,qr=2*Li+1,en=15,at=3,Bt=258,Tt=Bt+at+1,tn=32,Zt=42,Ci=57,Di=69,Oi=73,Si=91,Ti=103,Nt=113,ei=666,wt=1,Yt=2,Vt=3,Xt=4,rn=3,kt=(l,W)=>(l.msg=ge[W],W),ji=l=>l*2-(l>4?9:0),Ut=l=>{let W=l.length;for(;--W>=0;)l[W]=0},nn=l=>{let W,b,Q,ee=l.w_size;W=l.hash_size,Q=W;do b=l.head[--Q],l.head[Q]=b>=ee?b-ee:0;while(--W);W=ee,Q=W;do b=l.prev[--Q],l.prev[Q]=b>=ee?b-ee:0;while(--W)};let Ft=(l,W,b)=>(W<<l.hash_shift^b)&l.hash_mask;const Ct=l=>{const W=l.state;let b=W.pending;b>l.avail_out&&(b=l.avail_out),b!==0&&(l.output.set(W.pending_buf.subarray(W.pending_out,W.pending_out+b),l.next_out),l.next_out+=b,W.pending_out+=b,l.total_out+=b,l.avail_out-=b,W.pending-=b,W.pending===0&&(W.pending_out=0))},Dt=(l,W)=>{ye(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,W),l.block_start=l.strstart,Ct(l.strm)},dt=(l,W)=>{l.pending_buf[l.pending++]=W},ti=(l,W)=>{l.pending_buf[l.pending++]=W>>>8&255,l.pending_buf[l.pending++]=W&255},Pi=(l,W,b,Q)=>{let ee=l.avail_in;return ee>Q&&(ee=Q),ee===0?0:(l.avail_in-=ee,W.set(l.input.subarray(l.next_in,l.next_in+ee),b),l.state.wrap===1?l.adler=we(l.adler,W,ee,b):l.state.wrap===2&&(l.adler=D(l.adler,W,ee,b)),l.next_in+=ee,l.total_in+=ee,ee)},Hi=(l,W)=>{let b=l.max_chain_length,Q=l.strstart,ee,q,Me=l.prev_length,ve=l.nice_match;const $e=l.strstart>l.w_size-Tt?l.strstart-(l.w_size-Tt):0,le=l.window,Ae=l.w_mask,ft=l.prev,Xe=l.strstart+Bt;let Fe=le[Q+Me-1],Qe=le[Q+Me];l.prev_length>=l.good_match&&(b>>=2),ve>l.lookahead&&(ve=l.lookahead);do if(ee=W,!(le[ee+Me]!==Qe||le[ee+Me-1]!==Fe||le[ee]!==le[Q]||le[++ee]!==le[Q+1])){Q+=2,ee++;do;while(le[++Q]===le[++ee]&&le[++Q]===le[++ee]&&le[++Q]===le[++ee]&&le[++Q]===le[++ee]&&le[++Q]===le[++ee]&&le[++Q]===le[++ee]&&le[++Q]===le[++ee]&&le[++Q]===le[++ee]&&Q<Xe);if(q=Bt-(Xe-Q),Q=Xe-Bt,q>Me){if(l.match_start=W,Me=q,q>=ve)break;Fe=le[Q+Me-1],Qe=le[Q+Me]}}while((W=ft[W&Ae])>$e&&--b!==0);return Me<=l.lookahead?Me:l.lookahead},$t=l=>{const W=l.w_size;let b,Q,ee;do{if(Q=l.window_size-l.lookahead-l.strstart,l.strstart>=W+(W-Tt)&&(l.window.set(l.window.subarray(W,W+W-Q),0),l.match_start-=W,l.strstart-=W,l.block_start-=W,l.insert>l.strstart&&(l.insert=l.strstart),nn(l),Q+=W),l.strm.avail_in===0)break;if(b=Pi(l.strm,l.window,l.strstart+l.lookahead,Q),l.lookahead+=b,l.lookahead+l.insert>=at)for(ee=l.strstart-l.insert,l.ins_h=l.window[ee],l.ins_h=Ft(l,l.ins_h,l.window[ee+1]);l.insert&&(l.ins_h=Ft(l,l.ins_h,l.window[ee+at-1]),l.prev[ee&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=ee,ee++,l.insert--,!(l.lookahead+l.insert<at)););}while(l.lookahead<Tt&&l.strm.avail_in!==0)},Ki=(l,W)=>{let b=l.pending_buf_size-5>l.w_size?l.w_size:l.pending_buf_size-5,Q,ee,q,Me=0,ve=l.strm.avail_in;do{if(Q=65535,q=l.bi_valid+42>>3,l.strm.avail_out<q||(q=l.strm.avail_out-q,ee=l.strstart-l.block_start,Q>ee+l.strm.avail_in&&(Q=ee+l.strm.avail_in),Q>q&&(Q=q),Q<b&&(Q===0&&W!==it||W===Ve||Q!==ee+l.strm.avail_in)))break;Me=W===it&&Q===ee+l.strm.avail_in?1:0,ie(l,0,0,Me),l.pending_buf[l.pending-4]=Q,l.pending_buf[l.pending-3]=Q>>8,l.pending_buf[l.pending-2]=~Q,l.pending_buf[l.pending-1]=~Q>>8,Ct(l.strm),ee&&(ee>Q&&(ee=Q),l.strm.output.set(l.window.subarray(l.block_start,l.block_start+ee),l.strm.next_out),l.strm.next_out+=ee,l.strm.avail_out-=ee,l.strm.total_out+=ee,l.block_start+=ee,Q-=ee),Q&&(Pi(l.strm,l.strm.output,l.strm.next_out,Q),l.strm.next_out+=Q,l.strm.avail_out-=Q,l.strm.total_out+=Q)}while(Me===0);return ve-=l.strm.avail_in,ve&&(ve>=l.w_size?(l.matches=2,l.window.set(l.strm.input.subarray(l.strm.next_in-l.w_size,l.strm.next_in),0),l.strstart=l.w_size,l.insert=l.strstart):(l.window_size-l.strstart<=ve&&(l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,l.insert>l.strstart&&(l.insert=l.strstart)),l.window.set(l.strm.input.subarray(l.strm.next_in-ve,l.strm.next_in),l.strstart),l.strstart+=ve,l.insert+=ve>l.w_size-l.insert?l.w_size-l.insert:ve),l.block_start=l.strstart),l.high_water<l.strstart&&(l.high_water=l.strstart),Me?Xt:W!==Ve&&W!==it&&l.strm.avail_in===0&&l.strstart===l.block_start?Yt:(q=l.window_size-l.strstart,l.strm.avail_in>q&&l.block_start>=l.w_size&&(l.block_start-=l.w_size,l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,q+=l.w_size,l.insert>l.strstart&&(l.insert=l.strstart)),q>l.strm.avail_in&&(q=l.strm.avail_in),q&&(Pi(l.strm,l.window,l.strstart,q),l.strstart+=q,l.insert+=q>l.w_size-l.insert?l.w_size-l.insert:q),l.high_water<l.strstart&&(l.high_water=l.strstart),q=l.bi_valid+42>>3,q=l.pending_buf_size-q>65535?65535:l.pending_buf_size-q,b=q>l.w_size?l.w_size:q,ee=l.strstart-l.block_start,(ee>=b||(ee||W===it)&&W!==Ve&&l.strm.avail_in===0&&ee<=q)&&(Q=ee>q?q:ee,Me=W===it&&l.strm.avail_in===0&&Q===ee?1:0,ie(l,l.block_start,Q,Me),l.block_start+=Q,Ct(l.strm)),Me?Vt:wt)},Ii=(l,W)=>{let b,Q;for(;;){if(l.lookahead<Tt){if($t(l),l.lookahead<Tt&&W===Ve)return wt;if(l.lookahead===0)break}if(b=0,l.lookahead>=at&&(l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+at-1]),b=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),b!==0&&l.strstart-b<=l.w_size-Tt&&(l.match_length=Hi(l,b)),l.match_length>=at)if(Q=Ke(l,l.strstart-l.match_start,l.match_length-at),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=at){l.match_length--;do l.strstart++,l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+at-1]),b=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart;while(--l.match_length!==0);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+1]);else Q=Ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(Q&&(Dt(l,!1),l.strm.avail_out===0))return wt}return l.insert=l.strstart<at-1?l.strstart:at-1,W===it?(Dt(l,!0),l.strm.avail_out===0?Vt:Xt):l.sym_next&&(Dt(l,!1),l.strm.avail_out===0)?wt:Yt},Qt=(l,W)=>{let b,Q,ee;for(;;){if(l.lookahead<Tt){if($t(l),l.lookahead<Tt&&W===Ve)return wt;if(l.lookahead===0)break}if(b=0,l.lookahead>=at&&(l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+at-1]),b=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=at-1,b!==0&&l.prev_length<l.max_lazy_match&&l.strstart-b<=l.w_size-Tt&&(l.match_length=Hi(l,b),l.match_length<=5&&(l.strategy===mt||l.match_length===at&&l.strstart-l.match_start>4096)&&(l.match_length=at-1)),l.prev_length>=at&&l.match_length<=l.prev_length){ee=l.strstart+l.lookahead-at,Q=Ke(l,l.strstart-1-l.prev_match,l.prev_length-at),l.lookahead-=l.prev_length-1,l.prev_length-=2;do++l.strstart<=ee&&(l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+at-1]),b=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart);while(--l.prev_length!==0);if(l.match_available=0,l.match_length=at-1,l.strstart++,Q&&(Dt(l,!1),l.strm.avail_out===0))return wt}else if(l.match_available){if(Q=Ke(l,0,l.window[l.strstart-1]),Q&&Dt(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return wt}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(Q=Ke(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<at-1?l.strstart:at-1,W===it?(Dt(l,!0),l.strm.avail_out===0?Vt:Xt):l.sym_next&&(Dt(l,!1),l.strm.avail_out===0)?wt:Yt},sn=(l,W)=>{let b,Q,ee,q;const Me=l.window;for(;;){if(l.lookahead<=Bt){if($t(l),l.lookahead<=Bt&&W===Ve)return wt;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=at&&l.strstart>0&&(ee=l.strstart-1,Q=Me[ee],Q===Me[++ee]&&Q===Me[++ee]&&Q===Me[++ee])){q=l.strstart+Bt;do;while(Q===Me[++ee]&&Q===Me[++ee]&&Q===Me[++ee]&&Q===Me[++ee]&&Q===Me[++ee]&&Q===Me[++ee]&&Q===Me[++ee]&&Q===Me[++ee]&&ee<q);l.match_length=Bt-(q-ee),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=at?(b=Ke(l,1,l.match_length-at),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(b=Ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),b&&(Dt(l,!1),l.strm.avail_out===0))return wt}return l.insert=0,W===it?(Dt(l,!0),l.strm.avail_out===0?Vt:Xt):l.sym_next&&(Dt(l,!1),l.strm.avail_out===0)?wt:Yt},an=(l,W)=>{let b;for(;;){if(l.lookahead===0&&($t(l),l.lookahead===0)){if(W===Ve)return wt;break}if(l.match_length=0,b=Ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,b&&(Dt(l,!1),l.strm.avail_out===0))return wt}return l.insert=0,W===it?(Dt(l,!0),l.strm.avail_out===0?Vt:Xt):l.sym_next&&(Dt(l,!1),l.strm.avail_out===0)?wt:Yt};function Pt(l,W,b,Q,ee){this.good_length=l,this.max_lazy=W,this.nice_length=b,this.max_chain=Q,this.func=ee}const ii=[new Pt(0,0,0,0,Ki),new Pt(4,4,8,4,Ii),new Pt(4,5,16,8,Ii),new Pt(4,6,32,32,Ii),new Pt(4,4,16,16,Qt),new Pt(8,16,32,32,Qt),new Pt(8,16,128,128,Qt),new Pt(8,32,128,256,Qt),new Pt(32,128,258,1024,Qt),new Pt(32,258,258,4096,Qt)],on=l=>{l.window_size=2*l.w_size,Ut(l.head),l.max_lazy_match=ii[l.level].max_lazy,l.good_match=ii[l.level].good_length,l.nice_match=ii[l.level].nice_length,l.max_chain_length=ii[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=at-1,l.match_available=0,l.ins_h=0};function ln(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(qr*2),this.dyn_dtree=new Uint16Array((2*Qr+1)*2),this.bl_tree=new Uint16Array((2*Jr+1)*2),Ut(this.dyn_ltree),Ut(this.dyn_dtree),Ut(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(en+1),this.heap=new Uint16Array(2*Li+1),Ut(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Li+1),Ut(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ri=l=>{if(!l)return 1;const W=l.state;return!W||W.strm!==l||W.status!==Zt&&W.status!==Ci&&W.status!==Di&&W.status!==Oi&&W.status!==Si&&W.status!==Ti&&W.status!==Nt&&W.status!==ei?1:0},Zi=l=>{if(ri(l))return kt(l,vt);l.total_in=l.total_out=0,l.data_type=di;const W=l.state;return W.pending=0,W.pending_out=0,W.wrap<0&&(W.wrap=-W.wrap),W.status=W.wrap===2?Ci:W.wrap?Zt:Nt,l.adler=W.wrap===2?0:1,W.last_flush=-2,Y(W),rt},Yi=l=>{const W=Zi(l);return W===rt&&on(l.state),W},hn=(l,W)=>ri(l)||l.state.wrap!==2?vt:(l.state.gzhead=W,rt),Xi=(l,W,b,Q,ee,q)=>{if(!l)return vt;let Me=1;if(W===_t&&(W=6),Q<0?(Me=0,Q=-Q):Q>15&&(Me=2,Q-=16),ee<1||ee>ci||b!==Gt||Q<8||Q>15||W<0||W>9||q<0||q>At||Q===8&&Me!==1)return kt(l,vt);Q===8&&(Q=9);const ve=new ln;return l.state=ve,ve.strm=l,ve.status=Zt,ve.wrap=Me,ve.gzhead=null,ve.w_bits=Q,ve.w_size=1<<ve.w_bits,ve.w_mask=ve.w_size-1,ve.hash_bits=ee+7,ve.hash_size=1<<ve.hash_bits,ve.hash_mask=ve.hash_size-1,ve.hash_shift=~~((ve.hash_bits+at-1)/at),ve.window=new Uint8Array(ve.w_size*2),ve.head=new Uint16Array(ve.hash_size),ve.prev=new Uint16Array(ve.w_size),ve.lit_bufsize=1<<ee+6,ve.pending_buf_size=ve.lit_bufsize*4,ve.pending_buf=new Uint8Array(ve.pending_buf_size),ve.sym_buf=ve.lit_bufsize,ve.sym_end=(ve.lit_bufsize-1)*3,ve.level=W,ve.strategy=q,ve.method=b,Yi(l)},fn=(l,W)=>Xi(l,W,Gt,ui,vi,Wt),dn=(l,W)=>{if(ri(l)||W>qe||W<0)return l?kt(l,vt):vt;const b=l.state;if(!l.output||l.avail_in!==0&&!l.input||b.status===ei&&W!==it)return kt(l,l.avail_out===0?St:vt);const Q=b.last_flush;if(b.last_flush=W,b.pending!==0){if(Ct(l),l.avail_out===0)return b.last_flush=-1,rt}else if(l.avail_in===0&&ji(W)<=ji(Q)&&W!==it)return kt(l,St);if(b.status===ei&&l.avail_in!==0)return kt(l,St);if(b.status===Zt&&b.wrap===0&&(b.status=Nt),b.status===Zt){let ee=Gt+(b.w_bits-8<<4)<<8,q=-1;if(b.strategy>=gt||b.level<2?q=0:b.level<6?q=1:b.level===6?q=2:q=3,ee|=q<<6,b.strstart!==0&&(ee|=tn),ee+=31-ee%31,ti(b,ee),b.strstart!==0&&(ti(b,l.adler>>>16),ti(b,l.adler&65535)),l.adler=1,b.status=Nt,Ct(l),b.pending!==0)return b.last_flush=-1,rt}if(b.status===Ci){if(l.adler=0,dt(b,31),dt(b,139),dt(b,8),b.gzhead)dt(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),dt(b,b.gzhead.time&255),dt(b,b.gzhead.time>>8&255),dt(b,b.gzhead.time>>16&255),dt(b,b.gzhead.time>>24&255),dt(b,b.level===9?2:b.strategy>=gt||b.level<2?4:0),dt(b,b.gzhead.os&255),b.gzhead.extra&&b.gzhead.extra.length&&(dt(b,b.gzhead.extra.length&255),dt(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(l.adler=D(l.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=Di;else if(dt(b,0),dt(b,0),dt(b,0),dt(b,0),dt(b,0),dt(b,b.level===9?2:b.strategy>=gt||b.level<2?4:0),dt(b,rn),b.status=Nt,Ct(l),b.pending!==0)return b.last_flush=-1,rt}if(b.status===Di){if(b.gzhead.extra){let ee=b.pending,q=(b.gzhead.extra.length&65535)-b.gzindex;for(;b.pending+q>b.pending_buf_size;){let ve=b.pending_buf_size-b.pending;if(b.pending_buf.set(b.gzhead.extra.subarray(b.gzindex,b.gzindex+ve),b.pending),b.pending=b.pending_buf_size,b.gzhead.hcrc&&b.pending>ee&&(l.adler=D(l.adler,b.pending_buf,b.pending-ee,ee)),b.gzindex+=ve,Ct(l),b.pending!==0)return b.last_flush=-1,rt;ee=0,q-=ve}let Me=new Uint8Array(b.gzhead.extra);b.pending_buf.set(Me.subarray(b.gzindex,b.gzindex+q),b.pending),b.pending+=q,b.gzhead.hcrc&&b.pending>ee&&(l.adler=D(l.adler,b.pending_buf,b.pending-ee,ee)),b.gzindex=0}b.status=Oi}if(b.status===Oi){if(b.gzhead.name){let ee=b.pending,q;do{if(b.pending===b.pending_buf_size){if(b.gzhead.hcrc&&b.pending>ee&&(l.adler=D(l.adler,b.pending_buf,b.pending-ee,ee)),Ct(l),b.pending!==0)return b.last_flush=-1,rt;ee=0}b.gzindex<b.gzhead.name.length?q=b.gzhead.name.charCodeAt(b.gzindex++)&255:q=0,dt(b,q)}while(q!==0);b.gzhead.hcrc&&b.pending>ee&&(l.adler=D(l.adler,b.pending_buf,b.pending-ee,ee)),b.gzindex=0}b.status=Si}if(b.status===Si){if(b.gzhead.comment){let ee=b.pending,q;do{if(b.pending===b.pending_buf_size){if(b.gzhead.hcrc&&b.pending>ee&&(l.adler=D(l.adler,b.pending_buf,b.pending-ee,ee)),Ct(l),b.pending!==0)return b.last_flush=-1,rt;ee=0}b.gzindex<b.gzhead.comment.length?q=b.gzhead.comment.charCodeAt(b.gzindex++)&255:q=0,dt(b,q)}while(q!==0);b.gzhead.hcrc&&b.pending>ee&&(l.adler=D(l.adler,b.pending_buf,b.pending-ee,ee))}b.status=Ti}if(b.status===Ti){if(b.gzhead.hcrc){if(b.pending+2>b.pending_buf_size&&(Ct(l),b.pending!==0))return b.last_flush=-1,rt;dt(b,l.adler&255),dt(b,l.adler>>8&255),l.adler=0}if(b.status=Nt,Ct(l),b.pending!==0)return b.last_flush=-1,rt}if(l.avail_in!==0||b.lookahead!==0||W!==Ve&&b.status!==ei){let ee=b.level===0?Ki(b,W):b.strategy===gt?an(b,W):b.strategy===Lt?sn(b,W):ii[b.level].func(b,W);if((ee===Vt||ee===Xt)&&(b.status=ei),ee===wt||ee===Vt)return l.avail_out===0&&(b.last_flush=-1),rt;if(ee===Yt&&(W===tt?je(b):W!==qe&&(ie(b,0,0,!1),W===Mt&&(Ut(b.head),b.lookahead===0&&(b.strstart=0,b.block_start=0,b.insert=0))),Ct(l),l.avail_out===0))return b.last_flush=-1,rt}return W!==it?rt:b.wrap<=0?yt:(b.wrap===2?(dt(b,l.adler&255),dt(b,l.adler>>8&255),dt(b,l.adler>>16&255),dt(b,l.adler>>24&255),dt(b,l.total_in&255),dt(b,l.total_in>>8&255),dt(b,l.total_in>>16&255),dt(b,l.total_in>>24&255)):(ti(b,l.adler>>>16),ti(b,l.adler&65535)),Ct(l),b.wrap>0&&(b.wrap=-b.wrap),b.pending!==0?rt:yt)},cn=l=>{if(ri(l))return vt;const W=l.state.status;return l.state=null,W===Nt?kt(l,It):rt},un=(l,W)=>{let b=W.length;if(ri(l))return vt;const Q=l.state,ee=Q.wrap;if(ee===2||ee===1&&Q.status!==Zt||Q.lookahead)return vt;if(ee===1&&(l.adler=we(l.adler,W,b,0)),Q.wrap=0,b>=Q.w_size){ee===0&&(Ut(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0);let $e=new Uint8Array(Q.w_size);$e.set(W.subarray(b-Q.w_size,b),0),W=$e,b=Q.w_size}const q=l.avail_in,Me=l.next_in,ve=l.input;for(l.avail_in=b,l.next_in=0,l.input=W,$t(Q);Q.lookahead>=at;){let $e=Q.strstart,le=Q.lookahead-(at-1);do Q.ins_h=Ft(Q,Q.ins_h,Q.window[$e+at-1]),Q.prev[$e&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=$e,$e++;while(--le);Q.strstart=$e,Q.lookahead=at-1,$t(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=at-1,Q.match_available=0,l.next_in=Me,l.input=ve,l.avail_in=q,Q.wrap=ee,rt};var vn=fn,gn=Xi,pn=Yi,_n=Zi,mn=hn,xn=dn,bn=cn,yn=un,En="pako deflate (from Nodeca project)",ni={deflateInit:vn,deflateInit2:gn,deflateReset:pn,deflateResetKeep:_n,deflateSetHeader:mn,deflate:xn,deflateEnd:bn,deflateSetDictionary:yn,deflateInfo:En};const Mn=(l,W)=>Object.prototype.hasOwnProperty.call(l,W);var An=function(l){const W=Array.prototype.slice.call(arguments,1);for(;W.length;){const b=W.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(const Q in b)Mn(b,Q)&&(l[Q]=b[Q])}}return l},wn=l=>{let W=0;for(let Q=0,ee=l.length;Q<ee;Q++)W+=l[Q].length;const b=new Uint8Array(W);for(let Q=0,ee=0,q=l.length;Q<q;Q++){let Me=l[Q];b.set(Me,ee),ee+=Me.length}return b},pi={assign:An,flattenChunks:wn};let $i=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{$i=!1}const si=new Uint8Array(256);for(let l=0;l<256;l++)si[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;si[254]=si[254]=1;var Ln=l=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(l);let W,b,Q,ee,q,Me=l.length,ve=0;for(ee=0;ee<Me;ee++)b=l.charCodeAt(ee),(b&64512)===55296&&ee+1<Me&&(Q=l.charCodeAt(ee+1),(Q&64512)===56320&&(b=65536+(b-55296<<10)+(Q-56320),ee++)),ve+=b<128?1:b<2048?2:b<65536?3:4;for(W=new Uint8Array(ve),q=0,ee=0;q<ve;ee++)b=l.charCodeAt(ee),(b&64512)===55296&&ee+1<Me&&(Q=l.charCodeAt(ee+1),(Q&64512)===56320&&(b=65536+(b-55296<<10)+(Q-56320),ee++)),b<128?W[q++]=b:b<2048?(W[q++]=192|b>>>6,W[q++]=128|b&63):b<65536?(W[q++]=224|b>>>12,W[q++]=128|b>>>6&63,W[q++]=128|b&63):(W[q++]=240|b>>>18,W[q++]=128|b>>>12&63,W[q++]=128|b>>>6&63,W[q++]=128|b&63);return W};const Cn=(l,W)=>{if(W<65534&&l.subarray&&$i)return String.fromCharCode.apply(null,l.length===W?l:l.subarray(0,W));let b="";for(let Q=0;Q<W;Q++)b+=String.fromCharCode(l[Q]);return b};var Dn=(l,W)=>{const b=W||l.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(l.subarray(0,W));let Q,ee;const q=new Array(b*2);for(ee=0,Q=0;Q<b;){let Me=l[Q++];if(Me<128){q[ee++]=Me;continue}let ve=si[Me];if(ve>4){q[ee++]=65533,Q+=ve-1;continue}for(Me&=ve===2?31:ve===3?15:7;ve>1&&Q<b;)Me=Me<<6|l[Q++]&63,ve--;if(ve>1){q[ee++]=65533;continue}Me<65536?q[ee++]=Me:(Me-=65536,q[ee++]=55296|Me>>10&1023,q[ee++]=56320|Me&1023)}return Cn(q,ee)},On=(l,W)=>{W=W||l.length,W>l.length&&(W=l.length);let b=W-1;for(;b>=0&&(l[b]&192)===128;)b--;return b<0||b===0?W:b+si[l[b]]>W?b:W},ai={string2buf:Ln,buf2string:Dn,utf8border:On};function Sn(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Qi=Sn;const Ji=Object.prototype.toString,{Z_NO_FLUSH:Tn,Z_SYNC_FLUSH:Pn,Z_FULL_FLUSH:In,Z_FINISH:Rn,Z_OK:_i,Z_STREAM_END:zn,Z_DEFAULT_COMPRESSION:Bn,Z_DEFAULT_STRATEGY:Un,Z_DEFLATED:Fn}=be;function oi(l){this.options=pi.assign({level:Bn,method:Fn,chunkSize:16384,windowBits:15,memLevel:8,strategy:Un},l||{});let W=this.options;W.raw&&W.windowBits>0?W.windowBits=-W.windowBits:W.gzip&&W.windowBits>0&&W.windowBits<16&&(W.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Qi,this.strm.avail_out=0;let b=ni.deflateInit2(this.strm,W.level,W.method,W.windowBits,W.memLevel,W.strategy);if(b!==_i)throw new Error(ge[b]);if(W.header&&ni.deflateSetHeader(this.strm,W.header),W.dictionary){let Q;if(typeof W.dictionary=="string"?Q=ai.string2buf(W.dictionary):Ji.call(W.dictionary)==="[object ArrayBuffer]"?Q=new Uint8Array(W.dictionary):Q=W.dictionary,b=ni.deflateSetDictionary(this.strm,Q),b!==_i)throw new Error(ge[b]);this._dict_set=!0}}oi.prototype.push=function(l,W){const b=this.strm,Q=this.options.chunkSize;let ee,q;if(this.ended)return!1;for(W===~~W?q=W:q=W===!0?Rn:Tn,typeof l=="string"?b.input=ai.string2buf(l):Ji.call(l)==="[object ArrayBuffer]"?b.input=new Uint8Array(l):b.input=l,b.next_in=0,b.avail_in=b.input.length;;){if(b.avail_out===0&&(b.output=new Uint8Array(Q),b.next_out=0,b.avail_out=Q),(q===Pn||q===In)&&b.avail_out<=6){this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;continue}if(ee=ni.deflate(b,q),ee===zn)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),ee=ni.deflateEnd(this.strm),this.onEnd(ee),this.ended=!0,ee===_i;if(b.avail_out===0){this.onData(b.output);continue}if(q>0&&b.next_out>0){this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;continue}if(b.avail_in===0)break}return!0},oi.prototype.onData=function(l){this.chunks.push(l)},oi.prototype.onEnd=function(l){l===_i&&(this.result=pi.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function Ri(l,W){const b=new oi(W);if(b.push(l,!0),b.err)throw b.msg||ge[b.err];return b.result}function Wn(l,W){return W=W||{},W.raw=!0,Ri(l,W)}function Gn(l,W){return W=W||{},W.gzip=!0,Ri(l,W)}var Nn=oi,Vn=Ri,kn=Wn,jn=Gn,Hn=be,Kn={Deflate:Nn,deflate:Vn,deflateRaw:kn,gzip:jn,constants:Hn};const mi=16209,Zn=16191;var Yn=function(W,b){let Q,ee,q,Me,ve,$e,le,Ae,ft,Xe,Fe,Qe,bt,lt,nt,ut,st,Ye,ct,Et,Je,pt,ht,et;const ot=W.state;Q=W.next_in,ht=W.input,ee=Q+(W.avail_in-5),q=W.next_out,et=W.output,Me=q-(b-W.avail_out),ve=q+(W.avail_out-257),$e=ot.dmax,le=ot.wsize,Ae=ot.whave,ft=ot.wnext,Xe=ot.window,Fe=ot.hold,Qe=ot.bits,bt=ot.lencode,lt=ot.distcode,nt=(1<<ot.lenbits)-1,ut=(1<<ot.distbits)-1;e:do{Qe<15&&(Fe+=ht[Q++]<<Qe,Qe+=8,Fe+=ht[Q++]<<Qe,Qe+=8),st=bt[Fe&nt];t:for(;;){if(Ye=st>>>24,Fe>>>=Ye,Qe-=Ye,Ye=st>>>16&255,Ye===0)et[q++]=st&65535;else if(Ye&16){ct=st&65535,Ye&=15,Ye&&(Qe<Ye&&(Fe+=ht[Q++]<<Qe,Qe+=8),ct+=Fe&(1<<Ye)-1,Fe>>>=Ye,Qe-=Ye),Qe<15&&(Fe+=ht[Q++]<<Qe,Qe+=8,Fe+=ht[Q++]<<Qe,Qe+=8),st=lt[Fe&ut];i:for(;;){if(Ye=st>>>24,Fe>>>=Ye,Qe-=Ye,Ye=st>>>16&255,Ye&16){if(Et=st&65535,Ye&=15,Qe<Ye&&(Fe+=ht[Q++]<<Qe,Qe+=8,Qe<Ye&&(Fe+=ht[Q++]<<Qe,Qe+=8)),Et+=Fe&(1<<Ye)-1,Et>$e){W.msg="invalid distance too far back",ot.mode=mi;break e}if(Fe>>>=Ye,Qe-=Ye,Ye=q-Me,Et>Ye){if(Ye=Et-Ye,Ye>Ae&&ot.sane){W.msg="invalid distance too far back",ot.mode=mi;break e}if(Je=0,pt=Xe,ft===0){if(Je+=le-Ye,Ye<ct){ct-=Ye;do et[q++]=Xe[Je++];while(--Ye);Je=q-Et,pt=et}}else if(ft<Ye){if(Je+=le+ft-Ye,Ye-=ft,Ye<ct){ct-=Ye;do et[q++]=Xe[Je++];while(--Ye);if(Je=0,ft<ct){Ye=ft,ct-=Ye;do et[q++]=Xe[Je++];while(--Ye);Je=q-Et,pt=et}}}else if(Je+=ft-Ye,Ye<ct){ct-=Ye;do et[q++]=Xe[Je++];while(--Ye);Je=q-Et,pt=et}for(;ct>2;)et[q++]=pt[Je++],et[q++]=pt[Je++],et[q++]=pt[Je++],ct-=3;ct&&(et[q++]=pt[Je++],ct>1&&(et[q++]=pt[Je++]))}else{Je=q-Et;do et[q++]=et[Je++],et[q++]=et[Je++],et[q++]=et[Je++],ct-=3;while(ct>2);ct&&(et[q++]=et[Je++],ct>1&&(et[q++]=et[Je++]))}}else if(Ye&64){W.msg="invalid distance code",ot.mode=mi;break e}else{st=lt[(st&65535)+(Fe&(1<<Ye)-1)];continue i}break}}else if(Ye&64)if(Ye&32){ot.mode=Zn;break e}else{W.msg="invalid literal/length code",ot.mode=mi;break e}else{st=bt[(st&65535)+(Fe&(1<<Ye)-1)];continue t}break}}while(Q<ee&&q<ve);ct=Qe>>3,Q-=ct,Qe-=ct<<3,Fe&=(1<<Qe)-1,W.next_in=Q,W.next_out=q,W.avail_in=Q<ee?5+(ee-Q):5-(Q-ee),W.avail_out=q<ve?257+(ve-q):257-(q-ve),ot.hold=Fe,ot.bits=Qe};const Jt=15,qi=852,er=592,tr=0,zi=1,ir=2,Xn=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Qn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Jn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var li=(l,W,b,Q,ee,q,Me,ve)=>{const $e=ve.bits;let le=0,Ae=0,ft=0,Xe=0,Fe=0,Qe=0,bt=0,lt=0,nt=0,ut=0,st,Ye,ct,Et,Je,pt=null,ht;const et=new Uint16Array(Jt+1),ot=new Uint16Array(Jt+1);let Kt=null,$r,Ai,wi;for(le=0;le<=Jt;le++)et[le]=0;for(Ae=0;Ae<Q;Ae++)et[W[b+Ae]]++;for(Fe=$e,Xe=Jt;Xe>=1&&et[Xe]===0;Xe--);if(Fe>Xe&&(Fe=Xe),Xe===0)return ee[q++]=1<<24|64<<16|0,ee[q++]=1<<24|64<<16|0,ve.bits=1,0;for(ft=1;ft<Xe&&et[ft]===0;ft++);for(Fe<ft&&(Fe=ft),lt=1,le=1;le<=Jt;le++)if(lt<<=1,lt-=et[le],lt<0)return-1;if(lt>0&&(l===tr||Xe!==1))return-1;for(ot[1]=0,le=1;le<Jt;le++)ot[le+1]=ot[le]+et[le];for(Ae=0;Ae<Q;Ae++)W[b+Ae]!==0&&(Me[ot[W[b+Ae]]++]=Ae);if(l===tr?(pt=Kt=Me,ht=20):l===zi?(pt=Xn,Kt=$n,ht=257):(pt=Qn,Kt=Jn,ht=0),ut=0,Ae=0,le=ft,Je=q,Qe=Fe,bt=0,ct=-1,nt=1<<Fe,Et=nt-1,l===zi&&nt>qi||l===ir&&nt>er)return 1;for(;;){$r=le-bt,Me[Ae]+1<ht?(Ai=0,wi=Me[Ae]):Me[Ae]>=ht?(Ai=Kt[Me[Ae]-ht],wi=pt[Me[Ae]-ht]):(Ai=32+64,wi=0),st=1<<le-bt,Ye=1<<Qe,ft=Ye;do Ye-=st,ee[Je+(ut>>bt)+Ye]=$r<<24|Ai<<16|wi|0;while(Ye!==0);for(st=1<<le-1;ut&st;)st>>=1;if(st!==0?(ut&=st-1,ut+=st):ut=0,Ae++,--et[le]===0){if(le===Xe)break;le=W[b+Me[Ae]]}if(le>Fe&&(ut&Et)!==ct){for(bt===0&&(bt=Fe),Je+=ft,Qe=le-bt,lt=1<<Qe;Qe+bt<Xe&&(lt-=et[Qe+bt],!(lt<=0));)Qe++,lt<<=1;if(nt+=1<<Qe,l===zi&&nt>qi||l===ir&&nt>er)return 1;ct=ut&Et,ee[ct]=Fe<<24|Qe<<16|Je-q|0}}return ut!==0&&(ee[Je+ut]=le-bt<<24|64<<16|0),ve.bits=Fe,0};const qn=0,rr=1,nr=2,{Z_FINISH:sr,Z_BLOCK:es,Z_TREES:xi,Z_OK:jt,Z_STREAM_END:ts,Z_NEED_DICT:is,Z_STREAM_ERROR:Ot,Z_DATA_ERROR:ar,Z_MEM_ERROR:or,Z_BUF_ERROR:rs,Z_DEFLATED:lr}=be,bi=16180,hr=16181,fr=16182,dr=16183,cr=16184,ur=16185,vr=16186,gr=16187,pr=16188,_r=16189,yi=16190,Rt=16191,Bi=16192,mr=16193,Ui=16194,xr=16195,br=16196,yr=16197,Er=16198,Ei=16199,Mi=16200,Mr=16201,Ar=16202,wr=16203,Lr=16204,Cr=16205,Fi=16206,Dr=16207,Or=16208,xt=16209,Sr=16210,Tr=16211,ns=852,ss=592,as=15,Pr=l=>(l>>>24&255)+(l>>>8&65280)+((l&65280)<<8)+((l&255)<<24);function os(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ht=l=>{if(!l)return 1;const W=l.state;return!W||W.strm!==l||W.mode<bi||W.mode>Tr?1:0},Ir=l=>{if(Ht(l))return Ot;const W=l.state;return l.total_in=l.total_out=W.total=0,l.msg="",W.wrap&&(l.adler=W.wrap&1),W.mode=bi,W.last=0,W.havedict=0,W.flags=-1,W.dmax=32768,W.head=null,W.hold=0,W.bits=0,W.lencode=W.lendyn=new Int32Array(ns),W.distcode=W.distdyn=new Int32Array(ss),W.sane=1,W.back=-1,jt},Rr=l=>{if(Ht(l))return Ot;const W=l.state;return W.wsize=0,W.whave=0,W.wnext=0,Ir(l)},zr=(l,W)=>{let b;if(Ht(l))return Ot;const Q=l.state;return W<0?(b=0,W=-W):(b=(W>>4)+5,W<48&&(W&=15)),W&&(W<8||W>15)?Ot:(Q.window!==null&&Q.wbits!==W&&(Q.window=null),Q.wrap=b,Q.wbits=W,Rr(l))},Br=(l,W)=>{if(!l)return Ot;const b=new os;l.state=b,b.strm=l,b.window=null,b.mode=bi;const Q=zr(l,W);return Q!==jt&&(l.state=null),Q},ls=l=>Br(l,as);let Ur=!0,Wi,Gi;const hs=l=>{if(Ur){Wi=new Int32Array(512),Gi=new Int32Array(32);let W=0;for(;W<144;)l.lens[W++]=8;for(;W<256;)l.lens[W++]=9;for(;W<280;)l.lens[W++]=7;for(;W<288;)l.lens[W++]=8;for(li(rr,l.lens,0,288,Wi,0,l.work,{bits:9}),W=0;W<32;)l.lens[W++]=5;li(nr,l.lens,0,32,Gi,0,l.work,{bits:5}),Ur=!1}l.lencode=Wi,l.lenbits=9,l.distcode=Gi,l.distbits=5},Fr=(l,W,b,Q)=>{let ee;const q=l.state;return q.window===null&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new Uint8Array(q.wsize)),Q>=q.wsize?(q.window.set(W.subarray(b-q.wsize,b),0),q.wnext=0,q.whave=q.wsize):(ee=q.wsize-q.wnext,ee>Q&&(ee=Q),q.window.set(W.subarray(b-Q,b-Q+ee),q.wnext),Q-=ee,Q?(q.window.set(W.subarray(b-Q,b),0),q.wnext=Q,q.whave=q.wsize):(q.wnext+=ee,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=ee))),0},fs=(l,W)=>{let b,Q,ee,q,Me,ve,$e,le,Ae,ft,Xe,Fe,Qe,bt,lt=0,nt,ut,st,Ye,ct,Et,Je,pt;const ht=new Uint8Array(4);let et,ot;const Kt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ht(l)||!l.output||!l.input&&l.avail_in!==0)return Ot;b=l.state,b.mode===Rt&&(b.mode=Bi),Me=l.next_out,ee=l.output,$e=l.avail_out,q=l.next_in,Q=l.input,ve=l.avail_in,le=b.hold,Ae=b.bits,ft=ve,Xe=$e,pt=jt;e:for(;;)switch(b.mode){case bi:if(b.wrap===0){b.mode=Bi;break}for(;Ae<16;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(b.wrap&2&&le===35615){b.wbits===0&&(b.wbits=15),b.check=0,ht[0]=le&255,ht[1]=le>>>8&255,b.check=D(b.check,ht,2,0),le=0,Ae=0,b.mode=hr;break}if(b.head&&(b.head.done=!1),!(b.wrap&1)||(((le&255)<<8)+(le>>8))%31){l.msg="incorrect header check",b.mode=xt;break}if((le&15)!==lr){l.msg="unknown compression method",b.mode=xt;break}if(le>>>=4,Ae-=4,Je=(le&15)+8,b.wbits===0&&(b.wbits=Je),Je>15||Je>b.wbits){l.msg="invalid window size",b.mode=xt;break}b.dmax=1<<b.wbits,b.flags=0,l.adler=b.check=1,b.mode=le&512?_r:Rt,le=0,Ae=0;break;case hr:for(;Ae<16;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(b.flags=le,(b.flags&255)!==lr){l.msg="unknown compression method",b.mode=xt;break}if(b.flags&57344){l.msg="unknown header flags set",b.mode=xt;break}b.head&&(b.head.text=le>>8&1),b.flags&512&&b.wrap&4&&(ht[0]=le&255,ht[1]=le>>>8&255,b.check=D(b.check,ht,2,0)),le=0,Ae=0,b.mode=fr;case fr:for(;Ae<32;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}b.head&&(b.head.time=le),b.flags&512&&b.wrap&4&&(ht[0]=le&255,ht[1]=le>>>8&255,ht[2]=le>>>16&255,ht[3]=le>>>24&255,b.check=D(b.check,ht,4,0)),le=0,Ae=0,b.mode=dr;case dr:for(;Ae<16;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}b.head&&(b.head.xflags=le&255,b.head.os=le>>8),b.flags&512&&b.wrap&4&&(ht[0]=le&255,ht[1]=le>>>8&255,b.check=D(b.check,ht,2,0)),le=0,Ae=0,b.mode=cr;case cr:if(b.flags&1024){for(;Ae<16;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}b.length=le,b.head&&(b.head.extra_len=le),b.flags&512&&b.wrap&4&&(ht[0]=le&255,ht[1]=le>>>8&255,b.check=D(b.check,ht,2,0)),le=0,Ae=0}else b.head&&(b.head.extra=null);b.mode=ur;case ur:if(b.flags&1024&&(Fe=b.length,Fe>ve&&(Fe=ve),Fe&&(b.head&&(Je=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(Q.subarray(q,q+Fe),Je)),b.flags&512&&b.wrap&4&&(b.check=D(b.check,Q,Fe,q)),ve-=Fe,q+=Fe,b.length-=Fe),b.length))break e;b.length=0,b.mode=vr;case vr:if(b.flags&2048){if(ve===0)break e;Fe=0;do Je=Q[q+Fe++],b.head&&Je&&b.length<65536&&(b.head.name+=String.fromCharCode(Je));while(Je&&Fe<ve);if(b.flags&512&&b.wrap&4&&(b.check=D(b.check,Q,Fe,q)),ve-=Fe,q+=Fe,Je)break e}else b.head&&(b.head.name=null);b.length=0,b.mode=gr;case gr:if(b.flags&4096){if(ve===0)break e;Fe=0;do Je=Q[q+Fe++],b.head&&Je&&b.length<65536&&(b.head.comment+=String.fromCharCode(Je));while(Je&&Fe<ve);if(b.flags&512&&b.wrap&4&&(b.check=D(b.check,Q,Fe,q)),ve-=Fe,q+=Fe,Je)break e}else b.head&&(b.head.comment=null);b.mode=pr;case pr:if(b.flags&512){for(;Ae<16;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(b.wrap&4&&le!==(b.check&65535)){l.msg="header crc mismatch",b.mode=xt;break}le=0,Ae=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),l.adler=b.check=0,b.mode=Rt;break;case _r:for(;Ae<32;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}l.adler=b.check=Pr(le),le=0,Ae=0,b.mode=yi;case yi:if(b.havedict===0)return l.next_out=Me,l.avail_out=$e,l.next_in=q,l.avail_in=ve,b.hold=le,b.bits=Ae,is;l.adler=b.check=1,b.mode=Rt;case Rt:if(W===es||W===xi)break e;case Bi:if(b.last){le>>>=Ae&7,Ae-=Ae&7,b.mode=Fi;break}for(;Ae<3;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}switch(b.last=le&1,le>>>=1,Ae-=1,le&3){case 0:b.mode=mr;break;case 1:if(hs(b),b.mode=Ei,W===xi){le>>>=2,Ae-=2;break e}break;case 2:b.mode=br;break;case 3:l.msg="invalid block type",b.mode=xt}le>>>=2,Ae-=2;break;case mr:for(le>>>=Ae&7,Ae-=Ae&7;Ae<32;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if((le&65535)!==(le>>>16^65535)){l.msg="invalid stored block lengths",b.mode=xt;break}if(b.length=le&65535,le=0,Ae=0,b.mode=Ui,W===xi)break e;case Ui:b.mode=xr;case xr:if(Fe=b.length,Fe){if(Fe>ve&&(Fe=ve),Fe>$e&&(Fe=$e),Fe===0)break e;ee.set(Q.subarray(q,q+Fe),Me),ve-=Fe,q+=Fe,$e-=Fe,Me+=Fe,b.length-=Fe;break}b.mode=Rt;break;case br:for(;Ae<14;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(b.nlen=(le&31)+257,le>>>=5,Ae-=5,b.ndist=(le&31)+1,le>>>=5,Ae-=5,b.ncode=(le&15)+4,le>>>=4,Ae-=4,b.nlen>286||b.ndist>30){l.msg="too many length or distance symbols",b.mode=xt;break}b.have=0,b.mode=yr;case yr:for(;b.have<b.ncode;){for(;Ae<3;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}b.lens[Kt[b.have++]]=le&7,le>>>=3,Ae-=3}for(;b.have<19;)b.lens[Kt[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,et={bits:b.lenbits},pt=li(qn,b.lens,0,19,b.lencode,0,b.work,et),b.lenbits=et.bits,pt){l.msg="invalid code lengths set",b.mode=xt;break}b.have=0,b.mode=Er;case Er:for(;b.have<b.nlen+b.ndist;){for(;lt=b.lencode[le&(1<<b.lenbits)-1],nt=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(nt<=Ae);){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(st<16)le>>>=nt,Ae-=nt,b.lens[b.have++]=st;else{if(st===16){for(ot=nt+2;Ae<ot;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(le>>>=nt,Ae-=nt,b.have===0){l.msg="invalid bit length repeat",b.mode=xt;break}Je=b.lens[b.have-1],Fe=3+(le&3),le>>>=2,Ae-=2}else if(st===17){for(ot=nt+3;Ae<ot;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}le>>>=nt,Ae-=nt,Je=0,Fe=3+(le&7),le>>>=3,Ae-=3}else{for(ot=nt+7;Ae<ot;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}le>>>=nt,Ae-=nt,Je=0,Fe=11+(le&127),le>>>=7,Ae-=7}if(b.have+Fe>b.nlen+b.ndist){l.msg="invalid bit length repeat",b.mode=xt;break}for(;Fe--;)b.lens[b.have++]=Je}}if(b.mode===xt)break;if(b.lens[256]===0){l.msg="invalid code -- missing end-of-block",b.mode=xt;break}if(b.lenbits=9,et={bits:b.lenbits},pt=li(rr,b.lens,0,b.nlen,b.lencode,0,b.work,et),b.lenbits=et.bits,pt){l.msg="invalid literal/lengths set",b.mode=xt;break}if(b.distbits=6,b.distcode=b.distdyn,et={bits:b.distbits},pt=li(nr,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,et),b.distbits=et.bits,pt){l.msg="invalid distances set",b.mode=xt;break}if(b.mode=Ei,W===xi)break e;case Ei:b.mode=Mi;case Mi:if(ve>=6&&$e>=258){l.next_out=Me,l.avail_out=$e,l.next_in=q,l.avail_in=ve,b.hold=le,b.bits=Ae,Yn(l,Xe),Me=l.next_out,ee=l.output,$e=l.avail_out,q=l.next_in,Q=l.input,ve=l.avail_in,le=b.hold,Ae=b.bits,b.mode===Rt&&(b.back=-1);break}for(b.back=0;lt=b.lencode[le&(1<<b.lenbits)-1],nt=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(nt<=Ae);){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(ut&&!(ut&240)){for(Ye=nt,ct=ut,Et=st;lt=b.lencode[Et+((le&(1<<Ye+ct)-1)>>Ye)],nt=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(Ye+nt<=Ae);){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}le>>>=Ye,Ae-=Ye,b.back+=Ye}if(le>>>=nt,Ae-=nt,b.back+=nt,b.length=st,ut===0){b.mode=Cr;break}if(ut&32){b.back=-1,b.mode=Rt;break}if(ut&64){l.msg="invalid literal/length code",b.mode=xt;break}b.extra=ut&15,b.mode=Mr;case Mr:if(b.extra){for(ot=b.extra;Ae<ot;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}b.length+=le&(1<<b.extra)-1,le>>>=b.extra,Ae-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=Ar;case Ar:for(;lt=b.distcode[le&(1<<b.distbits)-1],nt=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(nt<=Ae);){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(!(ut&240)){for(Ye=nt,ct=ut,Et=st;lt=b.distcode[Et+((le&(1<<Ye+ct)-1)>>Ye)],nt=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(Ye+nt<=Ae);){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}le>>>=Ye,Ae-=Ye,b.back+=Ye}if(le>>>=nt,Ae-=nt,b.back+=nt,ut&64){l.msg="invalid distance code",b.mode=xt;break}b.offset=st,b.extra=ut&15,b.mode=wr;case wr:if(b.extra){for(ot=b.extra;Ae<ot;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}b.offset+=le&(1<<b.extra)-1,le>>>=b.extra,Ae-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){l.msg="invalid distance too far back",b.mode=xt;break}b.mode=Lr;case Lr:if($e===0)break e;if(Fe=Xe-$e,b.offset>Fe){if(Fe=b.offset-Fe,Fe>b.whave&&b.sane){l.msg="invalid distance too far back",b.mode=xt;break}Fe>b.wnext?(Fe-=b.wnext,Qe=b.wsize-Fe):Qe=b.wnext-Fe,Fe>b.length&&(Fe=b.length),bt=b.window}else bt=ee,Qe=Me-b.offset,Fe=b.length;Fe>$e&&(Fe=$e),$e-=Fe,b.length-=Fe;do ee[Me++]=bt[Qe++];while(--Fe);b.length===0&&(b.mode=Mi);break;case Cr:if($e===0)break e;ee[Me++]=b.length,$e--,b.mode=Mi;break;case Fi:if(b.wrap){for(;Ae<32;){if(ve===0)break e;ve--,le|=Q[q++]<<Ae,Ae+=8}if(Xe-=$e,l.total_out+=Xe,b.total+=Xe,b.wrap&4&&Xe&&(l.adler=b.check=b.flags?D(b.check,ee,Xe,Me-Xe):we(b.check,ee,Xe,Me-Xe)),Xe=$e,b.wrap&4&&(b.flags?le:Pr(le))!==b.check){l.msg="incorrect data check",b.mode=xt;break}le=0,Ae=0}b.mode=Dr;case Dr:if(b.wrap&&b.flags){for(;Ae<32;){if(ve===0)break e;ve--,le+=Q[q++]<<Ae,Ae+=8}if(b.wrap&4&&le!==(b.total&4294967295)){l.msg="incorrect length check",b.mode=xt;break}le=0,Ae=0}b.mode=Or;case Or:pt=ts;break e;case xt:pt=ar;break e;case Sr:return or;case Tr:default:return Ot}return l.next_out=Me,l.avail_out=$e,l.next_in=q,l.avail_in=ve,b.hold=le,b.bits=Ae,(b.wsize||Xe!==l.avail_out&&b.mode<xt&&(b.mode<Fi||W!==sr))&&Fr(l,l.output,l.next_out,Xe-l.avail_out),ft-=l.avail_in,Xe-=l.avail_out,l.total_in+=ft,l.total_out+=Xe,b.total+=Xe,b.wrap&4&&Xe&&(l.adler=b.check=b.flags?D(b.check,ee,Xe,l.next_out-Xe):we(b.check,ee,Xe,l.next_out-Xe)),l.data_type=b.bits+(b.last?64:0)+(b.mode===Rt?128:0)+(b.mode===Ei||b.mode===Ui?256:0),(ft===0&&Xe===0||W===sr)&&pt===jt&&(pt=rs),pt},ds=l=>{if(Ht(l))return Ot;let W=l.state;return W.window&&(W.window=null),l.state=null,jt},cs=(l,W)=>{if(Ht(l))return Ot;const b=l.state;return b.wrap&2?(b.head=W,W.done=!1,jt):Ot},us=(l,W)=>{const b=W.length;let Q,ee,q;return Ht(l)||(Q=l.state,Q.wrap!==0&&Q.mode!==yi)?Ot:Q.mode===yi&&(ee=1,ee=we(ee,W,b,0),ee!==Q.check)?ar:(q=Fr(l,W,b,b),q?(Q.mode=Sr,or):(Q.havedict=1,jt))};var vs=Rr,gs=zr,ps=Ir,_s=ls,ms=Br,xs=fs,bs=ds,ys=cs,Es=us,Ms="pako inflate (from Nodeca project)",zt={inflateReset:vs,inflateReset2:gs,inflateResetKeep:ps,inflateInit:_s,inflateInit2:ms,inflate:xs,inflateEnd:bs,inflateGetHeader:ys,inflateSetDictionary:Es,inflateInfo:Ms};function As(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var ws=As;const Wr=Object.prototype.toString,{Z_NO_FLUSH:Ls,Z_FINISH:Cs,Z_OK:hi,Z_STREAM_END:Ni,Z_NEED_DICT:Vi,Z_STREAM_ERROR:Ds,Z_DATA_ERROR:Gr,Z_MEM_ERROR:Os}=be;function fi(l){this.options=pi.assign({chunkSize:65536,windowBits:15,to:""},l||{});const W=this.options;W.raw&&W.windowBits>=0&&W.windowBits<16&&(W.windowBits=-W.windowBits,W.windowBits===0&&(W.windowBits=-15)),W.windowBits>=0&&W.windowBits<16&&!(l&&l.windowBits)&&(W.windowBits+=32),W.windowBits>15&&W.windowBits<48&&(W.windowBits&15||(W.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Qi,this.strm.avail_out=0;let b=zt.inflateInit2(this.strm,W.windowBits);if(b!==hi)throw new Error(ge[b]);if(this.header=new ws,zt.inflateGetHeader(this.strm,this.header),W.dictionary&&(typeof W.dictionary=="string"?W.dictionary=ai.string2buf(W.dictionary):Wr.call(W.dictionary)==="[object ArrayBuffer]"&&(W.dictionary=new Uint8Array(W.dictionary)),W.raw&&(b=zt.inflateSetDictionary(this.strm,W.dictionary),b!==hi)))throw new Error(ge[b])}fi.prototype.push=function(l,W){const b=this.strm,Q=this.options.chunkSize,ee=this.options.dictionary;let q,Me,ve;if(this.ended)return!1;for(W===~~W?Me=W:Me=W===!0?Cs:Ls,Wr.call(l)==="[object ArrayBuffer]"?b.input=new Uint8Array(l):b.input=l,b.next_in=0,b.avail_in=b.input.length;;){for(b.avail_out===0&&(b.output=new Uint8Array(Q),b.next_out=0,b.avail_out=Q),q=zt.inflate(b,Me),q===Vi&&ee&&(q=zt.inflateSetDictionary(b,ee),q===hi?q=zt.inflate(b,Me):q===Gr&&(q=Vi));b.avail_in>0&&q===Ni&&b.state.wrap>0&&l[b.next_in]!==0;)zt.inflateReset(b),q=zt.inflate(b,Me);switch(q){case Ds:case Gr:case Vi:case Os:return this.onEnd(q),this.ended=!0,!1}if(ve=b.avail_out,b.next_out&&(b.avail_out===0||q===Ni))if(this.options.to==="string"){let $e=ai.utf8border(b.output,b.next_out),le=b.next_out-$e,Ae=ai.buf2string(b.output,$e);b.next_out=le,b.avail_out=Q-le,le&&b.output.set(b.output.subarray($e,$e+le),0),this.onData(Ae)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(!(q===hi&&ve===0)){if(q===Ni)return q=zt.inflateEnd(this.strm),this.onEnd(q),this.ended=!0,!0;if(b.avail_in===0)break}}return!0},fi.prototype.onData=function(l){this.chunks.push(l)},fi.prototype.onEnd=function(l){l===hi&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=pi.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function ki(l,W){const b=new fi(W);if(b.push(l),b.err)throw b.msg||ge[b.err];return b.result}function Ss(l,W){return W=W||{},W.raw=!0,ki(l,W)}var Ts=fi,Ps=ki,Is=Ss,Rs=ki,zs=be,Bs={Inflate:Ts,inflate:Ps,inflateRaw:Is,ungzip:Rs,constants:zs};const{Deflate:Us,deflate:Fs,deflateRaw:Ws,gzip:Gs}=Kn,{Inflate:Ns,inflate:Vs,inflateRaw:ks,ungzip:js}=Bs;var Nr=Us,Vr=Fs,kr=Ws,jr=Gs,Hr=Ns,Kr=Vs,Zr=ks,Yr=js,Xr=be,Hs={Deflate:Nr,deflate:Vr,deflateRaw:kr,gzip:jr,Inflate:Hr,inflate:Kr,inflateRaw:Zr,ungzip:Yr,constants:Xr}}},__webpack_module_cache__={};function __webpack_require__($){var T=__webpack_module_cache__[$];if(T!==void 0)return T.exports;var f=__webpack_module_cache__[$]={exports:{}};return __webpack_modules__[$].call(f.exports,f,f.exports,__webpack_require__),f.exports}__webpack_require__.n=$=>{var T=$&&$.__esModule?()=>$.default:()=>$;return __webpack_require__.d(T,{a:T}),T},__webpack_require__.d=($,T)=>{for(var f in T)__webpack_require__.o(T,f)&&!__webpack_require__.o($,f)&&Object.defineProperty($,f,{enumerable:!0,get:T[f]})},__webpack_require__.o=($,T)=>Object.prototype.hasOwnProperty.call($,T),__webpack_require__.r=$=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty($,Symbol.toStringTag,{value:"Module"}),Object.defineProperty($,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})())})(_3Dmol);var _3DmolExports=_3Dmol.exports;export{_3DmolExports as _,commonjsGlobal as c,getDefaultExportFromCjs as g};
